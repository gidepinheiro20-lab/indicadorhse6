<!doctype html>
<!-- 
  SISTEMA INDICADOR DE HSE - VERSÃO COMPLETA
  Link de acesso: https://gidepinheiro20-lab.github.io/indicadorhse6/
  Última atualização: 07/02/2026
  Ferramentas: RAS, CPT, Inspeção HSE, Frequência, Colaboradores
-->
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Prevent caching to force clients (mobile) to fetch latest version -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>Indicador de HSE - Sistema Completo</title>
    <!-- Carregamento de configuraÃ§Ã£o da API -->
    <script src="config.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <style>
      /* Loading Screen */
      #loading-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        transition: opacity 0.5s ease-out;
      }
      #loading-screen.hidden {
        opacity: 0;
        pointer-events: none;
      }
      .loading-logo {
        width: 100px;
        height: 100px;
        background: #fff;
        border-radius: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 48px;
        font-weight: bold;
        color: #667eea;
        margin-bottom: 30px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.2);
      }
      .loading-text {
        color: #fff;
        font-size: 24px;
        font-weight: 600;
        margin-bottom: 10px;
      }
      .loading-subtext {
        color: rgba(255,255,255,0.8);
        font-size: 14px;
        margin-bottom: 30px;
      }
      .loading-spinner {
        width: 50px;
        height: 50px;
        border: 4px solid rgba(255,255,255,0.3);
        border-top-color: #fff;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        to { transform: rotate(360deg); }
      }
    </style>

    <style>
      :root{
      --sidebar-width:340px;
        --bg:#ffffff;
        --muted:#7a869a;
        --accent:#2b6cb0;
        --border:#e6edf3;
      }

      *{box-sizing:border-box}
      body{margin:0;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; background:var(--bg); color:#12263f}

      /* Layout */
      .app{
        display:flex;
        min-height:100vh;
      }

      /* Sidebar */
      .sidebar{
        width:var(--sidebar-width);
        border-right:1px solid var(--border);
        padding:28px 18px;
        background:linear-gradient(180deg,#fbfdff 0%, #f6fbff 100%);
        position:sticky;
        top:0;
        align-self:flex-start;
      }

      .brand{
        display:flex;gap:12px;align-items:center;margin-bottom:28px
      }

      .brand .logo{
        width:44px;height:44px;background:var(--accent);border-radius:8px;display:inline-grid;place-items:center;color:#fff;font-weight:700
      }

      .brand .title{font-weight:700}
      .brand .subtitle{display:block;color:var(--muted);font-size:12px;margin-top:2px}

      .section-title{font-size:12px;color:var(--muted);margin:18px 0 8px}

      .nav{list-style:none;padding:0;margin:0}
      .nav li{margin:6px 0}
      .nav a{
        display:flex;align-items:center;gap:12px;padding:10px;border-radius:8px;color:#102a43;text-decoration:none;font-size:15px
      }
      .nav a .icon{width:18px;height:18px;display:inline-block;flex:0 0 18px;color:var(--muted)}

      .nav a:hover{background:#f0f6fb}

      /* content placeholder */
      .main{
        flex:1;padding:28px
      }

      /* responsive: mobile-friendly layout */
      @media (max-width:720px){
        .app{
          flex-direction:column;
        }
        .sidebar{
          width:100%;
          position:relative;
          padding:16px;
          border-right:none;
          border-bottom:1px solid var(--border);
          transition: all 0.3s ease;
        }
        .sidebar.hidden-mobile{
          display:none;
        }
        .brand{
          margin-bottom:16px;
        }
        .brand .logo{
          width:36px;
          height:36px;
          font-size:14px;
        }
        .brand .title{
          font-size:16px;
        }
        .brand .subtitle{
          font-size:11px;
        }
        .section-title{
          font-size:11px;
          margin:12px 0 6px;
        }
        .nav{
          display:flex;
          flex-wrap:wrap;
          gap:8px;
        }
        .nav li{
          margin:0;
          flex:1 1 auto;
          min-width:140px;
        }
        .nav a{
          padding:8px 12px;
          font-size:13px;
          justify-content:flex-start;
          background:#fff;
          border:1px solid var(--border);
          border-radius:6px;
          transition: all 0.2s ease;
        }
        .nav a .icon{
          width:16px;
          height:16px;
          flex:0 0 16px;
        }
        .nav a:hover{
          background:#f8fafc;
        }
        .main{
          padding:16px;
        }
        .main.full-screen-mobile{
          padding:0;
          position:relative;
        }
        .main.full-screen-mobile #nova-ras{
          max-width:100%;
          margin:0;
          padding:16px;
        }
        .main.full-screen-mobile #cadastro-usuario{
          max-width:100%;
          padding:16px;
        }
        /* BotÃ£o para voltar ao menu principal no mobile */
        .back-to-menu{
          display:none;
          position:fixed;
          top:16px;
          left:16px;
          z-index:1000;
          background:var(--accent);
          color:#fff;
          border:none;
          border-radius:50%;
          width:48px;
          height:48px;
          font-size:18px;
          cursor:pointer;
          box-shadow:0 2px 8px rgba(0,0,0,0.15);
          transition: all 0.2s ease;
        }
        .back-to-menu:hover{
          transform:scale(1.05);
        }
        .back-to-menu.show{
          display:block;
        }
      }
      
      /* Para telas muito pequenas (menos de 480px) */
      @media (max-width:480px){
        .nav li{
          min-width:120px;
        }
        .nav a{
          font-size:12px;
          padding:6px 8px;
        }
      }
      
      /* Estilos para cards do dashboard */
      .dashboard-card {
        transition: transform 0.2s, box-shadow 0.2s;
      }
      
      .dashboard-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 16px rgba(0,0,0,0.15) !important;
      }
      
      .dashboard-tool-card {
        transition: all 0.2s;
      }
      
      .dashboard-tool-card:hover {
        transform: translateY(-2px);
        border-color: #3b82f6 !important;
        box-shadow: 0 8px 16px rgba(59, 130, 246, 0.1) !important;
      }
      
      /* Estilos para anexos */
      .secao-anexos {
        margin-top: 20px;
        padding: 20px;
        background: #f8fafc;
        border-radius: 8px;
        border: 1px solid #e2e8f0;
      }
      
      .grid-fotos {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
        gap: 12px;
        margin-top: 12px;
      }
      
      .item-foto {
        position: relative;
        aspect-ratio: 1;
        border-radius: 8px;
        overflow: hidden;
        cursor: pointer;
        transition: transform 0.2s ease;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      }
      
      .item-foto:hover {
        transform: scale(1.05);
      }
      
      .item-foto img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
      
      .nome-foto {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(transparent, rgba(0,0,0,0.8));
        color: white;
        padding: 8px 6px 4px;
        font-size: 0.75rem;
        text-align: center;
        word-break: break-word;
      }
      
      .lista-documentos {
        margin-top: 12px;
      }
      
      .item-documento {
        display: flex;
        align-items: center;
        padding: 12px;
        margin-bottom: 8px;
        background: white;
        border: 1px solid #e2e8f0;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s ease;
      }
      
      .item-documento:hover {
        background: #f1f5f9;
        border-color: #cbd5e1;
        transform: translateX(4px);
      }
      
      .icone-documento {
        width: 32px;
        height: 32px;
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        font-size: 0.75rem;
        margin-right: 12px;
        flex-shrink: 0;
      }
      
      .info-documento {
        flex-grow: 1;
        min-width: 0;
      }
      
      .nome-documento {
        font-weight: 500;
        color: #1f2937;
        margin-bottom: 2px;
        word-break: break-word;
      }
      
      .tipo-documento {
        font-size: 0.875rem;
        color: #6b7280;
      }
    </style>
  </head>
  <body>
    <!-- Loading Screen -->
    <div id="loading-screen">
      <div class="loading-logo">HSE</div>
      <div class="loading-text">Indicador de HSE</div>
      <div class="loading-subtext">Carregando sistema...</div>
      <div class="loading-spinner"></div>
    </div>

    <div class="app" id="app-sistema">
      <aside class="sidebar" aria-label="Barra lateral">
        <div class="brand">
          <div class="logo">HSE</div>
          <div>
            <div class="title">Indicador de HSE</div>
            <div class="subtitle">Gestão de Ferramentas</div>
          </div>
        </div>
        <!-- Link removido a pedido do usuÃ¡rio -->
        <div class="section">
          <div class="section-title">PRINCIPAL</div>
          <ul class="nav">
            <li><a href="#dashboard"><span class="icon" aria-hidden="true"></span><span class="label">Dashboard</span></a></li>
            <li><a href="#relatorios"><span class="icon" aria-hidden="true"></span><span class="label">Relatórios</span></a></li>
            <li><a href="#empresa"><span class="icon" aria-hidden="true"></span><span class="label">Empresa</span></a></li>
            <li><a href="#funcionarios"><span class="icon" aria-hidden="true"></span><span class="label">Novo Colaborador</span></a></li>
            <li><a href="#frequencia"><span class="icon" aria-hidden="true"></span><span class="label">Frequência</span></a></li>
            <li><a href="#usuario"><span class="icon" aria-hidden="true"></span><span class="label">Usuário</span></a></li>
          </ul>
        </div>
        <div class="section">
          <div class="section-title">FERRAMENTAS</div>
          <ul class="nav">
            <li><a href="#ras"><span class="icon" aria-hidden="true"></span><span class="label">RAS</span></a></li>
            <li><a href="#cpt"><span class="icon" aria-hidden="true"></span><span class="label">CPT</span></a></li>
            <li><a href="#inspecao"><span class="icon" aria-hidden="true"></span><span class="label">Inspeção de HSE</span></a></li>
            <li><a href="#moc"><span class="icon" aria-hidden="true"> ï¸</span><span class="label">WOC MDHO</span></a></li>
            <li><a href="#melhorias"><span class="icon" aria-hidden="true"></span><span class="label">Melhorias</span></a></li>
            <li><a href="#reuniao"><span class="icon" aria-hidden="true"></span><span class="label">Reunião Mensal</span></a></li>
            <li><a href="#art"><span class="icon" aria-hidden="true"></span><span class="label">ART</span></a></li>
            <li><a href="#checklist"><span class="icon" aria-hidden="true"></span><span class="label">Check List Fácil</span></a></li>
          </ul>
        </div>
      </aside>
      <main class="main">
        <button class="back-to-menu" id="back-to-menu" title="Voltar ao menu"></button>
        <div id="conteudo-principal"></div>
        <div id="nova-ras" style="display:none;max-width:none;margin:0;background:#f5f7fa;min-height:100vh;padding:0;">
          <!-- Cabeçalho Principal RAS -->
          <div style="background:linear-gradient(135deg, #16a085 0%, #2ecc71 100%);color:#fff;padding:32px 24px;border-radius:0;">
            <div style="max-width:1200px;margin:0 auto;">
              <div style="display:flex;align-items:center;gap:16px;margin-bottom:12px;">
                <div style="font-size:2rem;"></div>
                <h1 style="margin:0;font-size:2rem;font-weight:700;">RAS - Reunião de Análise de Segurança</h1>
              </div>
              <p style="margin:0;font-size:1.1rem;opacity:0.9;">Sistema de registros e controle de reuniões de segurança</p>
            </div>
          </div>
          
          <!-- Menu de Ações RAS -->
          <div style="background:#fff;border-bottom:2px solid #e2e8f0;padding:20px 24px;">
            <div style="max-width:1200px;margin:0 auto;display:flex;gap:12px;flex-wrap:wrap;">
              <button id="ras-nova-reuniao" style="background:#16a085;color:#fff;border:none;padding:12px 20px;border-radius:8px;font-size:1rem;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:8px;transition:all 0.2s;">
                <span style="font-size:1.2rem;"></span> Nova Reunião
              </button>
              <button id="ras-historico" style="background:#3498db;color:#fff;border:none;padding:12px 20px;border-radius:8px;font-size:1rem;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:8px;transition:all 0.2s;">
                <span style="font-size:1.2rem;"></span> Histórico
              </button>
              <button id="ras-relatorios" style="background:#9b59b6;color:#fff;border:none;padding:12px 20px;border-radius:8px;font-size:1rem;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:8px;transition:all 0.2s;">
                <span style="font-size:1.2rem;"></span> Relatórios
              </button>
              <button id="ras-configuracoes" style="background:#e74c3c;color:#fff;border:none;padding:12px 20px;border-radius:8px;font-size:1rem;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:8px;transition:all 0.2s;">
                <span style="font-size:1.2rem;"></span> Configurações
              </button>
            </div>
          </div>
          
          <!-- Conteúdo Principal -->
          <div style="max-width:1200px;margin:0 auto;padding:24px;">
            
            <!-- Lista de RAS Registradas -->
            <div id="ras-lista-reunioes" style="background:#fff;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.1);margin-bottom:24px;">
              <div style="padding:20px 24px;border-bottom:1px solid #e2e8f0;">
                <h2 style="margin:0;font-size:1.4rem;font-weight:700;color:#2d3748;">Registros de RAS</h2>
              </div>
              
              <div style="overflow-x:auto;">
                <table style="width:100%;border-collapse:collapse;">
                  <thead>
                    <tr style="background:#f7fafc;">
                      <th style="padding:12px 16px;text-align:left;font-weight:600;color:#4a5568;border-bottom:2px solid #e2e8f0;">Data</th>
                      <th style="padding:12px 16px;text-align:left;font-weight:600;color:#4a5568;border-bottom:2px solid #e2e8f0;">Empresa</th>
                      <th style="padding:12px 16px;text-align:left;font-weight:600;color:#4a5568;border-bottom:2px solid #e2e8f0;">Efetivo</th>
                      <th style="padding:12px 16px;text-align:left;font-weight:600;color:#4a5568;border-bottom:2px solid #e2e8f0;">Alto Risco</th>
                      <th style="padding:12px 16px;text-align:left;font-weight:600;color:#4a5568;border-bottom:2px solid #e2e8f0;">TARD-C</th>
                      <th style="padding:12px 16px;text-align:left;font-weight:600;color:#4a5568;border-bottom:2px solid #e2e8f0;">Status</th>
                      <th style="padding:12px 16px;text-align:left;font-weight:600;color:#4a5568;border-bottom:2px solid #e2e8f0;">Ações</th>
                    </tr>
                  </thead>
                  <tbody id="ras-tbody">
                    <!-- Registros serão carregados dinamicamente -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          
          <!-- Formulário Nova RAS (inicialmente oculto) -->
          <div id="ras-formulario-container" style="display:none;max-width:1200px;margin:0 auto;padding:24px;">
            <!-- Etapa 1: Informações Básicas -->
            <div id="ras-etapa-1">
              <div style="background:#fff;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.1);margin-bottom:24px;">
                <div style="background:linear-gradient(135deg, #3498db 0%, #2980b9 100%);color:#fff;padding:20px 24px;border-radius:12px 12px 0 0;">
                  <div style="display:flex;align-items:center;gap:12px;margin-bottom:8px;">
                    <div style="font-size:1.5rem;"></div>
                    <h3 style="margin:0;font-size:1.4rem;font-weight:700;">Nova RAS - Etapa 1 de 6</h3>
                  </div>
                  <p style="margin:0;opacity:0.9;">Informações Básicas da Reunião</p>
                </div>
                
                <form id="form-ras" autocomplete="off" style="padding:24px;">
              <div style="text-align:center;margin-bottom:18px">
                <div style="font-size:1.3rem;font-weight:700;">Informações Básicas</div>
                <div style="color:#888;font-size:1rem;">Preencha os dados principais da reunião</div>
              </div>
              <div style="margin-bottom:18px">
                <label style="font-weight:600;display:block;margin-bottom:4px">Empresa</label>
                <select id="ras-empresa" required style="width:100%;padding:8px 10px;font-size:1rem;border-radius:6px;border:1px solid #bbb">
                  <option value="">Selecione a empresa</option>
                  <!-- Opções carregadas dinamicamente -->
                </select>
              </div>
              <div style="display:flex;gap:12px;margin-bottom:18px;flex-wrap:wrap">
                <div style="flex:1 1 120px">
                  <label style="font-weight:600;display:block;margin-bottom:4px">Data</label>
                  <input type="date" id="ras-data" required style="width:100%;padding:8px 10px;font-size:1rem;border-radius:6px;border:1px solid #bbb">
                </div>
                <div style="flex:1 1 100px">
                  <label style="font-weight:600;display:block;margin-bottom:4px">Início</label>
                  <input type="time" id="ras-inicio" required style="width:100%;padding:8px 10px;font-size:1rem;border-radius:6px;border:1px solid #bbb">
                </div>
                <div style="flex:1 1 100px">
                  <label style="font-weight:600;display:block;margin-bottom:4px">Término</label>
                  <input type="time" id="ras-termino" required style="width:100%;padding:8px 10px;font-size:1rem;border-radius:6px;border:1px solid #bbb">
                </div>
              </div>
              <div style="margin-bottom:18px">
                <label style="font-weight:600;display:block;margin-bottom:4px">Efetivo</label>
                <input type="number" id="ras-efetivo" min="0" required style="width:100%;padding:8px 10px;font-size:1rem;border-radius:6px;border:1px solid #bbb">
              </div>
              <div style="margin-bottom:18px;border:1px solid #fbb4b4;background:#fff7f7;border-radius:8px;padding:12px">
                <label style="font-weight:600;display:block;margin-bottom:4px;color:#d32f2f">⚠️ Tarefa de Alto Risco</label>
                <textarea id="ras-alto-risco" required rows="2" style="width:100%;padding:8px 10px;font-size:1rem;border-radius:6px;border:1px solid #bbb" placeholder="Descreva as tarefas de alto risco identificadas..."></textarea>
              </div>
              <div style="margin-bottom:18px;border:1px solid #fbb4b4;background:#fff7f7;border-radius:8px;padding:12px;display:flex;align-items:center;justify-content:space-between">
                <div>
                  <label style="font-weight:600;display:block;margin-bottom:2px;color:#d32f2f">⚠️ TARD-C</label>
                  <span style="color:#b77;font-size:0.98rem">Ative se houver Tarefa de Alto Risco Crítica</span>
                </div>
                <input type="checkbox" id="ras-tardc" style="width:22px;height:22px">
              </div>
              <div style="margin-bottom:18px;border:1px solid #b4e2fb;background:#f7fbff;border-radius:8px;padding:12px">
                <label style="font-weight:600;display:block;margin-bottom:4px;color:#3197ab"> Algo a ser Compartilhado</label>
                <textarea id="ras-compartilhar" required rows="2" style="width:100%;padding:8px 10px;font-size:1rem;border-radius:6px;border:1px solid #bbb" placeholder="Informações importantes para compartilhar com a equipe..."></textarea>
              </div>
              <div style="text-align:right;padding-top:12px;border-top:1px solid #e2e8f0;margin-top:24px;">
                <button id="ras-voltar-formulario" type="button" style="background:#6c757d;color:#fff;padding:12px 24px;font-size:1rem;border:none;border-radius:6px;cursor:pointer;margin-right:12px;"> Voltar</button>
                <button id="ras-proximo-1" type="button" disabled style="background:#3498db;color:#fff;padding:12px 24px;font-size:1rem;border:none;border-radius:6px;opacity:0.5;cursor:not-allowed;">Próximo </button>
              </div>
            </form>
              </div>
            </div>
          </div>

          <!-- Etapa 2: Participação de Liderança -->
          <div id="ras-etapa-2" style="display:none;">
            <h2 style="margin-top:24px;font-size:1.6rem;font-weight:700;color:#222">Nova RAS</h2>
            <div style="color:#3197ab;font-size:1.1rem;margin-bottom:8px">Reunião de Análise de Segurança · Etapa 2 de 6</div>
            <div style="font-size:1.05rem;margin-bottom:18px;color:#888">Participação de Liderança</div>
            <form autocomplete="off" style="background:#fff;border-radius:12px;padding:24px 24px 16px 24px;box-shadow:0 2px 8px #0001;border:1px solid #e6edf3">
              <div style="text-align:center;margin-bottom:18px">
                <div style="font-size:1.3rem;font-weight:700;">Participação de Liderança</div>
                <div style="color:#888;font-size:1rem;">Registre os líderes presentes na reunião</div>
              </div>
              
              <!-- Substituído: vários selects por UI compacta (nome + setor + botão de adicionar) -->
              <div style="margin-bottom:12px;display:flex;gap:12px;align-items:center;flex-wrap:wrap">
                <div style="flex:1 1 320px">
                  <label style="font-weight:600;display:block;margin-bottom:8px;">Selecione o nome</label>
                  <select id="ras-participante-nome" style="width:100%;padding:12px;font-size:1rem;border-radius:6px;border:1px solid #bbb;background:#fff">
                    <option value="">Selecione o nome</option>
                    <!-- Opções carregadas dinamicamente (colaboradores) -->
                  </select>
                </div>

                <div style="width:240px;flex:0 0 240px">
                  <label style="font-weight:600;display:block;margin-bottom:8px;">Selecione o setor</label>
                  <select id="ras-participante-setor" style="width:100%;padding:12px;font-size:1rem;border-radius:6px;border:1px solid #bbb;background:#fff">
                    <option value="">Selecione o setor</option>
                    <option value="Gerente">Gerente</option>
                    <option value="Engenheiro">Engenheiro</option>
                    <option value="Supervisor">Supervisor</option>
                    <option value="Encarregado">Encarregado</option>
                    <option value="Técnico de Segurança">Técnico de Segurança</option>
                    <option value="HSE">HSE</option>
                  </select>
                </div>

                <div style="flex:0 0 48px;display:flex;align-items:flex-end;">
                  <button id="ras-add-participante" type="button" title="Adicionar participante" style="background:#111827;color:#fff;border:none;padding:10px;border-radius:8px;font-size:1.4rem;line-height:1;cursor:pointer;">+</button>
                </div>
              </div>

              <div id="ras-participantes-list" style="margin-bottom:18px;display:flex;flex-direction:column;gap:8px;">
                <!-- Itens adicionados aparecerão aqui -->
              </div>

              <!-- Hidden inputs (mantêm compatibilidade com coleta de dados existente) -->
              <input type="hidden" id="ras-gerente" value="">
              <input type="hidden" id="ras-engenheiro" value="">
              <input type="hidden" id="ras-supervisor" value="">
              <input type="hidden" id="ras-encarregado" value="">
              <input type="hidden" id="ras-tecnico-seguranca" value="">

              <div style="display:flex;gap:12px;justify-content:space-between">
                <button id="ras-voltar-2" type="button" style="background:#6b7280;color:#fff;padding:10px 24px;font-size:1.1rem;border:none;border-radius:6px;cursor:pointer"> Voltar</button>
                <button id="ras-proximo-2" type="button" disabled style="background:#3197ab;color:#fff;padding:10px 36px;font-size:1.1rem;border:none;border-radius:6px;opacity:0.5;cursor:not-allowed">Próximo </button>
              </div>
            </form>
          </div>

          <!-- Etapa 3: Outros Participantes -->
          <div id="ras-etapa-3" style="display:none;">
            <h2 style="margin-top:24px;font-size:1.6rem;font-weight:700;color:#222">Nova RAS</h2>
            <div style="color:#3197ab;font-size:1.1rem;margin-bottom:8px">Reunião de Análise de Segurança · Etapa 3 de 6</div>
            <div style="font-size:1.05rem;margin-bottom:18px;color:#888">Outros Participantes</div>
            <form autocomplete="off" style="background:#fff;border-radius:12px;padding:24px 24px 16px 24px;box-shadow:0 2px 8px #0001;border:1px solid #e6edf3">
              <div style="text-align:center;margin-bottom:18px">
                <div style="font-size:1.3rem;font-weight:700;">Outros Participantes</div>
                <div style="color:#888;font-size:1rem;">Complete com os demais envolvidos na reunião</div>
              </div>
              
              <div style="margin-bottom:18px">
                <label style="font-weight:600;display:block;margin-bottom:8px;display:flex;align-items:center;gap:8px">
                  <span style="font-size:1.2rem;"></span> Anjo da Semana
                </label>
                <select id="ras-anjo-semana" required style="width:100%;padding:12px;font-size:1rem;border-radius:6px;border:1px solid #bbb;background:#fff">
                  <option value="">Selecione o anjo da semana</option>
                </select>
              </div>

              <div style="margin-bottom:18px">
                <label style="font-weight:600;display:block;margin-bottom:8px;display:flex;align-items:center;gap:8px">
                  <span style="font-size:1.2rem;"></span> Líder da RAS
                </label>
                <select id="ras-lider-ras" required style="width:100%;padding:12px;font-size:1rem;border-radius:6px;border:1px solid #bbb;background:#fff">
                  <option value="">Selecione o líder da ras</option>
                </select>
              </div>

              <div style="margin-bottom:18px">
                <label style="font-weight:600;display:block;margin-bottom:8px;display:flex;align-items:center;gap:8px">
                  <span style="font-size:1.2rem;"></span> Líder CPT
                </label>
                <select id="ras-lider-cpt" required style="width:100%;padding:12px;font-size:1rem;border-radius:6px;border:1px solid #bbb;background:#fff">
                  <option value="">Selecione o líder cpt</option>
                </select>
              </div>

              <div style="margin-bottom:24px">
                <label style="font-weight:600;display:block;margin-bottom:8px;display:flex;align-items:center;gap:8px">
                  <span style="font-size:1.2rem;"></span> Brigada
                </label>
                <input type="text" id="ras-brigada" required placeholder="Digite o nome da brigada" style="width:100%;padding:12px;font-size:1rem;border-radius:6px;border:1px solid #bbb;background:#fff;box-sizing:border-box">
              </div>

              <div style="display:flex;gap:12px;justify-content:space-between">
                <button id="ras-voltar-3" type="button" style="background:#6b7280;color:#fff;padding:10px 24px;font-size:1.1rem;border:none;border-radius:6px;cursor:pointer"> Voltar</button>
                <button id="ras-proximo-3" type="button" disabled style="background:#3197ab;color:#fff;padding:10px 36px;font-size:1.1rem;border:none;border-radius:6px;opacity:0.5;cursor:not-allowed">Próximo </button>
              </div>
            </form>
          </div>

          <!-- Etapa 4: Anexos -->
          <div id="ras-etapa-4" style="display:none;">
            <h2 style="margin-top:24px;font-size:1.6rem;font-weight:700;color:#222">Nova RAS</h2>
            <div style="color:#3197ab;font-size:1.1rem;margin-bottom:8px">Reunião de Análise de Segurança · Etapa 4 de 6</div>
            <div style="font-size:1.05rem;margin-bottom:18px;color:#888">Anexos</div>
            <form autocomplete="off" style="background:#fff;border-radius:12px;padding:24px 24px 16px 24px;box-shadow:0 2px 8px #0001;border:1px solid #e6edf3">
              <div style="text-align:center;margin-bottom:24px">
                <div style="font-size:1.3rem;font-weight:700;">Anexos</div>
                <div style="color:#888;font-size:1rem;">Adicione fotos e evidências da reunião</div>
                <div style="color:#e53e3e;font-size:0.9rem;margin-top:4px;font-weight:600;">Itens obrigatórios</div>
              </div>
              
              <!-- Seção 1: Carregar Foto da RAS -->
              <div style="margin-bottom:24px;padding:20px;border:1px solid #e5e7eb;border-radius:12px;background:#f8fafc;">
                <div style="margin-bottom:16px;">
                  <div style="font-size:1.1rem;font-weight:600;color:#374151;margin-bottom:4px;display:flex;align-items:center;gap:8px;">
                    <span style="font-size:1.3rem;"></span> Carregar Foto da RAS
                  </div>
                  <div style="color:#6b7280;font-size:0.9rem;">Adicione fotos da reunião (JPG, PNG)</div>
                </div>
                
                <div style="border:2px dashed #bfdbfe;border-radius:8px;padding:30px 20px;text-align:center;background:#eff6ff;transition:all 0.3s ease;" id="upload-area-fotos">
                  <div style="font-size:2.5rem;color:#60a5fa;margin-bottom:8px;">📷</div>
                  <div style="font-size:1rem;font-weight:600;color:#1e40af;margin-bottom:6px;">Carregar Fotos</div>
                  <div style="color:#6b7280;font-size:0.9rem;margin-bottom:12px;">Selecione ou arraste fotos da RAS</div>
                  
                  <button type="button" id="select-fotos" style="background:#2563eb;color:#fff;padding:10px 20px;font-size:0.9rem;border:none;border-radius:6px;cursor:pointer;margin-bottom:6px;">Selecionar Fotos</button>
                  <input type="file" id="file-input-fotos" multiple accept=".jpg,.jpeg,.png" style="display:none;">
                  
                  <div style="color:#6b7280;font-size:0.8rem;">Formatos: JPG, PNG</div>
                </div>

                <!-- Lista de Fotos Carregadas -->
                <div id="fotos-list" style="margin-top:16px;display:none;">
                  <div style="font-weight:600;margin-bottom:8px;color:#374151;"> Fotos Selecionadas:</div>
                  <div id="fotos-container" style="max-height:150px;overflow-y:auto;"></div>
                </div>
              </div>

              <!-- Seção 2: Carregar Evidência da RAS -->
              <div style="margin-bottom:24px;padding:20px;border:1px solid #e5e7eb;border-radius:12px;background:#fef2f2;">
                <div style="margin-bottom:16px;">
                  <div style="font-size:1.1rem;font-weight:600;color:#374151;margin-bottom:4px;display:flex;align-items:center;gap:8px;">
                    <span style="font-size:1.3rem;"></span> Carregar Evidência da RAS
                  </div>
                  <div style="color:#6b7280;font-size:0.9rem;">Adicione documentos PDF como evidência</div>
                </div>
                
                <div style="border:2px dashed #fca5a5;border-radius:8px;padding:30px 20px;text-align:center;background:#fef2f2;transition:all 0.3s ease;" id="upload-area-evidencias">
                  <div style="font-size:2.5rem;color:#f87171;margin-bottom:8px;"></div>
                  <div style="font-size:1rem;font-weight:600;color:#dc2626;margin-bottom:6px;">Carregar Evidências</div>
                  <div style="color:#6b7280;font-size:0.9rem;margin-bottom:12px;">Selecione ou arraste documentos PDF</div>
                  
                  <button type="button" id="select-evidencias" style="background:#dc2626;color:#fff;padding:10px 20px;font-size:0.9rem;border:none;border-radius:6px;cursor:pointer;margin-bottom:6px;">Selecionar PDFs</button>
                  <input type="file" id="file-input-evidencias" multiple accept=".pdf" style="display:none;">
                  
                  <div style="color:#6b7280;font-size:0.8rem;">Formato: PDF</div>
                </div>

                <!-- Lista de Evidências Carregadas -->
                <div id="evidencias-list" style="margin-top:16px;display:none;">
                  <div style="font-weight:600;margin-bottom:8px;color:#374151;">📎 Evidências Selecionadas:</div>
                  <div id="evidencias-container" style="max-height:150px;overflow-y:auto;"></div>
                </div>
              </div>

              <div style="display:flex;gap:12px;justify-content:space-between">
                <button id="ras-voltar-4" type="button" style="background:#6b7280;color:#fff;padding:10px 24px;font-size:1.1rem;border:none;border-radius:6px;cursor:pointer"> Voltar</button>
                <button id="ras-proximo-4" type="button" disabled style="background:#3197ab;color:#fff;padding:10px 36px;font-size:1.1rem;border:none;border-radius:6px;opacity:0.5;cursor:not-allowed">Próximo </button>
              </div>
            </form>
          </div>

          <!-- Etapa 5: Revisar Informações -->
          <div id="ras-etapa-5" style="display:none;">
            <h2 style="margin-top:24px;font-size:1.6rem;font-weight:700;color:#222">Nova RAS</h2>
            <div style="color:#3197ab;font-size:1.1rem;margin-bottom:8px">Reunião de Análise de Segurança · Etapa 5 de 6</div>
            <div style="font-size:1.05rem;margin-bottom:18px;color:#888">Revisar Informações</div>
            
            <div style="background:#fff;border-radius:12px;padding:24px;box-shadow:0 2px 8px #0001;border:1px solid #e6edf3">
              <!-- Cabeçalho -->
              <div style="text-align:center;margin-bottom:24px;">
                <div style="width:60px;height:60px;background:#10b981;border-radius:50%;display:inline-flex;align-items:center;justify-content:center;margin-bottom:12px;">
                  <span style="font-size:24px;color:#fff;"></span>
                </div>
                <div style="font-size:1.4rem;font-weight:700;color:#374151;">Revisar Informações</div>
                <div style="color:#6b7280;font-size:1rem;">Verifique os dados antes de confirmar a presença</div>
              </div>

              <!-- Informações Básicas -->
              <div style="margin-bottom:20px;padding:16px;border:1px solid #e5e7eb;border-radius:8px;background:#f9fafb;">
                <div style="display:flex;align-items:center;gap:8px;margin-bottom:12px;">
                  <span style="font-size:1.2rem;"></span>
                  <span style="font-weight:600;color:#374151;">Informações Básicas</span>
                </div>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;font-size:0.9rem;">
                  <div><strong>Empresa:</strong> <span id="review-empresa">-</span></div>
                  <div><strong>Data:</strong> <span id="review-data">-</span></div>
                  <div><strong>Horário:</strong> <span id="review-horario">-</span></div>
                  <div><strong>Efetivo:</strong> <span id="review-efetivo">-</span> funcionários</div>
                </div>
                <div style="margin-top:12px;">
                  <div style="margin-bottom:8px;"><strong>⚠️ Tarefa de Alto Risco:</strong></div>
                  <div style="background:#fff7f7;padding:8px;border-radius:4px;border-left:3px solid #ef4444;font-size:0.85rem;" id="review-alto-risco">-</div>
                </div>
                <div style="margin-top:12px;">
                  <div style="margin-bottom:4px;"><strong>TARD-C:</strong> <span id="review-tardc">NÃO</span></div>
                </div>
                <div style="margin-top:12px;">
                  <div style="margin-bottom:8px;"><strong> Algo a ser Compartilhado:</strong></div>
                  <div style="background:#f7fbff;padding:8px;border-radius:4px;border-left:3px solid #3197ab;font-size:0.85rem;" id="review-compartilhar">-</div>
                </div>
              </div>

              <!-- Participantes -->
              <div style="margin-bottom:20px;padding:16px;border:1px solid #e5e7eb;border-radius:8px;background:#f9fafb;">
                <div style="display:flex;align-items:center;gap:8px;margin-bottom:12px;">
                  <span style="font-size:1.2rem;"></span>
                  <span style="font-weight:600;color:#374151;">Participantes</span>
                </div>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;font-size:0.9rem;">
                  <div><strong> Gerente:</strong> <span id="review-gerente">-</span></div>
                  <div><strong> Engenheiro:</strong> <span id="review-engenheiro">-</span></div>
                  <div><strong> Supervisor/Mestre:</strong> <span id="review-supervisor">-</span></div>
                  <div><strong> Encarregado:</strong> <span id="review-encarregado">-</span></div>
                  <div><strong> Técnico de Segurança:</strong> <span id="review-tecnico-seguranca">-</span></div>
                  <div><strong> Anjo da Semana:</strong> <span id="review-anjo-semana">-</span></div>
                  <div><strong> Líder da RAS:</strong> <span id="review-lider-ras">-</span></div>
                  <div><strong> Líder CPT:</strong> <span id="review-lider-cpt">-</span></div>
                  <div><strong> Brigada:</strong> <span id="review-brigada">-</span></div>
                </div>
              </div>

              <!-- Anexos -->
              <div style="margin-bottom:24px;padding:16px;border:1px solid #e5e7eb;border-radius:8px;background:#f9fafb;">
                <div style="display:flex;align-items:center;gap:8px;margin-bottom:12px;">
                  <span style="font-size:1.2rem;"></span>
                  <span style="font-weight:600;color:#374151;">Anexos (<span id="review-anexos-count">0</span>)</span>
                </div>
                <div id="review-anexos-list" style="font-size:0.9rem;">
                  <div style="color:#6b7280;">Nenhum arquivo carregado</div>
                </div>
              </div>

              <!-- Botões -->
              <div style="display:flex;gap:12px;justify-content:space-between">
                <button id="ras-voltar-5" type="button" style="background:#6b7280;color:#fff;padding:10px 24px;font-size:1.1rem;border:none;border-radius:6px;cursor:pointer"> Voltar</button>
                <button id="ras-confirmar-presenca" type="button" disabled style="background:#10b981;color:#fff;padding:10px 24px;font-size:1.1rem;border:none;border-radius:6px;opacity:0.5;cursor:not-allowed">Confirmar Presença </button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Etapa 6: Confirmar Presença -->
        <div id="ras-etapa-6" style="display:none">
          <div style="background:#fff;border-radius:16px;box-shadow:0 4px 16px #0001;border:1px solid #e6edf3;max-width:1000px;margin:0 auto">
            <div style="background:linear-gradient(135deg,#3197ab 0%,#2563eb 100%);color:#fff;padding:20px 24px;border-radius:16px 16px 0 0;text-align:center">
              <div style="font-size:1.4rem;font-weight:700;margin-bottom:6px">Nova RAS</div>
              <div style="font-size:1rem;opacity:0.9">Reunião de Análise de Segurança - Etapa 6 de 6</div>
            </div>
            
            <div style="padding:32px 24px">
              <div style="text-align:center;margin-bottom:32px">
                <div style="font-size:3rem;color:#3b82f6;margin-bottom:12px"></div>
                <div style="font-size:1.6rem;font-weight:700;color:#374151;margin-bottom:8px">Confirmar Presença</div>
                <div style="color:#6b7280;font-size:1rem">Marque os funcionários presentes na reunião.</div>
              </div>
              
              <div style="background:#f8fafc;border:1px solid #e5e7eb;border-radius:12px;padding:24px;margin-bottom:24px">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
                  <h3 style="margin:0;font-size:1.2rem;color:#374151">Lista de Funcionários</h3>
                  <button id="marcar-todos" type="button" style="background:#3b82f6;color:#fff;padding:8px 16px;font-size:0.9rem;border:none;border-radius:6px;cursor:pointer">Marcar Todos</button>
                </div>
                
                <div style="background:#fff;border:1px solid #e5e7eb;border-radius:8px;overflow:hidden">
                  <!-- Cabeçalho da tabela -->
                  <div style="background:#f9fafb;padding:12px 16px;border-bottom:1px solid #e5e7eb;display:grid;grid-template-columns:60px 120px 1fr 1fr 1fr;gap:16px;font-weight:600;color:#374151">
                    <div></div>
                    <div>Matrícula</div>
                    <div>Nome</div>
                    <div>Empresa</div>
                    <div>Função</div>
                  </div>
                  
                  <!-- Lista de funcionários -->
                  <div id="lista-funcionarios">
                    <!-- Lista será carregada dinamicamente -->
                  </div>
                </div>
                
                <div style="margin-top:16px;text-align:center">
                  <div style="color:#6b7280;font-size:1rem">
                    Total de Presentes: <span id="total-presentes" style="font-weight:600;color:#3b82f6">0</span>
                  </div>
                </div>
              </div>
              
              <!-- Botões -->
              <div style="display:flex;gap:12px;justify-content:space-between">
                <button id="ras-voltar-6" type="button" style="background:#6b7280;color:#fff;padding:12px 24px;font-size:1.1rem;border:none;border-radius:6px;cursor:pointer"> Voltar</button>
                <button id="ras-finalizar" type="button" style="background:#10b981;color:#fff;padding:12px 24px;font-size:1.1rem;border:none;border-radius:6px;cursor:pointer"> Finalizar RAS</button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Etapa 7: Relatório Final -->
        <div id="ras-relatorio-final" style="display:none">
          <div style="background:#fff;border-radius:16px;box-shadow:0 4px 16px #0001;border:1px solid #e6edf3;max-width:1200px;margin:0 auto">
            <div style="background:linear-gradient(135deg,#10b981 0%,#059669 100%);color:#fff;padding:20px 24px;border-radius:16px 16px 0 0;text-align:center">
              <div style="font-size:1.4rem;font-weight:700;margin-bottom:6px"> RAS Finalizada</div>
              <div style="font-size:1rem;opacity:0.9">Relatório da Reunião de Análise de Segurança</div>
            </div>
            
            <div id="relatorio-conteudo" style="padding:32px 24px">
              <div style="text-align:center;margin-bottom:32px">
                <div style="font-size:3rem;color:#10b981;margin-bottom:12px"></div>
                <div style="font-size:1.6rem;font-weight:700;color:#374151;margin-bottom:8px">Relatório Final da RAS</div>
                <div style="color:#6b7280;font-size:1rem">Resumo completo da reunião realizada</div>
              </div>
              
              <!-- Seção 1: Informações Básicas -->
              <div style="background:#f8fafc;border:1px solid #e5e7eb;border-radius:12px;padding:24px;margin-bottom:24px">
                <h3 style="margin:0 0 16px 0;color:#374151;font-size:1.3rem;display:flex;align-items:center;gap:8px">
                  <span></span> Informações Básicas
                </h3>
                <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:16px">
                  <div><strong>Empresa:</strong> <span id="rel-empresa">-</span></div>
                  <div><strong>Data:</strong> <span id="rel-data">-</span></div>
                  <div><strong>Horário:</strong> <span id="rel-horario">-</span></div>
                  <div><strong>Efetivo Total:</strong> <span id="rel-efetivo">-</span></div>
                  <div><strong>Atividade de Alto Risco:</strong> <span id="rel-alto-risco">-</span></div>
                  <div><strong>TARDC:</strong> <span id="rel-tardc">-</span></div>
                  <div style="grid-column:1/-1"><strong>Como Compartilhar:</strong> <span id="rel-compartilhar">-</span></div>
                </div>
              </div>
              
              <!-- Seção 2: Participação de Liderança -->
              <div style="background:#f0f9ff;border:1px solid #e0f2fe;border-radius:12px;padding:24px;margin-bottom:24px">
                <h3 style="margin:0 0 16px 0;color:#374151;font-size:1.3rem;display:flex;align-items:center;gap:8px">
                  <span></span> Participação de Liderança
                </h3>
                <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:16px">
                  <div><strong>Gerente:</strong> <span id="rel-gerente">-</span></div>
                  <div><strong>Engenheiro:</strong> <span id="rel-engenheiro">-</span></div>
                  <div><strong>Supervisor:</strong> <span id="rel-supervisor">-</span></div>
                  <div><strong>Encarregado:</strong> <span id="rel-encarregado">-</span></div>
                  <div><strong>Técnico de Segurança:</strong> <span id="rel-tecnico-seguranca">-</span></div>
                </div>
              </div>
              
              <!-- Seção 3: Outros Participantes -->
              <div style="background:#fef7ff;border:1px solid #f3e8ff;border-radius:12px;padding:24px;margin-bottom:24px">
                <h3 style="margin:0 0 16px 0;color:#374151;font-size:1.3rem;display:flex;align-items:center;gap:8px">
                  <span></span> Outros Participantes
                </h3>
                <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:16px">
                  <div><strong>Anjo da Semana:</strong> <span id="rel-anjo-semana">-</span></div>
                  <div><strong>Líder RAS:</strong> <span id="rel-lider-ras">-</span></div>
                  <div><strong>Líder CPT:</strong> <span id="rel-lider-cpt">-</span></div>
                  <div><strong>Brigada:</strong> <span id="rel-brigada">-</span></div>
                </div>
              </div>
              
              <!-- Seção 4: Anexos -->
              <div style="background:#fffbeb;border:1px solid #fef3c7;border-radius:12px;padding:24px;margin-bottom:24px">
                <h3 style="margin:0 0 16px 0;color:#374151;font-size:1.3rem;display:flex;align-items:center;gap:8px">
                  <span></span> Anexos
                </h3>
                
                <!-- Fotos da RAS -->
                <div id="rel-fotos-section" style="margin-bottom:20px">
                  <h4 style="color:#3b82f6;margin:0 0 12px 0"> Fotos da RAS</h4>
                  <div id="rel-fotos-container" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:12px"></div>
                </div>
                
                <!-- Evidências -->
                <div id="rel-evidencias-section">
                  <h4 style="color:#ef4444;margin:0 0 12px 0"> Evidências da RAS</h4>
                  <div id="rel-evidencias-container"></div>
                </div>
              </div>
              
              <!-- Seção 5: Lista de Presença -->
              <div style="background:#f0fdf4;border:1px solid #dcfce7;border-radius:12px;padding:24px;margin-bottom:32px">
                <h3 style="margin:0 0 16px 0;color:#374151;font-size:1.3rem;display:flex;align-items:center;gap:8px">
                  <span></span> Lista de Presença
                </h3>
                <div style="margin-bottom:12px;display:flex;gap:24px;align-items:center">
                  <div><strong>Total de Presentes:</strong> <span id="rel-total-presentes" style="color:#10b981;font-weight:600">0</span> funcionário(s)</div>
                  <div><strong>Total de Ausentes:</strong> <span id="rel-total-ausentes" style="color:#ef4444;font-weight:600">0</span> funcionário(s)</div>
                </div>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
                  <div id="rel-presentes-lista" style="background:#fff;border:1px solid #e5e7eb;border-radius:8px;overflow:hidden"></div>
                  <div id="rel-ausentes-lista" style="background:#fff;border:1px solid #ffe6e6;border-radius:8px;overflow:hidden"></div>
                </div>
              </div>
              
              <!-- Botões de Ação -->
              <div style="display:flex;flex-wrap:wrap;gap:12px;justify-content:center;margin-bottom:16px">
                <button id="btn-compartilhar-whatsapp" type="button" style="background:#25d366;color:#fff;padding:12px 24px;font-size:1rem;border:none;border-radius:8px;cursor:pointer;display:flex;align-items:center;gap:8px">
                  <span></span> Compartilhar no WhatsApp
                </button>
                <button id="btn-imprimir-pdf" type="button" style="background:#dc2626;color:#fff;padding:12px 24px;font-size:1rem;border:none;border-radius:8px;cursor:pointer;display:flex;align-items:center;gap:8px">
                  <span></span> Imprimir PDF
                </button>
                <button id="btn-sair-ras" type="button" style="background:#6b7280;color:#fff;padding:12px 24px;font-size:1rem;border:none;border-radius:8px;cursor:pointer;display:flex;align-items:center;gap:8px">
                  <span></span> Sair da RAS
                </button>
              </div>
            </div>
          </div>
        </div>
        <div id="cadastro-usuario" style="display:none;max-width:none;margin:0;">
          <h2>Cadastro de Perfil de Usuário</h2>
          <form id="form-cadastro" autocomplete="off" onsubmit="return false;">
            <label for="nome">Nome completo</label><br>
            <input type="text" id="nome" name="nome" required style="width:100%;margin-bottom:10px"><br>
            <label for="perfil">Perfil</label><br>
            <select id="perfil" name="perfil" required style="width:100%;margin-bottom:10px">
              <option value="Administrador">Administrador</option>
              <option value="Técnico">Técnico</option>
            </select><br>
            <label for="senha">Senha</label><br>
            <input type="password" id="senha" name="senha" required style="width:100%;margin-bottom:10px"><br>
            <button type="submit" style="margin-top:8px">Cadastrar</button>
          </form>
          <button id="btn-acessar-usuarios" style="margin-top:12px">Acessar usuários cadastrados</button>
          <p style="font-size:13px;color:#7a869a;margin-top:10px">
            <b>Login:</b> será o <b>primeiro nome</b> informado e a senha cadastrada.<br>
            Exemplo: Nome completo "Maria Silva"  login: <b>Maria</b>
          </p>
          <div id="usuarios-cadastrados" style="margin-top:24px;display:block"></div>
          <button id="btn-voltar-cadastro" style="margin-top:12px;display:none">Voltar ao cadastro</button>
        </div>
        
        <!-- Seção Empresa -->
        <div id="empresa" style="display:none;max-width:none;margin:0;">
          <div style="background:#fff;border-radius:16px;box-shadow:0 4px 16px #0001;border:1px solid #e6edf3">
            <div style="background:linear-gradient(135deg,#f59e0b 0%,#d97706 100%);color:#fff;padding:20px 24px;border-radius:16px 16px 0 0">
              <div style="display:flex;justify-content:space-between;align-items:center">
                <div>
                  <div style="font-size:1.4rem;font-weight:700;margin-bottom:6px;display:flex;align-items:center;gap:8px">
                    <span></span> Cadastro de Empresa
                  </div>
                  <div style="font-size:1rem;opacity:0.9">Gerencie informações da empresa e configurações corporativas.</div>
                </div>
                <div style="display:flex;gap:12px">
                  <button id="btn-nova-empresa" type="button" style="background:#fff;color:#f59e0b;padding:10px 20px;font-size:0.9rem;border:none;border-radius:6px;cursor:pointer;font-weight:600;display:flex;align-items:center;gap:6px">
                    <span></span> Nova Empresa
                  </button>
                </div>
              </div>
            </div>
            
            <div style="padding:24px">
              <!-- Barra de salvar alterações (Empresa) -->
              <div id="empresas-save-bar" style="display:none;margin-bottom:16px;background:#fff7ed;border:1px solid #fdba74;color:#9a3412;padding:12px;border-radius:8px;display:flex;justify-content:space-between;align-items:center;gap:12px">
                <div style="display:flex;align-items:center;gap:8px">
                  <span></span>
                  <span><strong>Alterações não salvas</strong> em empresas.</span>
                </div>
                <div style="display:flex;gap:8px">
                  <button type="button" onclick="salvarAlteracoesEmpresas()" style="background:#f59e0b;color:#fff;padding:8px 12px;border:none;border-radius:6px;cursor:pointer">Salvar alterações</button>
                  <button type="button" onclick="descartarAlteracoesEmpresas()" style="background:#6b7280;color:#fff;padding:8px 12px;border:none;border-radius:6px;cursor:pointer">Descartar</button>
                </div>
              </div>
              <!-- Lista de Empresas -->
              <div id="lista-empresas-secao" style="margin-bottom:24px">
                <h3 style="margin:0 0 16px 0;color:#374151;font-size:1.2rem">Lista de Empresas</h3>
                
                <div style="background:#f8fafc;border:1px solid #e5e7eb;border-radius:8px;overflow:hidden">
                  <!-- Cabeçalho da tabela -->
                  <div style="background:#f1f5f9;padding:12px 16px;border-bottom:1px solid #e5e7eb;display:grid;grid-template-columns:2fr 1.5fr 1fr 2fr 1fr 1.5fr 100px;gap:16px;font-weight:600;color:#374151">
                    <div>Nome</div>
                    <div>CNPJ</div>
                    <div>CNAE</div>
                    <div>Ramo de Atividade</div>
                    <div>Grau de Risco</div>
                    <div>Contato</div>
                    <div>Ações</div>
                  </div>
                  
                  <!-- Lista de empresas cadastradas -->
                  <div id="empresas-lista">
                    <!-- Empresas serão carregadas dinamicamente aqui -->
                  </div>
                </div>
                
                <div style="margin-top:16px;text-align:center;color:#6b7280">
                  Total de Empresas: <span id="total-empresas" style="font-weight:600;color:#f59e0b">0</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Modal Nova Empresa -->
        <div id="modal-empresa" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:1000;justify-content:center;align-items:center">
          <div style="background:#fff;border-radius:12px;padding:24px;max-width:600px;width:90%;max-height:90vh;overflow-y:auto">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
              <h3 style="margin:0;color:#374151"> Nova Empresa</h3>
              <button id="fechar-modal-empresa" style="background:none;border:none;font-size:1.5rem;cursor:pointer;color:#6b7280">×</button>
            </div>
            
            <form id="form-empresa" onsubmit="event.preventDefault(); cadastrarEmpresa();" style="display:grid;gap:16px">
              <div>
                <label style="display:block;margin-bottom:4px;font-weight:600;color:#374151">Nome da Empresa *</label>
                <input type="text" id="emp-nome" required style="width:100%;padding:8px 12px;border:1px solid #d1d5db;border-radius:6px">
              </div>
              
              <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px">
                <div>
                  <label style="display:block;margin-bottom:4px;font-weight:600;color:#374151">CNPJ *</label>
                  <input type="text" id="emp-cnpj" required placeholder="00.000.000/0000-00" style="width:100%;padding:8px 12px;border:1px solid #d1d5db;border-radius:6px">
                </div>
                <div>
                  <label style="display:block;margin-bottom:4px;font-weight:600;color:#374151">CNAE</label>
                  <input type="text" id="emp-cnae" placeholder="0000-0/00" style="width:100%;padding:8px 12px;border:1px solid #d1d5db;border-radius:6px">
                </div>
              </div>
              
              <div>
                <label style="display:block;margin-bottom:4px;font-weight:600;color:#374151">Ramo de Atividade</label>
                <input type="text" id="emp-ramo-atividade" placeholder="Ex: Construção Civil, Comércio, Indústria..." style="width:100%;padding:8px 12px;border:1px solid #d1d5db;border-radius:6px">
              </div>
              
              <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px">
                <div>
                  <label style="display:block;margin-bottom:4px;font-weight:600;color:#374151">Grau de Risco</label>
                  <select id="emp-grau-risco" style="width:100%;padding:8px 12px;border:1px solid #d1d5db;border-radius:6px;background:#fff">
                    <option value="">Selecione o grau de risco</option>
                    <option value="1">Grau 1 - Risco Mínimo</option>
                    <option value="2">Grau 2 - Risco Baixo</option>
                    <option value="3">Grau 3 - Risco Médio</option>
                    <option value="4">Grau 4 - Risco Alto</option>
                  </select>
                </div>
                <div>
                  <label style="display:block;margin-bottom:4px;font-weight:600;color:#374151">Contato</label>
                  <input type="text" id="emp-contato" placeholder="(00) 00000-0000" style="width:100%;padding:8px 12px;border:1px solid #d1d5db;border-radius:6px">
                </div>
              </div>
              
              <div style="display:flex;gap:12px;margin-top:8px">
                <button type="button" onclick="fecharModalEmpresa()" style="flex:1;background:#6b7280;color:#fff;padding:10px;border:none;border-radius:6px;cursor:pointer">Cancelar</button>
                <button type="submit" style="flex:1;background:#f59e0b;color:#fff;padding:10px;border:none;border-radius:6px;cursor:pointer">Salvar Empresa</button>
              </div>
            </form>
          </div>
        </div>
        
        <!-- SeÃ§Ã£o FuncionÃ¡rios -->
        <div id="funcionarios" style="display:none;max-width:none;margin:0;">
          <div style="background:#fff;border-radius:16px;box-shadow:0 4px 16px #0001;border:1px solid #e6edf3">
            <div style="background:linear-gradient(135deg,#3b82f6 0%,#1e40af 100%);color:#fff;padding:20px 24px;border-radius:16px 16px 0 0">
              <div style="display:flex;justify-content:space-between;align-items:center">
                <div>
                  <div style="font-size:1.4rem;font-weight:700;margin-bottom:6px;display:flex;align-items:center;gap:8px">
                    <span></span> Cadastro de Colaboradores
                  </div>
                  <div style="font-size:1rem;opacity:0.9">Gerencie a equipe e importe dados de planilhas.</div>
                </div>
                <div style="display:flex;gap:12px">
                  <button id="btn-novo-funcionario" type="button" style="background:#fff;color:#3b82f6;padding:10px 20px;font-size:0.9rem;border:none;border-radius:6px;cursor:pointer;font-weight:600;display:flex;align-items:center;gap:6px">
                    <span></span> Novo Colaborador
                  </button>
                  <button id="btn-importar-planilha" type="button" style="background:#10b981;color:#fff;padding:10px 20px;font-size:0.9rem;border:none;border-radius:6px;cursor:pointer;font-weight:600;display:flex;align-items:center;gap:6px">
                    <span></span> Importar Planilha
                  </button>
                  <button id="btn-limpar-dados" type="button" style="background:#dc2626;color:#fff;padding:10px 20px;font-size:0.9rem;border:none;border-radius:6px;cursor:pointer;font-weight:600;display:flex;align-items:center;gap:6px">
                    <span></span> Limpar Dados
                  </button>
                </div>
              </div>
            </div>
            
            <div style="padding:24px">
              <!-- Barra de salvar alterações (Funcionários) -->
              <div id="funcionarios-save-bar" style="display:none;margin-bottom:16px;background:#eff6ff;border:1px solid #93c5fd;color:#1e3a8a;padding:12px;border-radius:8px;display:flex;justify-content:space-between;align-items:center;gap:12px">
                <div style="display:flex;align-items:center;gap:8px">
                  <span></span>
                  <span><strong>Alterações não salvas</strong> em colaboradores.</span>
                </div>
                <div style="display:flex;gap:8px">
                  <button type="button" onclick="salvarAlteracoesFuncionarios()" style="background:#3b82f6;color:#fff;padding:8px 12px;border:none;border-radius:6px;cursor:pointer">Salvar alterações</button>
                  <button type="button" onclick="descartarAlteracoesFuncionarios()" style="background:#6b7280;color:#fff;padding:8px 12px;border:none;border-radius:6px;cursor:pointer">Descartar</button>
                </div>
              </div>
              <!-- Lista de Colaboradores -->
              <div id="lista-funcionarios-secao" style="margin-bottom:24px">
                <h3 style="margin:0 0 16px 0;color:#374151;font-size:1.2rem">Lista de Colaboradores</h3>
                
                <div style="background:#f8fafc;border:1px solid #e5e7eb;border-radius:8px;overflow:hidden">
                  <!-- Cabeçalho da tabela -->
                  <div style="background:#f1f5f9;padding:12px 16px;border-bottom:1px solid #e5e7eb;display:grid;grid-template-columns:120px 2fr 1.5fr 1.5fr 120px 1.5fr 100px;gap:16px;font-weight:600;color:#374151">
                    <div>Matrícula</div>
                    <div>Nome</div>
                    <div>Função</div>
                    <div>Setor</div>
                    <div>Data Admissão</div>
                    <div>Empresa</div>
                    <div>Ações</div>
                  </div>
                  
                  <!-- Lista de colaboradores cadastrados -->
                  <div id="funcionarios-lista">
                    <!-- Colaboradores serão carregados dinamicamente aqui -->
                  </div>
                </div>
                
                <div style="margin-top:16px;text-align:center;color:#6b7280">
                  Total de Colaboradores: <span id="total-funcionarios" style="font-weight:600;color:#3b82f6">1</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Modal Novo Colaborador -->
        <div id="modal-funcionario" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:1000;justify-content:center;align-items:center">
          <div style="background:#fff;border-radius:12px;padding:24px;max-width:500px;width:90%;max-height:90vh;overflow-y:auto">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
              <h3 style="margin:0;color:#374151"> Novo Colaborador</h3>
              <button id="fechar-modal" style="background:none;border:none;font-size:1.5rem;cursor:pointer;color:#6b7280">×</button>
            </div>
            
            <form id="form-funcionario" style="display:grid;gap:16px">
              <div>
                <label style="display:block;margin-bottom:4px;font-weight:600;color:#374151">Matrícula *</label>
                <input type="text" id="func-matricula" required style="width:100%;padding:8px 12px;border:1px solid #d1d5db;border-radius:6px">
              </div>
              
              <div>
                <label style="display:block;margin-bottom:4px;font-weight:600;color:#374151">Nome Completo *</label>
                <input type="text" id="func-nome" required style="width:100%;padding:8px 12px;border:1px solid #d1d5db;border-radius:6px">
              </div>
              
              <div>
                <label style="display:block;margin-bottom:4px;font-weight:600;color:#374151">Função *</label>
                <input type="text" id="func-funcao" required style="width:100%;padding:8px 12px;border:1px solid #d1d5db;border-radius:6px">
              </div>
              
              <div>
                <label style="display:block;margin-bottom:4px;font-weight:600;color:#374151">Setor *</label>
                <input type="text" id="func-setor" required style="width:100%;padding:8px 12px;border:1px solid #d1d5db;border-radius:6px">
              </div>
              
              <div>
                <label style="display:block;margin-bottom:4px;font-weight:600;color:#374151">Data de Admissão *</label>
                <input type="date" id="func-admissao" required style="width:100%;padding:8px 12px;border:1px solid #d1d5db;border-radius:6px">
              </div>
              
              <div>
                <label style="display:block;margin-bottom:4px;font-weight:600;color:#374151">Empresa *</label>
                <select id="func-empresa" required style="width:100%;padding:8px 12px;border:1px solid #d1d5db;border-radius:6px;background:#fff">
                  <option value="">Selecione a empresa</option>
                  <!-- Opções carregadas dinamicamente -->
                </select>
              </div>
              
              <div style="display:flex;gap:12px;margin-top:8px">
                <button type="button" id="cancelar-funcionario" style="flex:1;background:#6b7280;color:#fff;padding:10px;border:none;border-radius:6px;cursor:pointer">Cancelar</button>
                <button type="submit" style="flex:1;background:#3b82f6;color:#fff;padding:10px;border:none;border-radius:6px;cursor:pointer">Salvar Colaborador</button>
              </div>
            </form>
          </div>
        </div>
        
        <!-- Modal para Importar Planilha -->
        <div id="modal-importar" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:1001;justify-content:center;align-items:center">
          <div style="background:#fff;border-radius:12px;width:90%;max-width:600px;max-height:80vh;overflow-y:auto">
            <div style="background:linear-gradient(135deg,#10b981 0%,#059669 100%);color:#fff;padding:20px;border-radius:12px 12px 0 0">
              <h2 style="margin:0;font-size:1.3rem;font-weight:700;display:flex;align-items:center;gap:8px">
                <span></span> Importar Planilha de Colaboradores
              </h2>
              <p style="margin:8px 0 0 0;opacity:0.9;font-size:0.9rem">Envie um arquivo Excel (.xlsx) com os dados dos colaboradores</p>
            </div>
            
            <div style="padding:20px">
              <!-- Instruções -->
              <div style="background:#f0fdf4;border:1px solid #bbf7d0;border-radius:8px;padding:16px;margin-bottom:20px">
                <h4 style="margin:0 0 8px 0;color:#166534;font-size:1rem"> Formato da Planilha</h4>
                <p style="margin:0 0 8px 0;color:#166534;font-size:0.9rem">A planilha deve conter as seguintes colunas <strong>na ordem exata</strong>:</p>
                <ol style="margin:0;color:#166534;font-size:0.9rem">
                  <li><strong>Matrícula</strong> - Número de identificação do colaborador</li>
                  <li><strong>Nome</strong> - Nome completo do colaborador</li>
                  <li><strong>Função</strong> - Cargo ou função exercida</li>
                  <li><strong>Setor</strong> - Setor ou departamento de trabalho</li>
                  <li><strong>Data Admissão</strong> - Data no formato DD/MM/AAAA</li>
                  <li><strong>Empresa</strong> - Nome da empresa</li>
                </ol>
              </div>
              
              <!-- Upload Area -->
              <div id="upload-area-planilha" style="border:2px dashed #d1d5db;border-radius:8px;padding:40px 20px;text-align:center;cursor:pointer;transition:all 0.3s ease;background:#fafafa">
                <div style="font-size:2rem;margin-bottom:12px;color:#9ca3af"></div>
                <div style="font-size:1.1rem;font-weight:600;color:#374151;margin-bottom:8px">Clique aqui ou arraste o arquivo</div>
                <div style="font-size:0.9rem;color:#6b7280;margin-bottom:16px">Formatos aceitos: .xlsx, .xls (máx. 5MB)</div>
                <input type="file" id="input-planilha" accept=".xlsx,.xls" style="display:none">
                <button type="button" onclick="document.getElementById('input-planilha').click()" style="background:#10b981;color:#fff;border:none;border-radius:6px;padding:10px 20px;font-size:0.9rem;font-weight:600;cursor:pointer">
                  Selecionar Arquivo
                </button>
              </div>
              
              <!-- Preview da planilha -->
              <div id="preview-planilha" style="display:none;margin-top:20px">
                <h4 style="margin:0 0 12px 0;color:#374151"> Prévia dos Dados</h4>
                <div style="max-height:200px;overflow-y:auto;border:1px solid #e5e7eb;border-radius:6px">
                  <table id="tabela-preview" style="width:100%;border-collapse:collapse;font-size:0.8rem">
                    <!-- Preview será inserido aqui -->
                  </table>
                </div>
              </div>
              
              <!-- Status -->
              <div id="status-importacao" style="margin-top:16px;display:none">
                <!-- Status será inserido aqui -->
              </div>
            </div>
            
            <div style="padding:16px 20px;background:#f8fafc;border-radius:0 0 12px 12px;display:flex;justify-content:flex-end;gap:12px">
              <button type="button" onclick="fecharModalImportar()" style="background:#6b7280;color:#fff;border:none;border-radius:6px;padding:10px 20px;font-size:0.9rem;font-weight:600;cursor:pointer">
                Cancelar
              </button>
              <button type="button" id="btn-confirmar-importacao" onclick="confirmarImportacao()" disabled style="background:#10b981;color:#fff;border:none;border-radius:6px;padding:10px 20px;font-size:0.9rem;font-weight:600;cursor:pointer;opacity:0.5">
                Importar Colaboradores
              </button>
            </div>
          </div>
        </div>
        
        <!-- Seção Controle de Frequência -->
        <div id="frequencia" style="display:none;max-width:none;margin:0;">
          <div style="background:#fff;border-radius:16px;box-shadow:0 4px 16px #0001;border:1px solid #e6edf3">
            <div style="background:linear-gradient(135deg,#8b5cf6 0%,#7c3aed 100%);color:#fff;padding:20px 24px;border-radius:16px 16px 0 0">
              <div style="display:flex;justify-content:space-between;align-items:center">
                <div>
                  <div style="font-size:1.4rem;font-weight:700;margin-bottom:6px;display:flex;align-items:center;gap:8px">
                    <span></span> Controle de Frequência
                  </div>
                  <div style="font-size:1rem;opacity:0.9">Visualize presença e ausência dos funcionários por data</div>
                </div>
              </div>
            </div>
            
            <div style="padding:24px">
              <!-- Filtro por Data -->
              <div style="background:#f8fafc;border:1px solid #e5e7eb;border-radius:12px;padding:20px;margin-bottom:24px">
                <h3 style="margin:0 0 16px 0;color:#374151;font-size:1.2rem">Filtrar por Data</h3>
                <div style="display:flex;gap:16px;align-items:end;flex-wrap:wrap">
                  <div style="flex:1;min-width:200px">
                    <label style="display:block;font-weight:600;color:#374151;margin-bottom:6px">Data da RAS</label>
                    <input type="date" id="filtro-data-frequencia" style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem">
                  </div>
                  <button onclick="buscarFrequencia()" style="background:#8b5cf6;color:#fff;border:none;border-radius:6px;padding:12px 24px;font-size:0.9rem;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:6px">
                    <span></span> Buscar Frequência
                  </button>
                  <button onclick="limparFrequenciaDia()" style="background:#dc2626;color:#fff;border:none;border-radius:6px;padding:12px 24px;font-size:0.9rem;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:6px">
                    <span></span> Limpar Dia
                  </button>
                </div>
              </div>
              
              <!-- Cards de Resumo -->
              <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;margin-bottom:24px">
                <!-- Presentes -->
                <div style="background:linear-gradient(135deg,#10b981 0%,#059669 100%);color:#fff;padding:20px;border-radius:12px;text-align:center">
                  <div style="font-size:2rem;margin-bottom:8px"></div>
                  <div style="font-size:1.1rem;font-weight:600;margin-bottom:4px">Presentes</div>
                  <div style="font-size:2rem;font-weight:700" id="total-presentes">0</div>
                </div>
                
                <!-- Ausentes -->
                <div style="background:linear-gradient(135deg,#ef4444 0%,#dc2626 100%);color:#fff;padding:20px;border-radius:12px;text-align:center">
                  <div style="font-size:2rem;margin-bottom:8px"></div>
                  <div style="font-size:1.1rem;font-weight:600;margin-bottom:4px">Ausentes</div>
                  <div style="font-size:2rem;font-weight:700" id="total-ausentes">1</div>
                </div>
              </div>
              
              <!-- Listas de Presentes e Ausentes -->
              <div style="display:grid;grid-template-columns:1fr 1fr;gap:24px;margin-bottom:24px" id="listas-frequencia">
                <!-- Lista de Presentes -->
                <div style="background:#f0fdf4;border:1px solid #bbf7d0;border-radius:12px;overflow:hidden">
                  <div style="background:#10b981;color:#fff;padding:16px;font-weight:600;display:flex;align-items:center;gap:8px">
                    <span></span> Presentes
                    <span style="background:rgba(255,255,255,0.2);padding:2px 8px;border-radius:12px;font-size:0.8rem" id="badge-presentes">0</span>
                  </div>
                  
                  <div style="padding:0">
                    <div style="background:#f1f5f9;padding:12px 16px;border-bottom:1px solid #e5e7eb;display:grid;grid-template-columns:100px 2fr 1.5fr 1.5fr;gap:12px;font-weight:600;color:#374151;font-size:0.85rem">
                      <div>Matrícula</div>
                      <div>Nome</div>
                      <div>Função</div>
                      <div>Empresa</div>
                    </div>
                    
                    <div id="lista-presentes" style="min-height:120px;color:#166534">
                      <div style="padding:40px 16px;text-align:center;color:#9ca3af;font-style:italic">
                        Nenhum funcionário presente
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- Lista de Ausentes -->
                <div style="background:#fef2f2;border:1px solid #fecaca;border-radius:12px;overflow:hidden">
                  <div style="background:#ef4444;color:#fff;padding:16px;font-weight:600;display:flex;align-items:center;gap:8px">
                    <span></span> Ausentes
                    <span style="background:rgba(255,255,255,0.2);padding:2px 8px;border-radius:12px;font-size:0.8rem" id="badge-ausentes">1</span>
                  </div>
                  
                  <div style="padding:0">
                    <div style="background:#f1f5f9;padding:12px 16px;border-bottom:1px solid #e5e7eb;display:grid;grid-template-columns:100px 2fr 1.5fr 1.5fr;gap:12px;font-weight:600;color:#374151;font-size:0.85rem">
                      <div>Matrícula</div>
                      <div>Nome</div>
                      <div>Função</div>
                      <div>Empresa</div>
                    </div>
                    
                    <div id="lista-ausentes" style="min-height:120px;color:#dc2626">
                      <div style="padding:12px 16px;border-bottom:1px solid #f3f4f6;display:grid;grid-template-columns:100px 2fr 1.5fr 1.5fr;gap:12px;align-items:center;font-size:0.85rem">
                        <div style="font-weight:500">28853</div>
                        <div>Ademilcio Ferreira Caldas</div>
                        <div style="color:#6b7280">Encarregado de obras II</div>
                        <div style="color:#6b7280">RS Construções</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Resumo do Dia -->
              <div style="background:#f8fafc;border:1px solid #e5e7eb;border-radius:12px;padding:20px">
                <h3 style="margin:0 0 16px 0;color:#374151;font-size:1.2rem">Resumo do Dia - <span id="data-resumo">01/11/2025</span></h3>
                
                <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:20px;text-align:center">
                  <div style="background:#f1f5f9;padding:16px;border-radius:8px">
                    <div style="font-size:0.9rem;color:#6b7280;margin-bottom:4px">Total de Funcionários</div>
                    <div style="font-size:1.8rem;font-weight:700;color:#3b82f6" id="resumo-total">1</div>
                  </div>
                  
                  <div style="background:#f0fdf4;padding:16px;border-radius:8px">
                    <div style="font-size:0.9rem;color:#6b7280;margin-bottom:4px">Presentes</div>
                    <div style="font-size:1.8rem;font-weight:700;color:#10b981" id="resumo-presentes">0</div>
                  </div>
                  
                  <div style="background:#fef2f2;padding:16px;border-radius:8px">
                    <div style="font-size:0.9rem;color:#6b7280;margin-bottom:4px">Ausentes</div>
                    <div style="font-size:1.8rem;font-weight:700;color:#ef4444" id="resumo-ausentes">1</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Seção CPT - Conversa Pré Tarefa -->
        <div id="cpt" style="display:none;max-width:none;margin:0;">
          <div style="background:#fff;border-radius:16px;box-shadow:0 4px 16px #0001;border:1px solid #e6edf3">
            <div style="background:linear-gradient(135deg,#f59e0b 0%,#d97706 100%);color:#fff;padding:20px 24px;border-radius:16px 16px 0 0">
              <div style="display:flex;justify-content:space-between;align-items:center">
                <div>
                  <div style="font-size:1.4rem;font-weight:700;margin-bottom:6px;display:flex;align-items:center;gap:8px">
                    <span></span> CPT - Conversa Pré Tarefa
                  </div>
                  <div style="font-size:1rem;opacity:0.9">Registre as conversas pré-trabalho da equipe</div>
                </div>
              </div>
            </div>
            
            <div style="padding:24px">
              <form id="form-cpt" autocomplete="off">
                <!-- Empresa -->
                <div style="margin-bottom:18px">
                  <label style="display:block;font-weight:600;color:#374151;margin-bottom:6px">
                    <span style="font-size:1.1rem;"></span> Empresa
                  </label>
                  <select id="cpt-empresa" required style="width:100%;padding:12px;font-size:1rem;border-radius:6px;border:1px solid #bbb;background:#fff">
                    <option value="">Selecione a empresa</option>
                    <option value="RS Construções">RS Construções</option>
                    <option value="Construtora ABC">Construtora ABC</option>
                    <option value="Metalúrgica XYZ">Metalúrgica XYZ</option>
                    <option value="Engenharia Beta">Engenharia Beta</option>
                  </select>
                </div>
                
                <!-- Data e Hora -->
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:18px">
                  <div>
                    <label style="display:block;font-weight:600;color:#374151;margin-bottom:6px">
                      <span style="font-size:1.1rem;"></span> Data
                    </label>
                    <input type="date" id="cpt-data" required style="width:100%;padding:12px;font-size:1rem;border-radius:6px;border:1px solid #bbb">
                  </div>
                  <div>
                    <label style="display:block;font-weight:600;color:#374151;margin-bottom:6px">
                      <span style="font-size:1.1rem;"></span> Hora
                    </label>
                    <input type="time" id="cpt-hora" required placeholder="Hora" style="width:100%;padding:12px;font-size:1rem;border-radius:6px;border:1px solid #bbb">
                  </div>
                </div>
                
                <!-- Líder da CPT -->
                <div style="margin-bottom:18px">
                  <label style="display:block;font-weight:600;color:#374151;margin-bottom:6px">
                    <span style="font-size:1.1rem;"></span> Líder da CPT
                  </label>
                  <input type="text" id="cpt-lider" required placeholder="Nome do líder responsável pela CPT" style="width:100%;padding:12px;font-size:1rem;border-radius:6px;border:1px solid #bbb">
                </div>
                
                <!-- Ãrea -->
                <div style="margin-bottom:18px">
                  <label style="display:block;font-weight:600;color:#374151;margin-bottom:6px">
                    <span style="font-size:1.1rem;"></span> Ãrea
                  </label>
                  <input type="text" id="cpt-area" required placeholder="Ãrea ou setor de trabalho" style="width:100%;padding:12px;font-size:1rem;border-radius:6px;border:1px solid #bbb">
                </div>
                
                <!-- Local de Execução -->
                <div style="margin-bottom:18px">
                  <label style="display:block;font-weight:600;color:#374151;margin-bottom:6px">
                    <span style="font-size:1.1rem;"></span> Local de Execução
                  </label>
                  <input type="text" id="cpt-local" required placeholder="Local específico da execução" style="width:100%;padding:12px;font-size:1rem;border-radius:6px;border:1px solid #bbb">
                </div>
                
                <!-- Descrição da Tarefa -->
                <div style="margin-bottom:18px">
                  <label style="display:block;font-weight:600;color:#374151;margin-bottom:6px">
                    <span style="font-size:1.1rem;"></span> Descrição da Tarefa
                  </label>
                  <textarea id="cpt-descricao" required placeholder="Descreva detalhadamente a tarefa a ser executada" style="width:100%;padding:12px;font-size:1rem;border-radius:6px;border:1px solid #bbb;min-height:100px;resize:vertical"></textarea>
                </div>
                
                <!-- Quantidades de Executantes -->
                <div style="margin-bottom:18px">
                  <label style="display:block;font-weight:600;color:#374151;margin-bottom:6px">
                    <span style="font-size:1.1rem;"></span> Quantidades de Executantes
                  </label>
                  <input type="number" id="cpt-executantes" required placeholder="Número de pessoas que executarão a tarefa" min="1" style="width:100%;padding:12px;font-size:1rem;border-radius:6px;border:1px solid #bbb">
                </div>
                
                <!-- Convidados / Líderes / Avaliadores -->
                <div style="margin-bottom:18px">
                  <label style="display:block;font-weight:600;color:#374151;margin-bottom:6px">
                    <span style="font-size:1.1rem;"></span> Convidados / Líderes / Avaliadores
                  </label>
                  <div style="background:#f8fafc;border:1px solid #e5e7eb;border-radius:8px;padding:16px">
                    <div id="lista-participantes-cpt">
                      <!-- Linha 1 -->
                      <div style="display:grid;grid-template-columns:1fr 120px;gap:12px;margin-bottom:12px">
                        <input type="text" placeholder="Nome do participante" style="padding:8px;border:1px solid #d1d5db;border-radius:4px;font-size:0.9rem">
                        <input type="text" placeholder="Matrícula" style="padding:8px;border:1px solid #d1d5db;border-radius:4px;font-size:0.9rem">
                      </div>
                      <!-- Linha 2 -->
                      <div style="display:grid;grid-template-columns:1fr 120px;gap:12px;margin-bottom:12px">
                        <input type="text" placeholder="Nome do participante" style="padding:8px;border:1px solid #d1d5db;border-radius:4px;font-size:0.9rem">
                        <input type="text" placeholder="Matrícula" style="padding:8px;border:1px solid #d1d5db;border-radius:4px;font-size:0.9rem">
                      </div>
                      <!-- Linha 3 -->
                      <div style="display:grid;grid-template-columns:1fr 120px;gap:12px;margin-bottom:12px">
                        <input type="text" placeholder="Nome do participante" style="padding:8px;border:1px solid #d1d5db;border-radius:4px;font-size:0.9rem">
                        <input type="text" placeholder="Matrícula" style="padding:8px;border:1px solid #d1d5db;border-radius:4px;font-size:0.9rem">
                      </div>
                    </div>
                    <button type="button" onclick="adicionarParticipanteCPT()" style="background:#f59e0b;color:#fff;border:none;border-radius:6px;padding:8px 16px;font-size:0.9rem;cursor:pointer;margin-top:8px">
                      + Adicionar Participante
                    </button>
                  </div>
                </div>
                
                <!-- Status e Data de Fechamento -->
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:24px">
                  <div>
                    <label style="display:block;font-weight:600;color:#374151;margin-bottom:6px">
                      <span style="font-size:1.1rem;"></span> Situação
                    </label>
                    <select id="cpt-status" required style="width:100%;padding:12px;font-size:1rem;border-radius:6px;border:1px solid #bbb;background:#fff">
                      <option value="">Selecione o status</option>
                      <option value="Em Aberto">Em Aberto</option>
                      <option value="Fechado">Fechado</option>
                    </select>
                  </div>
                  <div>
                    <label style="display:block;font-weight:600;color:#374151;margin-bottom:6px">
                      <span style="font-size:1.1rem;"></span> Data do Fechamento
                    </label>
                    <input type="date" id="cpt-data-fechamento" style="width:100%;padding:12px;font-size:1rem;border-radius:6px;border:1px solid #bbb">
                  </div>
                </div>
                
                <!-- Botão Anexar CPT-PDF -->
                <div style="text-align:center;margin-bottom:24px">
                  <button type="button" onclick="anexarCPTPDF()" style="background:#fff;border:2px dashed #f59e0b;color:#f59e0b;padding:16px 24px;border-radius:8px;font-size:1rem;cursor:pointer;font-weight:600">
                     Anexar CPT-PDF
                  </button>
                </div>
                
                <!-- Botões de Ação -->
                <div style="display:flex;gap:12px">
                  <button type="button" onclick="cancelarCPT()" style="flex:1;background:#6b7280;color:#fff;padding:12px;border:none;border-radius:6px;cursor:pointer;font-weight:600">
                    Cancelar
                  </button>
                  <button type="submit" style="flex:2;background:#f59e0b;color:#fff;padding:12px;border:none;border-radius:6px;cursor:pointer;font-weight:600">
                     Salvar CPT
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
        
        <!-- SeÃ§Ã£o ART - Análise de Risco da Tarefa -->
        <div id="art" style="display:none;max-width:none;margin:0;">
          <div style="background:#fff;border-radius:16px;box-shadow:0 4px 16px #0001;border:1px solid #e6edf3">
            <div style="background:linear-gradient(135deg,#8b5cf6 0%,#7c3aed 100%);color:#fff;padding:20px 24px;border-radius:16px 16px 0 0">
              <div style="display:flex;justify-content:space-between;align-items:center">
                <div>
                  <div style="font-size:1.4rem;font-weight:700;margin-bottom:6px;display:flex;align-items:center;gap:8px">
                    <span></span> ART - Análise de Risco da Tarefa
                  </div>
                  <div style="font-size:1rem;opacity:0.9">Sistema de registros e controle de ARTs</div>
                </div>
                <div style="display:flex;gap:12px">
                  <button id="btn-nova-art" type="button" style="background:#fff;color:#8b5cf6;padding:10px 20px;font-size:0.9rem;border:none;border-radius:6px;cursor:pointer;font-weight:600;display:flex;align-items:center;gap:6px">
                    <span></span> Nova ART
                  </button>
                  <button id="btn-historico-art" type="button" style="background:#10b981;color:#fff;padding:10px 20px;font-size:0.9rem;border:none;border-radius:6px;cursor:pointer;font-weight:600;display:flex;align-items:center;gap:6px">
                    <span></span> Histórico
                  </button>
                </div>
              </div>
            </div>
            
            <div style="padding:24px">
              <!-- Lista de ARTs Registradas -->
              <div id="art-lista" style="margin-bottom:24px">
                <h3 style="margin:0 0 16px 0;color:#374151;font-size:1.2rem">Registros de ART</h3>
                
                <div style="background:#f8fafc;border:1px solid #e5e7eb;border-radius:8px;overflow:hidden">
                  <!-- Cabeçalho da tabela -->
                  <div style="background:#f1f5f9;padding:12px 16px;border-bottom:1px solid #e5e7eb;display:grid;grid-template-columns:100px 2fr 1fr 1fr 1fr 100px;gap:16px;font-weight:600;color:#374151">
                    <div>NÃºmero</div>
                    <div>Tarefa</div>
                    <div>Ãrea</div>
                    <div>Riscos</div>
                    <div>Status</div>
                    <div>Ações</div>
                  </div>
                  
                  <!-- Lista de ARTs -->
                  <div id="art-tbody">
                    <!-- ARTs serÃ£o carregadas dinamicamente -->
                  </div>
                </div>
                
                <div style="margin-top:16px;text-align:center;color:#6b7280">
                  Total de ARTs: <span id="total-art" style="font-weight:600;color:#8b5cf6">0</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Modal Nova ART -->
        <div id="modal-nova-art" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:#00000080;z-index:1000;padding:20px;box-sizing:border-box">
          <div style="max-width:900px;margin:0 auto;background:#fff;border-radius:12px;max-height:90vh;overflow-y:auto">
            <div style="background:linear-gradient(135deg,#059669 0%,#047857 100%);color:#fff;padding:20px 24px;border-radius:12px 12px 0 0">
              <div style="display:flex;justify-content:space-between;align-items:center">
                <h2 style="margin:0;font-size:1.5rem;font-weight:700;display:flex;align-items:center;gap:8px">
                  <span></span> Nova Análise de Risco da Tarefa (ART)
                </h2>
                <button id="fechar-modal-art" style="background:none;border:none;color:#fff;font-size:24px;cursor:pointer;padding:4px">&times;</button>
              </div>
            </div>
            
            <form id="form-nova-art" style="padding:24px">
              <!-- SeÃ§Ã£o 1: IdentificaÃ§Ã£o -->
              <div style="margin-bottom:32px">
                <h3 style="margin:0 0 16px 0;color:#059669;font-size:1.2rem;font-weight:600;border-bottom:2px solid #e5e7eb;padding-bottom:8px">
                   IdentificaÃ§Ã£o da ART
                </h3>
                <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:20px">
                  <div>
                    <label style="display:block;margin-bottom:6px;font-weight:600;color:#374151">NÃºmero da ART *</label>
                    <input type="text" id="art-numero" placeholder="Ex: ART-001" style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem" required>
                  </div>
                  
                  <div>
                    <label style="display:block;margin-bottom:6px;font-weight:600;color:#374151">Data da Análise *</label>
                    <input type="date" id="art-data" style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem" required>
                  </div>
                  
                  <div>
                    <label style="display:block;margin-bottom:6px;font-weight:600;color:#374151">Status</label>
                    <select id="art-status" style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem">
                      <option value="Pendente">Pendente</option>
                      <option value="Em Análise">Em Análise</option>
                      <option value="Aprovada">Aprovada</option>
                      <option value="Reprovada">Reprovada</option>
                      <option value="ConcluÃ­da">ConcluÃ­da</option>
                    </select>
                  </div>
                </div>
              </div>
              
              <!-- SeÃ§Ã£o 2: DescriÃ§Ã£o da Tarefa -->
              <div style="margin-bottom:32px">
                <h3 style="margin:0 0 16px 0;color:#059669;font-size:1.2rem;font-weight:600;border-bottom:2px solid #e5e7eb;padding-bottom:8px">
                   DescriÃ§Ã£o da Tarefa
                </h3>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px">
                  <div>
                    <label style="display:block;margin-bottom:6px;font-weight:600;color:#374151">Ãrea/Local *</label>
                    <input type="text" id="art-area" placeholder="Ex: BAP 1B, EscritÃ³rio, etc." style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem" required>
                  </div>
                  
                  <div>
                    <label style="display:block;margin-bottom:6px;font-weight:600;color:#374151">ResponsÃ¡vel pela Análise *</label>
                    <input type="text" id="art-responsavel" placeholder="Nome do responsÃ¡vel" style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem" required>
                  </div>
                </div>
                
                <div>
                  <label style="display:block;margin-bottom:6px;font-weight:600;color:#374151">Tarefa/Atividade *</label>
                  <textarea id="art-tarefa" placeholder="Descreva detalhadamente a tarefa a ser analisada, incluindo etapas, equipamentos utilizados, etc." rows="4" style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;resize:vertical" required></textarea>
                </div>
              </div>
              
              <!-- SeÃ§Ã£o 3: Análise de Riscos -->
              <div style="margin-bottom:32px">
                <h3 style="margin:0 0 16px 0;color:#dc2626;font-size:1.2rem;font-weight:600;border-bottom:2px solid #e5e7eb;padding-bottom:8px">
                   ï¸ Análise de Riscos
                </h3>
                <div style="margin-bottom:20px">
                  <label style="display:block;margin-bottom:6px;font-weight:600;color:#374151">Riscos Identificados *</label>
                  <textarea id="art-riscos" placeholder="Liste todos os riscos identificados na tarefa (queda em altura, choque elÃ©trico, exposiÃ§Ã£o a produtos quÃ­micos, etc.)" rows="4" style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;resize:vertical" required></textarea>
                </div>
                
                <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:20px;margin-bottom:20px">
                  <div>
                    <label style="display:block;margin-bottom:6px;font-weight:600;color:#374151">Severidade</label>
                    <select id="art-severidade" style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem">
                      <option value="">Selecione</option>
                      <option value="Baixa">Baixa</option>
                      <option value="MÃ©dia">MÃ©dia</option>
                      <option value="Alta">Alta</option>
                      <option value="CrÃ­tica">CrÃ­tica</option>
                    </select>
                  </div>
                  
                  <div>
                    <label style="display:block;margin-bottom:6px;font-weight:600;color:#374151">Probabilidade</label>
                    <select id="art-probabilidade" style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem">
                      <option value="">Selecione</option>
                      <option value="Baixa">Baixa</option>
                      <option value="MÃ©dia">MÃ©dia</option>
                      <option value="Alta">Alta</option>
                    </select>
                  </div>
                  
                  <div>
                    <label style="display:block;margin-bottom:6px;font-weight:600;color:#374151">NÃ­vel de Risco</label>
                    <input type="text" id="art-nivel-risco" placeholder="Calculado automaticamente" readonly style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;background:#f9fafb">
                  </div>
                </div>
              </div>
              
              <!-- SeÃ§Ã£o 4: Medidas de Controle -->
              <div style="margin-bottom:32px">
                <h3 style="margin:0 0 16px 0;color:#059669;font-size:1.2rem;font-weight:600;border-bottom:2px solid #e5e7eb;padding-bottom:8px">
                   Medidas de Controle e MitigaÃ§Ã£o
                </h3>
                <div style="margin-bottom:20px">
                  <label style="display:block;margin-bottom:6px;font-weight:600;color:#374151">Medidas Preventivas *</label>
                  <textarea id="art-medidas" placeholder="Descreva as medidas preventivas e de controle dos riscos identificados (EPI, procedimentos, treinamentos, etc.)" rows="4" style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;resize:vertical" required></textarea>
                </div>
                
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px">
                  <div>
                    <label style="display:block;margin-bottom:6px;font-weight:600;color:#374151">Equipamentos de ProteÃ§Ã£o</label>
                    <input type="text" id="art-epi" placeholder="Ex: Capacete, luvas, Ã³culos, etc." style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem">
                  </div>
                  
                  <div>
                    <label style="display:block;margin-bottom:6px;font-weight:600;color:#374151">Procedimentos de EmergÃªncia</label>
                    <input type="text" id="art-emergencia" placeholder="Ex: Plano de evacuaÃ§Ã£o, primeiros socorros" style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem">
                  </div>
                </div>
              </div>
              
              <!-- SeÃ§Ã£o 5: ObservaÃ§Ãµes e AprovaÃ§Ã£o -->
              <div style="margin-bottom:32px">
                <h3 style="margin:0 0 16px 0;color:#7c3aed;font-size:1.2rem;font-weight:600;border-bottom:2px solid #e5e7eb;padding-bottom:8px">
                   ObservaÃ§Ãµes e AprovaÃ§Ã£o
                </h3>
                <div style="margin-bottom:20px">
                  <label style="display:block;margin-bottom:6px;font-weight:600;color:#374151">ObservaÃ§Ãµes Adicionais</label>
                  <textarea id="art-observacoes" placeholder="ObservaÃ§Ãµes complementares, recomendaÃ§Ãµes especiais, etc." rows="3" style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;resize:vertical"></textarea>
                </div>
                
                <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:20px">
                  <div>
                    <label style="display:block;margin-bottom:6px;font-weight:600;color:#374151">Aprovado por</label>
                    <input type="text" id="art-aprovador" placeholder="Nome do aprovador" style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem">
                  </div>
                  
                  <div>
                    <label style="display:block;margin-bottom:6px;font-weight:600;color:#374151">Data da AprovaÃ§Ã£o</label>
                    <input type="date" id="art-data-aprovacao" style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem">
                  </div>
                  
                  <div>
                    <label style="display:block;margin-bottom:6px;font-weight:600;color:#374151">RevisÃ£o NecessÃ¡ria</label>
                    <select id="art-revisao" style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem">
                      <option value="NÃ£o">NÃ£o</option>
                      <option value="Sim">Sim</option>
                    </select>
                  </div>
                </div>
              </div>
              
              <div style="display:flex;justify-content:flex-end;gap:12px;padding-top:20px;border-top:1px solid #e5e7eb">
                <button type="button" id="cancelar-art" style="background:#6b7280;color:#fff;padding:12px 24px;border:none;border-radius:6px;cursor:pointer;font-weight:600">Cancelar</button>
                <button type="submit" style="background:#059669;color:#fff;padding:12px 24px;border:none;border-radius:6px;cursor:pointer;font-weight:600">Salvar ART</button>
              </div>
            </form>
          </div>
        </div>
        
        <!-- SeÃ§Ã£o Inspeção de HSE -->
        <div id="inspecao" style="display:none;max-width:none;margin:0;">
          <div style="background:#fff;border-radius:16px;box-shadow:0 4px 16px #0001;border:1px solid #e6edf3">
            <div style="background:linear-gradient(135deg,#059669 0%,#047857 100%);color:#fff;padding:20px 24px;border-radius:16px 16px 0 0">
              <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:16px">
                <div>
                  <div style="font-size:1.4rem;font-weight:700;margin-bottom:6px;display:flex;align-items:center;gap:8px">
                    <span></span> Inspeção de HSE
                  </div>
                  <div style="font-size:1rem;opacity:0.9">Sistema de registros e controle de inspeÃ§Ãµes</div>
                </div>
                <div style="display:flex;gap:12px;flex-wrap:wrap">
                  <button id="btn-nova-inspecao" type="button" style="background:#fff;color:#059669;padding:10px 20px;font-size:0.9rem;border:none;border-radius:6px;cursor:pointer;font-weight:600;display:flex;align-items:center;gap:6px">
                    <span></span> Nova Inspeção
                  </button>
                  <button id="btn-cadastrar-area" type="button" style="background:#10b981;color:#fff;padding:10px 20px;font-size:0.9rem;border:none;border-radius:6px;cursor:pointer;font-weight:600;display:flex;align-items:center;gap:6px">
                    <span></span> Cadastrar Ãrea / Local
                  </button>
                  <button id="btn-cadastrar-categoria" type="button" style="background:#059669;color:#fff;padding:10px 20px;font-size:0.9rem;border:none;border-radius:6px;cursor:pointer;font-weight:600;display:flex;align-items:center;gap:6px">
                    <span></span> Cadastrar Categoria
                  </button>
                  <!-- BotÃ£o para cadastrar novos tipos de registro -->
                  <button id="btn-cadastrar-tipo-registro" type="button" style="background:#7c3aed;color:#fff;padding:10px 20px;font-size:0.9rem;border:none;border-radius:6px;cursor:pointer;font-weight:600;display:flex;align-items:center;gap:6px">
                    <span></span> Cadastrar Tipo de Registro
                  </button>
                  <!-- BotÃ£o para cadastrar riscos e perigos - ATUALIZADO -->
                  <button id="btn-cadastrar-riscos-perigos" type="button" style="background:#dc2626;color:#fff;padding:10px 20px;font-size:0.9rem;border:none;border-radius:6px;cursor:pointer;font-weight:600;display:flex;align-items:center;gap:6px;box-shadow:0 2px 4px rgba(0,0,0,0.1)">
                    <span> ï¸</span> Cadastrar Riscos / Perigos
                  </button>
                </div>
              </div>
            </div>
            
            <div style="padding:24px">
              <!-- Registros de Inspeção -->
              <div id="lista-inspecoes-section">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
                  <h3 style="margin:0;color:#374151;font-size:1.3rem">Registros de Inspeção</h3>
                </div>
                
                <!-- Tabela de InspeÃ§Ãµes -->
                <div style="background:#f8fafc;border:1px solid #e5e7eb;border-radius:12px;overflow-x:auto;overflow-y:hidden">
                  <div style="min-width:1200px">
                  <!-- Cabeçalho da tabela -->
                  <div style="background:#f1f5f9;padding:12px 16px;border-bottom:1px solid #e5e7eb;display:grid;grid-template-columns:100px 80px 100px 80px 80px 120px 100px 100px 140px 100px 100px 140px;gap:8px;font-weight:600;color:#374151;font-size:0.85rem">
                    <div>Data</div>
                    <div>Ãrea</div>
                    <div>Local</div>
                    <div>Tipo</div>
                    <div>Semana</div>
                    <div>Categoria</div>
                    <div>Severidade</div>
                    <div>InterdiÃ§Ã£o</div>
                    <div>ResponsÃ¡vel</div>
                    <div>Status</div>
                    <div>Fotos</div>
                    <div>Ações</div>
                  </div>
                  
                  <!-- Lista de inspeÃ§Ãµes -->
                  <div id="lista-inspecoes">
                    <!-- Exemplo de inspeÃ§Ã£o -->
                    <div style="padding:12px 16px;border-bottom:1px solid #f3f4f6;display:grid;grid-template-columns:100px 80px 100px 80px 80px 120px 100px 100px 140px 100px 100px 140px;gap:8px;align-items:center;font-size:0.8rem">
                      <div style="color:#374151;font-weight:500">04/11/2025</div>
                      <div style="color:#374151">BAP 1B</div>
                      <div style="color:#6b7280">EscavaÃ§Ã£o</div>
                      <div style="color:#6b7280">Inspeção</div>
                      <div style="color:#6b7280">45</div>
                      <div style="color:#6b7280">Segurança do trabalho</div>
                      <div><span style="background:#10b981;color:#fff;padding:2px 8px;border-radius:12px;font-size:0.75rem">Baixa</span></div>
                      <div><span style="color:#ef4444;font-weight:600">NÃ£o</span></div>
                      <div style="color:#6b7280">Ademilcio Ferreira Caldas</div>
                      <div><span style="background:#10b981;color:#fff;padding:2px 8px;border-radius:12px;font-size:0.75rem">CONCLUÃDO</span></div>
                      <div>
                        <button onclick="mostrarFotosInspecao('1')" style="background:#3b82f6;color:#fff;border:none;border-radius:4px;padding:4px 8px;font-size:0.75rem;cursor:pointer" title="Ver e baixar fotos"> 2 Fotos</button>
                      </div>
                      <div style="display:flex;gap:4px">
                        <button onclick="mostrarRelatorioInspecao('1')" style="background:#8b5cf6;color:#fff;border:none;border-radius:4px;padding:4px 6px;font-size:0.7rem;cursor:pointer" title="Ver Relatório"></button>
                        <button onclick="editarInspecao('1')" style="background:#f59e0b;color:#fff;border:none;border-radius:4px;padding:4px 6px;font-size:0.7rem;cursor:pointer"></button>
                        <button onclick="excluirInspecao('1')" style="background:#ef4444;color:#fff;border:none;border-radius:4px;padding:4px 6px;font-size:0.7rem;cursor:pointer"></button>
                      </div>
                    </div>
                    
                    <!-- Segunda inspeÃ§Ã£o exemplo -->
                    <div style="padding:12px 16px;border-bottom:1px solid #f3f4f6;display:grid;grid-template-columns:100px 80px 100px 80px 80px 120px 100px 100px 140px 100px 100px 140px;gap:8px;align-items:center;font-size:0.8rem">
                      <div style="color:#374151;font-weight:500">03/11/2025</div>
                      <div style="color:#374151">BAP 1B</div>
                      <div style="color:#6b7280">EscavaÃ§Ã£o</div>
                      <div style="color:#6b7280">Inspeção</div>
                      <div style="color:#6b7280">45</div>
                      <div style="color:#6b7280">Segurança do trabalho</div>
                      <div><span style="background:#f59e0b;color:#fff;padding:2px 8px;border-radius:12px;font-size:0.75rem">MÃ©dia</span></div>
                      <div><span style="color:#ef4444;font-weight:600">NÃ£o</span></div>
                      <div style="color:#6b7280">Ademilcio Ferreira Caldas</div>
                      <div><span style="background:#10b981;color:#fff;padding:2px 8px;border-radius:12px;font-size:0.75rem">CONCLUÃDO</span></div>
                      <div>
                        <button style="background:#3b82f6;color:#fff;border:none;border-radius:4px;padding:4px 8px;font-size:0.75rem;cursor:pointer"> Ver Fotos</button>
                      </div>
                      <div style="display:flex;gap:4px">
                        <button onclick="editarInspecao('2')" style="background:#f59e0b;color:#fff;border:none;border-radius:4px;padding:4px 6px;font-size:0.7rem;cursor:pointer"></button>
                        <button onclick="excluirInspecao('2')" style="background:#ef4444;color:#fff;border:none;border-radius:4px;padding:4px 6px;font-size:0.7rem;cursor:pointer"></button>
                      </div>
                    </div>
                  </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Modal Nova Inspeção -->
        <div id="modal-nova-inspecao" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:1002;justify-content:center;align-items:center;overflow-y:auto">
          <div style="background:#fff;border-radius:12px;width:90%;max-width:800px;max-height:90vh;overflow-y:auto;margin:20px">
            <div style="background:linear-gradient(135deg,#059669 0%,#047857 100%);color:#fff;padding:20px;border-radius:12px 12px 0 0">
              <h2 style="margin:0;font-size:1.3rem;font-weight:700;display:flex;align-items:center;gap:8px">
                <span></span> Nova Inspeção de HSE
              </h2>
            </div>
            
            <div style="padding:24px">
              <form id="form-nova-inspecao">
                <!-- Primeira linha: Data, Ãrea, Local -->
                <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px;margin-bottom:16px">
                  <div>
                    <label style="display:block;font-weight:500;color:#374151;margin-bottom:6px;font-size:0.9rem">Data do Registro</label>
                    <input type="date" id="insp-data" required style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem">
                  </div>
                  
                  <div>
                    <label style="display:block;font-weight:500;color:#374151;margin-bottom:6px;font-size:0.9rem">Ãrea</label>
                    <select id="insp-area" required style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;background:#fff">
                      <option value=""></option>
                      <!-- OpÃ§Ãµes carregadas dinamicamente -->
                    </select>
                  </div>
                  
                  <div>
                    <label style="display:block;font-weight:500;color:#374151;margin-bottom:6px;font-size:0.9rem">Local</label>
                    <select id="insp-local" required style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;background:#fff">
                      <option value=""></option>
                      <!-- OpÃ§Ãµes carregadas dinamicamente -->
                    </select>
                  </div>
                </div>
                
                <!-- Segunda linha: Tipo de Registro, Semana -->
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px">
                  <div>
                    <label style="display:block;font-weight:500;color:#374151;margin-bottom:6px;font-size:0.9rem">Tipo de Registro</label>
                    <select id="insp-tipo" required style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem">
                      <option value="">Selecione o tipo de registro...</option>
                    </select>
                  </div>
                  
                  <div>
                    <label style="display:block;font-weight:500;color:#374151;margin-bottom:6px;font-size:0.9rem">Semana</label>
                    <input type="number" id="insp-semana" required min="1" max="53" style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem">
                  </div>
                </div>
                
                <!-- Terceira linha: DescriÃ§Ã£o do Desvio -->
                <div style="margin-bottom:16px">
                  <label style="display:block;font-weight:500;color:#374151;margin-bottom:6px;font-size:0.9rem">DescriÃ§Ã£o do Desvio</label>
                  <textarea id="insp-descricao" placeholder="Descreva detalhadamente a situaÃ§Ã£o encontrada..." style="width:100%;padding:12px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;min-height:80px;resize:vertical"></textarea>
                </div>
                
                <!-- Quarta linha: Upload de Fotos -->
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px">
                  <div>
                    <label style="display:block;font-weight:500;color:#374151;margin-bottom:6px;font-size:0.9rem">Foto Antes</label>
                    <div style="border:2px dashed #d1d5db;border-radius:6px;padding:40px 20px;text-align:center;background:#fafbfc;cursor:pointer" onclick="document.getElementById('insp-foto-antes').click()">
                      <div style="font-size:2rem;margin-bottom:8px;color:#9ca3af"></div>
                      <div style="font-size:0.85rem;color:#6b7280">Clique para adicionar</div>
                      <input type="file" id="insp-foto-antes" accept="image/*" style="display:none">
                    </div>
                    <div id="preview-foto-antes" style="margin-top:8px;display:none"></div>
                  </div>
                  
                  <div>
                    <label style="display:block;font-weight:500;color:#374151;margin-bottom:6px;font-size:0.9rem">Foto Depois</label>
                    <div style="border:2px dashed #d1d5db;border-radius:6px;padding:40px 20px;text-align:center;background:#fafbfc;cursor:pointer" onclick="document.getElementById('insp-foto-depois').click()">
                      <div style="font-size:2rem;margin-bottom:8px;color:#9ca3af"></div>
                      <div style="font-size:0.85rem;color:#6b7280">Clique para adicionar</div>
                      <input type="file" id="insp-foto-depois" accept="image/*" style="display:none">
                    </div>
                    <div id="preview-foto-depois" style="margin-top:8px;display:none"></div>
                  </div>
                </div>
                
                <!-- Quinta linha: Ações Tomadas -->
                <div style="margin-bottom:16px">
                  <label style="display:block;font-weight:500;color:#374151;margin-bottom:6px;font-size:0.9rem">Ações Tomadas</label>
                  <textarea id="insp-acoes" placeholder="Descreva as aÃ§Ãµes tomadas para resolver a situaÃ§Ã£o..." style="width:100%;padding:12px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;min-height:80px;resize:vertical"></textarea>
                </div>
                
                <!-- Sexta linha: Categoria, ClassificaÃ§Ã£o, Severidade -->
                <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px;margin-bottom:16px">
                  <div>
                    <label style="display:block;font-weight:500;color:#374151;margin-bottom:6px;font-size:0.9rem">Categoria</label>
                    <select id="insp-categoria" required style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;background:#fff">
                      <option value=""></option>
                      <!-- OpÃ§Ãµes carregadas dinamicamente -->
                    </select>
                  </div>
                  
                  <div>
                    <label style="display:block;font-weight:500;color:#374151;margin-bottom:6px;font-size:0.9rem">ClassificaÃ§Ã£o</label>
                    <select id="insp-classificacao" required style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;background:#fff">
                      <option value=""></option>
                      <!-- OpÃ§Ãµes carregadas dinamicamente -->
                    </select>
                  </div>
                  
                  <div>
                    <label style="display:block;font-weight:500;color:#374151;margin-bottom:6px;font-size:0.9rem">Severidade</label>
                    <select id="insp-severidade" required style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;background:#fff">
                      <option value=""></option>
                      <option value="Baixa">Baixa</option>
                      <option value="MÃ©dia">MÃ©dia</option>
                      <option value="Alta">Alta</option>
                      <option value="CrÃ­tica">CrÃ­tica</option>
                    </select>
                  </div>
                </div>
                
                <!-- SÃ©tima linha: Risco/Perigo, ControlÃ¡vel, InterdiÃ§Ã£o -->
                <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px;margin-bottom:16px">
                  <div>
                    <label style="display:block;font-weight:500;color:#374151;margin-bottom:6px;font-size:0.9rem">Risco/Perigo</label>
                    <select id="insp-risco" required style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;background:#fff">
                      <option value="">Selecione o risco/perigo...</option>
                    </select>
                  </div>
                  
                  <div>
                    <label style="display:block;font-weight:500;color:#374151;margin-bottom:6px;font-size:0.9rem">ControlÃ¡vel</label>
                    <select id="insp-controlavel" required style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;background:#fff">
                      <option value=""></option>
                      <option value="Sim">Sim</option>
                      <option value="NÃ£o">NÃ£o</option>
                    </select>
                  </div>
                  
                  <div>
                    <label style="display:block;font-weight:500;color:#374151;margin-bottom:6px;font-size:0.9rem">InterdiÃ§Ã£o</label>
                    <select id="insp-interdicao" required style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;background:#fff">
                      <option value=""></option>
                      <option value="Sim">Sim</option>
                      <option value="NÃ£o">NÃ£o</option>
                    </select>
                  </div>
                </div>
                
                <!-- Oitava linha: Emissor, ResponsÃ¡vel pela aÃ§Ã£o -->
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px">
                  <div>
                    <label style="display:block;font-weight:500;color:#374151;margin-bottom:6px;font-size:0.9rem">Emissor</label>
                    <input type="text" id="insp-emissor" required placeholder="" style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem">
                  </div>
                  
                  <div>
                    <label style="display:block;font-weight:500;color:#374151;margin-bottom:6px;font-size:0.9rem">ResponsÃ¡vel pela aÃ§Ã£o</label>
                    <input type="text" id="insp-responsavel" required placeholder="" style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem">
                  </div>
                </div>
                
                <!-- Nona linha: Prazo, ConclusÃ£o, Status -->
                <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px;margin-bottom:24px">
                  <div>
                    <label style="display:block;font-weight:500;color:#374151;margin-bottom:6px;font-size:0.9rem">Prazo</label>
                    <input type="date" id="insp-prazo" required style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem">
                  </div>
                  
                  <div>
                    <label style="display:block;font-weight:500;color:#374151;margin-bottom:6px;font-size:0.9rem">ConclusÃ£o</label>
                    <input type="date" id="insp-conclusao" style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem">
                  </div>
                  
                  <div>
                    <label style="display:block;font-weight:500;color:#374151;margin-bottom:6px;font-size:0.9rem">Status</label>
                    <select id="insp-status" required style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;background:#fff">
                      <option value=""></option>
                      <option value="PENDENTE">PENDENTE</option>
                      <option value="EM ANDAMENTO">EM ANDAMENTO</option>
                      <option value="CONCLUÃDO">CONCLUÃDO</option>
                    </select>
                  </div>
                </div>
                
                <div style="display:flex;gap:12px;justify-content:flex-end">
                  <button type="button" onclick="fecharModalInspecao()" style="background:#6b7280;color:#fff;padding:10px 20px;border:none;border-radius:6px;cursor:pointer;font-weight:500;font-size:0.9rem">
                    Cancelar
                  </button>
                  <button type="submit" style="background:#3b82f6;color:#fff;padding:10px 20px;border:none;border-radius:6px;cursor:pointer;font-weight:500;font-size:0.9rem">
                    Salvar Inspeção
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>

        <!-- Modal Relatório de Inspeção -->
        <div id="modal-relatorio-inspecao" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:1003;justify-content:center;align-items:center;overflow-y:auto">
          <div style="background:#fff;border-radius:12px;max-width:800px;width:90%;max-height:90vh;overflow-y:auto;box-shadow:0 20px 25px -5px rgba(0,0,0,0.1)">
            <div style="padding:24px">
              <!-- Cabeçalho do Relatório -->
              <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:20px">
                <div>
                  <h2 style="margin:0;color:#374151;font-size:1.5rem;font-weight:700;display:flex;align-items:center;gap:8px">
                     Relatório de Inspeção
                  </h2>
                  <p style="margin:4px 0 0 0;color:#6b7280;font-size:0.9rem">InformaÃ§Ãµes detalhadas da inspeÃ§Ã£o</p>
                </div>
                <button onclick="fecharModalRelatorio()" style="background:none;border:none;font-size:1.5rem;color:#9ca3af;cursor:pointer;padding:4px"></button>
              </div>

              <!-- ConteÃºdo do Relatório -->
              <div id="conteudo-relatorio">
                <!-- ConteÃºdo serÃ¡ preenchido dinamicamente -->
              </div>

              <!-- BotÃµes do RodapÃ© -->
              <div style="display:flex;gap:12px;justify-content:flex-end;margin-top:24px;padding-top:20px;border-top:1px solid #e5e7eb">
                <button onclick="imprimirRelatorio()" style="background:#059669;color:#fff;padding:10px 20px;border:none;border-radius:6px;cursor:pointer;font-weight:500;font-size:0.9rem;display:flex;align-items:center;gap:6px">
                   Imprimir
                </button>
                <button onclick="fecharModalRelatorio()" style="background:#6b7280;color:#fff;padding:10px 20px;border:none;border-radius:6px;cursor:pointer;font-weight:500;font-size:0.9rem">
                  Fechar
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Modal Fotos da Inspeção -->
        <div id="modal-fotos-inspecao" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:1004;justify-content:center;align-items:center;overflow-y:auto">
          <div style="background:#fff;border-radius:12px;max-width:900px;width:90%;max-height:90vh;overflow-y:auto;box-shadow:0 20px 25px -5px rgba(0,0,0,0.1)">
            <div style="padding:24px">
              <!-- Cabeçalho -->
              <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:20px">
                <div>
                  <h2 style="margin:0;color:#374151;font-size:1.5rem;font-weight:700;display:flex;align-items:center;gap:8px">
                     Fotos da Inspeção
                  </h2>
                  <p style="margin:4px 0 0 0;color:#6b7280;font-size:0.9rem">Visualize e faÃ§a download das fotos</p>
                </div>
                <button onclick="fecharModalFotos()" style="background:none;border:none;font-size:1.5rem;color:#9ca3af;cursor:pointer;padding:4px"></button>
              </div>

              <!-- ConteÃºdo das Fotos -->
              <div id="conteudo-fotos">
                <!-- ConteÃºdo serÃ¡ preenchido dinamicamente -->
              </div>

              <!-- BotÃµes do RodapÃ© -->
              <div style="display:flex;gap:12px;justify-content:flex-end;margin-top:24px;padding-top:20px;border-top:1px solid #e5e7eb">
                <button onclick="baixarTodasFotos()" style="background:#059669;color:#fff;padding:10px 20px;border:none;border-radius:6px;cursor:pointer;font-weight:500;font-size:0.9rem;display:flex;align-items:center;gap:6px">
                   Baixar Todas
                </button>
                <button onclick="fecharModalFotos()" style="background:#6b7280;color:#fff;padding:10px 20px;border:none;border-radius:6px;cursor:pointer;font-weight:500;font-size:0.9rem">
                  Fechar
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Modal Editar Inspeção -->
        <div id="modal-editar-inspecao" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:1005;justify-content:center;align-items:center;overflow-y:auto">
          <div style="background:#fff;border-radius:12px;width:90%;max-width:800px;max-height:90vh;overflow-y:auto;margin:20px">
            <div style="background:linear-gradient(135deg,#f59e0b 0%,#d97706 100%);color:#fff;padding:20px;border-radius:12px 12px 0 0">
              <h2 style="margin:0;font-size:1.3rem;font-weight:700;display:flex;align-items:center;gap:8px">
                <span></span> Editar Inspeção de HSE
              </h2>
            </div>
            
            <div style="padding:24px">
              <form id="form-editar-inspecao">
                <!-- Primeira linha: Data, Ãrea, Local -->
                <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px;margin-bottom:16px">
                  <div>
                    <label style="display:block;font-weight:500;color:#374151;margin-bottom:6px;font-size:0.9rem">Data do Registro</label>
                    <input type="date" id="edit-insp-data" required style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem">
                  </div>
                  
                  <div>
                    <label style="display:block;font-weight:500;color:#374151;margin-bottom:6px;font-size:0.9rem">Ãrea</label>
                    <select id="edit-insp-area" required style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;background:#fff">
                      <option value=""></option>
                      <!-- OpÃ§Ãµes carregadas dinamicamente -->
                    </select>
                  </div>
                  
                  <div>
                    <label style="display:block;font-weight:500;color:#374151;margin-bottom:6px;font-size:0.9rem">Local</label>
                    <select id="edit-insp-local" required style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;background:#fff">
                      <option value=""></option>
                      <!-- OpÃ§Ãµes carregadas dinamicamente -->
                    </select>
                  </div>
                </div>
                
                <!-- Segunda linha: Tipo de Registro, Semana -->
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px">
                  <div>
                    <label style="display:block;font-weight:500;color:#374151;margin-bottom:6px;font-size:0.9rem">Tipo de Registro</label>
                    <select id="edit-insp-tipo" required style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem">
                      <option value="">Selecione o tipo de registro...</option>
                    </select>
                  </div>
                  
                  <div>
                    <label style="display:block;font-weight:500;color:#374151;margin-bottom:6px;font-size:0.9rem">Semana</label>
                    <input type="number" id="edit-insp-semana" required min="1" max="53" style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem">
                  </div>
                </div>
                
                <!-- Terceira linha: DescriÃ§Ã£o do Desvio -->
                <div style="margin-bottom:16px">
                  <label style="display:block;font-weight:500;color:#374151;margin-bottom:6px;font-size:0.9rem">DescriÃ§Ã£o do Desvio</label>
                  <textarea id="edit-insp-descricao" placeholder="Descreva detalhadamente a situaÃ§Ã£o encontrada..." style="width:100%;padding:12px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;min-height:80px;resize:vertical"></textarea>
                </div>
                
                <!-- Quarta linha: Upload de Fotos -->
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px">
                  <div>
                    <label style="display:block;font-weight:500;color:#374151;margin-bottom:6px;font-size:0.9rem">Foto Antes</label>
                    <div style="border:2px dashed #d1d5db;border-radius:6px;padding:40px 20px;text-align:center;background:#fafbfc;cursor:pointer" onclick="document.getElementById('edit-insp-foto-antes').click()">
                      <div style="font-size:2rem;margin-bottom:8px;color:#9ca3af"></div>
                      <div style="font-size:0.85rem;color:#6b7280">Clique para alterar</div>
                      <input type="file" id="edit-insp-foto-antes" accept="image/*" style="display:none">
                    </div>
                    <div id="edit-preview-foto-antes" style="margin-top:8px"></div>
                  </div>
                  
                  <div>
                    <label style="display:block;font-weight:500;color:#374151;margin-bottom:6px;font-size:0.9rem">Foto Depois</label>
                    <div style="border:2px dashed #d1d5db;border-radius:6px;padding:40px 20px;text-align:center;background:#fafbfc;cursor:pointer" onclick="document.getElementById('edit-insp-foto-depois').click()">
                      <div style="font-size:2rem;margin-bottom:8px;color:#9ca3af"></div>
                      <div style="font-size:0.85rem;color:#6b7280">Clique para alterar</div>
                      <input type="file" id="edit-insp-foto-depois" accept="image/*" style="display:none">
                    </div>
                    <div id="edit-preview-foto-depois" style="margin-top:8px"></div>
                  </div>
                </div>
                
                <!-- Quinta linha: Ações Tomadas -->
                <div style="margin-bottom:16px">
                  <label style="display:block;font-weight:500;color:#374151;margin-bottom:6px;font-size:0.9rem">Ações Tomadas</label>
                  <textarea id="edit-insp-acoes" placeholder="Descreva as aÃ§Ãµes tomadas para resolver a situaÃ§Ã£o..." style="width:100%;padding:12px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;min-height:80px;resize:vertical"></textarea>
                </div>
                
                <!-- Sexta linha: Categoria, ClassificaÃ§Ã£o, Severidade -->
                <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px;margin-bottom:16px">
                  <div>
                    <label style="display:block;font-weight:500;color:#374151;margin-bottom:6px;font-size:0.9rem">Categoria</label>
                    <select id="edit-insp-categoria" required style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;background:#fff">
                      <option value=""></option>
                      <!-- OpÃ§Ãµes carregadas dinamicamente -->
                    </select>
                  </div>
                  
                  <div>
                    <label style="display:block;font-weight:500;color:#374151;margin-bottom:6px;font-size:0.9rem">ClassificaÃ§Ã£o</label>
                    <select id="edit-insp-classificacao" required style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;background:#fff">
                      <option value=""></option>
                      <!-- OpÃ§Ãµes carregadas dinamicamente -->
                    </select>
                  </div>
                  
                  <div>
                    <label style="display:block;font-weight:500;color:#374151;margin-bottom:6px;font-size:0.9rem">Severidade</label>
                    <select id="edit-insp-severidade" required style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;background:#fff">
                      <option value=""></option>
                      <option value="Baixa">Baixa</option>
                      <option value="MÃ©dia">MÃ©dia</option>
                      <option value="Alta">Alta</option>
                      <option value="CrÃ­tica">CrÃ­tica</option>
                    </select>
                  </div>
                </div>
                
                <!-- SÃ©tima linha: Risco/Perigo, ControlÃ¡vel, InterdiÃ§Ã£o -->
                <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px;margin-bottom:16px">
                  <div>
                    <label style="display:block;font-weight:500;color:#374151;margin-bottom:6px;font-size:0.9rem">Risco/Perigo</label>
                    <select id="edit-insp-risco" required style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;background:#fff">
                      <option value="">Selecione o risco/perigo...</option>
                    </select>
                  </div>
                  
                  <div>
                    <label style="display:block;font-weight:500;color:#374151;margin-bottom:6px;font-size:0.9rem">ControlÃ¡vel</label>
                    <select id="edit-insp-controlavel" required style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;background:#fff">
                      <option value=""></option>
                      <option value="Sim">Sim</option>
                      <option value="NÃ£o">NÃ£o</option>
                    </select>
                  </div>
                  
                  <div>
                    <label style="display:block;font-weight:500;color:#374151;margin-bottom:6px;font-size:0.9rem">InterdiÃ§Ã£o</label>
                    <select id="edit-insp-interdicao" required style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;background:#fff">
                      <option value=""></option>
                      <option value="Sim">Sim</option>
                      <option value="NÃ£o">NÃ£o</option>
                    </select>
                  </div>
                </div>
                
                <!-- Oitava linha: Emissor, ResponsÃ¡vel pela aÃ§Ã£o -->
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px">
                  <div>
                    <label style="display:block;font-weight:500;color:#374151;margin-bottom:6px;font-size:0.9rem">Emissor</label>
                    <input type="text" id="edit-insp-emissor" required placeholder="" style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem">
                  </div>
                  
                  <div>
                    <label style="display:block;font-weight:500;color:#374151;margin-bottom:6px;font-size:0.9rem">ResponsÃ¡vel pela aÃ§Ã£o</label>
                    <input type="text" id="edit-insp-responsavel" required placeholder="" style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem">
                  </div>
                </div>
                
                <!-- Nona linha: Prazo, ConclusÃ£o, Status -->
                <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px;margin-bottom:24px">
                  <div>
                    <label style="display:block;font-weight:500;color:#374151;margin-bottom:6px;font-size:0.9rem">Prazo</label>
                    <input type="date" id="edit-insp-prazo" required style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem">
                  </div>
                  
                  <div>
                    <label style="display:block;font-weight:500;color:#374151;margin-bottom:6px;font-size:0.9rem">ConclusÃ£o</label>
                    <input type="date" id="edit-insp-conclusao" style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem">
                  </div>
                  
                  <div>
                    <label style="display:block;font-weight:500;color:#374151;margin-bottom:6px;font-size:0.9rem">Status</label>
                    <select id="edit-insp-status" required style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;background:#fff">
                      <option value=""></option>
                      <option value="PENDENTE">PENDENTE</option>
                      <option value="EM ANDAMENTO">EM ANDAMENTO</option>
                      <option value="CONCLUÃDO">CONCLUÃDO</option>
                    </select>
                  </div>
                </div>
                
                <div style="display:flex;gap:12px;justify-content:flex-end">
                  <button type="button" onclick="fecharModalEditarInspecao()" style="background:#6b7280;color:#fff;padding:10px 20px;border:none;border-radius:6px;cursor:pointer;font-weight:500;font-size:0.9rem">
                    Cancelar
                  </button>
                  <button type="submit" style="background:#f59e0b;color:#fff;padding:10px 20px;border:none;border-radius:6px;cursor:pointer;font-weight:500;font-size:0.9rem">
                    Atualizar Inspeção
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      
      <!-- Seção Check List Fácil -->
      <div id="checklist" style="display:none;max-width:none;margin:0;">
        <div style="background:#fff;border-radius:16px;box-shadow:0 4px 6px -1px rgba(0,0,0,0.1);overflow:hidden">
          <!-- Header com gradiente teal -->
          <div style="background:linear-gradient(135deg,#0d9488 0%,#059669 100%);color:#fff;padding:28px">
            <div style="max-width:1200px;margin:0 auto;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:16px">
              <div>
                <h1 style="margin:0;font-size:1.8rem;font-weight:700;display:flex;align-items:center;gap:10px">
                  <span></span> Checklists Aplicados
                </h1>
                <p style="margin:6px 0 0 0;font-size:0.95rem;opacity:0.95">Controle e acompanhamento de listas de verificação</p>
              </div>
              <div style="display:flex;gap:12px;flex-wrap:wrap">
                <button onclick="abrirAcompanhamentoSemanal()" style="background:#10b981;color:#fff;padding:12px 24px;border:none;border-radius:8px;cursor:pointer;font-weight:600;font-size:0.95rem;display:flex;align-items:center;gap:8px">
                  <span></span> Acompanhamento Semanal
                </button>
                <button onclick="abrirMatrizFerramentas()" style="background:#8b5cf6;color:#fff;padding:12px 24px;border:none;border-radius:8px;cursor:pointer;font-weight:600;font-size:0.95rem;display:flex;align-items:center;gap:8px">
                  <span></span> Matriz de Ferramentas
                </button>
                <button onclick="mostrarModalNovaChecklist()" style="background:#fff;color:#0d9488;padding:12px 24px;border:none;border-radius:8px;cursor:pointer;font-weight:600;font-size:0.95rem;display:flex;align-items:center;gap:8px">
                  <span></span> Anexar formulário
                </button>
              </div>
            </div>
          </div>
          
          <!-- Conteúdo -->
          <div style="padding:28px;max-width:100%;margin:0 auto">
            <!-- Filtros -->
            <div style="background:#f9fafb;padding:20px;border-radius:12px;margin-bottom:24px">
              <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px">
                <!-- Filtro Empresa -->
                <div>
                  <label style="display:block;font-size:0.85rem;color:#6b7280;margin-bottom:6px;font-weight:500">Empresa</label>
                  <select id="filtro-empresa" style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;background:#fff">
                    <option value="">Selecione(s)</option>
                  </select>
                </div>
                
                <!-- Filtro Tipo -->
                <div>
                  <label style="display:block;font-size:0.85rem;color:#6b7280;margin-bottom:6px;font-weight:500">Tipo</label>
                  <select id="filtro-tipo" style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;background:#fff">
                    <option value="">Selecione(s)</option>
                  </select>
                </div>
                
                <!-- Filtro Autor -->
                <div>
                  <label style="display:block;font-size:0.85rem;color:#6b7280;margin-bottom:6px;font-weight:500">Autor</label>
                  <select id="filtro-autor" style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;background:#fff">
                    <option value="">Selecione(s)</option>
                  </select>
                </div>
                
                <!-- Filtro Período (Data Inicial) -->
                <div>
                  <label style="display:block;font-size:0.85rem;color:#6b7280;margin-bottom:6px;font-weight:500">Período</label>
                  <input type="date" id="filtro-periodo" style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem">
                </div>
                
                <!-- Filtro Período Final -->
                <div>
                  <label style="display:block;font-size:0.85rem;color:#6b7280;margin-bottom:6px;font-weight:500">Período Final</label>
                  <input type="date" id="filtro-periodo-final" style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem">
                </div>
              </div>
            </div>
            
            <!-- Tabela de Checklists Aplicados -->
            <div style="background:#fff;border:1px solid #e5e7eb;border-radius:12px;overflow:hidden">
              <!-- Cabeçalho da Tabela -->
              <div style="display:grid;grid-template-columns:100px 80px 180px 220px 120px 80px 150px;gap:16px;padding:16px;background:#f9fafb;border-bottom:1px solid #e5e7eb;font-weight:600;color:#374151;font-size:0.9rem;align-items:center">
                <div>Data</div>
                <div>Semana</div>
                <div>Tipo</div>
                <div>Nome (autor)</div>
                <div>Setor</div>
                <div>Foto</div>
                <div>Ações</div>
              </div>
              
              <!-- Corpo da Tabela -->
              <div id="corpo-tabela-checklists" style="max-height:500px;overflow-y:auto">
                <!-- Linhas serão adicionadas aqui -->
                <div style="padding:40px 20px;text-align:center;color:#9ca3af;grid-column:1/-1">
                  <div style="font-size:2.5rem;margin-bottom:12px;opacity:0.5"></div>
                  <div style="font-size:1rem;font-weight:500;margin-bottom:6px">Nenhum checklist aplicado ainda</div>
                  <div style="font-size:0.9rem">Clique em "Anexar formulário" para começar</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Modal Anexar Formulário -->
      <div id="modal-nova-checklist" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:1000;justify-content:center;align-items:center;overflow-y:auto">
      <div style="background:#fff;border-radius:12px;width:90%;max-width:700px;margin:20px;box-shadow:0 20px 25px -5px rgba(0,0,0,0.1);max-height:90vh;overflow-y:auto">
        <div style="background:linear-gradient(135deg,#0d9488 0%,#059669 100%);color:#fff;padding:20px;border-radius:12px 12px 0 0">
          <h2 style="margin:0;font-size:1.3rem;font-weight:700;display:flex;align-items:center;gap:8px">
            <span></span> Anexar Formulário
          </h2>
        </div>
        
        <div style="padding:24px">
          <form id="form-nova-checklist" onsubmit="salvarNovaChecklist(event)">
            <!-- Seção de Upload PDF -->
            <div style="margin-bottom:24px;padding:20px;background:#f0fdf4;border:2px dashed #10b981;border-radius:12px">
              <label style="display:block;margin-bottom:12px;font-weight:600;color:#15803d"> Upload de PDF (opcional)</label>
              <input type="file" id="checklist-pdf" accept=".pdf" style="width:100%;padding:12px;border:1px solid #d1d5db;border-radius:6px;font-size:0.95rem">
              <div id="pdf-status" style="margin-top:8px;color:#059669;font-size:0.9rem;display:none"> PDF carregado</div>
            </div>              <!-- Empresa -->
              <div style="margin-bottom:20px">
                <label style="display:block;margin-bottom:8px;font-weight:600;color:#374151">Empresa *</label>
                <select id="checklist-empresa" required style="width:100%;padding:12px;border:1px solid #d1d5db;border-radius:6px;font-size:0.95rem;background:#fff">
                  <option value="">Selecione a empresa</option>
                </select>
              </div>
              
            <!-- Tipo de Formulário -->
            <div style="margin-bottom:20px">
              <label style="display:block;margin-bottom:8px;font-weight:600;color:#374151">Tipo de Formulário *</label>
              <select id="checklist-tipo" required style="width:100%;padding:12px;border:1px solid #d1d5db;border-radius:6px;font-size:0.95rem;background:#fff">
                <option value="">Selecione o tipo</option>
                <option value="Participação na RAS">Participação na RAS</option>
                <option value="Participação na CPT">Participação na CPT</option>
                <option value="WOC MDHO">WOC MDHO</option>
              </select>
            </div>
            
            <!-- Autor -->
            <div style="margin-bottom:20px">
              <label style="display:block;margin-bottom:8px;font-weight:600;color:#374151">Nome do Funcionário *</label>
              <select id="checklist-autor" required style="width:100%;padding:12px;border:1px solid #d1d5db;border-radius:6px;font-size:0.95rem;background:#fff">
                <option value="">Selecione o funcionário</option>
              </select>
            </div>              <!-- Setor (preenchido automaticamente) -->
              <div style="margin-bottom:20px">
                <label style="display:block;margin-bottom:8px;font-weight:600;color:#374151">Setor (automático)</label>
                <input type="text" id="checklist-setor" placeholder="Será identificado pelo nome do autor" readonly style="width:100%;padding:12px;border:1px solid #d1d5db;border-radius:6px;font-size:0.95rem;background:#f9fafb;color:#6b7280">
              </div>
              
              <!-- Data -->
              <div style="margin-bottom:20px">
                <label style="display:block;margin-bottom:8px;font-weight:600;color:#374151">Data *</label>
                <input type="date" id="checklist-data" required style="width:100%;padding:12px;border:1px solid #d1d5db;border-radius:6px;font-size:0.95rem">
                <small style="color:#6b7280;display:block;margin-top:4px">Semana será calculada automaticamente</small>
              </div>
              
              <!-- Fotos anexadas (da extração PDF) -->
              <div style="margin-bottom:20px">
                <label style="display:block;margin-bottom:8px;font-weight:600;color:#374151">Fotos do Formulário</label>
                <div id="fotos-extraidas" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(100px,1fr));gap:12px;margin-bottom:12px">
                  <!-- Fotos do PDF serão adicionadas aqui -->
                </div>
                <input type="file" id="checklist-foto-manual" accept="image/*" multiple style="width:100%;padding:12px;border:1px solid #d1d5db;border-radius:6px;font-size:0.95rem">
                <small style="color:#6b7280;display:block;margin-top:4px">Formatos: JPG, PNG (máximo 5MB por arquivo)</small>
              </div>
              
              <!-- Informações extraídas (visualização) -->
              <div id="info-extraida" style="display:none;margin-bottom:20px;padding:16px;background:#eff6ff;border-left:4px solid #3b82f6;border-radius:6px">
                <h4 style="margin:0 0 12px 0;color:#1e40af;font-size:0.95rem"> Informações Extraídas do PDF</h4>
                <div id="detalhes-extraidos" style="font-size:0.9rem;color:#1e3a8a"></div>
              </div>
              
              <div style="display:flex;gap:12px;justify-content:flex-end;margin-top:24px;padding-top:20px;border-top:1px solid #e5e7eb">
                <button type="button" onclick="fecharModalNovaChecklist()" style="background:#6b7280;color:#fff;padding:10px 20px;border:none;border-radius:6px;cursor:pointer;font-weight:500">
                  Cancelar
                </button>
                <button type="submit" style="background:#0d9488;color:#fff;padding:10px 20px;border:none;border-radius:6px;cursor:pointer;font-weight:500">
                  Anexar Formulário
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
      
      <!-- Seção Categorias HSE -->
      <div id="categorias-hse" style="display:none;padding:20px">
        <div style="max-width:1200px;margin:0 auto">
          <!-- Cabeçalho -->
          <div style="background:linear-gradient(135deg,#059669 0%,#047857 100%);color:#fff;padding:24px;border-radius:12px;margin-bottom:24px">
            <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:16px">
              <div>
                <h1 style="margin:0;font-size:1.8rem;font-weight:700;display:flex;align-items:center;gap:10px">
                  <span></span> Categorias de HSE
                </h1>
                <div style="font-size:1rem;opacity:0.9">Sistema de classificação e categorias para inspeções</div>
              </div>
              <div style="display:flex;gap:12px;flex-wrap:wrap">
                <button id="btn-voltar-inspecao" type="button" style="background:#047857;color:#fff;padding:10px 20px;font-size:0.9rem;border:none;border-radius:6px;cursor:pointer;font-weight:600;display:flex;align-items:center;gap:6px">
                  <span></span> Voltar
                </button>
                <button id="btn-nova-categoria" type="button" style="background:#fff;color:#059669;padding:10px 20px;font-size:0.9rem;border:none;border-radius:6px;cursor:pointer;font-weight:600;display:flex;align-items:center;gap:6px">
                  <span></span> Nova Categoria
                </button>
              </div>
            </div>
          </div>
          
          <!-- Lista de Categorias -->
          <div style="background:#fff;border-radius:12px;border:1px solid #e5e7eb;overflow:hidden">
            <div style="padding:20px;border-bottom:1px solid #f3f4f6">
              <h3 style="margin:0;color:#374151;font-size:1.2rem;display:flex;align-items:center;gap:8px">
                <span></span> ClassificaÃ§Ã£o e Categoria
              </h3>
            </div>
            
            <div id="lista-categorias">
              <!-- Mensagem quando nÃ£o hÃ¡ categorias -->
              <div style="padding:60px 20px;text-align:center;color:#9ca3af">
                <div style="font-size:3rem;margin-bottom:16px;opacity:0.5"></div>
                <div style="font-size:1.1rem;font-weight:500;margin-bottom:8px">Nenhuma categoria cadastrada ainda.</div>
                <div style="font-size:0.9rem">Clique em "Nova Categoria" para comeÃ§ar.</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- SeÃ§Ã£o Ãrea e Local -->
      <div id="areas-locais" style="display:none;padding:20px">
        <div style="max-width:1200px;margin:0 auto">
          <!-- Cabeçalho -->
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:32px;flex-wrap:wrap;gap:16px">
            <div style="display:flex;align-items:center;gap:12px">
              <div style="background:#10b981;padding:8px;border-radius:8px">
                <div style="color:#fff;font-size:1.2rem"></div>
              </div>
              <h1 style="margin:0;color:#374151;font-size:1.5rem;font-weight:700">Ãrea e Local</h1>
            </div>
            <div style="display:flex;gap:12px;flex-wrap:wrap">
              <button id="btn-voltar-inspecao-area" style="background:#047857;color:#fff;padding:10px 16px;border:none;border-radius:6px;cursor:pointer;font-weight:500;display:flex;align-items:center;gap:6px;font-size:0.9rem">
                 Voltar
              </button>
              <button id="btn-nova-area" style="background:#10b981;color:#fff;padding:10px 16px;border:none;border-radius:6px;cursor:pointer;font-weight:500;display:flex;align-items:center;gap:6px;font-size:0.9rem">
                 Nova Ã¡rea e local
              </button>
            </div>
          </div>
          
          <!-- Lista de Ã¡reas e locais -->
          <div style="background:#fff;border-radius:8px;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,0.1)">
            <div id="lista-areas" style="min-height:200px">
              <!-- Lista serÃ¡ preenchida dinamicamente -->
              <div style="padding:60px 20px;text-align:center;color:#9ca3af">
                <div style="font-size:3rem;margin-bottom:16px;opacity:0.5"></div>
                <div style="font-size:1.1rem;font-weight:500;margin-bottom:8px">Nenhuma Ã¡rea e local cadastrado ainda.</div>
                <div style="font-size:0.9rem">Clique em "Nova Ã¡rea e local" para comeÃ§ar.</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- SeÃ§Ã£o Tipos de Registro -->
      <div id="gerenciamento-tipos-registro" style="display:none;padding:20px">
        <div style="max-width:1200px;margin:0 auto">
          <!-- Header -->
          <div style="background:linear-gradient(135deg,#7c3aed 0%,#a855f7 100%);border-radius:12px;padding:32px;margin-bottom:24px;color:#fff;text-align:center">
            <h2 style="margin:0;font-size:2rem;font-weight:700;margin-bottom:8px">Tipos de Registro</h2>
            <p style="margin:0;font-size:1.1rem;opacity:0.95">Gerencie os tipos de registros de inspeÃ§Ã£o</p>
          </div>
          
          <!-- Controles -->
          <div style="background:#fff;border-radius:12px;padding:24px;margin-bottom:20px;box-shadow:0 1px 3px rgba(0,0,0,0.1)">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
              <div style="display:flex;align-items:center;gap:12px">
                <button id="btn-voltar-inspecao-tipos-registro" style="background:#047857;color:#fff;padding:10px 16px;border:none;border-radius:6px;cursor:pointer;font-weight:500;display:flex;align-items:center;gap:6px;font-size:0.9rem">
                   Voltar para Inspeção
                </button>
                <h3 style="margin:0;font-size:1.2rem;font-weight:600;color:#374151">Tipos de Registro Cadastrados</h3>
              </div>
              <button id="btn-novo-tipo-registro" style="background:#7c3aed;color:#fff;padding:10px 16px;border:none;border-radius:6px;cursor:pointer;font-weight:500;display:flex;align-items:center;gap:6px;font-size:0.9rem">
                 Novo tipo de registro
              </button>
            </div>
          </div>
          
          <!-- Lista de tipos de registro -->
          <div style="background:#fff;border-radius:8px;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,0.1)">
            <div id="lista-tipos-registro" style="min-height:200px">
              <!-- Lista serÃ¡ preenchida dinamicamente -->
              <div style="padding:60px 20px;text-align:center;color:#9ca3af">
                <div style="font-size:3rem;margin-bottom:16px;opacity:0.5"></div>
                <div style="font-size:1.1rem;font-weight:500;margin-bottom:8px">Nenhum tipo de registro cadastrado ainda.</div>
                <div style="font-size:0.9rem">Clique em "Novo tipo de registro" para comeÃ§ar.</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- SeÃ§Ã£o Riscos e Perigos -->
      <div id="gerenciamento-riscos-perigos" style="display:none;padding:20px">
        <div style="max-width:1200px;margin:0 auto">
          <!-- Header -->
          <div style="background:linear-gradient(135deg,#dc2626 0%,#ef4444 100%);border-radius:12px;padding:32px;margin-bottom:24px;color:#fff;text-align:center">
            <h2 style="margin:0;font-size:2rem;font-weight:700;margin-bottom:8px">Riscos e Perigos</h2>
            <p style="margin:0;font-size:1.1rem;opacity:0.95">Gerencie os riscos e perigos identificados</p>
          </div>
          
          <!-- Controles -->
          <div style="background:#fff;border-radius:12px;padding:24px;margin-bottom:20px;box-shadow:0 1px 3px rgba(0,0,0,0.1)">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
              <div style="display:flex;align-items:center;gap:12px">
                <button id="btn-voltar-inspecao-riscos-perigos" style="background:#047857;color:#fff;padding:10px 16px;border:none;border-radius:6px;cursor:pointer;font-weight:500;display:flex;align-items:center;gap:6px;font-size:0.9rem">
                   Voltar para Inspeção
                </button>
                <h3 style="margin:0;font-size:1.2rem;font-weight:600;color:#374151">Riscos e Perigos Cadastrados</h3>
              </div>
              <button id="btn-novo-risco-perigo" style="background:#dc2626;color:#fff;padding:10px 16px;border:none;border-radius:6px;cursor:pointer;font-weight:500;display:flex;align-items:center;gap:6px;font-size:0.9rem">
                 ï¸ Novo risco/perigo
              </button>
            </div>
          </div>
          
          <!-- Lista de riscos e perigos -->
          <div style="background:#fff;border-radius:8px;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,0.1)">
            <div id="lista-riscos-perigos" style="min-height:200px">
              <!-- Lista serÃ¡ preenchida dinamicamente -->
              <div style="padding:60px 20px;text-align:center;color:#9ca3af">
                <div style="font-size:3rem;margin-bottom:16px;opacity:0.5"> ï¸</div>
                <div style="font-size:1.1rem;font-weight:500;margin-bottom:8px">Nenhum risco ou perigo cadastrado ainda.</div>
                <div style="font-size:0.9rem">Clique em "Novo risco/perigo" para comeÃ§ar.</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Modal Nova Categoria -->
      <div id="modal-nova-categoria" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:1003;justify-content:center;align-items:center;overflow-y:auto">
        <div style="background:#fff;border-radius:8px;width:90%;max-width:500px;margin:20px;position:relative">
          <!-- BotÃ£o X para fechar -->
          <button onclick="fecharModalCategoria()" style="position:absolute;top:12px;right:12px;background:none;border:none;font-size:1.2rem;color:#6b7280;cursor:pointer;width:24px;height:24px;display:flex;align-items:center;justify-content:center">Ã—</button>
          
          <div style="padding:24px">
            <h2 style="margin:0 0 24px 0;font-size:1.1rem;font-weight:600;color:#374151">Adicionar ClassificaÃ§Ã£o e Categoria</h2>
            
            <form id="form-nova-categoria">
              <!-- Campo ClassificaÃ§Ã£o -->
              <div style="margin-bottom:20px">
                <label style="display:block;font-weight:500;color:#374151;margin-bottom:8px;font-size:0.9rem">ClassificaÃ§Ã£o</label>
                <input type="text" id="cat-classificacao" required placeholder="" style="width:100%;padding:12px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;background:#fff">
              </div>
              
              <!-- Campo Categoria -->
              <div style="margin-bottom:32px">
                <label style="display:block;font-weight:500;color:#374151;margin-bottom:8px;font-size:0.9rem">Categoria</label>
                <input type="text" id="cat-nome" required placeholder="" style="width:100%;padding:12px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;background:#fff">
              </div>
              
              <div style="display:flex;gap:12px;justify-content:flex-end">
                <button type="button" onclick="fecharModalCategoria()" style="background:#f3f4f6;color:#374151;padding:10px 24px;border:1px solid #d1d5db;border-radius:6px;cursor:pointer;font-weight:500;font-size:0.9rem">
                  Cancelar
                </button>
                <button type="submit" style="background:#374151;color:#fff;padding:10px 24px;border:none;border-radius:6px;cursor:pointer;font-weight:500;font-size:0.9rem">
                  Adicionar
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
      
      <!-- Modal Editar Categoria -->
      <div id="modal-editar-categoria" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:1003;justify-content:center;align-items:center;overflow-y:auto">
        <div style="background:#fff;border-radius:8px;width:90%;max-width:500px;margin:20px;position:relative">
          <!-- BotÃ£o X para fechar -->
          <button onclick="fecharModalEdicaoCategoria()" style="position:absolute;top:12px;right:12px;background:none;border:none;font-size:1.2rem;color:#6b7280;cursor:pointer;width:24px;height:24px;display:flex;align-items:center;justify-content:center">Ã—</button>
          
          <div style="padding:24px">
            <h2 style="margin:0 0 24px 0;font-size:1.1rem;font-weight:600;color:#374151">Editar Categoria HSE</h2>
            
            <form id="form-editar-categoria">
              <!-- Campo Nome da Categoria -->
              <div style="margin-bottom:20px">
                <label style="display:block;font-weight:500;color:#374151;margin-bottom:8px;font-size:0.9rem">Nome da Categoria</label>
                <input type="text" id="edit-cat-nome" required style="width:100%;padding:12px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;background:#fff">
              </div>
              
              <!-- Campo Cor da Categoria -->
              <div style="margin-bottom:20px">
                <label style="display:block;font-weight:500;color:#374151;margin-bottom:8px;font-size:0.9rem">Cor da Categoria</label>
                <input type="color" id="edit-cat-cor" style="width:60px;height:40px;border:1px solid #d1d5db;border-radius:6px;cursor:pointer">
              </div>
              
              <!-- ClassificaÃ§Ãµes Existentes -->
              <div style="margin-bottom:20px">
                <label style="display:block;font-weight:500;color:#374151;margin-bottom:8px;font-size:0.9rem">ClassificaÃ§Ãµes Existentes</label>
                <div id="edit-classificacoes-lista" style="min-height:40px;padding:12px;border:1px solid #d1d5db;border-radius:6px;background:#f9fafb">
                  <!-- Lista serÃ¡ preenchida dinamicamente -->
                </div>
              </div>
              
              <!-- Adicionar Nova ClassificaÃ§Ã£o -->
              <div style="margin-bottom:32px">
                <label style="display:block;font-weight:500;color:#374151;margin-bottom:8px;font-size:0.9rem">Adicionar Nova ClassificaÃ§Ã£o</label>
                <div style="display:flex;gap:8px">
                  <input type="text" id="edit-nova-classificacao" placeholder="Digite uma nova classificaÃ§Ã£o" style="flex:1;padding:12px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;background:#fff">
                  <button type="button" onclick="adicionarClassificacaoEdicao()" style="background:#10b981;color:#fff;padding:12px 16px;border:none;border-radius:6px;cursor:pointer;font-weight:500">+ Adicionar</button>
                </div>
              </div>
              
              <div style="display:flex;gap:12px;justify-content:flex-end">
                <button type="button" onclick="fecharModalEdicaoCategoria()" style="background:#f3f4f6;color:#374151;padding:10px 24px;border:1px solid #d1d5db;border-radius:6px;cursor:pointer;font-weight:500;font-size:0.9rem">
                  Cancelar
                </button>
                <button type="submit" style="background:#f59e0b;color:#fff;padding:10px 24px;border:none;border-radius:6px;cursor:pointer;font-weight:500;font-size:0.9rem">
                  Salvar AlteraÃ§Ãµes
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
      
      <!-- Modal Novo Tipo de Registro -->
      <div id="modal-novo-tipo-registro" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:1003;justify-content:center;align-items:center;overflow-y:auto">
        <div style="background:#fff;border-radius:8px;width:90%;max-width:500px;margin:20px;position:relative">
          <!-- BotÃ£o X para fechar -->
          <button onclick="fecharModalTipoRegistro()" style="position:absolute;top:12px;right:12px;background:none;border:none;font-size:1.2rem;color:#6b7280;cursor:pointer;width:24px;height:24px;display:flex;align-items:center;justify-content:center">Ã—</button>
          
          <div style="padding:24px">
            <h2 style="margin:0 0 24px 0;font-size:1.1rem;font-weight:600;color:#374151">Novo Tipo de Registro</h2>
            
            <form id="form-tipo-registro" onsubmit="salvarTipoRegistro(event)">
              <div style="margin-bottom:16px">
                <label style="display:block;color:#374151;font-weight:500;margin-bottom:8px">Nome do Tipo de Registro *</label>
                <input id="nome-tipo-registro" type="text" required style="width:100%;padding:12px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;color:#374151" placeholder="Ex: Inspeção de Segurança, Auditoria Ambiental">
              </div>
              
              <div style="margin-bottom:16px">
                <label style="display:block;color:#374151;font-weight:500;margin-bottom:8px">DescriÃ§Ã£o</label>
                <textarea id="descricao-tipo-registro" style="width:100%;padding:12px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;color:#374151;min-height:80px;resize:vertical" placeholder="DescriÃ§Ã£o detalhada do tipo de registro..."></textarea>
              </div>
              
              <div style="margin-bottom:16px">
                <label style="display:block;color:#374151;font-weight:500;margin-bottom:8px">CÃ³digo/Sigla</label>
                <input id="codigo-tipo-registro" type="text" style="width:100%;padding:12px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;color:#374151" placeholder="Ex: IS, AA, VA">
              </div>
              
              <div style="margin-bottom:24px">
                <label style="display:block;color:#374151;font-weight:500;margin-bottom:8px">Status</label>
                <select id="status-tipo-registro" style="width:100%;padding:12px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;color:#374151">
                  <option value="ativo">Ativo</option>
                  <option value="inativo">Inativo</option>
                </select>
              </div>
              
              <div style="display:flex;gap:12px;justify-content:flex-end">
                <button type="button" onclick="fecharModalTipoRegistro()" style="background:#f3f4f6;color:#374151;padding:10px 24px;border:1px solid #d1d5db;border-radius:6px;cursor:pointer;font-weight:500;font-size:0.9rem">
                  Cancelar
                </button>
                <button type="submit" style="background:#7c3aed;color:#fff;padding:10px 24px;border:none;border-radius:6px;cursor:pointer;font-weight:500;font-size:0.9rem">
                  Salvar Tipo de Registro
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
      
      <!-- Modal Nova Ãrea/Local -->
      <div id="modal-nova-area" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:1003;justify-content:center;align-items:center;overflow-y:auto">
        <div style="background:#fff;border-radius:8px;width:90%;max-width:500px;margin:20px;position:relative">
          <!-- BotÃ£o X para fechar -->
          <button onclick="fecharModalArea()" style="position:absolute;top:12px;right:12px;background:none;border:none;font-size:1.2rem;color:#6b7280;cursor:pointer;width:24px;height:24px;display:flex;align-items:center;justify-content:center">Ã—</button>
          
          <div style="padding:24px">
            <h2 style="margin:0 0 24px 0;font-size:1.1rem;font-weight:600;color:#374151">Nova Ãrea e Local</h2>
            
            <form id="form-nova-area">
              <!-- Campo Nome da Ãrea -->
              <div style="margin-bottom:20px">
                <label style="display:block;font-weight:500;color:#374151;margin-bottom:8px;font-size:0.9rem">Nome da Ãrea</label>
                <input type="text" id="area-nome" required placeholder="Ex: EscritÃ³rio, ProduÃ§Ã£o, Almoxarifado..." style="width:100%;padding:12px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;background:#fff">
              </div>
              
              <!-- Campo Local EspecÃ­fico -->
              <div style="margin-bottom:20px">
                <label style="display:block;font-weight:500;color:#374151;margin-bottom:8px;font-size:0.9rem">Local EspecÃ­fico</label>
                <input type="text" id="area-local" required placeholder="Ex: Sala 101, Linha de ProduÃ§Ã£o A, DepÃ³sito 2..." style="width:100%;padding:12px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;background:#fff">
              </div>
              
              <!-- Campo DescriÃ§Ã£o -->
              <div style="margin-bottom:20px">
                <label style="display:block;font-weight:500;color:#374151;margin-bottom:8px;font-size:0.9rem">DescriÃ§Ã£o (Opcional)</label>
                <textarea id="area-descricao" placeholder="DescriÃ§Ã£o adicional sobre a Ã¡rea/local..." style="width:100%;padding:12px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;background:#fff;resize:vertical;min-height:80px"></textarea>
              </div>
              
              <!-- Campo Cor Identificadora -->
              <div style="margin-bottom:32px">
                <label style="display:block;font-weight:500;color:#374151;margin-bottom:8px;font-size:0.9rem">Cor Identificadora</label>
                <input type="color" id="area-cor" value="#10b981" style="width:60px;height:40px;border:1px solid #d1d5db;border-radius:6px;cursor:pointer">
              </div>
              
              <div style="display:flex;gap:12px;justify-content:flex-end">
                <button type="button" onclick="fecharModalArea()" style="background:#f3f4f6;color:#374151;padding:10px 24px;border:1px solid #d1d5db;border-radius:6px;cursor:pointer;font-weight:500;font-size:0.9rem">
                  Cancelar
                </button>
                <button type="submit" style="background:#10b981;color:#fff;padding:10px 24px;border:none;border-radius:6px;cursor:pointer;font-weight:500;font-size:0.9rem">
                  Adicionar
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
      
      <!-- Modal Editar Tipo de Registro -->
      <div id="modal-editar-tipo-registro" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:1003;justify-content:center;align-items:center;overflow-y:auto">
        <div style="background:#fff;border-radius:8px;width:90%;max-width:500px;margin:20px;position:relative">
          <!-- BotÃ£o X para fechar -->
          <button onclick="fecharModalEdicaoTipoRegistro()" style="position:absolute;top:12px;right:12px;background:none;border:none;font-size:1.2rem;color:#6b7280;cursor:pointer;width:24px;height:24px;display:flex;align-items:center;justify-content:center">Ã—</button>
          
          <div style="padding:24px">
            <h2 style="margin:0 0 24px 0;font-size:1.1rem;font-weight:600;color:#374151">Editar Tipo de Registro</h2>
            
            <form id="form-editar-tipo-registro" onsubmit="atualizarTipoRegistro(event)">
              <input type="hidden" id="id-editar-tipo-registro">
              
              <div style="margin-bottom:16px">
                <label style="display:block;color:#374151;font-weight:500;margin-bottom:8px">Nome do Tipo de Registro *</label>
                <input id="nome-editar-tipo-registro" type="text" required style="width:100%;padding:12px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;color:#374151" placeholder="Ex: Inspeção de Segurança, Auditoria Ambiental">
              </div>
              
              <div style="margin-bottom:16px">
                <label style="display:block;color:#374151;font-weight:500;margin-bottom:8px">DescriÃ§Ã£o</label>
                <textarea id="descricao-editar-tipo-registro" style="width:100%;padding:12px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;color:#374151;min-height:80px;resize:vertical" placeholder="DescriÃ§Ã£o detalhada do tipo de registro..."></textarea>
              </div>
              
              <div style="margin-bottom:16px">
                <label style="display:block;color:#374151;font-weight:500;margin-bottom:8px">CÃ³digo/Sigla</label>
                <input id="codigo-editar-tipo-registro" type="text" style="width:100%;padding:12px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;color:#374151" placeholder="Ex: IS, AA, VA">
              </div>
              
              <div style="margin-bottom:24px">
                <label style="display:block;color:#374151;font-weight:500;margin-bottom:8px">Status</label>
                <select id="status-editar-tipo-registro" style="width:100%;padding:12px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;color:#374151">
                  <option value="ativo">Ativo</option>
                  <option value="inativo">Inativo</option>
                </select>
              </div>
              
              <div style="display:flex;gap:12px;justify-content:flex-end">
                <button type="button" onclick="fecharModalEdicaoTipoRegistro()" style="background:#f3f4f6;color:#374151;padding:10px 24px;border:1px solid #d1d5db;border-radius:6px;cursor:pointer;font-weight:500;font-size:0.9rem">
                  Cancelar
                </button>
                <button type="submit" style="background:#7c3aed;color:#fff;padding:10px 24px;border:none;border-radius:6px;cursor:pointer;font-weight:500;font-size:0.9rem">
                  Atualizar Tipo de Registro
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
      
      <!-- Modal Novo Risco/Perigo -->
      <div id="modal-novo-risco-perigo" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:1003;justify-content:center;align-items:center;overflow-y:auto">
        <div style="background:#fff;border-radius:8px;width:90%;max-width:600px;margin:20px;position:relative">
          <!-- BotÃ£o X para fechar -->
          <button onclick="fecharModalRiscoPerigo()" style="position:absolute;top:12px;right:12px;background:none;border:none;font-size:1.2rem;color:#6b7280;cursor:pointer;width:24px;height:24px;display:flex;align-items:center;justify-content:center">Ã—</button>
          
          <div style="padding:24px">
            <h2 style="margin:0 0 24px 0;font-size:1.1rem;font-weight:600;color:#374151">Novo Risco / Perigo</h2>
            
            <form id="form-risco-perigo" onsubmit="salvarRiscoPerigo(event)">
              <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px">
                <div>
                  <label style="display:block;color:#374151;font-weight:500;margin-bottom:8px">Tipo *</label>
                  <select id="tipo-risco-perigo" required style="width:100%;padding:12px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;color:#374151">
                    <option value="">Selecione o tipo...</option>
                    <option value="risco">Risco</option>
                    <option value="perigo">Perigo</option>
                  </select>
                </div>
                
                <div>
                  <label style="display:block;color:#374151;font-weight:500;margin-bottom:8px">Categoria</label>
                  <select id="categoria-risco-perigo" style="width:100%;padding:12px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;color:#374151">
                    <option value="">Selecione a categoria...</option>
                    <option value="fisico">FÃ­sico</option>
                    <option value="quimico">QuÃ­mico</option>
                    <option value="biologico">BiolÃ³gico</option>
                    <option value="ergonomico">ErgonÃ´mico</option>
                    <option value="acidente">Acidente</option>
                    <option value="ambiental">Ambiental</option>
                    <option value="social">Social</option>
                  </select>
                </div>
              </div>
              
              <div style="margin-bottom:16px">
                <label style="display:block;color:#374151;font-weight:500;margin-bottom:8px">Nome/DescriÃ§Ã£o *</label>
                <input id="nome-risco-perigo" type="text" required style="width:100%;padding:12px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;color:#374151" placeholder="Ex: RuÃ­do excessivo, ExposiÃ§Ã£o quÃ­mica, Queda de altura">
              </div>
              
              <div style="margin-bottom:24px">
                <label style="display:block;color:#374151;font-weight:500;margin-bottom:8px">Status</label>
                <select id="status-risco-perigo" style="width:100%;padding:12px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;color:#374151">
                  <option value="ativo">Ativo</option>
                  <option value="controlado">Controlado</option>
                  <option value="eliminado">Eliminado</option>
                </select>
              </div>
              
              <div style="display:flex;gap:12px;justify-content:flex-end">
                <button type="button" onclick="fecharModalRiscoPerigo()" style="background:#f3f4f6;color:#374151;padding:10px 24px;border:1px solid #d1d5db;border-radius:6px;cursor:pointer;font-weight:500;font-size:0.9rem">
                  Cancelar
                </button>
                <button type="submit" style="background:#dc2626;color:#fff;padding:10px 24px;border:none;border-radius:6px;cursor:pointer;font-weight:500;font-size:0.9rem">
                  Salvar Risco/Perigo
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
      
      <!-- Modal Editar Risco/Perigo -->
      <div id="modal-editar-risco-perigo" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:1003;justify-content:center;align-items:center;overflow-y:auto">
        <div style="background:#fff;border-radius:8px;width:90%;max-width:600px;margin:20px;position:relative">
          <!-- BotÃ£o X para fechar -->
          <button onclick="fecharModalEdicaoRiscoPerigo()" style="position:absolute;top:12px;right:12px;background:none;border:none;font-size:1.2rem;color:#6b7280;cursor:pointer;width:24px;height:24px;display:flex;align-items:center;justify-content:center">Ã—</button>
          
          <div style="padding:24px">
            <h2 style="margin:0 0 24px 0;font-size:1.1rem;font-weight:600;color:#374151">Editar Risco / Perigo</h2>
            
            <form id="form-editar-risco-perigo" onsubmit="atualizarRiscoPerigo(event)">
              <input type="hidden" id="id-editar-risco-perigo">
              
              <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px">
                <div>
                  <label style="display:block;color:#374151;font-weight:500;margin-bottom:8px">Tipo *</label>
                  <select id="tipo-editar-risco-perigo" required style="width:100%;padding:12px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;color:#374151">
                    <option value="">Selecione o tipo...</option>
                    <option value="risco">Risco</option>
                    <option value="perigo">Perigo</option>
                  </select>
                </div>
                
                <div>
                  <label style="display:block;color:#374151;font-weight:500;margin-bottom:8px">Categoria</label>
                  <select id="categoria-editar-risco-perigo" style="width:100%;padding:12px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;color:#374151">
                    <option value="">Selecione a categoria...</option>
                    <option value="fisico">FÃ­sico</option>
                    <option value="quimico">QuÃ­mico</option>
                    <option value="biologico">BiolÃ³gico</option>
                    <option value="ergonomico">ErgonÃ´mico</option>
                    <option value="acidente">Acidente</option>
                    <option value="ambiental">Ambiental</option>
                    <option value="social">Social</option>
                  </select>
                </div>
              </div>
              
              <div style="margin-bottom:16px">
                <label style="display:block;color:#374151;font-weight:500;margin-bottom:8px">Nome/DescriÃ§Ã£o *</label>
                <input id="nome-editar-risco-perigo" type="text" required style="width:100%;padding:12px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;color:#374151" placeholder="Ex: RuÃ­do excessivo, ExposiÃ§Ã£o quÃ­mica, Queda de altura">
              </div>
              
              <div style="margin-bottom:24px">
                <label style="display:block;color:#374151;font-weight:500;margin-bottom:8px">Status</label>
                <select id="status-editar-risco-perigo" style="width:100%;padding:12px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;color:#374151">
                  <option value="ativo">Ativo</option>
                  <option value="controlado">Controlado</option>
                  <option value="eliminado">Eliminado</option>
                </select>
              </div>
              
              <div style="display:flex;gap:12px;justify-content:flex-end">
                <button type="button" onclick="fecharModalEdicaoRiscoPerigo()" style="background:#f3f4f6;color:#374151;padding:10px 24px;border:1px solid #d1d5db;border-radius:6px;cursor:pointer;font-weight:500;font-size:0.9rem">
                  Cancelar
                </button>
                <button type="submit" style="background:#dc2626;color:#fff;padding:10px 24px;border:none;border-radius:6px;cursor:pointer;font-weight:500;font-size:0.9rem">
                  Atualizar Risco/Perigo
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
      
      <!-- Modal Editar Ãrea/Local -->
      <div id="modal-editar-area" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:1003;justify-content:center;align-items:center;overflow-y:auto">
        <div style="background:#fff;border-radius:8px;width:90%;max-width:500px;margin:20px;position:relative">
          <!-- BotÃ£o X para fechar -->
          <button onclick="fecharModalEdicaoArea()" style="position:absolute;top:12px;right:12px;background:none;border:none;font-size:1.2rem;color:#6b7280;cursor:pointer;width:24px;height:24px;display:flex;align-items:center;justify-content:center">Ã—</button>
          
          <div style="padding:24px">
            <h2 style="margin:0 0 24px 0;font-size:1.1rem;font-weight:600;color:#374151">Editar Ãrea e Local</h2>
            
            <form id="form-editar-area">
              <!-- Campo Nome da Ãrea -->
              <div style="margin-bottom:20px">
                <label style="display:block;font-weight:500;color:#374151;margin-bottom:8px;font-size:0.9rem">Nome da Ãrea</label>
                <input type="text" id="edit-area-nome" required style="width:100%;padding:12px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;background:#fff">
              </div>
              
              <!-- Campo Local EspecÃ­fico -->
              <div style="margin-bottom:20px">
                <label style="display:block;font-weight:500;color:#374151;margin-bottom:8px;font-size:0.9rem">Local EspecÃ­fico</label>
                <input type="text" id="edit-area-local" required style="width:100%;padding:12px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;background:#fff">
              </div>
              
              <!-- Campo DescriÃ§Ã£o -->
              <div style="margin-bottom:20px">
                <label style="display:block;font-weight:500;color:#374151;margin-bottom:8px;font-size:0.9rem">DescriÃ§Ã£o (Opcional)</label>
                <textarea id="edit-area-descricao" style="width:100%;padding:12px;border:1px solid #d1d5db;border-radius:6px;font-size:0.9rem;background:#fff;resize:vertical;min-height:80px"></textarea>
              </div>
              
              <!-- Campo Cor Identificadora -->
              <div style="margin-bottom:32px">
                <label style="display:block;font-weight:500;color:#374151;margin-bottom:8px;font-size:0.9rem">Cor Identificadora</label>
                <input type="color" id="edit-area-cor" style="width:60px;height:40px;border:1px solid #d1d5db;border-radius:6px;cursor:pointer">
              </div>
              
              <div style="display:flex;gap:12px;justify-content:flex-end">
                <button type="button" onclick="fecharModalEdicaoArea()" style="background:#f3f4f6;color:#374151;padding:10px 24px;border:1px solid #d1d5db;border-radius:6px;cursor:pointer;font-weight:500;font-size:0.9rem">
                  Cancelar
                </button>
                <button type="submit" style="background:#f59e0b;color:#fff;padding:10px 24px;border:none;border-radius:6px;cursor:pointer;font-weight:500;font-size:0.9rem">
                  Salvar AlteraÃ§Ãµes
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
      
      </main>
    </div>
      <script>
      // ===== CONFIGURAÃ‡ÃƒO DA API =====
      // Usar configuraÃ§Ã£o do config.js (PRIORIDADE MÃXIMA)
      const API_BASE_URL = window.API_BASE_URL || (function() {
        // Fallback: Se nÃ£o houver config.js, detectar automaticamente
        if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
          return 'http://localhost:3000';
        }
        // Se estiver acessando via IP local (ex: 192.168.x.x)
        if (/^192\.168\.|^10\.|^172\.(1[6-9]|2[0-9]|3[01])\./.test(window.location.hostname)) {
          return 'http://' + window.location.hostname + ':3000';
        }
        // Fallback padrÃ£o: null (nÃ£o conecta a servidor)
        console.warn(' ï¸ API_BASE_URL nÃ£o configurada!');
        return null;
      })();        async function sincronizarComServidor(tabela, dados) {
          if (!API_BASE_URL) return false; // Se nÃ£o houver API, retorna false
          try {
            const response = await fetch(API_BASE_URL + '/api/' + tabela, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(dados)
            });
            if (response.ok) {
              console.log('Sincronizado com servidor:', tabela);
              return true;
            }
          } catch (err) {
            console.warn('Erro ao sincronizar:', err.message);
          }
          return false;
        }

        // FunÃ§Ã£o para carregar dados do servidor
        async function carregarDoServidor(tabela) {
          if (!API_BASE_URL) return []; // Se nÃ£o houver API, retorna vazio
          try {
            const response = await fetch(API_BASE_URL + '/api/' + tabela);
            if (response.ok) {
              const dados = await response.json();
              console.log('Carregado do servidor:', tabela, dados.length + ' registros');
              return dados;
            }
          } catch (err) {
            console.warn('Erro ao carregar do servidor:', err.message);
          }
          return [];
        }

      // ===== FUNÃ‡Ã•ES WRAPPER PARA SINCRONIZAÃ‡ÃƒO AUTOMÃTICA =====
      
      // Wrapper do localStorage.setItem que sincroniza automaticamente
      const localStorageOriginal = {
        setItem: localStorage.setItem.bind(localStorage),
        getItem: localStorage.getItem.bind(localStorage)
      };

      // Override do localStorage.setItem para sincronizar automaticamente
      Storage.prototype.setItemSync = async function(key, value) {
        // Salvar localmente
        localStorageOriginal.setItem(key, value);
        
        // Sincronizar com servidor (se for um dado do sistema)
        const tabelasParaSincronizar = [
          'funcionarios', 'empresas', 'ras_reunioes', 'usuarios', 
          'historico_ras', 'cpts', 'inspecoes', 'categorias_hse', 
          'areasLocais', 'tiposRegistro', 'riscosPerigos', 'arts',
          'frequencias', 'categorias', 'riscos'
        ];
        
        if (tabelasParaSincronizar.includes(key)) {
          try {
            const dados = JSON.parse(value);
            // Se for array, sincronizar cada item
            if (Array.isArray(dados)) {
              for (let item of dados) {
                await sincronizarComServidor(key, item);
              }
            } else {
              await sincronizarComServidor(key, dados);
            }
          } catch (e) {
            console.warn('Erro ao sincronizar:', key, e);
          }
        }
      };

      // FunÃ§Ã£o helper para carregar dados (servidor primeiro, depois localStorage)
      async function loadData(key) {
        // Tentar carregar do servidor primeiro
        const dadosServidor = await carregarDoServidor(key);
        if (dadosServidor && dadosServidor.length > 0) {
          // Atualizar localStorage com dados do servidor
          localStorageOriginal.setItem(key, JSON.stringify(dadosServidor));
          return dadosServidor;
        }
        
        // Fallback para localStorage
        const dadosLocal = localStorageOriginal.getItem(key);
        return dadosLocal ? JSON.parse(dadosLocal) : [];
      }

      // FunÃ§Ã£o helper para salvar dados (localStorage + servidor)
      async function saveData(key, value) {
        const valueStr = typeof value === 'string' ? value : JSON.stringify(value);
        await localStorage.setItemSync(key, valueStr);
      }

    // ===== FIM DAS FUNÃ‡Ã•ES WRAPPER =====

    // INTERCEPTAR TODAS AS CHAMADAS DE localStorage.setItem
    (function() {
      const originalSetItem = localStorage.setItem;
      
      localStorage.setItem = function(key, value) {
        // Chamar o original
        originalSetItem.call(localStorage, key, value);
        
        // DESABILITADO: SincronizaÃ§Ã£o automÃ¡tica no setItem causa duplicaÃ§Ã£o
        // A sincronizaÃ§Ã£o Ã© feita apenas no carregamento inicial da pÃ¡gina
      };
    })();
    console.log(' Sistema de sincronizaÃ§Ã£o automÃ¡tica ativado!');
    console.log(' Servidor:', API_BASE_URL);

    // ===== FORÃ‡AR CARREGAMENTO DO SERVIDOR AO INICIAR =====
    window.addEventListener('DOMContentLoaded', async function() {
      if (API_BASE_URL) {
        console.log(' Carregando dados do servidor...');
        try {
          // Carregar empresas do servidor
          const resEmpresas = await fetch(API_BASE_URL + '/api/empresas');
          if (resEmpresas.ok) {
            const empresas = await resEmpresas.json();
            localStorage.setItem('empresas', JSON.stringify(empresas));
            console.log(' Empresas carregadas do servidor:', empresas.length);
          }
          
          // Carregar funcionÃ¡rios do servidor
          const resFuncionarios = await fetch(API_BASE_URL + '/api/funcionarios');
          if (resFuncionarios.ok) {
            const funcionarios = await resFuncionarios.json();
            localStorage.setItem('funcionarios', JSON.stringify(funcionarios));
            console.log(' FuncionÃ¡rios carregados do servidor:', funcionarios.length);
          }
        } catch (err) {
          console.warn(' ï¸ Erro ao carregar dados do servidor:', err.message);
        }
      }
    });

    // ===== FIM DA INTERCEPTAÃ‡ÃƒO =====      // Mostrar sidebar no mobile
      function showSidebarOnMobile() {
            document.querySelector('.sidebar').classList.remove('hidden-mobile');
            document.querySelector('.main').classList.remove('full-screen-mobile');
            document.getElementById('back-to-menu').classList.remove('show');
          }

        // FunÃ§Ã£o para ocultar todas as seÃ§Ãµes
        function hideAllSections() {
          document.getElementById('conteudo-principal').style.display = 'none';
          document.getElementById('cadastro-usuario').style.display = 'none';
          document.getElementById('nova-ras').style.display = 'none';
          document.getElementById('funcionarios').style.display = 'none';
          document.getElementById('frequencia').style.display = 'none';
          document.getElementById('cpt').style.display = 'none';
          document.getElementById('inspecao').style.display = 'none';
          document.getElementById('art').style.display = 'none';
          document.getElementById('checklist').style.display = 'none';
          document.getElementById('categorias-hse').style.display = 'none';
          document.getElementById('areas-locais').style.display = 'none';
          document.getElementById('gerenciamento-tipos-registro').style.display = 'none';
          document.getElementById('gerenciamento-riscos-perigos').style.display = 'none';
          document.getElementById('empresa').style.display = 'none';
        }          function abrirSecaoDoHash(hash) {
            const alvo = (hash || '#').replace('#', '');
            switch (alvo) {
              case 'usuario':
                hideAllSections();
                document.getElementById('cadastro-usuario').style.display = 'block';
                break;
              case 'ras':
                hideAllSections();
                document.getElementById('nova-ras').style.display = 'block';
                document.getElementById('ras-lista-reunioes').style.display = 'block';
                document.getElementById('ras-formulario-container').style.display = 'none';
                carregarEmpresasRAS();
                carregarColaboradoresRAS();
                carregarColaboradoresRASEtapa3();
                carregarFuncionariosRASEtapa6();
                carregarListaRAS();
                break;
              case 'funcionarios':
                hideAllSections();
                document.getElementById('funcionarios').style.display = 'block';
                exibirFuncionarios();
                carregarEmpresasColaborador();
                break;
              case 'frequencia':
                hideAllSections();
                document.getElementById('frequencia').style.display = 'block';
                inicializarFrequencia();
                break;
              case 'cpt':
                hideAllSections();
                document.getElementById('cpt').style.display = 'block';
                inicializarCPT();
                break;
              case 'inspecao':
                hideAllSections();
                document.getElementById('inspecao').style.display = 'block';
                inicializarInspecao();
                break;
              case 'art':
                hideAllSections();
                document.getElementById('art').style.display = 'block';
                inicializarART();
                break;
              case 'checklist':
                hideAllSections();
                document.getElementById('checklist').style.display = 'block';
                carregarChecklists();
                break;
              case 'empresa':
                hideAllSections();
                document.getElementById('empresa').style.display = 'block';
                exibirEmpresas();
                break;
              default:
                hideAllSections();
                document.getElementById('conteudo-principal').style.display = 'block';
                break;
            }
            hideSidebarOnMobile();
          }

          function navegarParaHash(hash) {
            if (window.location.hash === hash) {
              abrirSecaoDoHash(hash);
            } else {
              window.location.hash = hash;
            }
          }

          window.addEventListener('hashchange', function() {
            abrirSecaoDoHash(window.location.hash || '#');
          });

          document.addEventListener('DOMContentLoaded', function() {
            abrirSecaoDoHash(window.location.hash || '#');
          });

          // BotÃ£o voltar ao menu
          document.getElementById('back-to-menu').addEventListener('click', function() {
            // Ocultar todas as seÃ§Ãµes
            hideAllSections();
            document.getElementById('conteudo-principal').style.display = 'block';
              window.location.hash = '#';
            
            // Mostrar sidebar novamente
            showSidebarOnMobile();
          });

          // Alterna exibiÃ§Ã£o do formulÃ¡rio ao clicar em "Usuário"
            document.querySelectorAll('.nav a[href="#usuario"]').forEach(function(link){
              link.addEventListener('click',function(e){
                e.preventDefault();
                navegarParaHash('#usuario');
              });
            });
          // Exibir formulÃ¡rio Nova RAS ao clicar em +RAS
            document.querySelectorAll('.nav a[href="#ras"]').forEach(function(link){
              link.addEventListener('click',function(e){
                e.preventDefault();
                navegarParaHash('#ras');
              });
            });
            
            // Event listeners para botÃµes do RAS
            document.addEventListener('DOMContentLoaded', function() {
              // BotÃ£o Nova Reunião
              if (document.getElementById('ras-nova-reuniao')) {
                document.getElementById('ras-nova-reuniao').addEventListener('click', function() {
                  document.getElementById('ras-lista-reunioes').style.display = 'none';
                  document.getElementById('ras-formulario-container').style.display = 'block';
                  // Resetar para etapa 1
                  mostrarEtapaRAS(1);
                });
              }
              
              // BotÃ£o Voltar do FormulÃ¡rio
              if (document.getElementById('ras-voltar-formulario')) {
                document.getElementById('ras-voltar-formulario').addEventListener('click', function() {
                  document.getElementById('ras-formulario-container').style.display = 'none';
                  document.getElementById('ras-lista-reunioes').style.display = 'block';
                });
              }
            });
          // Exibir funcionÃ¡rios ao clicar em FuncionÃ¡rios
            document.querySelectorAll('.nav a[href="#funcionarios"]').forEach(function(link){
              link.addEventListener('click',function(e){
                e.preventDefault();
                navegarParaHash('#funcionarios');
              });
            });
          // Exibir frequÃªncia ao clicar em Frequência
            document.querySelectorAll('.nav a[href="#frequencia"]').forEach(function(link){
              link.addEventListener('click',function(e){
                e.preventDefault();
                navegarParaHash('#frequencia');
              });
            });
          // Exibir CPT ao clicar em CPT
            document.querySelectorAll('.nav a[href="#cpt"]').forEach(function(link){
              link.addEventListener('click',function(e){
                e.preventDefault();
                navegarParaHash('#cpt');
              });
            });
          // Exibir Inspeção ao clicar em Inspeção de HSE
            document.querySelectorAll('.nav a[href="#inspecao"]').forEach(function(link){
              link.addEventListener('click',function(e){
                e.preventDefault();
                navegarParaHash('#inspecao');
              });
            });
          // Exibir ART ao clicar em ART
            document.querySelectorAll('.nav a[href="#art"]').forEach(function(link){
              link.addEventListener('click',function(e){
                e.preventDefault();
                navegarParaHash('#art');
              });
            });
          // Exibir Empresa ao clicar em Empresa
            document.querySelectorAll('.nav a[href="#empresa"]').forEach(function(link){
              link.addEventListener('click',function(e){
                e.preventDefault();
                navegarParaHash('#empresa');
              });
            });
          // Ocultar outras seÃ§Ãµes ao clicar em outros itens
            document.querySelectorAll('.nav a:not([href="#ras"]):not([href="#usuario"]):not([href="#funcionarios"]):not([href="#frequencia"]):not([href="#cpt"]):not([href="#inspecao"]):not([href="#art"]):not([href="#empresa"])').forEach(function(link){
              link.addEventListener('click',function(){
                navegarParaHash('#');
              });
            });

          // Habilitar botÃ£o PrÃ³ximo sÃ³ se todos os campos obrigatÃ³rios estiverem preenchidos - Etapa 1
          function validarRASEtapa1() {
            var empresa = document.getElementById('ras-empresa').value;
            var data = document.getElementById('ras-data').value;
            var inicio = document.getElementById('ras-inicio').value;
            var termino = document.getElementById('ras-termino').value;
            var efetivo = document.getElementById('ras-efetivo').value;
            var altoRisco = document.getElementById('ras-alto-risco').value.trim();
            var compartilhar = document.getElementById('ras-compartilhar').value.trim();
            var proximo = document.getElementById('ras-proximo-1');
            if(empresa && data && inicio && termino && efetivo && altoRisco && compartilhar) {
              proximo.disabled = false;
              proximo.style.opacity = '1';
              proximo.style.cursor = 'pointer';
            } else {
              proximo.disabled = true;
              proximo.style.opacity = '0.5';
              proximo.style.cursor = 'not-allowed';
            }
          }

          // ValidaÃ§Ã£o para Etapa 2 - ParticipaÃ§Ã£o de LideranÃ§a
          function validarRASEtapa2() {
            var proximo = document.getElementById('ras-proximo-2');

            // If the compact participants UI is used, allow progressing when at least one participant was added
            if (typeof participantesRAS !== 'undefined' && participantesRAS.length > 0) {
              proximo.disabled = false;
              proximo.style.opacity = '1';
              proximo.style.cursor = 'pointer';
              return;
            }

            // Fallback to legacy hidden-role validation (for compatibility)
            var gerente = document.getElementById('ras-gerente')?.value || '';
            var engenheiro = document.getElementById('ras-engenheiro')?.value || '';
            var supervisor = document.getElementById('ras-supervisor')?.value || '';
            var encarregado = document.getElementById('ras-encarregado')?.value || '';
            var tecnicoSeguranca = document.getElementById('ras-tecnico-seguranca')?.value || '';

            if(gerente && engenheiro && supervisor && encarregado && tecnicoSeguranca) {
              proximo.disabled = false;
              proximo.style.opacity = '1';
              proximo.style.cursor = 'pointer';
            } else {
              proximo.disabled = true;
              proximo.style.opacity = '0.5';
              proximo.style.cursor = 'not-allowed';
            }
          }

          // ValidaÃ§Ã£o para Etapa 3 - Outros Participantes
          function validarRASEtapa3() {
            var anjoSemana = document.getElementById('ras-anjo-semana').value;
            var liderRas = document.getElementById('ras-lider-ras').value;
            var liderCpt = document.getElementById('ras-lider-cpt').value;
            var brigada = document.getElementById('ras-brigada').value;
            var proximo = document.getElementById('ras-proximo-3');
            
            if(anjoSemana && liderRas && liderCpt && brigada) {
              proximo.disabled = false;
              proximo.style.opacity = '1';
              proximo.style.cursor = 'pointer';
            } else {
              proximo.disabled = true;
              proximo.style.opacity = '0.5';
              proximo.style.cursor = 'not-allowed';
            }
          }

          // VariÃ¡veis globais para armazenar arquivos separados
          var fotosCarregadas = [];
          var evidenciasCarregadas = [];

          // ValidaÃ§Ã£o para Etapa 4 - Anexos
          function validarRASEtapa4() {
            var proximo = document.getElementById('ras-proximo-4');
            
            // Precisa ter pelo menos 1 foto E 1 evidÃªncia
            if(fotosCarregadas.length > 0 && evidenciasCarregadas.length > 0) {
              proximo.disabled = false;
              proximo.style.opacity = '1';
              proximo.style.cursor = 'pointer';
            } else {
              proximo.disabled = true;
              proximo.style.opacity = '0.5';
              proximo.style.cursor = 'not-allowed';
            }
          }

          // FunÃ§Ã£o para validar tipo de arquivo - Fotos
          function validarTipoFoto(arquivo) {
            var tiposPermitidos = ['image/jpeg', 'image/jpg', 'image/png'];
            return tiposPermitidos.includes(arquivo.type);
          }

          // FunÃ§Ã£o para validar tipo de arquivo - EvidÃªncias (PDF)
          function validarTipoEvidencia(arquivo) {
            return arquivo.type === 'application/pdf';
          }

          // FunÃ§Ã£o para formatar tamanho do arquivo
          function formatarTamanho(bytes) {
            if (bytes === 0) return '0 Bytes';
            var k = 1024;
            var tamanhos = ['Bytes', 'KB', 'MB', 'GB'];
            var i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + tamanhos[i];
          }

          // FunÃ§Ã£o para exibir fotos carregadas
          function exibirFotos() {
            var container = document.getElementById('fotos-container');
            var listaFotos = document.getElementById('fotos-list');
            
            if (fotosCarregadas.length > 0) {
              listaFotos.style.display = 'block';
              container.innerHTML = '';
              
              fotosCarregadas.forEach(function(arquivo, index) {
                var arquivoDiv = document.createElement('div');
                arquivoDiv.style.cssText = 'display:flex;align-items:center;justify-content:space-between;padding:8px 12px;margin-bottom:8px;background:#dbeafe;border-radius:6px;border:1px solid #93c5fd;';
                
                var infoArquivo = document.createElement('div');
                infoArquivo.style.cssText = 'flex:1;';
                
                var nomeArquivo = document.createElement('div');
                nomeArquivo.style.cssText = 'font-weight:600;color:#1e40af;font-size:0.9rem;';
                nomeArquivo.textContent = arquivo.name;
                
                var tamanhoArquivo = document.createElement('div');
                tamanhoArquivo.style.cssText = 'color:#6b7280;font-size:0.8rem;';
                tamanhoArquivo.textContent = formatarTamanho(arquivo.size);
                
                var botaoRemover = document.createElement('button');
                botaoRemover.style.cssText = 'background:#ef4444;color:#fff;border:none;border-radius:4px;padding:4px 8px;font-size:0.8rem;cursor:pointer;';
                botaoRemover.textContent = 'X';
                botaoRemover.onclick = function() {
                  fotosCarregadas.splice(index, 1);
                  exibirFotos();
                  validarRASEtapa4();
                };
                
                infoArquivo.appendChild(nomeArquivo);
                infoArquivo.appendChild(tamanhoArquivo);
                arquivoDiv.appendChild(infoArquivo);
                arquivoDiv.appendChild(botaoRemover);
                container.appendChild(arquivoDiv);
              });
            } else {
              listaFotos.style.display = 'none';
            }
          }

          // FunÃ§Ã£o para exibir evidÃªncias carregadas
          function exibirEvidencias() {
            var container = document.getElementById('evidencias-container');
            var listaEvidencias = document.getElementById('evidencias-list');
            
            if (evidenciasCarregadas.length > 0) {
              listaEvidencias.style.display = 'block';
              container.innerHTML = '';
              
              evidenciasCarregadas.forEach(function(arquivo, index) {
                var arquivoDiv = document.createElement('div');
                arquivoDiv.style.cssText = 'display:flex;align-items:center;justify-content:space-between;padding:8px 12px;margin-bottom:8px;background:#fee2e2;border-radius:6px;border:1px solid #fca5a5;';
                
                var infoArquivo = document.createElement('div');
                infoArquivo.style.cssText = 'flex:1;';
                
                var nomeArquivo = document.createElement('div');
                nomeArquivo.style.cssText = 'font-weight:600;color:#dc2626;font-size:0.9rem;';
                nomeArquivo.textContent = arquivo.name;
                
                var tamanhoArquivo = document.createElement('div');
                tamanhoArquivo.style.cssText = 'color:#6b7280;font-size:0.8rem;';
                tamanhoArquivo.textContent = formatarTamanho(arquivo.size);
                
                var botaoRemover = document.createElement('button');
                botaoRemover.style.cssText = 'background:#ef4444;color:#fff;border:none;border-radius:4px;padding:4px 8px;font-size:0.8rem;cursor:pointer;';
                botaoRemover.textContent = 'X';
                botaoRemover.onclick = function() {
                  evidenciasCarregadas.splice(index, 1);
                  exibirEvidencias();
                  validarRASEtapa4();
                };
                
                infoArquivo.appendChild(nomeArquivo);
                infoArquivo.appendChild(tamanhoArquivo);
                arquivoDiv.appendChild(infoArquivo);
                arquivoDiv.appendChild(botaoRemover);
                container.appendChild(arquivoDiv);
              });
            } else {
              listaEvidencias.style.display = 'none';
            }
          }

          // Configurar upload de fotos
          function configurarUploadFotos() {
            var uploadArea = document.getElementById('upload-area-fotos');
            var fileInput = document.getElementById('file-input-fotos');
            var selectButton = document.getElementById('select-fotos');
            
            // Clique no botÃ£o
            selectButton.addEventListener('click', function() {
              fileInput.click();
            });
            
            // Clique na Ã¡rea de upload
            uploadArea.addEventListener('click', function(e) {
              if (e.target !== selectButton) {
                fileInput.click();
              }
            });
            
            // Arrastar e soltar
            uploadArea.addEventListener('dragover', function(e) {
              e.preventDefault();
              uploadArea.style.borderColor = '#3b82f6';
              uploadArea.style.backgroundColor = '#eff6ff';
            });
            
            uploadArea.addEventListener('dragleave', function(e) {
              e.preventDefault();
              uploadArea.style.borderColor = '#d1d5db';
              uploadArea.style.backgroundColor = '#f0f9ff';
            });
            
            uploadArea.addEventListener('drop', function(e) {
              e.preventDefault();
              uploadArea.style.borderColor = '#d1d5db';
              uploadArea.style.backgroundColor = '#f0f9ff';
              
              var arquivos = Array.from(e.dataTransfer.files);
              processarFotos(arquivos);
            });
            
            // SeleÃ§Ã£o de arquivos
            fileInput.addEventListener('change', function(e) {
              var arquivos = Array.from(e.target.files);
              processarFotos(arquivos);
            });
          }

          // Configurar upload de evidÃªncias
          function configurarUploadEvidencias() {
            var uploadArea = document.getElementById('upload-area-evidencias');
            var fileInput = document.getElementById('file-input-evidencias');
            var selectButton = document.getElementById('select-evidencias');
            
            // Clique no botÃ£o
            selectButton.addEventListener('click', function() {
              fileInput.click();
            });
            
            // Clique na Ã¡rea de upload
            uploadArea.addEventListener('click', function(e) {
              if (e.target !== selectButton) {
                fileInput.click();
              }
            });
            
            // Arrastar e soltar
            uploadArea.addEventListener('dragover', function(e) {
              e.preventDefault();
              uploadArea.style.borderColor = '#ef4444';
              uploadArea.style.backgroundColor = '#fef2f2';
            });
            
            uploadArea.addEventListener('dragleave', function(e) {
              e.preventDefault();
              uploadArea.style.borderColor = '#d1d5db';
              uploadArea.style.backgroundColor = '#fef2f2';
            });
            
            uploadArea.addEventListener('drop', function(e) {
              e.preventDefault();
              uploadArea.style.borderColor = '#d1d5db';
              uploadArea.style.backgroundColor = '#fef2f2';
              
              var arquivos = Array.from(e.dataTransfer.files);
              processarEvidencias(arquivos);
            });
            
            // SeleÃ§Ã£o de arquivos
            fileInput.addEventListener('change', function(e) {
              var arquivos = Array.from(e.target.files);
              processarEvidencias(arquivos);
            });
          }

          // Processar fotos selecionadas
          function processarFotos(arquivos) {
            arquivos.forEach(function(arquivo) {
              if (validarTipoFoto(arquivo)) {
                // Verificar se arquivo jÃ¡ foi adicionado
                var jaExiste = fotosCarregadas.some(function(arq) {
                  return arq.name === arquivo.name && arq.size === arquivo.size;
                });
                
                if (!jaExiste) {
                  fotosCarregadas.push(arquivo);
                }
              } else {
                alert('Tipo de arquivo nÃ£o permitido para fotos: ' + arquivo.name + '\nUse apenas JPG ou PNG.');
              }
            });
            
            exibirFotos();
            validarRASEtapa4();
          }

          // Processar evidÃªncias selecionadas
          function processarEvidencias(arquivos) {
            arquivos.forEach(function(arquivo) {
              if (validarTipoEvidencia(arquivo)) {
                // Verificar se arquivo jÃ¡ foi adicionado
                var jaExiste = evidenciasCarregadas.some(function(arq) {
                  return arq.name === arquivo.name && arq.size === arquivo.size;
                });
                
                if (!jaExiste) {
                  evidenciasCarregadas.push(arquivo);
                }
              } else {
                alert('Tipo de arquivo nÃ£o permitido para evidÃªncias: ' + arquivo.name + '\nUse apenas PDF.');
              }
            });
            
            exibirEvidencias();
            validarRASEtapa4();
          }

          // Validar tipo de arquivo para fotos
          function validarTipoFoto(arquivo) {
            var extensoesPermitidas = ['jpg', 'jpeg', 'png'];
            var extensao = arquivo.name.split('.').pop().toLowerCase();
            return extensoesPermitidas.includes(extensao);
          }

          // Validar tipo de arquivo para evidÃªncias
          function validarTipoEvidencia(arquivo) {
            var extensao = arquivo.name.split('.').pop().toLowerCase();
            return extensao === 'pdf';
          }

          // FunÃ§Ã£o para coletar todos os dados preenchidos
          function coletarDadosRAS() {
            var dados = {
              // Etapa 1 - InformaÃ§Ãµes BÃ¡sicas
              empresa: document.getElementById('ras-empresa').value,
              data: document.getElementById('ras-data').value,
              inicio: document.getElementById('ras-inicio').value,
              termino: document.getElementById('ras-termino').value,
              efetivo: document.getElementById('ras-efetivo').value,
              altoRisco: document.getElementById('ras-alto-risco').value,
              tardc: document.getElementById('ras-tardc').checked,
              compartilhar: document.getElementById('ras-compartilhar').value,
              
              // Etapa 2 - ParticipaÃ§Ã£o de LideranÃ§a
              gerente: document.getElementById('ras-gerente').value,
              engenheiro: document.getElementById('ras-engenheiro').value,
              supervisor: document.getElementById('ras-supervisor').value,
              encarregado: document.getElementById('ras-encarregado').value,
              tecnicoSeguranca: document.getElementById('ras-tecnico-seguranca').value,
              
              // Etapa 3 - Outros Participantes
              anjoSemana: document.getElementById('ras-anjo-semana').value,
              liderRas: document.getElementById('ras-lider-ras').value,
              liderCpt: document.getElementById('ras-lider-cpt').value,
              brigada: document.getElementById('ras-brigada').value,
              
              // Etapa 4 - Anexos
              fotos: fotosCarregadas,
              evidencias: evidenciasCarregadas
            };
            
            return dados;
          }

          // FunÃ§Ã£o para formatar data para exibiÃ§Ã£o
          function formatarDataExibicao(dataInput) {
            if (!dataInput) return '-';
            var data = new Date(dataInput + 'T00:00:00');
            return data.toLocaleDateString('pt-BR');
          }

          // FunÃ§Ã£o para atualizar revisÃ£o dos dados
          function atualizarRevisao() {
            var dados = coletarDadosRAS();
            
            // InformaÃ§Ãµes BÃ¡sicas
            document.getElementById('review-empresa').textContent = dados.empresa || '-';
            document.getElementById('review-data').textContent = formatarDataExibicao(dados.data);
            document.getElementById('review-horario').textContent = dados.inicio && dados.termino ? dados.inicio + ' Ã s ' + dados.termino : '-';
            document.getElementById('review-efetivo').textContent = dados.efetivo || '-';
            document.getElementById('review-alto-risco').textContent = dados.altoRisco || '-';
            document.getElementById('review-tardc').textContent = dados.tardc ? 'SIM' : 'NÃƒO';
            document.getElementById('review-compartilhar').textContent = dados.compartilhar || '-';
            
            // Participantes
            document.getElementById('review-gerente').textContent = dados.gerente || '-';
            document.getElementById('review-engenheiro').textContent = dados.engenheiro || '-';
            document.getElementById('review-supervisor').textContent = dados.supervisor || '-';
            document.getElementById('review-encarregado').textContent = dados.encarregado || '-';
            document.getElementById('review-tecnico-seguranca').textContent = dados.tecnicoSeguranca || '-';
            document.getElementById('review-anjo-semana').textContent = dados.anjoSemana || '-';
            document.getElementById('review-lider-ras').textContent = dados.liderRas || '-';
            document.getElementById('review-lider-cpt').textContent = dados.liderCpt || '-';
            document.getElementById('review-brigada').textContent = dados.brigada || '-';
            
            // Anexos
            var fotosCount = dados.fotos.length;
            var evidenciasCount = dados.evidencias.length;
            var totalAnexos = fotosCount + evidenciasCount;
            
            document.getElementById('review-anexos-count').textContent = totalAnexos;
            
            var anexosList = document.getElementById('review-anexos-list');
            if (totalAnexos > 0) {
              var listaHTML = '';
              
              // Exibir fotos
              if (fotosCount > 0) {
                listaHTML += '<div style="font-weight:bold;color:#3b82f6;margin-bottom:8px;"> Fotos da RAS (' + fotosCount + '):</div>';
                dados.fotos.forEach(function(arquivo) {
                  listaHTML += '<div style="display:flex;align-items:center;gap:8px;margin-bottom:4px;margin-left:16px;">';
                  listaHTML += '<span style="font-size:1rem;"></span>';
                  listaHTML += '<span>' + arquivo.name + '</span>';
                  listaHTML += '</div>';
                });
              }
              
              // Exibir evidÃªncias
              if (evidenciasCount > 0) {
                if (fotosCount > 0) listaHTML += '<div style="margin:12px 0;"></div>';
                listaHTML += '<div style="font-weight:bold;color:#ef4444;margin-bottom:8px;"> EvidÃªncias da RAS (' + evidenciasCount + '):</div>';
                dados.evidencias.forEach(function(arquivo) {
                  listaHTML += '<div style="display:flex;align-items:center;gap:8px;margin-bottom:4px;margin-left:16px;">';
                  listaHTML += '<span style="font-size:1rem;">ï¿½</span>';
                  listaHTML += '<span>' + arquivo.name + '</span>';
                  listaHTML += '</div>';
                });
              }
              
              anexosList.innerHTML = listaHTML;
            } else {
              anexosList.innerHTML = '<div style="color:#6b7280;">Nenhum arquivo carregado</div>';
            }
          }

          // ValidaÃ§Ã£o para Etapa 5 - Revisar InformaÃ§Ãµes
          function validarRASEtapa5() {
            var dados = coletarDadosRAS();
            var botao = document.getElementById('ras-confirmar-presenca');
            
            // Verificar se todos os dados essenciais estÃ£o preenchidos
            // Consider participantsRAS (compact UI) as satisfying leadership presence
            var possuiLideranca = (typeof participantesRAS !== 'undefined' && participantesRAS.length > 0) ||
                       (dados.gerente && dados.engenheiro && dados.supervisor && dados.encarregado && dados.tecnicoSeguranca);

            var possuiAnexos = (dados.fotos.length > 0 || dados.evidencias.length > 0);

            var dadosCompletos = dados.empresa && dados.data && dados.inicio && dados.termino && 
                      dados.efetivo && dados.altoRisco && dados.compartilhar &&
                      possuiLideranca &&
                      dados.anjoSemana && dados.liderRas && dados.liderCpt && 
                      dados.brigada && possuiAnexos;
            
            if (dadosCompletos) {
              botao.disabled = false;
              botao.style.opacity = '1';
              botao.style.cursor = 'pointer';
            } else {
              botao.disabled = true;
              botao.style.opacity = '0.5';
              botao.style.cursor = 'not-allowed';
            }
          }

          // Eventos para validaÃ§Ã£o da Etapa 1
          ['ras-empresa','ras-data','ras-inicio','ras-termino','ras-efetivo','ras-alto-risco','ras-compartilhar'].forEach(function(id){
            document.getElementById(id).addEventListener('input',validarRASEtapa1);
          });

          // Eventos para validaÃ§Ã£o da Etapa 2 (ui compacta: adicionar / remover participantes)
          // Os inputs "ras-gerente" etc. sÃ£o hidden e serÃ£o atualizados quando itens forem adicionados/removidos
          document.getElementById('ras-add-participante').addEventListener('click', function() {
            adicionarParticipanteRAS();
          });

          // TambÃ©m validar quando as hidden inputs mudarem (manter compatibilidade)
          ['ras-gerente','ras-engenheiro','ras-supervisor','ras-encarregado','ras-tecnico-seguranca'].forEach(function(id){
            var el = document.getElementById(id);
            if (el) el.addEventListener('change', validarRASEtapa2);
          });

          // Eventos para validaÃ§Ã£o da Etapa 3
          ['ras-anjo-semana','ras-lider-ras','ras-lider-cpt','ras-brigada'].forEach(function(id){
            document.getElementById(id).addEventListener('change',validarRASEtapa3);
          });

          // NavegaÃ§Ã£o entre etapas
          document.getElementById('ras-proximo-1').addEventListener('click', function() {
            if (!this.disabled) {
              document.getElementById('ras-etapa-1').style.display = 'none';
              document.getElementById('ras-etapa-2').style.display = 'block';
              // Carregar colaboradores quando avanÃ§ar para Etapa 2
              carregarColaboradoresRAS();
              // Se form for criaÃ§Ã£o nova (nÃ£o ediÃ§Ã£o), limpar lista; caso contrÃ¡rio manter participantes jÃ¡ preenchidos
              if (typeof window.rasEditandoIndex === 'undefined') {
                limparParticipantesRAS();
              } else {
                renderListaParticipantesRAS();
              }
            }
          });

          document.getElementById('ras-voltar-2').addEventListener('click', function() {
            document.getElementById('ras-etapa-2').style.display = 'none';
            document.getElementById('ras-etapa-1').style.display = 'block';
          });

          document.getElementById('ras-proximo-2').addEventListener('click', function() {
            if (!this.disabled) {
              document.getElementById('ras-etapa-2').style.display = 'none';
              document.getElementById('ras-etapa-3').style.display = 'block';
              // Carregar colaboradores na etapa 3
              carregarColaboradoresRASEtapa3();
            }
          });

          document.getElementById('ras-voltar-3').addEventListener('click', function() {
            document.getElementById('ras-etapa-3').style.display = 'none';
            document.getElementById('ras-etapa-2').style.display = 'block';
          });

          document.getElementById('ras-proximo-3').addEventListener('click', function() {
            if (!this.disabled) {
              document.getElementById('ras-etapa-3').style.display = 'none';
              document.getElementById('ras-etapa-4').style.display = 'block';
              // Inicializar sistemas de upload na primeira vez que entrar na etapa 4
              if (!window.uploadInicializado) {
                configurarUploadFotos();
                configurarUploadEvidencias();
                window.uploadInicializado = true;
              }
            }
          });

          document.getElementById('ras-voltar-4').addEventListener('click', function() {
            document.getElementById('ras-etapa-4').style.display = 'none';
            document.getElementById('ras-etapa-3').style.display = 'block';
            // Carregar colaboradores na etapa 3
            carregarColaboradoresRASEtapa3();
          });

          document.getElementById('ras-proximo-4').addEventListener('click', function() {
            if (!this.disabled) {
              document.getElementById('ras-etapa-4').style.display = 'none';
              document.getElementById('ras-etapa-5').style.display = 'block';
              // Atualizar revisÃ£o dos dados ao entrar na etapa 5
              atualizarRevisao();
              validarRASEtapa5();
            }
          });

          document.getElementById('ras-voltar-5').addEventListener('click', function() {
            document.getElementById('ras-etapa-5').style.display = 'none';
            document.getElementById('ras-etapa-4').style.display = 'block';
          });

          document.getElementById('ras-confirmar-presenca').addEventListener('click', function() {
            if (!this.disabled) {
              document.getElementById('ras-etapa-5').style.display = 'none';
              document.getElementById('ras-etapa-6').style.display = 'block';
              // Carregar lista de funcionÃ¡rios
              carregarFuncionariosRASEtapa6();
            }
          });

          // Eventos da Etapa 6
          document.getElementById('ras-voltar-6').addEventListener('click', function() {
            document.getElementById('ras-etapa-6').style.display = 'none';
            document.getElementById('ras-etapa-5').style.display = 'block';
          });

          document.getElementById('ras-finalizar').addEventListener('click', function() {
            document.getElementById('ras-etapa-6').style.display = 'none';
            document.getElementById('ras-relatorio-final').style.display = 'block';
            gerarRelatorioFinal();
          });

          // FunÃ§Ã£o para marcar/desmarcar todos os funcionÃ¡rios
          document.getElementById('marcar-todos').addEventListener('click', function() {
            toggleTodosFuncionarios();
            this.textContent = todosMarcados ? 'Marcar Todos' : 'Desmarcar Todos';
          });

          // FunÃ§Ã£o para atualizar contador de presentes
          function atualizarContadorPresentes() {
            // Count checked boxes inside rows
            var checkboxes = document.querySelectorAll('.funcionario-row input[type="checkbox"]:checked');
            var total = checkboxes.length;
            var span = document.getElementById('total-presentes');
            if (span) span.textContent = total;
          }

          // FunÃ§Ã£o para coletar funcionÃ¡rios presentes
          function coletarFuncionariosPresentes() {
            var presentes = [];
            var checkboxes = document.querySelectorAll('.funcionario-row input[type="checkbox"]:checked');

            checkboxes.forEach(function(checkbox) {
              // Find the row element that represents the employee
              var row = checkbox.closest('.funcionario-row');
              if (!row) return;

              // Direct child divs correspond to columns: [checkboxDiv, matriculaDiv, nomeDiv, empresaDiv, funcaoDiv]
              var cols = Array.prototype.slice.call(row.children || []);
              if (cols.length < 5) return;

              presentes.push({
                matricula: (cols[1].textContent || '').trim(),
                nome: (cols[2].textContent || '').trim(),
                empresa: (cols[3].textContent || '').trim(),
                funcao: (cols[4].textContent || '').trim()
              });
            });

            return presentes;
          }

          // Adicionar event listeners aos checkboxes dos funcionÃ¡rios
          document.addEventListener('change', function(e) {
            if (e.target.type === 'checkbox' && e.target.closest('#lista-funcionarios')) {
              atualizarContadorPresentes();
            }
          });

          // FunÃ§Ã£o para gerar o relatÃ³rio final
          function gerarRelatorioFinal() {
            var dados = coletarDadosRAS();
            var presentes = coletarFuncionariosPresentes();
            
            // Preencher informaÃ§Ãµes bÃ¡sicas
            document.getElementById('rel-empresa').textContent = dados.empresa || '-';
            document.getElementById('rel-data').textContent = formatarDataExibicao(dados.data);
            document.getElementById('rel-horario').textContent = dados.inicio && dados.termino ? dados.inicio + ' Ã s ' + dados.termino : '-';
            document.getElementById('rel-efetivo').textContent = dados.efetivo || '-';
            document.getElementById('rel-alto-risco').textContent = dados.altoRisco || '-';
            document.getElementById('rel-tardc').textContent = dados.tardc ? 'SIM' : 'NÃƒO';
            document.getElementById('rel-compartilhar').textContent = dados.compartilhar || '-';
            
            // ParticipaÃ§Ã£o de lideranÃ§a
            document.getElementById('rel-gerente').textContent = dados.gerente || '-';
            document.getElementById('rel-engenheiro').textContent = dados.engenheiro || '-';
            document.getElementById('rel-supervisor').textContent = dados.supervisor || '-';
            document.getElementById('rel-encarregado').textContent = dados.encarregado || '-';
            document.getElementById('rel-tecnico-seguranca').textContent = dados.tecnicoSeguranca || '-';
            
            // Outros participantes
            document.getElementById('rel-anjo-semana').textContent = dados.anjoSemana || '-';
            document.getElementById('rel-lider-ras').textContent = dados.liderRas || '-';
            document.getElementById('rel-lider-cpt').textContent = dados.liderCpt || '-';
            document.getElementById('rel-brigada').textContent = dados.brigada || '-';
            
            // Exibir fotos
            exibirFotosRelatorio(dados.fotos);
            
            // Exibir evidÃªncias
            exibirEvidenciasRelatorio(dados.evidencias);
            
            // Lista de presenÃ§a
            document.getElementById('rel-total-presentes').textContent = presentes.length;
            // Calcular ausentes com base no efetivo informado (se existir)
            var efetivoNum = parseInt(dados.efetivo) || 0;
            var ausentes = 0;
            if (efetivoNum > 0) {
              ausentes = Math.max(0, efetivoNum - presentes.length);
            } else {
              // NÃ£o hÃ¡ efetivo informado  ausentes calculados como 0 (nÃ£o sabemos o total esperado)
              ausentes = 0;
            }
            var ausentesSpan = document.getElementById('rel-total-ausentes');
            if (ausentesSpan) ausentesSpan.textContent = ausentes;
            // Calcular lista de ausentes a partir dos colaboradores cadastrados localmente (compatÃ­vel com Etapa 6)
            var colaboradoresCadastrados = JSON.parse(localStorage.getItem('funcionarios')) || [];
            var matriculasPresentes = presentes.map(function(p){ return (p.matricula || '').toString().trim(); }).filter(Boolean);
            var ausentes = [];
            colaboradoresCadastrados.forEach(function(f){
              var m = (f.matricula || '').toString().trim();
              var estaPresente = m ? (matriculasPresentes.indexOf(m) !== -1) : presentes.some(function(p){ return p.nome === f.nome; });
              if (!estaPresente) {
                ausentes.push({ matricula: f.matricula || '', nome: f.nome || '', empresa: f.empresa || '', funcao: f.funcao || '' });
              }
            });

            // Atualizar total de ausentes mostrado no relatÃ³rio e exibir as listas
            var ausentesSpan = document.getElementById('rel-total-ausentes');
            if (ausentesSpan) ausentesSpan.textContent = ausentes.length;

            exibirListaPresencaRelatorio(presentes);
            exibirListaAusentesRelatorio(ausentes);
            
            // Salvar dados de frequÃªncia no histÃ³rico
            salvarFrequenciaRAS(dados.data, presentes);
          }

          // FunÃ§Ã£o para exibir fotos no relatÃ³rio
          function exibirFotosRelatorio(fotos) {
            var container = document.getElementById('rel-fotos-container');
            var section = document.getElementById('rel-fotos-section');
            
            if (fotos && fotos.length > 0) {
              section.style.display = 'block';
              var html = '';
              fotos.forEach(function(foto) {
                var url = URL.createObjectURL(foto);
                html += '<div style="border:1px solid #e5e7eb;border-radius:8px;overflow:hidden;background:#fff">';
                html += '<img src="' + url + '" style="width:100%;height:150px;object-fit:cover">';
                html += '<div style="padding:8px;font-size:0.9rem;color:#6b7280">' + foto.name + '</div>';
                html += '</div>';
              });
              container.innerHTML = html;
            } else {
              section.style.display = 'none';
            }
          }

          // FunÃ§Ã£o para exibir evidÃªncias no relatÃ³rio
          function exibirEvidenciasRelatorio(evidencias) {
            var container = document.getElementById('rel-evidencias-container');
            var section = document.getElementById('rel-evidencias-section');
            
            if (evidencias && evidencias.length > 0) {
              section.style.display = 'block';
              var html = '';
              evidencias.forEach(function(evidencia) {
                html += '<div style="display:flex;align-items:center;gap:8px;padding:8px;border:1px solid #e5e7eb;border-radius:6px;margin-bottom:8px;background:#fff">';
                html += '<span style="font-size:1.2rem;"></span>';
                html += '<span style="flex:1">' + evidencia.name + '</span>';
                html += '<span style="color:#6b7280;font-size:0.8rem">' + formatarTamanho(evidencia.size) + '</span>';
                html += '</div>';
              });
              container.innerHTML = html;
            } else {
              section.style.display = 'none';
            }
          }

          // FunÃ§Ã£o para exibir lista de presenÃ§a no relatÃ³rio
          function exibirListaPresencaRelatorio(presentes) {
            var container = document.getElementById('rel-presentes-lista');
            
            if (presentes.length > 0) {
              var html = '<div style="background:#f9fafb;padding:12px 16px;border-bottom:1px solid #e5e7eb;display:grid;grid-template-columns:120px 1fr 1fr 1fr;gap:16px;font-weight:600;color:#374151">';
              html += '<div>MatrÃ­cula</div><div>Nome</div><div>Empresa</div><div>FunÃ§Ã£o</div></div>';
              
              presentes.forEach(function(pessoa) {
                html += '<div style="padding:12px 16px;border-bottom:1px solid #f3f4f6;display:grid;grid-template-columns:120px 1fr 1fr 1fr;gap:16px">';
                html += '<div style="font-weight:500">' + pessoa.matricula + '</div>';
                html += '<div>' + pessoa.nome + '</div>';
                html += '<div style="color:#6b7280">' + pessoa.empresa + '</div>';
                html += '<div style="color:#6b7280">' + pessoa.funcao + '</div>';
                html += '</div>';
              });
              
              container.innerHTML = html;
            } else {
              container.innerHTML = '<div style="padding:20px;text-align:center;color:#6b7280">Nenhum funcionÃ¡rio marcado como presente</div>';
            }
          }

          // FunÃ§Ã£o para exibir lista de ausentes no relatÃ³rio
          function exibirListaAusentesRelatorio(ausentes) {
            var container = document.getElementById('rel-ausentes-lista');

            if (!container) return;

            if (ausentes.length > 0) {
              var html = '<div style="background:#fef2f2;padding:12px 16px;border-bottom:1px solid #fee2e2;display:grid;grid-template-columns:120px 1fr 1fr 1fr;gap:16px;font-weight:600;color:#92302a">';
              html += '<div>MatrÃ­cula</div><div>Nome</div><div>Empresa</div><div>FunÃ§Ã£o</div></div>';

              ausentes.forEach(function(pessoa) {
                html += '<div style="padding:12px 16px;border-bottom:1px solid #fef2f2;display:grid;grid-template-columns:120px 1fr 1fr 1fr;gap:16px">';
                html += '<div style="font-weight:500">' + (pessoa.matricula || '-') + '</div>';
                html += '<div>' + (pessoa.nome || '-') + '</div>';
                html += '<div style="color:#6b7280">' + (pessoa.empresa || '-') + '</div>';
                html += '<div style="color:#6b7280">' + (pessoa.funcao || '-') + '</div>';
                html += '</div>';
              });

              container.innerHTML = html;
            } else {
              container.innerHTML = '<div style="padding:20px;text-align:center;color:#6b7280">Nenhum funcionÃ¡rio ausente</div>';
            }
          }

          // Eventos dos botÃµes do relatÃ³rio
          document.getElementById('btn-compartilhar-whatsapp').addEventListener('click', function() {
            console.log('BotÃ£o WhatsApp clicado!'); // Debug
            alert('BotÃ£o WhatsApp funcionando!'); // Teste temporÃ¡rio
            
            var dados = coletarDadosRAS();
            console.log('Dados coletados:', dados); // Debug
            
            var presentes = coletarFuncionariosPresentes();
            console.log('Presentes:', presentes); // Debug
            
            var mensagem = '';
            
            // TÃ­tulo principal
            mensagem += 'RAS - Reunião de Análise de Segurança\n\n';
            
            // InformaÃ§Ãµes da empresa
            mensagem += ' Empresa: ' + (dados.empresa || '-') + '\n';
            mensagem += ' DATA: ' + formatarDataExibicao(dados.data) + '\n';
            mensagem += ' Tempo: ' + (dados.inicio && dados.termino ? dados.inicio + ' Ã s ' + dados.termino : '-') + '\n';
            mensagem += ' Efetivo: ' + (dados.efetivo || '-') + ' funcionÃ¡rios\n';
            mensagem += '________________\n\n';
            
            // Tarefa de alto risco
            mensagem += ' ï¸ TAREFA DE ALTO RISCO:\n';
            mensagem += (dados.altoRisco || '-') + '\n';
            mensagem += '________________\n\n';
            
            // Algo a ser compartilhado
            mensagem += ' Algo a ser compartilhado:\n';
            mensagem += (dados.compartilhar || '-') + '\n';
            mensagem += '________________\n\n';
            
            // LideranÃ§a
            mensagem += ' LIDERANÃ‡A:\n';
            mensagem += ' Gerente: ' + (dados.gerente || '-') + '\n';
            mensagem += ' Engenheiro: ' + (dados.engenheiro || '-') + '\n';
            mensagem += ' Supervisor: ' + (dados.supervisor || '-') + '\n';
            mensagem += ' Encarregado: ' + (dados.encarregado || '-') + '\n';
            mensagem += '________________\n\n';
            
            // Segunda seÃ§Ã£o de participantes
            mensagem += ' TÃ©cnico de Segurança: ' + (dados.tecnicoSeguranca || '-') + '\n';
            mensagem += ' Anjo da Semana: ' + (dados.anjoSemana || '-') + '\n';
            mensagem += 'ï¿½ TARD-C: ' + (dados.tardc ? 'SIM' : 'NÃƒO') + '\n';
            mensagem += ' Brigada: ' + (dados.brigada || '-') + '\n';
            
            console.log('Dados coletados:', dados); // Debug
            console.log('Mensagem:', mensagem); // Debug
            
            var url = 'https://api.whatsapp.com/send?text=' + encodeURIComponent(mensagem);
            window.open(url, '_blank');
          });

          document.getElementById('btn-imprimir-pdf').addEventListener('click', function() {
            // Ocultar botÃµes antes de imprimir
            var botoes = document.querySelector('#ras-relatorio-final .flex-wrap');
            botoes.style.display = 'none';
            
            // Configurar para impressÃ£o
            window.print();
            
            // Restaurar botÃµes apÃ³s impressÃ£o
            setTimeout(function() {
              botoes.style.display = 'flex';
            }, 100);
          });

          document.getElementById('btn-sair-ras').addEventListener('click', function() {
            if (confirm('Deseja salvar esta RAS e sair?\n\nA reuniÃ£o serÃ¡ registrada como concluÃ­da.')) {
              // Salvar RAS finalizada
              var salvou = salvarRASFinalizada();
              
              if (salvou) {
                alert('RAS salva com sucesso!');
                
                // Atualizar lista de RAS se estivermos na tela principal
                carregarListaRAS();
                
                // Reset do formulÃ¡rio
                document.getElementById('ras-relatorio-final').style.display = 'none';
                document.getElementById('nova-ras').style.display = 'block';
                document.getElementById('ras-lista-reunioes').style.display = 'block';
                document.getElementById('ras-formulario-container').style.display = 'none';
                
                // Limpar dados
                fotosCarregadas = [];
                evidenciasCarregadas = [];
                
                // Reset das etapas
                for (var i = 1; i <= 6; i++) {
                  document.getElementById('ras-etapa-' + i).style.display = 'none';
                }
                
                // Mostrar etapa 1 novamente
                document.getElementById('ras-etapa-1').style.display = 'block';
                
                // Limpar formulÃ¡rios
                document.querySelectorAll('#nova-ras input, #nova-ras select, #nova-ras textarea').forEach(function(campo) {
                  if (campo.type === 'checkbox') {
                    campo.checked = false;
                  } else {
                    campo.value = '';
                  }
                });
                
                // Limpar checkboxes de funcionÃ¡rios presentes
                document.querySelectorAll('.checkbox-presente').forEach(function(checkbox) {
                  checkbox.checked = false;
                });
                
              } else {
                alert('Erro ao salvar RAS. Tente novamente.');
              }
            }
          });

          // Cadastro de usuÃ¡rios com persistÃªncia em localStorage
          var usuarios = [];
          // Carregar do localStorage ao iniciar
          if(localStorage.getItem('usuarios')){
            try {
              usuarios = JSON.parse(localStorage.getItem('usuarios')) || [];
            } catch(e){ usuarios = []; }
          }
          exibirUsuarios();

          document.getElementById('form-cadastro').addEventListener('submit', function(){
            var nome = document.getElementById('nome').value.trim();
            var perfil = document.getElementById('perfil').value;
            var senha = document.getElementById('senha').value;
            if(!nome || !perfil || !senha) return;
            var primeiroNome = nome.split(' ')[0];
            usuarios.push({nome, perfil, senha, login: primeiroNome});
            // Salvar no localStorage
            localStorage.setItem('usuarios', JSON.stringify(usuarios));
            document.getElementById('form-cadastro').reset();
            exibirUsuarios();
          });

          function exibirUsuarios(){
            var div = document.getElementById('usuarios-cadastrados');
            if(usuarios.length === 0){
              div.innerHTML = '';
              return;
            }
            var html = '<h3>Usuários cadastrados</h3>';
            html += '<table border="1" cellpadding="6" style="border-collapse:collapse;width:100%;font-size:14px">';
            html += '<tr><th>Login</th><th>Nome</th><th>Perfil</th><th>Senha</th><th>Ações</th></tr>';
            usuarios.forEach(function(u, idx){
              html += `<tr><td>${u.login}</td><td>${u.nome}</td><td>${u.perfil}</td><td>${u.senha}</td><td><button onclick=\"excluirUsuario(${idx})\" style='color:#fff;background:#e53e3e;border:none;padding:4px 10px;border-radius:4px;cursor:pointer'>Excluir</button></td></tr>`;
            });
            html += '</table>';
            div.innerHTML = html;
          }

          // FunÃ§Ã£o para excluir usuÃ¡rio (global)
          window.excluirUsuario = function(idx){
            if(confirm('Deseja realmente excluir este usuÃ¡rio?')){
              usuarios.splice(idx,1);
              localStorage.setItem('usuarios', JSON.stringify(usuarios));
              exibirUsuarios();
            }
          }
          // AlternÃ¢ncia entre cadastro e tabela de usuÃ¡rios
          document.getElementById('btn-acessar-usuarios').addEventListener('click', function(){
            document.getElementById('form-cadastro').style.display = 'none';
            document.getElementById('btn-acessar-usuarios').style.display = 'none';
            document.getElementById('usuarios-cadastrados').style.display = 'block';
            document.getElementById('btn-voltar-cadastro').style.display = 'inline-block';
          });
          document.getElementById('btn-voltar-cadastro').addEventListener('click', function(){
            document.getElementById('form-cadastro').style.display = 'block';
            document.getElementById('btn-acessar-usuarios').style.display = 'inline-block';
            document.getElementById('usuarios-cadastrados').style.display = 'block';
            document.getElementById('btn-voltar-cadastro').style.display = 'none';
          });

          // Sistema inicializado sem login

          // ===== SISTEMA DE FUNCIONÃRIOS =====
          var funcionarios = [];

          // Firestore fallback variables
          var firebaseEnabled = false;
          var db = null;

          // Carregar funcionÃ¡rios do localStorage inicialmente (fallback enquanto Firestore carrega)
          if(localStorage.getItem('funcionarios')){
            try {
              funcionarios = JSON.parse(localStorage.getItem('funcionarios')) || [];
            } catch(e){ funcionarios = []; }
          }

          // Inicializar dados exemplo se nÃ£o houver colaboradores (apenas uma vez)
          if (funcionarios.length === 0) {
            funcionarios = [{
              matricula: '28853',
              nome: 'Ademilcio Ferreira Caldas',
              funcao: 'Encarregado de obras II',
              setor: 'Obras Civis',
              admissao: '2025-10-10',
              empresa: 'RS ConstruÃ§Ãµes'
            }];
            localStorage.setItem('funcionarios', JSON.stringify(funcionarios));
          }

          // FunÃ§Ãµes para integrar com Firebase Firestore (opcional)
          window.initFirebaseForFuncionarios = function(config) {
            if(!config) return console.warn('Firebase config nÃ£o fornecido. Ignorando init Firebase.');
            try {
              if(typeof firebase === 'undefined') return console.warn('SDK Firebase nÃ£o carregado.');
              if(!firebase.apps.length) firebase.initializeApp(config);
              db = firebase.firestore();
              firebaseEnabled = true;
              // ApÃ³s inicializar, carregar dados do Firestore e substituir localStorage
              window.loadFuncionariosFromFirestore();
            } catch(e) { console.error('Erro ao inicializar Firebase:', e); }
          }

          window.loadFuncionariosFromFirestore = async function() {
            if(!firebaseEnabled || !db) return;
            try {
              var snapshot = await db.collection('funcionarios').get();
              var docs = [];
              snapshot.forEach(function(d){ docs.push(d.data()); });
              if(docs.length) {
                funcionarios = docs;
                localStorage.setItem('funcionarios', JSON.stringify(funcionarios));
                console.log('FuncionÃ¡rios carregados do Firestore:', funcionarios.length);
                carregarColaboradoresRAS();
                carregarEmpresasColaborador();
              }
            } catch(e) { console.error('Erro ao carregar funcionarios do Firestore:', e); }
          }

        // Salvar funcionÃ¡rios: escreve em Firestore (se ativo) e em localStorage
        window.salvarFuncionarios = async function() {
          try {
            // Salvar localmente sempre
            localStorage.setItem('funcionarios', JSON.stringify(funcionarios));
            console.log('FuncionÃ¡rios salvos localmente:', funcionarios.length);
            // Se Firestore ativo, sincronizar (cada documento terÃ¡ id = matricula)
            if(firebaseEnabled && db) {
              for(var i=0;i<funcionarios.length;i++){
                var f = funcionarios[i];
                if(!f.matricula) continue;
                try { await db.collection('funcionarios').doc(String(f.matricula)).set(f); } catch(e){ console.error('Erro ao salvar funcionario no Firestore', f, e); }
              }
              console.log('FuncionÃ¡rios sincronizados com Firestore');
            }
            // Atualizar dropdowns da RAS
            carregarColaboradoresRAS();
            carregarEmpresasColaborador();
          } catch(e) {
            console.error('Erro ao salvar funcionÃ¡rios:', e);
          }
        }

        // Controle de alteraÃ§Ãµes pendentes (FuncionÃ¡rios)
        var pendingOpsFuncionarios = [];
        function showFuncionariosSaveBar() {
          var bar = document.getElementById('funcionarios-save-bar');
          if (bar) bar.style.display = 'flex';
        }
        function hideFuncionariosSaveBar() {
          var bar = document.getElementById('funcionarios-save-bar');
          if (bar) bar.style.display = 'none';
        }
        async function salvarAlteracoesFuncionarios() {
          try {
            for (const op of pendingOpsFuncionarios) {
              const targetId = op.id || op.key;
              if (op.type === 'edit') {
                const resp = await fetch(`${API_BASE_URL}/api/funcionarios/${targetId}`, {
                  method: 'PUT',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify(op.data)
                });
                if (!resp.ok) throw new Error('Falha ao salvar ediÃ§Ã£o de funcionÃ¡rio');
              } else if (op.type === 'delete') {
                const resp = await fetch(`${API_BASE_URL}/api/funcionarios/${targetId}`, { method: 'DELETE' });
                if (!resp.ok) throw new Error('Falha ao excluir funcionÃ¡rio no servidor');
              }
            }
            pendingOpsFuncionarios = [];
            hideFuncionariosSaveBar();
            exibirFuncionarios();
            alert('AlteraÃ§Ãµes de colaboradores salvas no servidor.');
          } catch (err) {
            console.error('Erro ao salvar alteraÃ§Ãµes de funcionÃ¡rios:', err);
            alert('Erro ao salvar alteraÃ§Ãµes de funcionÃ¡rios. Tente novamente.');
          }
        }
        function descartarAlteracoesFuncionarios() {
          pendingOpsFuncionarios = [];
          hideFuncionariosSaveBar();
          // Recarregar do servidor se disponÃ­vel
          if (typeof carregarFuncionariosDoServidor === 'function') {
            carregarFuncionariosDoServidor();
          }
          else {
            window.location.reload();
        }
      }
        // Ao carregar a pÃ¡gina, tentar inicializar Firebase automaticamente se existir configuraÃ§Ã£o global
        window.addEventListener('load', function(){
          // Esconder loading screen apÃ³s 1 segundo
          setTimeout(function() {
            var loadingScreen = document.getElementById('loading-screen');
            if (loadingScreen) {
              loadingScreen.classList.add('hidden');
              setTimeout(function() {
                loadingScreen.style.display = 'none';
              }, 500);
            }
          }, 1000);
        });
          // Carregar funcionÃ¡rios na RAS (Etapa 6 - Confirmar PresenÃ§a) - Escopo Global
          window.carregarFuncionarios = function() {
            var container = document.getElementById('lista-funcionarios');
            
            if (funcionarios.length === 0) {
              container.innerHTML = '<div style="padding:40px 16px;text-align:center;color:#9ca3af;font-style:italic">Nenhum funcionÃ¡rio cadastrado.<br>Cadastre funcionÃ¡rios na seÃ§Ã£o "FuncionÃ¡rios" primeiro.</div>';
              return;
            }
            
            var html = '';
            funcionarios.forEach(function(func) {
              html += '<div style="padding:12px 16px;border-bottom:1px solid #f3f4f6;display:grid;grid-template-columns:60px 120px 1fr 1fr 1fr;gap:16px;align-items:center">';
              html += '<input type="checkbox" id="func-' + func.matricula + '" style="width:18px;height:18px;cursor:pointer" onchange="atualizarContadorPresentes()">';
              html += '<div style="color:#374151;font-weight:500">' + func.matricula + '</div>';
              html += '<div style="color:#374151">' + func.nome + '</div>';
              html += '<div style="color:#6b7280">' + func.empresa + '</div>';
              html += '<div style="color:#6b7280">' + func.funcao + '</div>';
              html += '</div>';
            });
            
            container.innerHTML = html;
            
            // Resetar contador de presentes
            document.getElementById('total-presentes').textContent = '0';
          }

          // Exibir lista de funcionÃ¡rios - Escopo Global  
          window.exibirFuncionarios = function() {
            var container = document.getElementById('funcionarios-lista');
            var total = document.getElementById('total-funcionarios');
            
            // ForÃ§ar recarga do localStorage antes de exibir
            if(localStorage.getItem('funcionarios')){
              try {
                funcionarios = JSON.parse(localStorage.getItem('funcionarios')) || [];
              } catch(e){ funcionarios = []; }
            }
            
            console.log('EXIBIR: Total de funcionÃ¡rios:', funcionarios.length);
            
            if (funcionarios.length === 0) {
              container.innerHTML = '<div style="padding:20px;text-align:center;color:#6b7280">Nenhum funcionÃ¡rio cadastrado</div>';
              total.textContent = '0';
              return;
            }
            
            var html = '';
            funcionarios.forEach(function(func) {
              html += '<div style="padding:12px 16px;border-bottom:1px solid #f3f4f6;display:grid;grid-template-columns:120px 2fr 1.5fr 1.5fr 120px 1.5fr 100px;gap:16px;align-items:center">';
              html += '<div style="color:#374151;font-weight:500">' + func.matricula + '</div>';
              html += '<div style="color:#374151">' + func.nome + '</div>';
              html += '<div style="color:#6b7280">' + func.funcao + '</div>';
              html += '<div style="color:#6b7280">' + (func.setor || 'NÃ£o informado') + '</div>';
              html += '<div style="color:#6b7280">' + formatarDataBR(func.admissao) + '</div>';
              html += '<div style="color:#6b7280">' + func.empresa + '</div>';
              html += '<div>';
              html += '<button onclick="editarFuncionario(\'' + func.matricula + '\')" style="background:#f59e0b;color:#fff;border:none;border-radius:4px;padding:4px 8px;font-size:0.8rem;cursor:pointer;margin-right:4px"></button>';
              html += '<button onclick="excluirFuncionario(\'' + func.matricula + '\')" style="background:#ef4444;color:#fff;border:none;border-radius:4px;padding:4px 8px;font-size:0.8rem;cursor:pointer"></button>';
              html += '</div>';
              html += '</div>';
            });
            
            container.innerHTML = html;
            total.textContent = funcionarios.length;
          }
          
          // Exibir lista de funcionÃ¡rios
          function exibirFuncionarios() {
            var container = document.getElementById('funcionarios-lista');
            var total = document.getElementById('total-funcionarios');
            
            // Verificar se os elementos existem
            if (!container || !total) {
              console.error('Elementos nÃ£o encontrados:', {container: !!container, total: !!total});
              return;
            }
            
            // Sempre recarregar do localStorage
            try {
              funcionarios = JSON.parse(localStorage.getItem('funcionarios')) || [];
            } catch(e) { 
              console.error('Erro ao carregar funcionÃ¡rios:', e);
              funcionarios = []; 
            }
            
            console.log('EXIBIR: Total de funcionÃ¡rios:', funcionarios.length, funcionarios);
            
            if (funcionarios.length === 0) {
              container.innerHTML = '<div style="padding:20px;text-align:center;color:#6b7280">Nenhum colaborador cadastrado</div>';
              total.textContent = '0';
              return;
            }
            
            var html = '';
            console.log('Iniciando geraÃ§Ã£o do HTML para', funcionarios.length, 'funcionÃ¡rios');
            
            funcionarios.forEach(function(func, index) {
              console.log('Processando funcionÃ¡rio', index + 1, ':', func);
              
              try {
                html += '<div style="padding:12px 16px;border-bottom:1px solid #f3f4f6;display:grid;grid-template-columns:120px 2fr 1.5fr 1.5fr 120px 1.5fr 100px;gap:16px;align-items:center">';
                html += '<div style="color:#374151;font-weight:500">' + (func.matricula || '') + '</div>';
                html += '<div style="color:#374151">' + (func.nome || '') + '</div>';
                html += '<div style="color:#6b7280">' + (func.funcao || '') + '</div>';
                html += '<div style="color:#6b7280">' + (func.setor || 'NÃ£o informado') + '</div>';
                html += '<div style="color:#6b7280">' + formatarDataBR(func.admissao) + '</div>';
                html += '<div style="color:#6b7280">' + (func.empresa || '') + '</div>';
                html += '<div>';
                html += '<button onclick="editarFuncionario(\'' + func.matricula + '\')" style="background:#f59e0b;color:#fff;border:none;border-radius:4px;padding:4px 8px;font-size:0.8rem;cursor:pointer;margin-right:4px"></button>';
                html += '<button onclick="excluirFuncionario(\'' + func.matricula + '\')" style="background:#ef4444;color:#fff;border:none;border-radius:4px;padding:4px 8px;font-size:0.8rem;cursor:pointer"></button>';
                html += '</div>';
                html += '</div>';
              } catch(e) {
                console.error('Erro ao processar funcionÃ¡rio:', func, e);
              }
            });
            
            console.log('HTML gerado:', html.length, 'caracteres');
            console.log('Definindo innerHTML no container:', container);
            
            container.innerHTML = html;
            total.textContent = funcionarios.length;
            
            console.log('ExibiÃ§Ã£o concluÃ­da. Container innerHTML length:', container.innerHTML.length);
          }
          
        // Excluir colaborador - Escopo Global
        window.excluirFuncionario = function(matricula) {
          console.log('Excluindo colaborador:', matricula);
          if (confirm('Tem certeza que deseja excluir este colaborador?')) {
            var alvo = funcionarios.find(function(f) { return f.matricula === matricula; });
            funcionarios = funcionarios.filter(function(f) { return f.matricula !== matricula; });
            pendingOpsFuncionarios.push({ type: 'delete', key: matricula, id: alvo && alvo.id });
            showFuncionariosSaveBar();
            salvarFuncionarios();
            exibirFuncionarios();
            // Atualizar lista da RAS Etapa 6 se estiver visÃ­vel
            if (document.getElementById('ras-etapa-6').style.display === 'block') {
              carregarFuncionariosRASEtapa6();
            }
            alert('ExclusÃ£o marcada. Clique em \"Salvar alteraÃ§Ãµes\" para enviar ao servidor.');
          }
        }          // Editar colaborador - Escopo Global
          window.editarFuncionario = function(matricula) {
            console.log('Editando colaborador:', matricula);
            var funcionario = funcionarios.find(function(f) { return f.matricula === matricula; });
            console.log('Colaborador encontrado:', funcionario);
            if (funcionario) {
              // Preencher formulÃ¡rio com dados existentes
              document.getElementById('func-matricula').value = funcionario.matricula;
              document.getElementById('func-nome').value = funcionario.nome;
              document.getElementById('func-funcao').value = funcionario.funcao;
              document.getElementById('func-setor').value = funcionario.setor || '';
              document.getElementById('func-admissao').value = funcionario.admissao;
              document.getElementById('func-empresa').value = funcionario.empresa;
              
              // Marcar como ediÃ§Ã£o
              document.getElementById('modal-funcionario').setAttribute('data-editando', matricula);
              document.getElementById('modal-funcionario').style.display = 'flex';
              
              // Alterar tÃ­tulo do modal
              document.querySelector('#modal-funcionario h2').textContent = 'Editar Colaborador';
            }
          }
          
          // Formatar data para exibiÃ§Ã£o brasileira
          function formatarDataBR(data) {
            if (!data) return '-';
            var partes = data.split('-');
            return partes[2] + '/' + partes[1] + '/' + partes[0];
          }
          
          // Abrir modal novo colaborador
          document.getElementById('btn-novo-funcionario').addEventListener('click', function() {
            var modal = document.getElementById('modal-funcionario');
            modal.style.display = 'flex';
            modal.removeAttribute('data-editando');
            document.getElementById('form-funcionario').reset();
            document.querySelector('#modal-funcionario h2').textContent = 'Novo Colaborador';
            // Carregar empresas quando abrir modal de novo colaborador
            carregarEmpresasColaborador();
          });
          
          // Fechar modal
          document.getElementById('fechar-modal').addEventListener('click', function() {
            var modal = document.getElementById('modal-funcionario');
            modal.style.display = 'none';
            modal.removeAttribute('data-editando');
            document.querySelector('#modal-funcionario h2').textContent = 'Novo Colaborador';
          });
          
          document.getElementById('cancelar-funcionario').addEventListener('click', function() {
            var modal = document.getElementById('modal-funcionario');
            modal.style.display = 'none';
            modal.removeAttribute('data-editando');
            document.querySelector('#modal-funcionario h2').textContent = 'Novo Colaborador';
          });
          
        // Cadastrar/Editar colaborador
        document.getElementById('form-funcionario').addEventListener('submit', async function(e) {
          e.preventDefault();
          
          var matricula = document.getElementById('func-matricula').value;
          var nome = document.getElementById('func-nome').value;
          var funcao = document.getElementById('func-funcao').value;
          var setor = document.getElementById('func-setor').value;
          var admissao = document.getElementById('func-admissao').value;
          var empresa = document.getElementById('func-empresa').value;
          
          var modal = document.getElementById('modal-funcionario');
          var editando = modal.getAttribute('data-editando');
          
          var funcionarioData = {
            matricula: matricula,
            nome: nome,
            funcao: funcao,
            setor: setor,
            admissao: admissao,
            empresa: empresa
          };
          
          try {
            if (editando) {
              // Editar localmente e marcar como pendente (preserva id)
              var index = funcionarios.findIndex(function(f) { return f.matricula === editando; });
              if (index !== -1) {
                if (funcionarios[index].id) funcionarioData.id = funcionarios[index].id;
                funcionarios[index] = funcionarioData;
                pendingOpsFuncionarios.push({ type: 'edit', key: editando, id: funcionarioData.id, data: funcionarioData });
                showFuncionariosSaveBar();
              }
              alert('Colaborador editado. Clique em "Salvar alteraÃ§Ãµes" para enviar ao servidor.');
              modal.removeAttribute('data-editando');
            } else {
              // Modo cadastro - verificar se matrÃ­cula jÃ¡ existe
              var existe = funcionarios.find(function(f) { return f.matricula === matricula; });
              if (existe) {
                alert('MatrÃ­cula jÃ¡ existe! Use uma matrÃ­cula diferente.');
                return;
              }
              
              // Enviar para o servidor
              const response = await fetch(`${API_BASE_URL}/api/funcionarios`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(funcionarioData)
              });
              
              if (!response.ok) throw new Error('Erro ao cadastrar funcionÃ¡rio');
              const resJson = await response.json();
              if (resJson && resJson.id) funcionarioData.id = resJson.id;
            
              // Adicionar colaborador
              funcionarios.push(funcionarioData);
              alert('Colaborador cadastrado com sucesso!');
            }
            
            salvarFuncionarios();
            exibirFuncionarios();
            document.getElementById('modal-funcionario').style.display = 'none';
          } catch (error) {
            console.error('Erro ao salvar funcionÃ¡rio:', error);
            alert('Erro ao salvar funcionÃ¡rio no servidor. Tente novamente.');
          }
        });
          
          // VariÃ¡veis globais para importaÃ§Ã£o
          var dadosPreview = [];
          
          // Importar planilha - abrir modal
          document.getElementById('btn-importar-planilha').addEventListener('click', function() {
            document.getElementById('modal-importar').style.display = 'flex';
            resetarModalImportacao();
          });
          
          // Limpar todos os dados de colaboradores
          document.getElementById('btn-limpar-dados').addEventListener('click', function() {
            if (confirm(' ï¸ ATENÃ‡ÃƒO!\n\nTem certeza que deseja excluir TODOS os colaboradores cadastrados?\n\nEsta aÃ§Ã£o nÃ£o pode ser desfeita e removerÃ¡:\n Todos os colaboradores importados\n Todos os colaboradores cadastrados manualmente\n Dados da planilha Excel\n\nDeseja continuar?')) {
              // Limpar array de funcionÃ¡rios
              funcionarios = [];
              
              // Remover do localStorage
              localStorage.removeItem('funcionarios');
              
              // Atualizar exibiÃ§Ã£o
              exibirFuncionarios();
              
              // Mensagem de confirmaÃ§Ã£o
              alert(' Todos os dados de colaboradores foram removidos com sucesso!\n\nO sistema foi resetado para o estado inicial.');
            }
          });
          
          // Fechar modal de importaÃ§Ã£o
          function fecharModalImportar() {
            document.getElementById('modal-importar').style.display = 'none';
            resetarModalImportacao();
          }
          
          // Resetar modal de importaÃ§Ã£o
          function resetarModalImportacao() {
            document.getElementById('input-planilha').value = '';
            document.getElementById('preview-planilha').style.display = 'none';
            document.getElementById('status-importacao').style.display = 'none';
            document.getElementById('btn-confirmar-importacao').disabled = true;
            document.getElementById('btn-confirmar-importacao').style.opacity = '0.5';
            dadosPreview = [];
          }
          
          // Upload de planilha
          document.getElementById('input-planilha').addEventListener('change', function(e) {
            var file = e.target.files[0];
            if (!file) return;
            
            // ValidaÃ§Ãµes
            if (file.size > 5 * 1024 * 1024) { // 5MB
              mostrarStatus('Arquivo muito grande! MÃ¡ximo permitido: 5MB', 'erro');
              return;
            }
            
            var validTypes = ['application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', 'application/vnd.ms-excel'];
            if (!validTypes.includes(file.type)) {
              mostrarStatus('Formato nÃ£o suportado! Use apenas arquivos .xlsx ou .xls', 'erro');
              return;
            }
            
            mostrarStatus('Processando arquivo...', 'carregando');
            processarPlanilha(file);
          });
          
          // Drag and drop
          var uploadArea = document.getElementById('upload-area-planilha');
          uploadArea.addEventListener('dragover', function(e) {
            e.preventDefault();
            this.style.borderColor = '#10b981';
            this.style.background = '#ecfdf5';
          });
          
          uploadArea.addEventListener('dragleave', function(e) {
            e.preventDefault();
            this.style.borderColor = '#d1d5db';
            this.style.background = '#fafafa';
          });
          
          uploadArea.addEventListener('drop', function(e) {
            e.preventDefault();
            this.style.borderColor = '#d1d5db';
            this.style.background = '#fafafa';
            
            var file = e.dataTransfer.files[0];
            if (file) {
              document.getElementById('input-planilha').files = e.dataTransfer.files;
              document.getElementById('input-planilha').dispatchEvent(new Event('change'));
            }
          });
          
          // Processar planilha Excel (real)
          function processarPlanilha(file) {
            mostrarStatus('Lendo arquivo...', 'carregando');
            
            var reader = new FileReader();
            reader.onload = function(e) {
              try {
                mostrarStatus('Processando dados...', 'carregando');
                
                var data = new Uint8Array(e.target.result);
                
                // Usar SheetJS para ler o arquivo Excel
                var workbook = XLSX.read(data, {type: 'array'});
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];
                
                // Converter para array de arrays
                var jsonData = XLSX.utils.sheet_to_json(worksheet, {header: 1, defval: ''});
                
                console.log('Dados brutos do Excel:', jsonData);
                
                // Filtrar linhas vazias
                var dadosLimpos = jsonData.filter(function(linha) {
                  return linha.length > 0 && linha.some(function(celula) {
                    return String(celula).trim() !== '';
                  });
                });
                
                console.log('Dados apÃ³s filtro:', dadosLimpos);
                
                if (dadosLimpos.length === 0) {
                  mostrarStatus('Arquivo vazio ou invÃ¡lido!', 'erro');
                  return;
                }
                
                if (dadosLimpos.length === 1) {
                  mostrarStatus('Planilha contÃ©m apenas cabeÃ§alho. Adicione dados nas linhas seguintes.', 'erro');
                  return;
                }
                
                // Verificar se tem pelo menos 5 colunas bÃ¡sicas (flexÃ­vel para suportar com ou sem setor)
                var numColunas = dadosLimpos[0].length;
                if (numColunas < 5) {
                  mostrarStatus('Formato invÃ¡lido! A planilha deve ter pelo menos 5 colunas: MatrÃ­cula, Nome, FunÃ§Ã£o, Data AdmissÃ£o, Empresa', 'erro');
                  return;
                }
                
                // Se tem 6 colunas, incluir setor
                var comSetor = numColunas >= 6;
                console.log('Planilha com setor:', comSetor, '- Colunas:', numColunas);
                
                dadosPreview = dadosLimpos;
                exibirPreview(dadosLimpos);
                
                var numFuncionarios = dadosLimpos.length - 1;
                var mensagem = 'Arquivo processado com sucesso! ' + numFuncionarios + ' funcionÃ¡rio' + (numFuncionarios > 1 ? 's' : '') + ' encontrado' + (numFuncionarios > 1 ? 's' : '') + '.';
                if (comSetor) {
                  mensagem += ' (com campo Setor)';
                } else {
                  mensagem += ' (sem campo Setor - serÃ¡ preenchido como "NÃ£o informado")';
                }
                
                mostrarStatus(mensagem, 'sucesso');
                
                document.getElementById('btn-confirmar-importacao').disabled = false;
                document.getElementById('btn-confirmar-importacao').style.opacity = '1';
                
              } catch (error) {
                console.error('Erro ao processar Excel:', error);
                mostrarStatus('Erro ao processar arquivo Excel: ' + error.message, 'erro');
              }
            };
            
            reader.onerror = function() {
              mostrarStatus('Erro ao ler o arquivo. Tente novamente.', 'erro');
            };
            
            reader.readAsArrayBuffer(file);
          }
          
          // Exibir preview dos dados
          function exibirPreview(dados) {
            var tabela = document.getElementById('tabela-preview');
            var html = '';
            
            dados.forEach(function(linha, index) {
              var isHeader = index === 0;
              html += '<tr style="' + (isHeader ? 'background:#f1f5f9;font-weight:600;' : '') + '">';
              linha.forEach(function(celula) {
                html += '<td style="padding:8px;border:1px solid #e5e7eb;font-size:0.8rem">' + celula + '</td>';
              });
              html += '</tr>';
            });
            
            tabela.innerHTML = html;
            document.getElementById('preview-planilha').style.display = 'block';
          }
          
          // Mostrar status da importaÃ§Ã£o
          function mostrarStatus(mensagem, tipo) {
            var statusDiv = document.getElementById('status-importacao');
            var cores = {
              'sucesso': { bg: '#f0fdf4', border: '#bbf7d0', text: '#166534', icon: '✓' },
              'erro': { bg: '#fef2f2', border: '#fecaca', text: '#dc2626', icon: '✕' },
              'carregando': { bg: '#eff6ff', border: '#bfdbfe', text: '#1d4ed8', icon: '⏳' }
            };
            
            var cor = cores[tipo] || cores['carregando'];
            
            statusDiv.innerHTML = '<div style="background:' + cor.bg + ';border:1px solid ' + cor.border + ';border-radius:6px;padding:12px;color:' + cor.text + '">' +
              '<span style="margin-right:8px">' + cor.icon + '</span>' + mensagem + '</div>';
            statusDiv.style.display = 'block';
          }
          
          // Confirmar importaÃ§Ã£o
          function confirmarImportacao() {
            if (dadosPreview.length <= 1) {
              mostrarStatus('Nenhum dado para importar!', 'erro');
              return;
            }
            
            mostrarStatus('Importando funcionÃ¡rios...', 'carregando');
            
            // Processar dados (pular cabeÃ§alho)
            var novosfuncionarios = [];
            var comSetor = dadosPreview[0].length >= 6; // Verifica se tem campo setor
            
            for (var i = 1; i < dadosPreview.length; i++) {
              var linha = dadosPreview[i];
              
              // Suporta planilhas com 5 colunas (sem setor) ou 6 colunas (com setor)
              if (linha.length >= 5) {
                var funcionario;
                
                if (comSetor && linha.length >= 6) {
                  // Planilha com setor (6 colunas)
                  funcionario = {
                    matricula: String(linha[0] || '').trim(),
                    nome: String(linha[1] || '').trim(),
                    funcao: String(linha[2] || '').trim(),
                    setor: String(linha[3] || '').trim(),
                    admissao: String(linha[4] || '').trim(),
                    empresa: String(linha[5] || '').trim()
                  };
                } else {
                  // Planilha sem setor (5 colunas)
                  funcionario = {
                    matricula: String(linha[0] || '').trim(),
                    nome: String(linha[1] || '').trim(),
                    funcao: String(linha[2] || '').trim(),
                    setor: 'NÃ£o informado',
                    admissao: String(linha[3] || '').trim(),
                    empresa: String(linha[4] || '').trim()
                  };
                }
                
                // Verificar se matrÃ­cula jÃ¡ existe e se dados estÃ£o vÃ¡lidos
                if (funcionario.matricula && funcionario.nome) {
                  var existe = funcionarios.find(function(f) { return f.matricula === funcionario.matricula; });
                  if (!existe) {
                    novosfuncionarios.push(funcionario);
                  }
                }
              }
            }
            
            // Adicionar ao array de funcionÃ¡rios
            console.log('IMPORTAÃ‡ÃƒO: Antes =', funcionarios.length, '| Novos =', novosfuncionarios.length);
            
            funcionarios = funcionarios.concat(novosfuncionarios);
            salvarFuncionarios();
            
            console.log('IMPORTAÃ‡ÃƒO: ApÃ³s salvar =', funcionarios.length);
            console.log('VERIFICAÃ‡ÃƒO localStorage:', JSON.parse(localStorage.getItem('funcionarios') || '[]').length);
            
            exibirFuncionarios();
            
            setTimeout(function() {
              mostrarStatus('ImportaÃ§Ã£o concluÃ­da! ' + novosfuncionarios.length + ' funcionÃ¡rios adicionados.', 'sucesso');
              
              setTimeout(function() {
                fecharModalImportar();
              }, 2000);
            }, 1000);
          }
          
          // === SISTEMA DE GERENCIAMENTO DE EMPRESAS ===
          
          // Array global para armazenar empresas
          var empresas = JSON.parse(localStorage.getItem('empresas')) || [];
          
          // Carregar empresas no dropdown da RAS
          function carregarEmpresasRAS() {
            var selectEmpresa = document.getElementById('ras-empresa');
            if (!selectEmpresa) return;
            
            // Limpar opÃ§Ãµes existentes (manter primeira opÃ§Ã£o vazia)
            selectEmpresa.innerHTML = '<option value="">Selecione a empresa</option>';
            
            // Recarregar empresas do localStorage
            var empresasCadastradas = JSON.parse(localStorage.getItem('empresas')) || [];
            
            if (empresasCadastradas.length === 0) {
              // Se nÃ£o hÃ¡ empresas cadastradas, adicionar opÃ§Ã£o informativa
              var optionInfo = document.createElement('option');
              optionInfo.value = '';
              optionInfo.textContent = 'Nenhuma empresa cadastrada - Cadastre uma empresa primeiro';
              optionInfo.disabled = true;
              selectEmpresa.appendChild(optionInfo);
              return;
            }
            
            // Ordenar empresas alfabeticamente por nome
            empresasCadastradas.sort(function(a, b) {
              return (a.nome || '').localeCompare(b.nome || '');
            });
            
          // Adicionar cada empresa ao dropdown
          empresasCadastradas.forEach(function(empresa) {
            var option = document.createElement('option');
            option.value = empresa.nome;
            // Mostrar apenas o nome da empresa
            option.textContent = empresa.nome;
            selectEmpresa.appendChild(option);
          });            console.log('Empresas carregadas na RAS:', empresasCadastradas.length);
          }
          
          // Carregar empresas no dropdown de colaboradores
          function carregarEmpresasColaborador() {
            var selectEmpresa = document.getElementById('func-empresa');
            if (!selectEmpresa) return;
            
            // Limpar opÃ§Ãµes existentes (manter primeira opÃ§Ã£o vazia)
            selectEmpresa.innerHTML = '<option value="">Selecione a empresa</option>';
            
            // Recarregar empresas do localStorage
            var empresasCadastradas = JSON.parse(localStorage.getItem('empresas')) || [];
            
            if (empresasCadastradas.length === 0) {
              // Se nÃ£o hÃ¡ empresas cadastradas, adicionar opÃ§Ã£o informativa
              var optionInfo = document.createElement('option');
              optionInfo.value = '';
              optionInfo.textContent = 'Nenhuma empresa cadastrada - Cadastre uma empresa primeiro';
              optionInfo.disabled = true;
              selectEmpresa.appendChild(optionInfo);
              return;
            }
            
            // Ordenar empresas alfabeticamente por nome
            empresasCadastradas.sort(function(a, b) {
              return (a.nome || '').localeCompare(b.nome || '');
            });
            
            // Adicionar cada empresa ao dropdown
            empresasCadastradas.forEach(function(empresa) {
              var option = document.createElement('option');
              option.value = empresa.nome;
              option.textContent = empresa.nome;
              selectEmpresa.appendChild(option);
            });
            
            console.log('Empresas carregadas no colaborador:', empresasCadastradas.length);
          }
          
          // Participantes RAS armazenados localmente durante criaÃ§Ã£o
          var participantesRAS = [];

          // Carregar colaboradores apenas no dropdown compacto da Etapa 2 (nome)
          function carregarColaboradoresRAS() {
            var selectNome = document.getElementById('ras-participante-nome');
            var placeholder = 'Selecione o nome';

            // Recarregar colaboradores do localStorage
            var colaboradoresCadastrados = JSON.parse(localStorage.getItem('funcionarios')) || [];

            if (!selectNome) return;
            selectNome.innerHTML = '<option value="">' + placeholder + '</option>';

            if (colaboradoresCadastrados.length === 0) {
              var optionInfo = document.createElement('option');
              optionInfo.value = '';
              optionInfo.textContent = 'Nenhum colaborador cadastrado';
              optionInfo.disabled = true;
              selectNome.appendChild(optionInfo);
              return;
            }

            // Ordenar colaboradores alfabeticamente por nome
            var colaboradoresOrdenados = colaboradoresCadastrados.slice().sort(function(a, b) {
              return (a.nome || '').localeCompare(b.nome || '');
            });

            colaboradoresOrdenados.forEach(function(colaborador) {
              var option = document.createElement('option');
              option.value = colaborador.nome;
              var partesNome = (colaborador.nome || '').trim().split(' ');
              var primeiroNome = partesNome[0] || '';
              var sobrenome = partesNome.length > 1 ? partesNome[partesNome.length - 1] : '';
              var nomeExibicao = sobrenome ? primeiroNome + ' ' + sobrenome : primeiroNome;
              option.textContent = nomeExibicao;
              selectNome.appendChild(option);
            });

            console.log('Colaboradores carregados na RAS Etapa 2 (nome):', colaboradoresCadastrados.length);
          }

          // Atualiza os hidden inputs de lideranÃ§a com base no array participantesRAS
          function atualizarHiddenPorSetor() {
            // Limpar
            ['ras-gerente','ras-engenheiro','ras-supervisor','ras-encarregado','ras-tecnico-seguranca'].forEach(function(id){
              var el = document.getElementById(id);
              if (el) el.value = '';
            });

            // Preencher com o primeiro participante encontrado para cada setor
            participantesRAS.forEach(function(p) {
              var setor = p.setor;
              var nome = p.nome;
              if (!setor || !nome) return;

              if (setor === 'Gerente') document.getElementById('ras-gerente').value = nome;
              if (setor === 'Engenheiro') document.getElementById('ras-engenheiro').value = nome;
              if (setor === 'Supervisor') document.getElementById('ras-supervisor').value = nome;
              if (setor === 'Encarregado') document.getElementById('ras-encarregado').value = nome;
              if (setor === 'TÃ©cnico de Segurança') document.getElementById('ras-tecnico-seguranca').value = nome;
              // HSE or other setores are not assigned to hidden-role fields
            });

            // Trigger validation after update (Etapa 2 and 5)
            validarRASEtapa2();
            if (typeof validarRASEtapa5 === 'function') validarRASEtapa5();
          }

          // Renderiza a lista de participantes adicionados na Etapa 2
          function renderListaParticipantesRAS() {
            var container = document.getElementById('ras-participantes-list');
            if (!container) return;
            container.innerHTML = '';

            if (participantesRAS.length === 0) {
              container.innerHTML = '<div style="color:#6b7280;text-align:center;padding:12px;border-radius:6px;background:#f8fafc;border:1px dashed #dbeafe">Nenhum participante adicionado</div>';
              return;
            }

            participantesRAS.forEach(function(p, idx){
              var item = document.createElement('div');
              item.style.cssText = 'display:flex;align-items:center;gap:12px;padding:8px;border-radius:8px;border:1px solid #e6edf3;background:#fff;justify-content:space-between';
              var left = document.createElement('div');
              left.style.cssText = 'display:flex;align-items:center;gap:12px;';
              left.innerHTML = '<div style="width:8px;height:8px;border-radius:50%;background:#111827;margin-right:6px"></div>' + '<div><strong style="font-size:0.95rem">' + p.nome + '</strong><div style="font-size:0.85rem;color:#6b7280">' + p.setor + '</div></div>';
              var btn = document.createElement('button');
              btn.type = 'button';
              btn.title = 'Remover';
              btn.style.cssText = 'background:#ef4444;color:#fff;border:none;border-radius:6px;padding:6px 8px;cursor:pointer';
              btn.textContent = 'X';
              btn.addEventListener('click', function(){
                participantesRAS.splice(idx,1);
                renderListaParticipantesRAS();
                atualizarHiddenPorSetor();
              });

              item.appendChild(left);
              item.appendChild(btn);
              container.appendChild(item);
            });
          }

          // Limpar participantes (ao comeÃ§ar uma nova RAS)
          function limparParticipantesRAS() {
            participantesRAS = [];
            renderListaParticipantesRAS();
            // Atualizar hidden inputs com participantes e validar etapa 2
            atualizarHiddenPorSetor();
            atualizarHiddenPorSetor();
          }

          // FunÃ§Ã£o para adicionar participante atravÃ©s da UI compacta
          function adicionarParticipanteRAS() {
            var nome = document.getElementById('ras-participante-nome').value;
            var setor = document.getElementById('ras-participante-setor').value;

            if (!nome) { alert('Por favor selecione um nome.'); return; }
            if (!setor) { alert('Por favor selecione um setor.'); return; }

            // Evitar duplicados exatos (mesmo nome + setor)
            var existe = participantesRAS.some(function(p){ return p.nome === nome && p.setor === setor; });
            if (existe) { alert('Participante jÃ¡ adicionado com este setor.'); return; }

            participantesRAS.push({ nome: nome, setor: setor });

            // ApÃ³s adicionar, limpar selects
            document.getElementById('ras-participante-nome').value = '';
            document.getElementById('ras-participante-setor').value = '';

            renderListaParticipantesRAS();
            atualizarHiddenPorSetor();
          }
          
          // Carregar colaboradores nos dropdowns da RAS Etapa 3
          function carregarColaboradoresRASEtapa3() {
            var selectsEtapa3 = [
              'ras-anjo-semana',
              'ras-lider-ras',
              'ras-lider-cpt'
            ];
            
            var placeholders = {
              'ras-anjo-semana': 'Selecione o anjo da semana',
              'ras-lider-ras': 'Selecione o lÃ­der da ras',
              'ras-lider-cpt': 'Selecione o lÃ­der cpt'
            };
            
            // Recarregar colaboradores do localStorage
            var colaboradoresCadastrados = JSON.parse(localStorage.getItem('funcionarios')) || [];
            
            selectsEtapa3.forEach(function(selectId) {
              var selectElement = document.getElementById(selectId);
              if (!selectElement) return;
              
              // Limpar opÃ§Ãµes existentes
              selectElement.innerHTML = '<option value="">' + placeholders[selectId] + '</option>';
              
              if (colaboradoresCadastrados.length === 0) {
                // Se nÃ£o hÃ¡ colaboradores cadastrados
                var optionInfo = document.createElement('option');
                optionInfo.value = '';
                optionInfo.textContent = 'Nenhum colaborador cadastrado';
                optionInfo.disabled = true;
                selectElement.appendChild(optionInfo);
                return;
              }
              
              // Ordenar colaboradores alfabeticamente por nome
              var colaboradoresOrdenados = colaboradoresCadastrados.slice().sort(function(a, b) {
                return (a.nome || '').localeCompare(b.nome || '');
              });
              
              // Adicionar cada colaborador ao dropdown
              colaboradoresOrdenados.forEach(function(colaborador) {
                var option = document.createElement('option');
                option.value = colaborador.nome;
                // Extrair apenas primeiro nome e sobrenome
                var partesNome = (colaborador.nome || '').trim().split(' ');
                var primeiroNome = partesNome[0] || '';
                var sobrenome = partesNome.length > 1 ? partesNome[partesNome.length - 1] : '';
                var nomeCompleto = sobrenome ? primeiroNome + ' ' + sobrenome : primeiroNome;
                option.textContent = nomeCompleto;
                selectElement.appendChild(option);
              });
            });
            
            console.log('Colaboradores carregados na RAS Etapa 3:', colaboradoresCadastrados.length);
          }
          
          // Carregar lista de funcionÃ¡rios na RAS Etapa 6
          function carregarFuncionariosRASEtapa6() {
            var colaboradoresCadastrados = JSON.parse(localStorage.getItem('funcionarios')) || [];
            var listaContainer = document.getElementById('lista-funcionarios');
            var totalPresentesSpan = document.getElementById('total-presentes');
            
            if (!listaContainer) return;
            
            // Limpar lista existente
            listaContainer.innerHTML = '';
            
            if (colaboradoresCadastrados.length === 0) {
              listaContainer.innerHTML = '<div style="padding:24px;text-align:center;color:#6b7280">Nenhum colaborador cadastrado</div>';
              if (totalPresentesSpan) totalPresentesSpan.textContent = '0';
              return;
            }
            
            // Ordenar colaboradores por nome
            var colaboradoresOrdenados = colaboradoresCadastrados.slice().sort(function(a, b) {
              return (a.nome || '').localeCompare(b.nome || '');
            });
            
            // Criar linha para cada colaborador
            colaboradoresOrdenados.forEach(function(colaborador, index) {
              var linha = document.createElement('div');
              linha.className = 'funcionario-row';
              linha.style.cssText = 'padding:12px 16px;border-bottom:1px solid #e5e7eb;display:grid;grid-template-columns:60px 120px 1fr 1fr 1fr;gap:16px;align-items:center;background:#fff';
              
              // Remover border-bottom da Ãºltima linha
              if (index === colaboradoresOrdenados.length - 1) {
                linha.style.borderBottom = 'none';
              }
              
              linha.innerHTML = 
                '<div><input type="checkbox" id="presente-' + index + '" class="checkbox-presente" style="width:18px;height:18px;cursor:pointer"></div>' +
                '<div style="color:#374151;font-weight:500">' + (colaborador.matricula || '-') + '</div>' +
                '<div style="color:#374151;font-weight:500">' + (colaborador.nome || '-') + '</div>' +
                '<div style="color:#6b7280">' + (colaborador.empresa || '-') + '</div>' +
                '<div style="color:#6b7280">' + (colaborador.funcao || '-') + '</div>';
              
              listaContainer.appendChild(linha);
            });
            
            // Atualizar contador inicial
            atualizarContadorPresentes();
            
            // Adicionar event listeners para checkboxes
            var checkboxes = document.querySelectorAll('.checkbox-presente');
            checkboxes.forEach(function(checkbox) {
              checkbox.addEventListener('change', atualizarContadorPresentes);
            });
            
            console.log('FuncionÃ¡rios carregados na RAS Etapa 6:', colaboradoresOrdenados.length);
          }
          
          // Atualizar contador de presentes
          function atualizarContadorPresentes() {
            var checkboxes = document.querySelectorAll('.checkbox-presente:checked');
            var totalPresentesSpan = document.getElementById('total-presentes');
            if (totalPresentesSpan) {
              totalPresentesSpan.textContent = checkboxes.length;
            }
          }
          
          // Marcar/desmarcar todos os funcionÃ¡rios
          function toggleTodosFuncionarios() {
            var checkboxes = document.querySelectorAll('.checkbox-presente');
            var marcarTodos = document.getElementById('marcar-todos');
            var todosChecked = Array.from(checkboxes).every(function(cb) { return cb.checked; });
            
            checkboxes.forEach(function(checkbox) {
              checkbox.checked = !todosChecked;
            });
            
            // Atualizar texto do botÃ£o
            if (marcarTodos) {
              marcarTodos.textContent = todosChecked ? 'Marcar Todos' : 'Desmarcar Todos';
            }
            
            atualizarContadorPresentes();
          }
          
          // Carregar lista de RAS registradas
          function carregarListaRAS() {
            var rasRegistradas = JSON.parse(localStorage.getItem('ras-reunioes')) || [];
            var tbody = document.getElementById('ras-tbody');
            
            if (!tbody) return;
            
            if (rasRegistradas.length === 0) {
              tbody.innerHTML = '<tr><td colspan="7" style="padding:24px;text-align:center;color:#6b7280;">Nenhuma RAS registrada ainda</td></tr>';
              return;
            }
            
            tbody.innerHTML = '';
            
            rasRegistradas.forEach(function(ras, index) {
              var row = document.createElement('tr');
              row.style.borderBottom = '1px solid #e2e8f0';
              
              var statusClass = ras.status === 'ConcluÃ­da' ? 'background:#10b981;color:#fff' : 'background:#f59e0b;color:#fff';
              var tardcIcon = ras.tardc ? '✓' : '';
              
              row.innerHTML = 
                '<td style="padding:12px 16px;color:#2d3748;">' + (ras.data || '-') + '</td>' +
                '<td style="padding:12px 16px;color:#2d3748;">' + (ras.empresa || '-') + '</td>' +
                '<td style="padding:12px 16px;color:#2d3748;">' + (ras.efetivo || '0') + '</td>' +
                '<td style="padding:12px 16px;color:#2d3748;max-width:200px;overflow:hidden;text-overflow:ellipsis;">' + (ras.altoRisco || '-') + '</td>' +
                '<td style="padding:12px 16px;text-align:center;font-size:1.2rem;">' + tardcIcon + '</td>' +
                '<td style="padding:12px 16px;"><span style="padding:4px 8px;border-radius:4px;font-size:0.85rem;font-weight:600;' + statusClass + '">' + (ras.status || 'Em Andamento') + '</span></td>' +
                '<td style="padding:12px 16px;">' +
                  '<button onclick="visualizarRAS(' + index + ')" style="background:#3498db;color:#fff;border:none;border-radius:4px;padding:6px 12px;margin-right:4px;cursor:pointer;font-size:0.85rem;"> Ver</button>' +
                  '<button onclick="editarRAS(' + index + ')" style="background:#f39c12;color:#fff;border:none;border-radius:4px;padding:6px 12px;margin-right:4px;cursor:pointer;font-size:0.85rem;"> Editar</button>' +
                  '<button onclick="excluirRAS(' + index + ')" style="background:#e74c3c;color:#fff;border:none;border-radius:4px;padding:6px 12px;cursor:pointer;font-size:0.85rem;"></button>' +
                '</td>';
                
              tbody.appendChild(row);
            });
          }
          
          // Mostrar etapa especÃ­fica do RAS
          function mostrarEtapaRAS(etapa) {
            // Ocultar todas as etapas
            for (var i = 1; i <= 6; i++) {
              var etapaElement = document.getElementById('ras-etapa-' + i);
              if (etapaElement) {
                etapaElement.style.display = 'none';
              }
            }
            
            // Mostrar etapa solicitada
            var etapaAtual = document.getElementById('ras-etapa-' + etapa);
            if (etapaAtual) {
              etapaAtual.style.display = 'block';
            }
          }
          
          // Salvar RAS finalizada no localStorage
          function salvarRASFinalizada() {
            try {
              // Verificar se estamos editando uma RAS existente
              var isEdicao = typeof window.rasEditandoIndex !== 'undefined';
              var rasRegistradas = JSON.parse(localStorage.getItem('ras-reunioes')) || [];
              
              // Coletar dados de todas as etapas
              var dadosRAS = {
                id: isEdicao && rasRegistradas[window.rasEditandoIndex] ? rasRegistradas[window.rasEditandoIndex].id : Date.now(),
                dataRegistro: isEdicao && rasRegistradas[window.rasEditandoIndex] ? rasRegistradas[window.rasEditandoIndex].dataRegistro : new Date().toISOString(),
                dataEdicao: isEdicao ? new Date().toISOString() : undefined,
                status: 'ConcluÃ­da',
                // Etapa 1 - InformaÃ§Ãµes BÃ¡sicas
                empresa: document.getElementById('ras-empresa')?.value || '',
                data: document.getElementById('ras-data')?.value || '',
                inicio: document.getElementById('ras-inicio')?.value || '',
                termino: document.getElementById('ras-termino')?.value || '',
                efetivo: document.getElementById('ras-efetivo')?.value || '0',
                altoRisco: document.getElementById('ras-alto-risco')?.value || '',
                tardc: document.getElementById('ras-tardc')?.checked || false,
                compartilhar: document.getElementById('ras-compartilhar')?.value || '',
                // Etapa 2 - LideranÃ§a
                gerente: document.getElementById('ras-gerente')?.value || '',
                engenheiro: document.getElementById('ras-engenheiro')?.value || '',
                supervisor: document.getElementById('ras-supervisor')?.value || '',
                encarregado: document.getElementById('ras-encarregado')?.value || '',
                tecnicoSeguranca: document.getElementById('ras-tecnico-seguranca')?.value || '',
                // Etapa 3 - DesignaÃ§Ãµes
                anjoSemana: document.getElementById('ras-anjo-semana')?.value || '',
                liderRAS: document.getElementById('ras-lider-ras')?.value || '',
                liderCPT: document.getElementById('ras-lider-cpt')?.value || '',
                brigada: document.getElementById('ras-brigada')?.value || '',
                // Etapa 6 - Presentes (se houver)
                funcionariosPresentes: coletarFuncionariosPresentes(),
                // Etapa 6 - Ausentes (calc. a partir dos colaboradores cadastrados no momento)
                funcionariosAusentes: (function(){
                  try {
                    var presentes = coletarFuncionariosPresentes() || [];
                    var matriculasPresentes = presentes.map(function(p){ return (p.matricula || '').toString().trim(); }).filter(Boolean);
                    var todos = JSON.parse(localStorage.getItem('funcionarios')) || [];
                    var ausentes = [];
                    todos.forEach(function(f){
                      var m = (f.matricula || '').toString().trim();
                      // If matricula exists, compare by matricula, otherwise compare by name
                      var estaPresente = m ? (matriculasPresentes.indexOf(m) !== -1) : presentes.some(function(p){ return p.nome === f.nome; });
                      if (!estaPresente) {
                        ausentes.push({ matricula: f.matricula || '', nome: f.nome || '', empresa: f.empresa || '', funcao: f.funcao || '' });
                      }
                    });
                    return ausentes;
                  } catch(e) { return []; }
                })(),
                // Anexos - Fotos e Documentos
                fotos: typeof fotosCarregadas !== 'undefined' ? fotosCarregadas.slice() : [],
                documentos: typeof evidenciasCarregadas !== 'undefined' ? evidenciasCarregadas.slice() : []
              };
              
              if (isEdicao) {
                // Atualizar RAS existente
                rasRegistradas[window.rasEditandoIndex] = dadosRAS;
                // Limpar Ã­ndice de ediÃ§Ã£o
                delete window.rasEditandoIndex;
                console.log('RAS editada com sucesso:', dadosRAS);
              } else {
                // Adicionar nova RAS
                rasRegistradas.push(dadosRAS);
                console.log('RAS criada com sucesso:', dadosRAS);
              }
              
              // Salvar no localStorage
              localStorage.setItem('ras-reunioes', JSON.stringify(rasRegistradas));
              
              return true;
            } catch (error) {
              console.error('Erro ao salvar RAS:', error);
              return false;
            }
          }
          
          // Coletar funcionÃ¡rios presentes marcados
          function coletarFuncionariosPresentes() {
            var presentes = [];
            var checkboxes = document.querySelectorAll('.funcionario-row input[type="checkbox"]:checked');

            checkboxes.forEach(function(checkbox) {
              var linha = checkbox.closest('.funcionario-row');
              if (!linha) return;

              var colunas = Array.prototype.slice.call(linha.children || []);
              if (colunas.length < 5) return;

              presentes.push({
                matricula: (colunas[1].textContent || '').trim(),
                nome: (colunas[2].textContent || '').trim(),
                empresa: (colunas[3].textContent || '').trim(),
                funcao: (colunas[4].textContent || '').trim()
              });
            });

            return presentes;
          }
          
          // Visualizar RAS - Escopo Global
          window.visualizarRAS = function(index) {
            var rasRegistradas = JSON.parse(localStorage.getItem('ras-reunioes')) || [];
            var ras = rasRegistradas[index];
            
            if (!ras) {
              alert('RAS nÃ£o encontrada!');
              return;
            }
            
            // Criar modal de visualizaÃ§Ã£o com relatÃ³rio final completo
            var modal = document.createElement('div');
            modal.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:10000;display:flex;align-items:center;justify-content:center;padding:20px;box-sizing:border-box;';
            
            var conteudo = document.createElement('div');
            conteudo.style.cssText = 'background:#fff;border-radius:16px;max-width:900px;max-height:90vh;overflow-y:auto;box-shadow:0 8px 32px rgba(0,0,0,0.3);';
            
            // FormataÃ§Ã£o de dados
            var dataFormatada = ras.data ? new Date(ras.data + 'T00:00:00').toLocaleDateString('pt-BR') : '-';
            var funcionariosPresentes = ras.funcionariosPresentes || [];
            var totalPresentes = funcionariosPresentes.length;
            // Build absent list from stored data if available, otherwise compute from localStorage
            var funcionariosAusentes = ras.funcionariosAusentes || (function(){
              try {
                var todos = JSON.parse(localStorage.getItem('funcionarios')) || [];
                var matriculasPresentes = funcionariosPresentes.map(function(p){ return (p.matricula || '').toString().trim(); }).filter(Boolean);
                var aus = [];
                todos.forEach(function(f){
                  var m = (f.matricula || '').toString().trim();
                  var estaPresente = m ? (matriculasPresentes.indexOf(m) !== -1) : funcionariosPresentes.some(function(p){ return p.nome === f.nome; });
                  if (!estaPresente) aus.push({ matricula: f.matricula || '', nome: f.nome || '', empresa: f.empresa || '', funcao: f.funcao || '' });
                });
                return aus;
              } catch(e) { return []; }
            })();
            var totalAusentes = funcionariosAusentes.length;
            var efetivoTotal = parseInt(ras.efetivo) || 0;
            var totalAusentes = efetivoTotal > 0 ? Math.max(0, efetivoTotal - totalPresentes) : 0;
            
            // Gerar lista de funcionÃ¡rios presentes em formato de tabela
            var tabelaPresentes = '';
            if (funcionariosPresentes.length > 0) {
              tabelaPresentes = '<div style="background:#f8fafc;border:1px solid #e2e8f0;border-radius:8px;overflow:hidden;margin:16px 0;">' +
                '<div style="background:#374151;color:#fff;padding:12px;font-weight:600;display:flex;justify-content:space-between;align-items:center;">' +
                  '<div>FuncionÃ¡rios Presentes (' + totalPresentes + ')</div>' +
                  '<div style="font-weight:600;color:#fefefe;font-size:0.95rem">Ausentes: ' + totalAusentes + '</div>' +
                '</div>' +
                '<div style="max-height:200px;overflow-y:auto;">';
              
              funcionariosPresentes.forEach(function(funcionario, idx) {
                var bgColor = idx % 2 === 0 ? '#fff' : '#f9fafb';
                tabelaPresentes += 
                  '<div style="display:grid;grid-template-columns:100px 1fr 1fr 1fr;gap:12px;padding:10px;border-bottom:1px solid #e5e7eb;background:' + bgColor + ';align-items:center;">' +
                    '<div style="font-weight:500;color:#1f2937;">' + (funcionario.matricula || '-') + '</div>' +
                    '<div style="color:#374151;">' + (funcionario.nome || '-') + '</div>' +
                    '<div style="color:#6b7280;">' + (funcionario.empresa || '-') + '</div>' +
                    '<div style="color:#6b7280;">' + (funcionario.funcao || '-') + '</div>' +
                  '</div>';
              });
              
              tabelaPresentes += '</div></div>';

            // Build table for absent employees (if any)
            var tabelaAusentes = '';
            if (funcionariosAusentes.length > 0) {
              tabelaAusentes = '<div style="background:#fff;border:1px solid #fee2e2;border-radius:8px;overflow:hidden;margin:16px 0;">' +
                '<div style="background:#b91c1c;color:#fff;padding:12px;font-weight:600;display:flex;justify-content:space-between;align-items:center;">' +
                  '<div>FuncionÃ¡rios Ausentes (' + totalAusentes + ')</div>' +
                '</div>' +
                '<div style="max-height:200px;overflow-y:auto;">';

              funcionariosAusentes.forEach(function(funcionario, idx) {
                var bgColor = idx % 2 === 0 ? '#fff' : '#fff7f7';
                tabelaAusentes += '<div style="display:grid;grid-template-columns:100px 1fr 1fr 1fr;gap:12px;padding:10px;border-bottom:1px solid #fbeaea;background:' + bgColor + ';align-items:center;">' +
                  '<div style="font-weight:500;color:#1f2937;">' + (funcionario.matricula || '-') + '</div>' +
                  '<div style="color:#374151;">' + (funcionario.nome || '-') + '</div>' +
                  '<div style="color:#6b7280;">' + (funcionario.empresa || '-') + '</div>' +
                  '<div style="color:#6b7280;">' + (funcionario.funcao || '-') + '</div>' +
                '</div>';
              });

              tabelaAusentes += '</div></div>';
            }
            } else {
              tabelaPresentes = '<div style="background:#fef3c7;border:1px solid #f59e0b;border-radius:8px;padding:16px;margin:16px 0;text-align:center;color:#92400e;"> ï¸ Nenhum funcionÃ¡rio registrado como presente</div>';
            }
            
            conteudo.innerHTML = 
              '<div style="background:linear-gradient(135deg,#3b82f6 0%,#1d4ed8 100%);color:#fff;padding:24px;border-radius:16px 16px 0 0;text-align:center;">' +
                '<div style="font-size:2.5rem;margin-bottom:8px;"></div>' +
                '<h1 style="margin:0;font-size:1.8rem;font-weight:700;">Relatório Final - RAS</h1>' +
                '<p style="margin:8px 0 0 0;opacity:0.9;font-size:1.1rem;">Reunião de Análise de Segurança</p>' +
              '</div>' +
              
              '<div style="padding:32px;">' +
                // SeÃ§Ã£o InformaÃ§Ãµes BÃ¡sicas
                '<div style="background:#f8fafc;border:1px solid #e2e8f0;border-radius:12px;padding:20px;margin-bottom:24px;">' +
                  '<h3 style="margin:0 0 16px 0;color:#1f2937;font-size:1.3rem;border-bottom:2px solid #3b82f6;padding-bottom:8px;"> InformaÃ§Ãµes BÃ¡sicas</h3>' +
                  '<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:16px;">' +
                    '<div><strong style="color:#374151;"> Data:</strong><br><span style="color:#1f2937;font-size:1.1rem;">' + dataFormatada + '</span></div>' +
                    '<div><strong style="color:#374151;"> Empresa:</strong><br><span style="color:#1f2937;font-size:1.1rem;">' + (ras.empresa || '-') + '</span></div>' +
                    '<div><strong style="color:#374151;"> HorÃ¡rio:</strong><br><span style="color:#1f2937;font-size:1.1rem;">' + (ras.inicio || '-') + ' Ã s ' + (ras.termino || '-') + '</span></div>' +
                    '<div><strong style="color:#374151;"> Efetivo:</strong><br><span style="color:#1f2937;font-size:1.1rem;">' + (ras.efetivo || '0') + ' pessoas</span></div>' +
                  '</div>' +
                '</div>' +
                
                // SeÃ§Ã£o LideranÃ§a
                '<div style="background:#f0f9ff;border:1px solid #0ea5e9;border-radius:12px;padding:20px;margin-bottom:24px;">' +
                  '<h3 style="margin:0 0 16px 0;color:#1f2937;font-size:1.3rem;border-bottom:2px solid #0ea5e9;padding-bottom:8px;"> ParticipaÃ§Ã£o de LideranÃ§a</h3>' +
                  '<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;">' +
                    '<div><strong> Gerente:</strong> ' + (ras.gerente || '-') + '</div>' +
                    '<div><strong> Engenheiro:</strong> ' + (ras.engenheiro || '-') + '</div>' +
                    '<div><strong> Supervisor:</strong> ' + (ras.supervisor || '-') + '</div>' +
                    '<div><strong> Encarregado:</strong> ' + (ras.encarregado || '-') + '</div>' +
                    '<div><strong> TÃ©cnico Seg.:</strong> ' + (ras.tecnicoSeguranca || '-') + '</div>' +
                  '</div>' +
                '</div>' +
                
                // SeÃ§Ã£o DesignaÃ§Ãµes
                '<div style="background:#f0fdf4;border:1px solid #16a34a;border-radius:12px;padding:20px;margin-bottom:24px;">' +
                  '<h3 style="margin:0 0 16px 0;color:#1f2937;font-size:1.3rem;border-bottom:2px solid #16a34a;padding-bottom:8px;"> DesignaÃ§Ãµes Especiais</h3>' +
                  '<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;">' +
                    '<div><strong> Anjo da Semana:</strong> ' + (ras.anjoSemana || '-') + '</div>' +
                    '<div><strong> LÃ­der da RAS:</strong> ' + (ras.liderRAS || '-') + '</div>' +
                    '<div><strong> LÃ­der CPT:</strong> ' + (ras.liderCPT || '-') + '</div>' +
                    '<div><strong> Brigada:</strong> ' + (ras.brigada || '-') + '</div>' +
                  '</div>' +
                '</div>' +
                
                // SeÃ§Ã£o Riscos e ObservaÃ§Ãµes
                '<div style="background:#fef2f2;border:1px solid #ef4444;border-radius:12px;padding:20px;margin-bottom:24px;">' +
                  '<h3 style="margin:0 0 16px 0;color:#1f2937;font-size:1.3rem;border-bottom:2px solid #ef4444;padding-bottom:8px;"> ï¸ Análise de Riscos</h3>' +
                  '<div style="margin-bottom:16px;"><strong style="color:#dc2626;"> Tarefas de Alto Risco:</strong><br><div style="background:#fff;border:1px solid #fca5a5;border-radius:6px;padding:12px;margin-top:8px;color:#374151;">' + (ras.altoRisco || 'NÃ£o informado') + '</div></div>' +
                  '<div style="margin-bottom:16px;"><strong style="color:#dc2626;"> ï¸ TARD-C:</strong> <span style="padding:4px 12px;border-radius:20px;font-weight:600;color:#fff;background:' + (ras.tardc ? '#ef4444' : '#10b981') + ';">' + (ras.tardc ? ' ATIVADO' : ' INATIVO') + '</span></div>' +
                  '<div><strong style="color:#dc2626;"> InformaÃ§Ãµes para Compartilhar:</strong><br><div style="background:#fff;border:1px solid #fca5a5;border-radius:6px;padding:12px;margin-top:8px;color:#374151;">' + (ras.compartilhar || 'NÃ£o informado') + '</div></div>' +
                '</div>' +
                
                // SeÃ§Ã£o FuncionÃ¡rios Presentes
                tabelaPresentes + tabelaAusentes +
                
                // SeÃ§Ã£o Anexos - Fotos e Documentos
                gerarSecaoAnexos(ras) +
                
                // RodapÃ©
                '<div style="text-align:center;border-top:2px solid #e5e7eb;padding-top:24px;margin-top:32px;">' +
                  '<div style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap;">' +
                    '<button onclick="imprimirRelatorio()" style="background:#3b82f6;color:#fff;border:none;padding:12px 24px;border-radius:8px;cursor:pointer;font-size:1rem;display:flex;align-items:center;gap:8px;"><span></span> Imprimir</button>' +
                    '<button onclick="compartilharRelatorio()" style="background:#10b981;color:#fff;border:none;padding:12px 24px;border-radius:8px;cursor:pointer;font-size:1rem;display:flex;align-items:center;gap:8px;"><span></span> Compartilhar</button>' +
                    '<button onclick="fecharModal()" style="background:#6b7280;color:#fff;border:none;padding:12px 24px;border-radius:8px;cursor:pointer;font-size:1rem;display:flex;align-items:center;gap:8px;"><span></span> Fechar</button>' +
                  '</div>' +
                  '<div style="margin-top:16px;color:#6b7280;font-size:0.9rem;">' +
                    '<strong>Registrado em:</strong> ' + (ras.dataRegistro ? new Date(ras.dataRegistro).toLocaleString('pt-BR') : '-') +
                    (ras.dataEdicao ? '<br><strong>Última ediÃ§Ã£o:</strong> ' + new Date(ras.dataEdicao).toLocaleString('pt-BR') : '') +
                  '</div>' +
                '</div>' +
              '</div>';
            
            modal.appendChild(conteudo);
            document.body.appendChild(modal);
            
            // Fechar modal ao clicar fora
            modal.addEventListener('click', function(e) {
              if (e.target === modal) {
                document.body.removeChild(modal);
              }
            });
            
            // FunÃ§Ãµes globais para as aÃ§Ãµes do modal
            window.fecharModal = function() {
              if (modal && modal.parentNode) {
                document.body.removeChild(modal);
              }
            }
            
            window.imprimirRelatorio = function() {
              window.print();
            }
            
            window.compartilharRelatorio = function() {
              if (navigator.share) {
                navigator.share({
                  title: 'Relatório RAS - ' + (ras.empresa || 'Empresa'),
                  text: 'Relatório da Reunião de Análise de Segurança realizada em ' + dataFormatada,
                  url: window.location.href
                });
              } else {
                // Fallback para dispositivos que nÃ£o suportam Web Share API
                var texto = 'Relatório RAS - ' + (ras.empresa || 'Empresa') + '\n' +
                      'Data: ' + dataFormatada + '\n' +
                      'Efetivo: ' + (ras.efetivo || '0') + ' pessoas\n' +
                      'Presentes: ' + totalPresentes + ' funcionÃ¡rios';
                
                if (navigator.clipboard) {
                  navigator.clipboard.writeText(texto);
                  alert('InformaÃ§Ãµes copiadas para a Ã¡rea de transferÃªncia!');
                } else {
                  prompt('Copie o texto abaixo:', texto);
                }
              }
            }
            
            // FunÃ§Ãµes globais para visualizaÃ§Ã£o de anexos
            window.abrirImagemModal = function(src, nome) {
              var modalImg = document.createElement('div');
              modalImg.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);z-index:20000;display:flex;align-items:center;justify-content:center;padding:20px;box-sizing:border-box;';
              
              modalImg.innerHTML = 
                '<div style="position:relative;max-width:90%;max-height:90%;background:#fff;border-radius:8px;overflow:hidden;box-shadow:0 8px 32px rgba(0,0,0,0.5);">' +
                  '<div style="background:#374151;color:#fff;padding:12px 16px;display:flex;justify-content:space-between;align-items:center;">' +
                    '<h4 style="margin:0;font-size:1rem;">' + nome + '</h4>' +
                    '<button onclick="fecharModalImagem()" style="background:none;border:none;color:#fff;font-size:1.5rem;cursor:pointer;padding:0;width:24px;height:24px;">Ã—</button>' +
                  '</div>' +
                  '<img src="' + src + '" alt="' + nome + '" style="display:block;max-width:100%;max-height:calc(90vh - 60px);object-fit:contain;">' +
                '</div>';
              
              document.body.appendChild(modalImg);
              
              // Fechar ao clicar fora da imagem
              modalImg.addEventListener('click', function(e) {
                if (e.target === modalImg) {
                  document.body.removeChild(modalImg);
                }
              });
              
              window.fecharModalImagem = function() {
                if (modalImg && modalImg.parentNode) {
                  document.body.removeChild(modalImg);
                }
              }
            }
            
            window.abrirDocumento = function(src, nome) {
              var extensao = nome.split('.').pop().toLowerCase();
              
              if (['jpg', 'jpeg', 'png', 'gif'].includes(extensao)) {
                // Se for imagem, usar o modal de imagem
                window.abrirImagemModal(src, nome);
              } else if (extensao === 'pdf') {
                // Para PDF, tentar abrir em nova aba
                try {
                  var newWindow = window.open(src, '_blank');
                  if (!newWindow) {
                    alert('Pop-ups bloqueados. Por favor, permita pop-ups para visualizar o documento.');
                  }
                } catch (error) {
                  alert('NÃ£o foi possÃ­vel abrir o documento. Tente fazer o download.');
                }
              } else {
                // Para outros tipos, fazer download
                var link = document.createElement('a');
                link.href = src;
                link.download = nome;
                link.style.display = 'none';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
              }
            }
          }
          
          // Editar RAS - Escopo Global
          window.editarRAS = function(index) {
            var rasRegistradas = JSON.parse(localStorage.getItem('ras-reunioes')) || [];
            var ras = rasRegistradas[index];
            
            if (!ras) {
              alert('RAS nÃ£o encontrada!');
              return;
            }
            
            if (confirm('Deseja editar esta RAS?\n\nVocÃª serÃ¡ redirecionado para o formulÃ¡rio com os dados preenchidos.')) {
              // Mostrar formulÃ¡rio
              document.getElementById('ras-lista-reunioes').style.display = 'none';
              document.getElementById('ras-formulario-container').style.display = 'block';
              
              // Preencher formulÃ¡rio com dados existentes
              preencherFormularioRAS(ras);
              
              // Mostrar etapa 1
              mostrarEtapaRAS(1);
              
              // Armazenar Ã­ndice para atualização posterior
              window.rasEditandoIndex = index;
            }
          }
          
          // Excluir RAS - Escopo Global
          window.excluirRAS = function(index) {
            var rasRegistradas = JSON.parse(localStorage.getItem('ras-reunioes')) || [];
            var ras = rasRegistradas[index];
            
            if (!ras) {
              alert('RAS nÃ£o encontrada!');
              return;
            }
            
            var dataFormatada = ras.data ? new Date(ras.data + 'T00:00:00').toLocaleDateString('pt-BR') : '-';
            
            if (confirm('Tem certeza que deseja excluir esta RAS?\n\nData: ' + dataFormatada + '\nEmpresa: ' + (ras.empresa || '-') + '\n\nEsta aÃ§Ã£o nÃ£o pode ser desfeita.')) {
              // Remover do array
              rasRegistradas.splice(index, 1);
              
              // Salvar no localStorage
              localStorage.setItem('ras-reunioes', JSON.stringify(rasRegistradas));
              
              // Atualizar lista
              carregarListaRAS();
              
              alert('RAS excluÃ­da com sucesso!');
            }
          }
          
          // Gerar seÃ§Ã£o de anexos (fotos e documentos)
          function gerarSecaoAnexos(ras) {
            var fotos = ras.fotos || [];
            var documentos = ras.documentos || [];
            var temAnexos = fotos.length > 0 || documentos.length > 0;
            
            if (!temAnexos) {
              return '<div style="background:#fef3c7;border:1px solid #f59e0b;border-radius:12px;padding:20px;margin-bottom:24px;text-align:center;">' +
                '<h3 style="margin:0 0 8px 0;color:#92400e;font-size:1.3rem;"> Anexos</h3>' +
                '<p style="margin:0;color:#92400e;">Nenhum arquivo foi anexado a esta RAS</p>' +
              '</div>';
            }
            
            var secaoAnexos = '<div style="background:#f8fafc;border:1px solid #64748b;border-radius:12px;padding:20px;margin-bottom:24px;">' +
              '<h3 style="margin:0 0 16px 0;color:#1f2937;font-size:1.3rem;border-bottom:2px solid #64748b;padding-bottom:8px;"> Anexos</h3>';
            
            // SeÃ§Ã£o Fotos
            if (fotos.length > 0) {
              secaoAnexos += '<div style="margin-bottom:20px;">' +
                '<h4 style="margin:0 0 12px 0;color:#374151;display:flex;align-items:center;gap:8px;"><span style="font-size:1.2rem;"></span> Fotos (' + fotos.length + ')</h4>' +
                '<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:12px;">';
              
              fotos.forEach(function(foto, index) {
                var nomeArquivo = foto.nome || 'foto_' + (index + 1) + '.jpg';
                secaoAnexos += 
                  '<div style="background:#fff;border:1px solid #e5e7eb;border-radius:8px;overflow:hidden;box-shadow:0 2px 4px rgba(0,0,0,0.1);">' +
                    '<div style="position:relative;padding-bottom:75%;overflow:hidden;">' +
                      '<img src="' + foto.src + '" alt="' + nomeArquivo + '" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;cursor:pointer;" onclick="abrirImagemModal(\'' + foto.src + '\', \'' + nomeArquivo + '\')">' +
                    '</div>' +
                    '<div style="padding:8px;text-align:center;">' +
                      '<div style="font-size:0.85rem;color:#374151;font-weight:500;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">' + nomeArquivo + '</div>' +
                      '<div style="font-size:0.75rem;color:#6b7280;margin-top:2px;">' + (foto.tamanho || 'Tamanho nÃ£o disponÃ­vel') + '</div>' +
                    '</div>' +
                  '</div>';
              });
              
              secaoAnexos += '</div></div>';
            }
            
            // SeÃ§Ã£o Documentos
            if (documentos.length > 0) {
              secaoAnexos += '<div>' +
                '<h4 style="margin:0 0 12px 0;color:#374151;display:flex;align-items:center;gap:8px;"><span style="font-size:1.2rem;"></span> Documentos (' + documentos.length + ')</h4>' +
                '<div style="display:grid;gap:8px;">';
              
              documentos.forEach(function(doc, index) {
                var nomeArquivo = doc.nome || 'documento_' + (index + 1);
                var extensao = nomeArquivo.split('.').pop().toLowerCase();
                var iconeDoc = obterIconeDocumento(extensao);
                var corDoc = obterCorDocumento(extensao);
                
                secaoAnexos += 
                  '<div style="background:#fff;border:1px solid #e5e7eb;border-radius:8px;padding:12px;display:flex;align-items:center;gap:12px;transition:all 0.2s;cursor:pointer;" onclick="abrirDocumento(\'' + doc.src + '\', \'' + nomeArquivo + '\')" onmouseover="this.style.backgroundColor=\'#f9fafb\'" onmouseout="this.style.backgroundColor=\'#fff\'">' +
                    '<div style="font-size:2rem;color:' + corDoc + ';">' + iconeDoc + '</div>' +
                    '<div style="flex:1;">' +
                      '<div style="font-weight:500;color:#1f2937;margin-bottom:2px;">' + nomeArquivo + '</div>' +
                      '<div style="font-size:0.85rem;color:#6b7280;">' + (doc.tamanho || 'Tamanho nÃ£o disponÃ­vel') + '</div>' +
                    '</div>' +
                    '<div style="color:#6b7280;font-size:0.85rem;">Clique para visualizar</div>' +
                  '</div>';
              });
              
              secaoAnexos += '</div></div>';
            }
            
            secaoAnexos += '</div>';
            return secaoAnexos;
          }
          
          // Obter Ã­cone do documento baseado na extensÃ£o
          function obterIconeDocumento(extensao) {
            var icones = {
              'pdf': '📄',
              'doc': '📄',
              'docx': '📄',
              'xls': '📊',
              'xlsx': '📊',
              'ppt': '📊',
              'pptx': '📊',
              'txt': '📝',
              'jpg': '🖼️',
              'jpeg': '🖼️',
              'png': '🖼️',
              'gif': '🖼️',
              'zip': '🗂️',
              'rar': '🗂️'
            };
            return icones[extensao] || '📎';
          }
          
          // Obter cor do documento baseado na extensÃ£o
          function obterCorDocumento(extensao) {
            var cores = {
              'pdf': '#dc2626',
              'doc': '#2563eb',
              'docx': '#2563eb',
              'xls': '#16a34a',
              'xlsx': '#16a34a',
              'ppt': '#ea580c',
              'pptx': '#ea580c',
              'txt': '#6b7280',
              'jpg': '#7c3aed',
              'jpeg': '#7c3aed',
              'png': '#7c3aed',
              'gif': '#7c3aed',
              'zip': '#4338ca',
              'rar': '#4338ca'
            };
            return cores[extensao] || '#6b7280';
          }
          
          // Preencher formulÃ¡rio com dados da RAS para ediÃ§Ã£o
          function preencherFormularioRAS(ras) {
            // Etapa 1 - InformaÃ§Ãµes BÃ¡sicas
            if (document.getElementById('ras-empresa')) document.getElementById('ras-empresa').value = ras.empresa || '';
            if (document.getElementById('ras-data')) document.getElementById('ras-data').value = ras.data || '';
            if (document.getElementById('ras-inicio')) document.getElementById('ras-inicio').value = ras.inicio || '';
            if (document.getElementById('ras-termino')) document.getElementById('ras-termino').value = ras.termino || '';
            if (document.getElementById('ras-efetivo')) document.getElementById('ras-efetivo').value = ras.efetivo || '';
            if (document.getElementById('ras-alto-risco')) document.getElementById('ras-alto-risco').value = ras.altoRisco || '';
            if (document.getElementById('ras-tardc')) document.getElementById('ras-tardc').checked = ras.tardc || false;
            if (document.getElementById('ras-compartilhar')) document.getElementById('ras-compartilhar').value = ras.compartilhar || '';
            
            // Etapa 2 - LideranÃ§a
              if (document.getElementById('ras-gerente')) document.getElementById('ras-gerente').value = ras.gerente || '';
              if (document.getElementById('ras-engenheiro')) document.getElementById('ras-engenheiro').value = ras.engenheiro || '';
              if (document.getElementById('ras-supervisor')) document.getElementById('ras-supervisor').value = ras.supervisor || '';
              if (document.getElementById('ras-encarregado')) document.getElementById('ras-encarregado').value = ras.encarregado || '';
              if (document.getElementById('ras-tecnico-seguranca')) document.getElementById('ras-tecnico-seguranca').value = ras.tecnicoSeguranca || '';

              // Reconstruir a lista de participantes da etapa 2 para exibiÃ§Ã£o (mantÃ©m compatibilidade)
              participantesRAS = [];
              if (ras.gerente) participantesRAS.push({ nome: ras.gerente, setor: 'Gerente' });
              if (ras.engenheiro) participantesRAS.push({ nome: ras.engenheiro, setor: 'Engenheiro' });
              if (ras.supervisor) participantesRAS.push({ nome: ras.supervisor, setor: 'Supervisor' });
              if (ras.encarregado) participantesRAS.push({ nome: ras.encarregado, setor: 'Encarregado' });
              if (ras.tecnicoSeguranca) participantesRAS.push({ nome: ras.tecnicoSeguranca, setor: 'TÃ©cnico de Segurança' });
              renderListaParticipantesRAS();
              // Atualizar campos hidden e validar (inclui validaÃ§Ã£o da etapa 5)
              atualizarHiddenPorSetor();
            
            // Etapa 3 - DesignaÃ§Ãµes
            if (document.getElementById('ras-anjo-semana')) document.getElementById('ras-anjo-semana').value = ras.anjoSemana || '';
            if (document.getElementById('ras-lider-ras')) document.getElementById('ras-lider-ras').value = ras.liderRAS || '';
            if (document.getElementById('ras-lider-cpt')) document.getElementById('ras-lider-cpt').value = ras.liderCPT || '';
            if (document.getElementById('ras-brigada')) document.getElementById('ras-brigada').value = ras.brigada || '';
          }
          
        // Salvar empresas no localStorage E NO SERVIDOR
        async function salvarEmpresas() {
          try {
            localStorage.setItem('empresas', JSON.stringify(empresas));
            console.log('Empresas salvas no localStorage:', empresas.length);
            // Atualizar dropdowns quando empresas forem salvas
            carregarEmpresasRAS();
            carregarEmpresasColaborador();
          } catch(e) {
            console.error('Erro ao salvar empresas:', e);
          }
        }

        // Controle de alteraÃ§Ãµes pendentes (Empresa)
        var pendingOpsEmpresas = [];
        function showEmpresasSaveBar() {
          var bar = document.getElementById('empresas-save-bar');
          if (bar) bar.style.display = 'flex';
        }
        function hideEmpresasSaveBar() {
          var bar = document.getElementById('empresas-save-bar');
          if (bar) bar.style.display = 'none';
        }
        async function salvarAlteracoesEmpresas() {
          try {
            for (const op of pendingOpsEmpresas) {
              const targetId = op.id || op.key;
              if (op.type === 'edit') {
                const resp = await fetch(`${API_BASE_URL}/api/empresas/${targetId}`, {
                  method: 'PUT',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify(op.data)
                });
                if (!resp.ok) throw new Error('Falha ao salvar ediÃ§Ã£o de empresa');
              } else if (op.type === 'delete') {
                const resp = await fetch(`${API_BASE_URL}/api/empresas/${targetId}`, { method: 'DELETE' });
                if (!resp.ok) throw new Error('Falha ao excluir empresa no servidor');
              }
            }
            pendingOpsEmpresas = [];
            hideEmpresasSaveBar();
            exibirEmpresas();
            alert('AlteraÃ§Ãµes de empresas salvas no servidor.');
          } catch (err) {
            console.error('Erro ao salvar alteraÃ§Ãµes de empresas:', err);
            alert('Erro ao salvar alteraÃ§Ãµes de empresas. Tente novamente.');
          }
        }
        function descartarAlteracoesEmpresas() {
          pendingOpsEmpresas = [];
          hideEmpresasSaveBar();
          // Recarregar do servidor se disponÃ­vel
          if (typeof carregarEmpresasDoServidor === 'function') {
            carregarEmpresasDoServidor();
          }
          else {
            window.location.reload();
          }
        }

        // Exibir lista de empresas
        function exibirEmpresas() {
          var container = document.getElementById('empresas-lista');
          var total = document.getElementById('total-empresas');
          
          if (!container || !total) {
            console.error('Elementos nÃ£o encontrados:', {container: !!container, total: !!total});
            return;
          }
          
          // Sempre recarregar do localStorage
          try {
            empresas = JSON.parse(localStorage.getItem('empresas')) || [];
          } catch(e) { 
            console.error('Erro ao carregar empresas:', e);
            empresas = []; 
          }
            
            console.log('EXIBIR: Total de empresas:', empresas.length, empresas);
            
            if (empresas.length === 0) {
              container.innerHTML = '<div style="padding:20px;text-align:center;color:#6b7280">Nenhuma empresa cadastrada</div>';
              total.textContent = '0';
              return;
            }
            
            var html = '';
            console.log('Iniciando geraÃ§Ã£o do HTML para', empresas.length, 'empresas');
            
          empresas.forEach(function(emp, index) {
            console.log('Processando empresa', index + 1, ':', emp);
            
            try {
              html += '<div style="padding:12px 16px;border-bottom:1px solid #f3f4f6;display:grid;grid-template-columns:2fr 1.5fr 1fr 2fr 1fr 1.5fr 100px;gap:16px;align-items:center">';
              html += '<div style="color:#374151;font-weight:500">' + (emp.nome || '') + '</div>';
              html += '<div style="color:#374151">' + (emp.cnpj || '') + '</div>';
              html += '<div style="color:#6b7280">' + (emp.cnae || '') + '</div>';
              html += '<div style="color:#6b7280">' + (emp.ramoAtividade || '') + '</div>';
              html += '<div style="color:#6b7280">' + (emp.grauRisco ? 'Grau ' + emp.grauRisco : '') + '</div>';
              html += '<div style="color:#6b7280">' + (emp.contato || '') + '</div>';
              html += '<div>';
              html += '<button onclick="editarEmpresa(\'' + emp.cnpj + '\')" style="background:#f59e0b;color:#fff;border:none;border-radius:4px;padding:4px 8px;font-size:0.8rem;cursor:pointer;margin-right:4px"></button>';
              html += '<button onclick="excluirEmpresa(\'' + emp.cnpj + '\')" style="background:#ef4444;color:#fff;border:none;border-radius:4px;padding:4px 8px;font-size:0.8rem;cursor:pointer"></button>';
              html += '</div>';
              html += '</div>';
            } catch(e) {
              console.error('Erro ao processar empresa:', emp, e);
            }
          });            console.log('HTML gerado:', html.length, 'caracteres');
            
            container.innerHTML = html;
            total.textContent = empresas.length;
            
            console.log('ExibiÃ§Ã£o concluÃ­da. Container innerHTML length:', container.innerHTML.length);
          }
          
          // Abrir modal nova empresa
          function abrirModalNovaEmpresa() {
            console.log('Abrindo modal nova empresa');
            document.getElementById('modal-empresa').removeAttribute('data-editando');
            document.querySelector('#modal-empresa h3').textContent = ' Nova Empresa';
            document.getElementById('form-empresa').reset();
            document.getElementById('modal-empresa').style.display = 'flex';
          }
          
          // Fechar modal empresa
          function fecharModalEmpresa() {
            document.getElementById('modal-empresa').style.display = 'none';
            document.getElementById('form-empresa').reset();
            document.getElementById('modal-empresa').removeAttribute('data-editando');
          }
          
        
        // Cadastrar/editar empresa
        async function cadastrarEmpresa() {
          var nome = document.getElementById('emp-nome').value.trim();
          var cnpj = document.getElementById('emp-cnpj').value.trim();
          var cnae = document.getElementById('emp-cnae').value.trim();
          var ramoAtividade = document.getElementById('emp-ramo-atividade').value.trim();
          var grauRisco = document.getElementById('emp-grau-risco').value.trim();
          var contato = document.getElementById('emp-contato').value.trim();
          
          if (!nome || !cnpj) {
            alert('Nome da Empresa e CNPJ sÃ£o obrigatÃ³rios!');
            return;
          }
          
          var modal = document.getElementById('modal-empresa');
          var editando = modal.getAttribute('data-editando');
          
          var empresaData = {
            nome: nome,
            cnpj: cnpj,
            cnae: cnae,
            ramoAtividade: ramoAtividade,
            grauRisco: grauRisco,
            contato: contato
          };
          
          try {
            if (editando) {
              // Editar localmente e marcar como pendente (preserva id)
              var index = empresas.findIndex(function(e) { return e.cnpj === editando; });
              if (index !== -1) {
                if (empresas[index].id) empresaData.id = empresas[index].id;
                empresas[index] = empresaData;
                pendingOpsEmpresas.push({ type: 'edit', key: editando, id: empresaData.id, data: empresaData });
                showEmpresasSaveBar();
              }
              alert('Empresa editada. Clique em "Salvar alteraÃ§Ãµes" para enviar ao servidor.');
            } else {
              // Nova empresa
              var existe = empresas.find(function(e) { return e.cnpj === cnpj; });
              if (existe) {
                alert('CNPJ jÃ¡ cadastrado!');
                return;
              }
              
              // Enviar para o servidor
              const response = await fetch(`${API_BASE_URL}/api/empresas`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(empresaData)
              });
              
              if (!response.ok) throw new Error('Erro ao cadastrar empresa');
              const resJson = await response.json();
              if (resJson && resJson.id) empresaData.id = resJson.id;
            
              empresas.push(empresaData);
              alert('Empresa cadastrada com sucesso!');
            }
            
            salvarEmpresas();
            exibirEmpresas();
            fecharModalEmpresa();
        } catch (error) {
          console.error('Erro ao salvar empresa:', error);
          alert('Erro ao salvar empresa no servidor. Tente novamente.');
        }
      }
      
      // Excluir empresa - Escopo Global
      window.excluirEmpresa = function(cnpj) {
        console.log('Excluindo empresa:', cnpj);
        if (confirm('Tem certeza que deseja excluir esta empresa?')) {
          // Excluir localmente e marcar como pendente (com id se existir)
          var alvo = empresas.find(function(e) { return e.cnpj === cnpj; });
          empresas = empresas.filter(function(e) { return e.cnpj !== cnpj; });
          pendingOpsEmpresas.push({ type: 'delete', key: cnpj, id: alvo && alvo.id });
          showEmpresasSaveBar();
          salvarEmpresas();
          exibirEmpresas();
          alert('ExclusÃ£o marcada. Clique em "Salvar alteraÃ§Ãµes" para enviar ao servidor.');
        }
      }          // Editar empresa - Escopo Global
          window.editarEmpresa = function(cnpj) {
            console.log('Editando empresa:', cnpj);
            var empresa = empresas.find(function(e) { return e.cnpj === cnpj; });
            console.log('Empresa encontrada:', empresa);
            if (empresa) {
              // Preencher formulÃ¡rio com dados existentes
              document.getElementById('emp-nome').value = empresa.nome || '';
              document.getElementById('emp-cnpj').value = empresa.cnpj;
              document.getElementById('emp-cnae').value = empresa.cnae || '';
              document.getElementById('emp-ramo-atividade').value = empresa.ramoAtividade || '';
              document.getElementById('emp-grau-risco').value = empresa.grauRisco || '';
              document.getElementById('emp-contato').value = empresa.contato || '';
              
              // Marcar como ediÃ§Ã£o
              document.getElementById('modal-empresa').setAttribute('data-editando', cnpj);
              document.getElementById('modal-empresa').style.display = 'flex';
              
              // Alterar tÃ­tulo do modal
              document.querySelector('#modal-empresa h3').textContent = ' Editar Empresa';
            }
          }
          
          // SISTEMA DE CONTROLE DE FREQUÃŠNCIA
          
          // Histórico de presenÃ§as (simulado - em produÃ§Ã£o viria das RAS)
          var historicoRAS = JSON.parse(localStorage.getItem('historicoRAS')) || [];
          
          // Inicializar frequÃªncia
          function inicializarFrequencia() {
            var hoje = new Date();
            var dataFormatada = hoje.getDate().toString().padStart(2, '0') + '/' + 
                       (hoje.getMonth() + 1).toString().padStart(2, '0') + '/' + 
                       hoje.getFullYear();
            
            document.getElementById('filtro-data-frequencia').valueAsDate = hoje;
            document.getElementById('data-resumo').textContent = dataFormatada;
            
            // Carregar dados iniciais
            carregarFrequenciaDia(dataFormatada);
          }
          
          // Buscar frequÃªncia por data
          function buscarFrequencia() {
            var dataInput = document.getElementById('filtro-data-frequencia').value;
            if (!dataInput) {
              alert('Por favor, selecione uma data para buscar.');
              return;
            }
            
            var data = new Date(dataInput);
            var dataFormatada = data.getDate().toString().padStart(2, '0') + '/' + 
                       (data.getMonth() + 1).toString().padStart(2, '0') + '/' + 
                       data.getFullYear();
            
            document.getElementById('data-resumo').textContent = dataFormatada;
            carregarFrequenciaDia(dataFormatada);
          }
          
          // Carregar frequÃªncia de um dia especÃ­fico
          function carregarFrequenciaDia(data) {
            // Buscar RAS da data especÃ­fica
            var rasDoDia = historicoRAS.find(function(ras) {
              return ras.data === data;
            });

            // Se nÃ£o encontrar RAS, mostrar mensagem de nenhum registro
            if (!rasDoDia) {
              exibirFrequencia([], []);
              return;
            }

            // Usar os dados completos da RAS (presentes tem nome, empresa, funÃ§Ã£o)
            var presentes = rasDoDia.presentes || [];

            // Tentar recuperar lista de ausentes salva junto com a RAS
            var ausentes = rasDoDia.funcionariosAusentes || [];

            // Se nÃ£o houver lista de ausentes salva, calcular a partir dos colaboradores cadastrados
            if ((!ausentes || ausentes.length === 0) && (presentes.length > 0)) {
              try {
                var colaboradoresCadastrados = JSON.parse(localStorage.getItem('funcionarios')) || [];
                var matriculasPresentes = presentes.map(function(p){ return (p.matricula || '').toString().trim(); }).filter(Boolean);
                ausentes = [];
                colaboradoresCadastrados.forEach(function(f){
                  var m = (f.matricula || '').toString().trim();
                  var estaPresente = m ? (matriculasPresentes.indexOf(m) !== -1) : presentes.some(function(p){ return p.nome === f.nome; });
                  if (!estaPresente) {
                    ausentes.push({ matricula: f.matricula || '', nome: f.nome || '', empresa: f.empresa || '', funcao: f.funcao || '' });
                  }
                });
              } catch(e) {
                ausentes = [];
              }
            }

            exibirFrequencia(presentes, ausentes || []);
          }

          // Exibir listas de frequÃªncia
          function exibirFrequencia(presentes, ausentes) {
            presentes = presentes || [];
            ausentes = ausentes || [];

            // Atualizar totais
            document.getElementById('total-presentes').textContent = presentes.length;
            document.getElementById('total-ausentes').textContent = ausentes.length;
            document.getElementById('badge-presentes').textContent = presentes.length;
            document.getElementById('badge-ausentes').textContent = ausentes.length;

            // Resumo
            var totalGeral = presentes.length + ausentes.length;
            document.getElementById('resumo-total').textContent = totalGeral;
            document.getElementById('resumo-presentes').textContent = presentes.length;
            document.getElementById('resumo-ausentes').textContent = ausentes.length;

            // Lista de presentes (usando dados completos da RAS)
            var listaPresentes = document.getElementById('lista-presentes');
            if (presentes.length === 0) {
              listaPresentes.innerHTML = '<div style="padding:40px 16px;text-align:center;color:#9ca3af;font-style:italic">Nenhuma RAS encontrada para esta data</div>';
            } else {
              var htmlPresentes = '';
              presentes.forEach(function(funcionario) {
                htmlPresentes += '<div style="padding:12px 16px;border-bottom:1px solid #bbf7d0;display:grid;grid-template-columns:100px 2fr 1.5fr 1.5fr 60px;gap:12px;align-items:center;font-size:0.85rem">';
                htmlPresentes += '<div style="font-weight:500">' + (funcionario.matricula || '-') + '</div>';
                htmlPresentes += '<div>' + (funcionario.nome || '-') + '</div>';
                htmlPresentes += '<div style="color:#059669">' + (funcionario.funcao || '-') + '</div>';
                htmlPresentes += '<div style="color:#059669">' + (funcionario.empresa || '-') + '</div>';
                htmlPresentes += '<div><button onclick="removerPresencaRAS(\'' + (funcionario.matricula || '') + '\')" style="background:#dc2626;color:#fff;border:none;border-radius:4px;padding:4px 8px;font-size:0.7rem;cursor:pointer" title="Remover presença"></button></div>';
                htmlPresentes += '</div>';
              });
              listaPresentes.innerHTML = htmlPresentes;
            }

            // Lista de ausentes (exibir nomes se houver)
            var listaAusentes = document.getElementById('lista-ausentes');
            if (ausentes.length === 0) {
              listaAusentes.innerHTML = '<div style="padding:40px 16px;text-align:center;color:#9ca3af;font-style:italic">Nenhum funcionário ausente registrado para esta data</div>';
            } else {
              var htmlAusentes = '';
              ausentes.forEach(function(funcionario) {
                htmlAusentes += '<div style="padding:12px 16px;border-bottom:1px solid #f3f4f6;display:grid;grid-template-columns:100px 2fr 1.5fr 1.5fr;gap:12px;align-items:center;font-size:0.85rem">';
                htmlAusentes += '<div style="font-weight:500">' + (funcionario.matricula || '-') + '</div>';
                htmlAusentes += '<div>' + (funcionario.nome || '-') + '</div>';
                htmlAusentes += '<div style="color:#6b7280">' + (funcionario.funcao || '-') + '</div>';
                htmlAusentes += '<div style="color:#6b7280">' + (funcionario.empresa || '-') + '</div>';
                htmlAusentes += '</div>';
              });
              listaAusentes.innerHTML = htmlAusentes;
            }
          }
          

          
          // Salvar dados de frequência da RAS
          function salvarFrequenciaRAS(data, presentes) {
            // Converter data para formato DD/MM/AAAA se necessário
            var dataFormatada = data;
            if (data.includes('-')) {
              var partes = data.split('-');
              dataFormatada = partes[2] + '/' + partes[1] + '/' + partes[0];
            }
            
            // Buscar se jÃ¡ existe registro para esta data
            var indiceExistente = historicoRAS.findIndex(function(ras) {
              return ras.data === dataFormatada;
            });
            
            // Atualizar ou adicionar novo registro
            var novoRegistro = {
              data: dataFormatada,
              presentes: presentes
            };
            
            if (indiceExistente >= 0) {
              historicoRAS[indiceExistente] = novoRegistro;
            } else {
              historicoRAS.push(novoRegistro);
            }
            
            // Salvar no localStorage
            localStorage.setItem('historicoRAS', JSON.stringify(historicoRAS));
            
            console.log('Frequência salva para', dataFormatada, ':', presentes.length, 'presentes');
          }
          
          // SISTEMA CPT - CONVERSA PRÃ‰ TAREFA
          
          // Array para armazenar CPTs
          var cpts = JSON.parse(localStorage.getItem('cpts')) || [];
          
          // Remover presenÃ§a de um funcionÃ¡rio da RAS
          function removerPresencaRAS(matricula) {
            if (!confirm('Tem certeza que deseja remover este funcionÃ¡rio da RAS?')) {
              return;
            }
            
            var dataAtual = document.getElementById('data-resumo').textContent;
            
            // Buscar o RAS do dia
            var rasIndex = historicoRAS.findIndex(function(ras) {
              return ras.data === dataAtual;
            });
            
            if (rasIndex !== -1) {
              // Remover da lista de presentes (comparar por matrÃ­cula)
              var presentes = historicoRAS[rasIndex].presentes || [];
              var novaListaPresentes = presentes.filter(function(funcionario) {
                return funcionario.matricula !== matricula;
              });
              
              historicoRAS[rasIndex].presentes = novaListaPresentes;
              
              // Se nÃ£o sobrou ninguÃ©m, remover o registro RAS completo
              if (novaListaPresentes.length === 0) {
                historicoRAS.splice(rasIndex, 1);
              }
              
              // Salvar no localStorage
              localStorage.setItem('historicoRAS', JSON.stringify(historicoRAS));
              
              // Recarregar a exibiÃ§Ã£o
              carregarFrequenciaDia(dataAtual);
            }
          }
          
          // Limpar toda a RAS do dia
          function limparFrequenciaDia() {
            if (!confirm('Tem certeza que deseja limpar TODA a RAS do dia? Esta aÃ§Ã£o nÃ£o pode ser desfeita e removerÃ¡ completamente os dados da reuniÃ£o.')) {
              return;
            }
            
            var dataAtual = document.getElementById('data-resumo').textContent;
            
            // Buscar o RAS do dia
            var rasIndex = historicoRAS.findIndex(function(ras) {
              return ras.data === dataAtual;
            });
            
            if (rasIndex !== -1) {
              // Remover o registro completo do dia
              historicoRAS.splice(rasIndex, 1);
              
              // Salvar no localStorage
              localStorage.setItem('historicoRAS', JSON.stringify(historicoRAS));
              
              // Recarregar a exibiÃ§Ã£o
              carregarFrequenciaDia(dataAtual);
              
              alert('RAS do dia removida com sucesso!');
            } else {
              alert('NÃ£o hÃ¡ RAS registrada para este dia.');
            }
          }

          // Inicializar CPT
          function inicializarCPT() {
            var hoje = new Date();
            var dataHoje = hoje.getFullYear() + '-' + 
                     (hoje.getMonth() + 1).toString().padStart(2, '0') + '-' + 
                     hoje.getDate().toString().padStart(2, '0');
            var horaAtual = hoje.getHours().toString().padStart(2, '0') + ':' + 
                    hoje.getMinutes().toString().padStart(2, '0');
            
            document.getElementById('cpt-data').value = dataHoje;
            document.getElementById('cpt-hora').value = horaAtual;
            document.getElementById('cpt-status').value = 'Em Aberto';
            
            // Limpar formulÃ¡rio
            document.getElementById('form-cpt').reset();
            document.getElementById('cpt-data').value = dataHoje;
            document.getElementById('cpt-hora').value = horaAtual;
            document.getElementById('cpt-status').value = 'Em Aberto';
          }
          
          // Adicionar participante Ã  CPT
          function adicionarParticipanteCPT() {
            var container = document.getElementById('lista-participantes-cpt');
            var novaLinha = document.createElement('div');
            novaLinha.style.cssText = 'display:grid;grid-template-columns:1fr 120px 40px;gap:12px;margin-bottom:12px;align-items:center';
            novaLinha.innerHTML = 
              '<input type="text" placeholder="Nome do participante" style="padding:8px;border:1px solid #d1d5db;border-radius:4px;font-size:0.9rem">' +
              '<input type="text" placeholder="MatrÃ­cula" style="padding:8px;border:1px solid #d1d5db;border-radius:4px;font-size:0.9rem">' +
              '<button type="button" onclick="removerParticipanteCPT(this)" style="background:#ef4444;color:#fff;border:none;border-radius:4px;padding:6px;cursor:pointer;font-size:0.8rem"></button>';
            container.appendChild(novaLinha);
          }
          
          // Remover participante da CPT
          function removerParticipanteCPT(botao) {
            botao.parentElement.remove();
          }
          
          // Anexar CPT PDF
          function anexarCPTPDF() {
            var input = document.createElement('input');
            input.type = 'file';
            input.accept = '.pdf';
            input.onchange = function(e) {
              var file = e.target.files[0];
              if (file) {
                alert('Arquivo ' + file.name + ' anexado com sucesso!');
                // Aqui seria implementado o upload real do arquivo
              }
            };
            input.click();
          }
          
          // Cancelar CPT
          function cancelarCPT() {
            if (confirm('Deseja cancelar? Todos os dados serÃ£o perdidos.')) {
              document.getElementById('form-cpt').reset();
              inicializarCPT();
            }
          }
          
          // Salvar CPT
          document.getElementById('form-cpt').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Coletar dados do formulÃ¡rio
            var participantes = [];
            var linhasParticipantes = document.querySelectorAll('#lista-participantes-cpt > div');
            linhasParticipantes.forEach(function(linha) {
              var inputs = linha.querySelectorAll('input');
              if (inputs.length >= 2 && inputs[0].value.trim() && inputs[1].value.trim()) {
                participantes.push({
                  nome: inputs[0].value.trim(),
                  matricula: inputs[1].value.trim()
                });
              }
            });
            
            var cpt = {
              id: Date.now(),
              empresa: document.getElementById('cpt-empresa').value,
              data: document.getElementById('cpt-data').value,
              hora: document.getElementById('cpt-hora').value,
              lider: document.getElementById('cpt-lider').value,
              area: document.getElementById('cpt-area').value,
              local: document.getElementById('cpt-local').value,
              descricao: document.getElementById('cpt-descricao').value,
              executantes: document.getElementById('cpt-executantes').value,
              participantes: participantes,
              status: document.getElementById('cpt-status').value,
              dataFechamento: document.getElementById('cpt-data-fechamento').value,
              dataCriacao: new Date().toISOString()
            };
            
            // Adicionar Ã  lista
            cpts.push(cpt);
            localStorage.setItem('cpts', JSON.stringify(cpts));
            
            alert('CPT salva com sucesso!');
            
            // Limpar formulÃ¡rio
            inicializarCPT();
          });
          
          // Habilitar/desabilitar data de fechamento baseado no status
          document.getElementById('cpt-status').addEventListener('change', function() {
            var dataFechamento = document.getElementById('cpt-data-fechamento');
            if (this.value === 'Fechado') {
              dataFechamento.required = true;
              dataFechamento.style.backgroundColor = '#fef3c7';
              if (!dataFechamento.value) {
                var hoje = new Date();
                var dataHoje = hoje.getFullYear() + '-' + 
                         (hoje.getMonth() + 1).toString().padStart(2, '0') + '-' + 
                         hoje.getDate().toString().padStart(2, '0');
                dataFechamento.value = dataHoje;
              }
            } else {
              dataFechamento.required = false;
              dataFechamento.style.backgroundColor = '#fff';
              dataFechamento.value = '';
            }
          });
          
          // SISTEMA DE INSPEÃ‡ÃƒO DE HSE
          
          // Array para armazenar inspeÃ§Ãµes
          var inspecoes = JSON.parse(localStorage.getItem('inspecoes')) || [];
          
          // Inicializar sistema de inspeÃ§Ã£o
          function inicializarInspecao() {
            // Adicionar dados de exemplo se nÃ£o houver inspeÃ§Ãµes
            if (inspecoes.length === 0) {
              var inspecaoExemplo = {
                id: Date.now(),
                data: '2025-11-09',
                area: 'BAP 1B',
                local: 'Ferragem',
                tipo: 'Inspeção de HSE',
                semana: '45',
                descricao: 'Tampa da canaleta fora de posiÃ§Ã£o',
                acoes: 'Reposicionamento da tampa e sinalizaÃ§Ã£o adequada',
                categoria: 'Ferramentas manuais',
                classificacao: 'Categorias de riscos',
                severidade: 'Baixa',
                risco: 'Ferramentas inadequadas',
                controlavel: 'Sim',
                interdicao: 'NÃ£o',
                emissor: 'Sistema',
                responsavel: 'Adelson',
                prazo: '2025-11-15',
                conclusao: '',
                status: 'CONCLUÃDO',
                fotoAntes: null,
                fotoDepois: null,
                dataCriacao: new Date().toISOString()
              };
              inspecoes.push(inspecaoExemplo);
              localStorage.setItem('inspecoes', JSON.stringify(inspecoes));
            }
            
            carregarInspecoes();
            configurarSemanaAtual();
            carregarCategoriasDropdown();
            carregarClassificacoesDropdown();
            carregarAreasDropdown();
            carregarLocaisDropdown();
          }
          
          // Configurar semana atual
          function configurarSemanaAtual() {
            var hoje = new Date();
            var primeiroDia = new Date(hoje.getFullYear(), 0, 1);
            var diasPassados = Math.floor((hoje - primeiroDia) / (24 * 60 * 60 * 1000));
            var semanaAtual = Math.ceil((diasPassados + primeiroDia.getDay() + 1) / 7);
            
            var inputSemana = document.getElementById('insp-semana');
            if (inputSemana) {
              inputSemana.value = semanaAtual;
            }
          }
          
          // Carregar categorias no dropdown
          function carregarCategoriasDropdown() {
            var selectCategoria = document.getElementById('insp-categoria');
            if (!selectCategoria) return;
            
            // Limpar opÃ§Ãµes existentes (manter primeira opÃ§Ã£o vazia)
            selectCategoria.innerHTML = '<option value=""></option>';
            
            // Buscar categorias cadastradas
            var categoriasHSE = JSON.parse(localStorage.getItem('categoriasHSE')) || [];
            
            // Adicionar cada categoria ao dropdown
            categoriasHSE.forEach(function(categoria) {
              var option = document.createElement('option');
              option.value = categoria.nome;
              option.textContent = categoria.nome;
              selectCategoria.appendChild(option);
            });
            
            // Event listener para atualizar classificaÃ§Ãµes quando categoria muda
            selectCategoria.addEventListener('change', function() {
              carregarClassificacoesPorCategoria(this.value);
            });
          }
          
          // Carregar classificaÃ§Ãµes no dropdown
          function carregarClassificacoesDropdown() {
            var selectClassificacao = document.getElementById('insp-classificacao');
            if (!selectClassificacao) return;
            
            // Limpar opÃ§Ãµes existentes (manter primeira opÃ§Ã£o vazia)
            selectClassificacao.innerHTML = '<option value=""></option>';
            
            // Buscar todas as classificaÃ§Ãµes cadastradas
            var categoriasHSE = JSON.parse(localStorage.getItem('categoriasHSE')) || [];
            var todasClassificacoes = [];
            
            // Coletar todas as classificaÃ§Ãµes Ãºnicas
            categoriasHSE.forEach(function(categoria) {
              if (categoria.classificacoes && categoria.classificacoes.length > 0) {
                categoria.classificacoes.forEach(function(classif) {
                  if (todasClassificacoes.indexOf(classif) === -1) {
                    todasClassificacoes.push(classif);
                  }
                });
              }
              // Compatibilidade com dados antigos (subcategorias)
              if (categoria.subcategorias && categoria.subcategorias.length > 0 && !categoria.classificacoes) {
                categoria.subcategorias.forEach(function(sub) {
                  if (todasClassificacoes.indexOf(sub) === -1) {
                    todasClassificacoes.push(sub);
                  }
                });
              }
            });
            
            // Ordenar alfabeticamente
            todasClassificacoes.sort();
            
            // Adicionar cada classificaÃ§Ã£o ao dropdown
            todasClassificacoes.forEach(function(classificacao) {
              var option = document.createElement('option');
              option.value = classificacao;
              option.textContent = classificacao;
              selectClassificacao.appendChild(option);
            });
          }
          
          // Carregar classificaÃ§Ãµes filtradas por categoria
          function carregarClassificacoesPorCategoria(nomeCategoria) {
            var selectClassificacao = document.getElementById('insp-classificacao');
            if (!selectClassificacao) return;
            
            // Limpar opÃ§Ãµes existentes (manter primeira opÃ§Ã£o vazia)
            selectClassificacao.innerHTML = '<option value=""></option>';
            
            if (!nomeCategoria) {
              // Se nenhuma categoria selecionada, carregar todas as classificaÃ§Ãµes
              carregarClassificacoesDropdown();
              return;
            }
            
            // Buscar a categoria especÃ­fica
            var categoriasHSE = JSON.parse(localStorage.getItem('categoriasHSE')) || [];
            var categoriaEncontrada = categoriasHSE.find(function(cat) {
              return cat.nome === nomeCategoria;
            });
            
            if (!categoriaEncontrada) return;
            
            var classificacoes = categoriaEncontrada.classificacoes || categoriaEncontrada.subcategorias || [];
            
            // Ordenar alfabeticamente
            classificacoes.sort();
            
            // Adicionar cada classificaÃ§Ã£o ao dropdown
            classificacoes.forEach(function(classificacao) {
              var option = document.createElement('option');
              option.value = classificacao;
              option.textContent = classificacao;
              selectClassificacao.appendChild(option);
            });
          }
          
          // Carregar Ã¡reas no dropdown
          function carregarAreasDropdown() {
            var selectArea = document.getElementById('insp-area');
            if (!selectArea) return;
            
            // Limpar opÃ§Ãµes existentes (manter primeira opÃ§Ã£o vazia)
            selectArea.innerHTML = '<option value=""></option>';
            
            // Buscar Ã¡reas cadastradas
            var areasLocais = JSON.parse(localStorage.getItem('areasLocais')) || [];
            
            // Coletar Ã¡reas Ãºnicas
            var areasUnicas = [];
            areasLocais.forEach(function(area) {
              if (areasUnicas.indexOf(area.nome) === -1) {
                areasUnicas.push(area.nome);
              }
            });
            
            // Ordenar alfabeticamente
            areasUnicas.sort();
            
            // Adicionar cada Ã¡rea ao dropdown
            areasUnicas.forEach(function(nomeArea) {
              var option = document.createElement('option');
              option.value = nomeArea;
              option.textContent = nomeArea;
              selectArea.appendChild(option);
            });
            
            // Event listener para atualizar locais quando Ã¡rea muda
            selectArea.addEventListener('change', function() {
              carregarLocaisPorArea(this.value);
            });
          }
          
          // Carregar locais no dropdown
          function carregarLocaisDropdown() {
            var selectLocal = document.getElementById('insp-local');
            if (!selectLocal) return;
            
            // Limpar opÃ§Ãµes existentes (manter primeira opÃ§Ã£o vazia)
            selectLocal.innerHTML = '<option value=""></option>';
            
            // Buscar todas as Ã¡reas/locais cadastradas
            var areasLocais = JSON.parse(localStorage.getItem('areasLocais')) || [];
            
            // Coletar todos os locais Ãºnicos
            var locaisUnicos = [];
            areasLocais.forEach(function(area) {
              if (locaisUnicos.indexOf(area.local) === -1) {
                locaisUnicos.push(area.local);
              }
            });
            
            // Ordenar alfabeticamente
            locaisUnicos.sort();
            
            // Adicionar cada local ao dropdown
            locaisUnicos.forEach(function(local) {
              var option = document.createElement('option');
              option.value = local;
              option.textContent = local;
              selectLocal.appendChild(option);
            });
          }
          
          // Carregar locais filtrados por Ã¡rea
          function carregarLocaisPorArea(nomeArea) {
            var selectLocal = document.getElementById('insp-local');
            if (!selectLocal) return;
            
            // Limpar opÃ§Ãµes existentes (manter primeira opÃ§Ã£o vazia)
            selectLocal.innerHTML = '<option value=""></option>';
            
            if (!nomeArea) {
              // Se nenhuma Ã¡rea selecionada, carregar todos os locais
              carregarLocaisDropdown();
              return;
            }
            
            // Buscar locais da Ã¡rea especÃ­fica
            var areasLocais = JSON.parse(localStorage.getItem('areasLocais')) || [];
            var locaisDaArea = areasLocais.filter(function(area) {
              return area.nome === nomeArea;
            }).map(function(area) {
              return area.local;
            });
            
            // Remover duplicatas e ordenar
            var locaisUnicos = locaisDaArea.filter(function(item, index) {
              return locaisDaArea.indexOf(item) === index;
            }).sort();
            
            // Adicionar cada local ao dropdown
            locaisUnicos.forEach(function(local) {
              var option = document.createElement('option');
              option.value = local;
              option.textContent = local;
              selectLocal.appendChild(option);
            });
          }
          
          // Carregar tipos de registro no dropdown
          function carregarTiposRegistroDropdown() {
            var selectTipo = document.getElementById('insp-tipo');
            if (!selectTipo) return;
            
            // Limpar opÃ§Ãµes existentes (manter primeira opÃ§Ã£o vazia)
            selectTipo.innerHTML = '<option value="">Selecione o tipo de registro...</option>';
            
            // Buscar tipos de registro cadastrados
            var tiposRegistro = JSON.parse(localStorage.getItem('tiposRegistro')) || [];
            
            // Filtrar apenas os tipos ativos
            var tiposAtivos = tiposRegistro.filter(function(tipo) {
              return tipo.status === 'ativo';
            });
            
            // Ordenar alfabeticamente
            tiposAtivos.sort(function(a, b) {
              return a.nome.localeCompare(b.nome);
            });
            
            // Adicionar cada tipo ao dropdown
            tiposAtivos.forEach(function(tipo) {
              var option = document.createElement('option');
              option.value = tipo.nome;
              option.textContent = tipo.nome + (tipo.codigo ? ' (' + tipo.codigo + ')' : '');
              selectTipo.appendChild(option);
            });
          }
          
          // Carregar riscos/perigos no dropdown
          function carregarRiscosPerigosDropdown() {
            var selectRisco = document.getElementById('insp-risco');
            if (!selectRisco) return;
            
            // Limpar opÃ§Ãµes existentes (manter primeira opÃ§Ã£o vazia)
            selectRisco.innerHTML = '<option value="">Selecione o risco/perigo...</option>';
            
            // Buscar riscos/perigos cadastrados
            var riscosPerigos = JSON.parse(localStorage.getItem('riscosPerigos')) || [];
            
            // Filtrar apenas os ativos
            var riscosAtivos = riscosPerigos.filter(function(item) {
              return item.status === 'ativo';
            });
            
            // Ordenar alfabeticamente
            riscosAtivos.sort(function(a, b) {
              return a.nome.localeCompare(b.nome);
            });
            
            // Adicionar cada risco/perigo ao dropdown
            riscosAtivos.forEach(function(item) {
              var option = document.createElement('option');
              option.value = item.nome;
              var tipoIcon = item.tipo === 'risco' ? '🚫' : '';
              var categoriaText = item.categoria ? ' - ' + item.categoria.charAt(0).toUpperCase() + item.categoria.slice(1) : '';
              option.textContent = tipoIcon + ' ' + item.nome + categoriaText;
              selectRisco.appendChild(option);
            });
          }
          
          // Abrir modal nova inspeÃ§Ã£o
          document.getElementById('btn-nova-inspecao').addEventListener('click', abrirModalNovaInspecao);
          
          function abrirModalNovaInspecao() {
            document.getElementById('modal-nova-inspecao').style.display = 'flex';
            
            // Configurar data atual
            var hoje = new Date();
            var dataHoje = hoje.getFullYear() + '-' + 
                     (hoje.getMonth() + 1).toString().padStart(2, '0') + '-' + 
                     hoje.getDate().toString().padStart(2, '0');
            document.getElementById('insp-data').value = dataHoje;
            
            configurarSemanaAtual();
            
            // Carregar dropdowns com dados atualizados
            carregarCategoriasDropdown();
            carregarClassificacoesDropdown();
            carregarAreasDropdown();
            carregarTiposRegistroDropdown();
            carregarRiscosPerigosDropdown();
            carregarLocaisDropdown();
          }
          
          // Fechar modal de inspeÃ§Ã£o
          function fecharModalInspecao() {
            document.getElementById('modal-nova-inspecao').style.display = 'none';
            document.getElementById('form-nova-inspecao').reset();
            document.getElementById('preview-foto-antes').style.display = 'none';
            document.getElementById('preview-foto-depois').style.display = 'none';
          }
          
          // Upload de foto antes com preview
          document.getElementById('insp-foto-antes').addEventListener('change', function(e) {
            var file = e.target.files[0];
            var preview = document.getElementById('preview-foto-antes');
            
            if (file && file.type.startsWith('image/')) {
              var url = URL.createObjectURL(file);
              preview.innerHTML = '<img src="' + url + '" style="width:100%;max-width:150px;height:100px;object-fit:cover;border-radius:6px;border:1px solid #e5e7eb">';
              preview.style.display = 'block';
            } else {
              preview.style.display = 'none';
            }
          });
          
          // Upload de foto depois com preview
          document.getElementById('insp-foto-depois').addEventListener('change', function(e) {
            var file = e.target.files[0];
            var preview = document.getElementById('preview-foto-depois');
            
            if (file && file.type.startsWith('image/')) {
              var url = URL.createObjectURL(file);
              preview.innerHTML = '<img src="' + url + '" style="width:100%;max-width:150px;height:100px;object-fit:cover;border-radius:6px;border:1px solid #e5e7eb">';
              preview.style.display = 'block';
            } else {
              preview.style.display = 'none';
            }
          });
          
          // Salvar nova inspeÃ§Ã£o
          document.getElementById('form-nova-inspecao').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Processar fotos
            var fotoAntesFile = document.getElementById('insp-foto-antes').files[0];
            var fotoDepoisFile = document.getElementById('insp-foto-depois').files[0];
            
            var novaInspecao = {
              id: Date.now(),
              data: document.getElementById('insp-data').value,
              area: document.getElementById('insp-area').value,
              local: document.getElementById('insp-local').value,
              tipo: document.getElementById('insp-tipo').value,
              semana: document.getElementById('insp-semana').value,
              descricao: document.getElementById('insp-descricao').value,
              acoes: document.getElementById('insp-acoes').value,
              categoria: document.getElementById('insp-categoria').value,
              classificacao: document.getElementById('insp-classificacao').value,
              severidade: document.getElementById('insp-severidade').value,
              risco: document.getElementById('insp-risco').value,
              controlavel: document.getElementById('insp-controlavel').value,
              interdicao: document.getElementById('insp-interdicao').value,
              emissor: document.getElementById('insp-emissor').value,
              responsavel: document.getElementById('insp-responsavel').value,
              prazo: document.getElementById('insp-prazo').value,
              conclusao: document.getElementById('insp-conclusao').value,
              status: document.getElementById('insp-status').value,
              fotoAntes: null,
              fotoDepois: null,
              dataCriacao: new Date().toISOString()
            };

            // FunÃ§Ã£o para processar fotos e salvar
            function processarFotos() {
              var fotosProcessadas = 0;
              var totalFotos = (fotoAntesFile ? 1 : 0) + (fotoDepoisFile ? 1 : 0);
              
              if (totalFotos === 0) {
                // NÃ£o hÃ¡ fotos, salvar direto
                finalizarSalvamento();
                return;
              }
              
              if (fotoAntesFile) {
                var readerAntes = new FileReader();
                readerAntes.onload = function(e) {
                  novaInspecao.fotoAntes = e.target.result;
                  fotosProcessadas++;
                  if (fotosProcessadas === totalFotos) {
                    finalizarSalvamento();
                  }
                };
                readerAntes.readAsDataURL(fotoAntesFile);
              }
              
              if (fotoDepoisFile) {
                var readerDepois = new FileReader();
                readerDepois.onload = function(e) {
                  novaInspecao.fotoDepois = e.target.result;
                  fotosProcessadas++;
                  if (fotosProcessadas === totalFotos) {
                    finalizarSalvamento();
                  }
                };
                readerDepois.readAsDataURL(fotoDepoisFile);
              }
            }
            
            function finalizarSalvamento() {
              inspecoes.push(novaInspecao);
              localStorage.setItem('inspecoes', JSON.stringify(inspecoes));
              
              alert('Inspeção registrada com sucesso!');
              fecharModalInspecao();
              carregarInspecoes();
            }
            
            processarFotos();
          });

          // Salvar ediÃ§Ã£o da inspeÃ§Ã£o
          document.getElementById('form-editar-inspecao').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!inspecaoEditandoId) {
              alert('Erro: ID da inspeÃ§Ã£o nÃ£o encontrado!');
              return;
            }

            // Processar fotos
            var fotoAntesFile = document.getElementById('edit-insp-foto-antes').files[0];
            var fotoDepoisFile = document.getElementById('edit-insp-foto-depois').files[0];
            
            // Encontrar inspeÃ§Ã£o existente
            var inspecaoIndex = inspecoes.findIndex(function(insp) { return insp.id == inspecaoEditandoId; });
            if (inspecaoIndex === -1) {
              alert('Inspeção nÃ£o encontrada!');
              return;
            }

            // Manter fotos existentes se nÃ£o foram alteradas
            var inspecaoExistente = inspecoes[inspecaoIndex];
            
            var inspecaoAtualizada = {
              id: inspecaoEditandoId,
              data: document.getElementById('edit-insp-data').value,
              area: document.getElementById('edit-insp-area').value,
              local: document.getElementById('edit-insp-local').value,
              tipo: document.getElementById('edit-insp-tipo').value,
              semana: document.getElementById('edit-insp-semana').value,
              descricao: document.getElementById('edit-insp-descricao').value,
              acoes: document.getElementById('edit-insp-acoes').value,
              categoria: document.getElementById('edit-insp-categoria').value,
              classificacao: document.getElementById('edit-insp-classificacao').value,
              severidade: document.getElementById('edit-insp-severidade').value,
              risco: document.getElementById('edit-insp-risco').value,
              controlavel: document.getElementById('edit-insp-controlavel').value,
              interdicao: document.getElementById('edit-insp-interdicao').value,
              emissor: document.getElementById('edit-insp-emissor').value,
              responsavel: document.getElementById('edit-insp-responsavel').value,
              prazo: document.getElementById('edit-insp-prazo').value,
              conclusao: document.getElementById('edit-insp-conclusao').value,
              status: document.getElementById('edit-insp-status').value,
              fotoAntes: inspecaoExistente.fotoAntes, // Manter foto existente inicialmente
              fotoDepois: inspecaoExistente.fotoDepois, // Manter foto existente inicialmente
              dataCriacao: inspecaoExistente.dataCriacao,
              dataAtualizacao: new Date().toISOString()
            };

            // FunÃ§Ã£o para processar fotos da ediÃ§Ã£o
            function processarFotosEdicao() {
              var fotosProcessadas = 0;
              var totalFotos = (fotoAntesFile ? 1 : 0) + (fotoDepoisFile ? 1 : 0);
              
              if (totalFotos === 0) {
                // NÃ£o hÃ¡ fotos novas, finalizar com fotos existentes
                finalizarEdicao();
                return;
              }
              
              if (fotoAntesFile) {
                var readerAntes = new FileReader();
                readerAntes.onload = function(e) {
                  inspecaoAtualizada.fotoAntes = e.target.result;
                  fotosProcessadas++;
                  if (fotosProcessadas === totalFotos) {
                    finalizarEdicao();
                  }
                };
                readerAntes.readAsDataURL(fotoAntesFile);
              }
              
              if (fotoDepoisFile) {
                var readerDepois = new FileReader();
                readerDepois.onload = function(e) {
                  inspecaoAtualizada.fotoDepois = e.target.result;
                  fotosProcessadas++;
                  if (fotosProcessadas === totalFotos) {
                    finalizarEdicao();
                  }
                };
                readerDepois.readAsDataURL(fotoDepoisFile);
              }
            }
            
            function finalizarEdicao() {
              inspecoes[inspecaoIndex] = inspecaoAtualizada;
              localStorage.setItem('inspecoes', JSON.stringify(inspecoes));
              
              alert('Inspeção atualizada com sucesso!');
              fecharModalEditarInspecao();
              carregarInspecoes();
            }
            
            processarFotosEdicao();
          });

          // Preview das fotos no modal de ediÃ§Ã£o
          document.getElementById('edit-insp-foto-antes').addEventListener('change', function(e) {
            var file = e.target.files[0];
            if (file) {
              var reader = new FileReader();
              reader.onload = function(e) {
                document.getElementById('edit-preview-foto-antes').innerHTML = '<img src="' + e.target.result + '" style="width:100px;height:100px;object-fit:cover;border-radius:6px;border:1px solid #e5e7eb"><br><small style="color:#6b7280">Nova foto</small>';
              };
              reader.readAsDataURL(file);
            }
          });

          document.getElementById('edit-insp-foto-depois').addEventListener('change', function(e) {
            var file = e.target.files[0];
            if (file) {
              var reader = new FileReader();
              reader.onload = function(e) {
                document.getElementById('edit-preview-foto-depois').innerHTML = '<img src="' + e.target.result + '" style="width:100px;height:100px;object-fit:cover;border-radius:6px;border:1px solid #e5e7eb"><br><small style="color:#6b7280">Nova foto</small>';
              };
              reader.readAsDataURL(file);
            }
          });
          
          // Carregar e exibir inspeÃ§Ãµes
          function carregarInspecoes() {
            var lista = document.getElementById('lista-inspecoes');
            
            if (inspecoes.length === 0) {
              lista.innerHTML = '<div style="padding:40px;text-align:center;color:#9ca3af;font-style:italic">Nenhuma inspeÃ§Ã£o cadastrada</div>';
              return;
            }
            
            var html = '';
            inspecoes.forEach(function(inspecao) {
              var dataFormatada = formatarData(inspecao.data);
              var corSeveridade = getCorSeveridade(inspecao.severidade);
              var corStatus = getCorStatus(inspecao.status);
              
              html += '<div style="padding:12px 16px;border-bottom:1px solid #f3f4f6;display:grid;grid-template-columns:100px 80px 100px 80px 80px 120px 100px 100px 140px 100px 100px 140px;gap:8px;align-items:center;font-size:0.8rem">';
              html += '<div style="color:#374151;font-weight:500">' + dataFormatada + '</div>';
              html += '<div style="color:#374151">' + (inspecao.area || '') + '</div>';
              html += '<div style="color:#6b7280">' + (inspecao.local || '') + '</div>';
              html += '<div style="color:#6b7280">' + (inspecao.tipo || '') + '</div>';
              html += '<div style="color:#6b7280">' + (inspecao.semana || '') + '</div>';
              html += '<div style="color:#6b7280">' + (inspecao.categoria || '') + '</div>';
              html += '<div><span style="background:' + corSeveridade + ';color:#fff;padding:2px 8px;border-radius:12px;font-size:0.75rem">' + (inspecao.severidade || '') + '</span></div>';
              html += '<div><span style="color:' + (inspecao.interdicao === 'Sim' ? '#ef4444' : '#10b981') + ';font-weight:600">' + (inspecao.interdicao || 'NÃ£o') + '</span></div>';
              html += '<div style="color:#6b7280">' + (inspecao.responsavel || '') + '</div>';
              html += '<div><span style="background:' + corStatus + ';color:#fff;padding:2px 8px;border-radius:12px;font-size:0.75rem">' + (inspecao.status || '') + '</span></div>';
              html += '<div>';
              var totalFotos = 0;
              if (inspecao.fotoAntes) totalFotos++;
              if (inspecao.fotoDepois) totalFotos++;
              
              if (totalFotos > 0) {
                html += '<button onclick="mostrarFotosInspecao(\'' + inspecao.id + '\')" style="background:#3b82f6;color:#fff;border:none;border-radius:4px;padding:4px 8px;font-size:0.75rem;cursor:pointer" title="Ver e baixar fotos"> ' + totalFotos + ' Foto' + (totalFotos > 1 ? 's' : '') + '</button>';
              } else {
                html += '<span style="color:#9ca3af;font-size:0.75rem">Sem fotos</span>';
              }
              html += '</div>';
              html += '<div style="display:flex;gap:4px">';
              html += '<button onclick="mostrarRelatorioInspecao(\'' + inspecao.id + '\')" style="background:#8b5cf6;color:#fff;border:none;border-radius:4px;padding:4px 6px;font-size:0.7rem;cursor:pointer" title="Ver Relatório"></button>';
              html += '<button onclick="editarInspecao(\'' + inspecao.id + '\')" style="background:#f59e0b;color:#fff;border:none;border-radius:4px;padding:4px 6px;font-size:0.7rem;cursor:pointer"></button>';
              html += '<button onclick="excluirInspecao(\'' + inspecao.id + '\')" style="background:#ef4444;color:#fff;border:none;border-radius:4px;padding:4px 6px;font-size:0.7rem;cursor:pointer"></button>';
              html += '</div>';
              html += '</div>';
            });
            
            lista.innerHTML = html;
          }
          
          // FunÃ§Ãµes auxiliares
          function formatarData(data) {
            var partes = data.split('-');
            return partes[2] + '/' + partes[1] + '/' + partes[0];
          }
          
          function getCorSeveridade(severidade) {
            switch(severidade) {
              case 'Baixa': return '#10b981';
              case 'MÃ©dia': return '#f59e0b';
              case 'Alta': return '#ef4444';
              case 'CrÃ­tica': return '#dc2626';
              default: return '#6b7280';
            }
          }
          
          function getCorStatus(status) {
            switch(status) {
              case 'CONCLUÃDO': return '#10b981';
              case 'EM ANDAMENTO': return '#f59e0b';
              case 'PENDENTE': return '#ef4444';
              default: return '#6b7280';
            }
          }
          
          // VariÃ¡vel global para armazenar ID da inspeÃ§Ã£o sendo editada
          var inspecaoEditandoId = null;

          // FunÃ§Ã£o para editar inspeÃ§Ã£o
          function editarInspecao(id) {
            var inspecao = inspecoes.find(function(insp) { return insp.id == id; });
            
            if (!inspecao) {
              alert('Inspeção nÃ£o encontrada!');
              return;
            }

            inspecaoEditandoId = id;

            // Preencher o formulÃ¡rio com os dados existentes
            document.getElementById('edit-insp-data').value = inspecao.data || '';
            document.getElementById('edit-insp-area').value = inspecao.area || '';
            document.getElementById('edit-insp-local').value = inspecao.local || '';
            document.getElementById('edit-insp-tipo').value = inspecao.tipo || '';
            document.getElementById('edit-insp-semana').value = inspecao.semana || '';
            document.getElementById('edit-insp-descricao').value = inspecao.descricao || '';
            document.getElementById('edit-insp-acoes').value = inspecao.acoes || '';
            document.getElementById('edit-insp-categoria').value = inspecao.categoria || '';
            document.getElementById('edit-insp-classificacao').value = inspecao.classificacao || '';
            document.getElementById('edit-insp-severidade').value = inspecao.severidade || '';
            document.getElementById('edit-insp-risco').value = inspecao.risco || '';
            document.getElementById('edit-insp-controlavel').value = inspecao.controlavel || '';
            document.getElementById('edit-insp-interdicao').value = inspecao.interdicao || '';
            document.getElementById('edit-insp-emissor').value = inspecao.emissor || '';
            document.getElementById('edit-insp-responsavel').value = inspecao.responsavel || '';
            document.getElementById('edit-insp-prazo').value = inspecao.prazo || '';
            document.getElementById('edit-insp-conclusao').value = inspecao.conclusao || '';
            document.getElementById('edit-insp-status').value = inspecao.status || '';

            // Carregar opÃ§Ãµes dos selects
            carregarOpcoesEditarInspecao();

            // Mostrar fotos existentes se houver
            if (inspecao.fotoAntes) {
              document.getElementById('edit-preview-foto-antes').innerHTML = '<img src="' + inspecao.fotoAntes + '" style="width:100px;height:100px;object-fit:cover;border-radius:6px;border:1px solid #e5e7eb"><br><small style="color:#6b7280">Foto atual</small>';
            }

            if (inspecao.fotoDepois) {
              document.getElementById('edit-preview-foto-depois').innerHTML = '<img src="' + inspecao.fotoDepois + '" style="width:100px;height:100px;object-fit:cover;border-radius:6px;border:1px solid #e5e7eb"><br><small style="color:#6b7280">Foto atual</small>';
            }

            // Abrir modal
            document.getElementById('modal-editar-inspecao').style.display = 'flex';
          }

          function carregarOpcoesEditarInspecao() {
            // Carregar Ã¡reas do localStorage
            var areasLocaisData = JSON.parse(localStorage.getItem('areasLocais')) || [];
            var selectArea = document.getElementById('edit-insp-area');
            if (selectArea) {
              selectArea.innerHTML = '<option value="">Selecione a Ã¡rea...</option>';
              var areasUnicas = [];
              areasLocaisData.forEach(function(area) {
                if (areasUnicas.indexOf(area.nome) === -1) {
                  areasUnicas.push(area.nome);
                }
              });
              areasUnicas.sort();
              areasUnicas.forEach(function(nomeArea) {
                var option = document.createElement('option');
                option.value = nomeArea;
                option.textContent = nomeArea;
                selectArea.appendChild(option);
              });
            }

            // Carregar locais do localStorage
            var selectLocal = document.getElementById('edit-insp-local');
            if (selectLocal) {
              selectLocal.innerHTML = '<option value="">Selecione o local...</option>';
              var locaisUnicos = [];
              areasLocaisData.forEach(function(area) {
                if (locaisUnicos.indexOf(area.local) === -1) {
                  locaisUnicos.push(area.local);
                }
              });
              locaisUnicos.sort();
              locaisUnicos.forEach(function(local) {
                var option = document.createElement('option');
                option.value = local;
                option.textContent = local;
                selectLocal.appendChild(option);
              });
            }

            // Carregar tipos de registro do localStorage
            var tiposRegistroData = JSON.parse(localStorage.getItem('tiposRegistro')) || [];
            var selectTipo = document.getElementById('edit-insp-tipo');
            if (selectTipo) {
              selectTipo.innerHTML = '<option value="">Selecione o tipo de registro...</option>';
              tiposRegistroData.filter(function(tipo) { return tipo.status === 'ativo'; }).forEach(function(tipo) {
                var option = document.createElement('option');
                option.value = tipo.nome;
                option.textContent = tipo.nome;
                selectTipo.appendChild(option);
              });
            }

            // Carregar categorias do localStorage
            var categoriasHSEData = JSON.parse(localStorage.getItem('categoriasHSE')) || [];
            var selectCategoria = document.getElementById('edit-insp-categoria');
            if (selectCategoria) {
              selectCategoria.innerHTML = '<option value="">Selecione a categoria...</option>';
              categoriasHSEData.forEach(function(categoria) {
                var option = document.createElement('option');
                option.value = categoria.nome;
                option.textContent = categoria.nome;
                selectCategoria.appendChild(option);
              });
            }

            // Carregar riscos/perigos do localStorage
            var riscosPerigosData = JSON.parse(localStorage.getItem('riscosPerigos')) || [];
            var selectRisco = document.getElementById('edit-insp-risco');
            if (selectRisco) {
              selectRisco.innerHTML = '<option value="">Selecione o risco/perigo...</option>';
              riscosPerigosData.filter(function(risco) { return risco.status === 'ativo'; }).forEach(function(risco) {
                var option = document.createElement('option');
                option.value = risco.nome;
                option.textContent = risco.nome;
                selectRisco.appendChild(option);
              });
            }
          }

          function fecharModalEditarInspecao() {
            document.getElementById('modal-editar-inspecao').style.display = 'none';
            document.getElementById('form-editar-inspecao').reset();
            document.getElementById('edit-preview-foto-antes').innerHTML = '';
            document.getElementById('edit-preview-foto-depois').innerHTML = '';
            inspecaoEditandoId = null;
          }
          
          function excluirInspecao(id) {
            if (confirm('Deseja realmente excluir esta inspeÃ§Ã£o?')) {
              inspecoes = inspecoes.filter(function(insp) { return insp.id != id; });
              localStorage.setItem('inspecoes', JSON.stringify(inspecoes));
              carregarInspecoes();
              alert('Inspeção excluÃ­da com sucesso!');
            }
          }

          // FunÃ§Ãµes do Modal de Relatório
          function mostrarRelatorioInspecao(id) {
            var inspecao = inspecoes.find(function(insp) { return insp.id == id; });
            if (!inspecao) {
              alert('Inspeção nÃ£o encontrada!');
              return;
            }

            var html = '';
            
            // InformaÃ§Ãµes BÃ¡sicas
            html += '<div style="background:#f8fafc;border:1px solid #e5e7eb;border-radius:8px;padding:20px;margin-bottom:20px">';
            html += '<h3 style="margin:0 0 16px 0;color:#374151;font-size:1.2rem;font-weight:600;display:flex;align-items:center;gap:8px"> InformaÃ§Ãµes BÃ¡sicas</h3>';
            html += '<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px">';
            html += '<div><strong style="color:#6b7280">Data:</strong><br><span style="color:#374151">' + formatarData(inspecao.data) + '</span></div>';
            html += '<div><strong style="color:#6b7280">Ãrea:</strong><br><span style="color:#374151">' + (inspecao.area || 'NÃ£o informado') + '</span></div>';
            html += '<div><strong style="color:#6b7280">Local:</strong><br><span style="color:#374151">' + (inspecao.local || 'NÃ£o informado') + '</span></div>';
            html += '<div><strong style="color:#6b7280">Tipo:</strong><br><span style="color:#374151">' + (inspecao.tipo || 'NÃ£o informado') + '</span></div>';
            html += '<div><strong style="color:#6b7280">Semana:</strong><br><span style="color:#374151">' + (inspecao.semana || 'NÃ£o informado') + '</span></div>';
            html += '<div><strong style="color:#6b7280">Emissor:</strong><br><span style="color:#374151">' + (inspecao.emissor || 'NÃ£o informado') + '</span></div>';
            html += '<div><strong style="color:#6b7280">ResponsÃ¡vel:</strong><br><span style="color:#374151">' + (inspecao.responsavel || 'NÃ£o informado') + '</span></div>';
            if (inspecao.prazo) {
              html += '<div><strong style="color:#6b7280">Prazo:</strong><br><span style="color:#374151">' + formatarData(inspecao.prazo) + '</span></div>';
            }
            if (inspecao.conclusao) {
              html += '<div><strong style="color:#6b7280">Data ConclusÃ£o:</strong><br><span style="color:#374151">' + formatarData(inspecao.conclusao) + '</span></div>';
            }
            html += '</div>';
            html += '</div>';

            // Detalhes da Inspeção
            html += '<div style="background:#f8fafc;border:1px solid #e5e7eb;border-radius:8px;padding:20px;margin-bottom:20px">';
            html += '<h3 style="margin:0 0 16px 0;color:#374151;font-size:1.2rem;font-weight:600;display:flex;align-items:center;gap:8px"> Detalhes da Inspeção</h3>';
            html += '<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;margin-bottom:16px">';
            html += '<div><strong style="color:#6b7280">Categoria:</strong><br><span style="color:#374151">' + (inspecao.categoria || 'NÃ£o informado') + '</span></div>';
            if (inspecao.classificacao) {
              html += '<div><strong style="color:#6b7280">ClassificaÃ§Ã£o:</strong><br><span style="color:#374151">' + inspecao.classificacao + '</span></div>';
            }
            var corSeveridade = getCorSeveridade(inspecao.severidade);
            html += '<div><strong style="color:#6b7280">Severidade:</strong><br><span style="background:' + corSeveridade + ';color:#fff;padding:4px 12px;border-radius:16px;font-size:0.85rem;font-weight:500">' + (inspecao.severidade || 'NÃ£o informado') + '</span></div>';
            if (inspecao.risco) {
              html += '<div><strong style="color:#6b7280">Risco:</strong><br><span style="color:#374151">' + inspecao.risco + '</span></div>';
            }
            if (inspecao.controlavel) {
              html += '<div><strong style="color:#6b7280">ControlÃ¡vel:</strong><br><span style="color:' + (inspecao.controlavel === 'Sim' ? '#10b981' : '#ef4444') + ';font-weight:600">' + inspecao.controlavel + '</span></div>';
            }
            html += '<div><strong style="color:#6b7280">InterdiÃ§Ã£o:</strong><br><span style="color:' + (inspecao.interdicao === 'Sim' ? '#10b981' : '#ef4444') + ';font-weight:600">' + (inspecao.interdicao || 'NÃ£o informado') + '</span></div>';
            var corStatus = getCorStatus(inspecao.status);
            html += '<div><strong style="color:#6b7280">Status:</strong><br><span style="background:' + corStatus + ';color:#fff;padding:4px 12px;border-radius:16px;font-size:0.85rem;font-weight:500">' + (inspecao.status || 'NÃ£o informado') + '</span></div>';
            html += '</div>';
            
            if (inspecao.descricao) {
              html += '<div style="margin-top:16px">';
              html += '<strong style="color:#6b7280">DescriÃ§Ã£o:</strong>';
              html += '<div style="background:#fff;border:1px solid #e5e7eb;border-radius:6px;padding:12px;margin-top:8px;color:#374151">' + inspecao.descricao + '</div>';
              html += '</div>';
            }
            
            if (inspecao.acoes) {
              html += '<div style="margin-top:16px">';
              html += '<strong style="color:#6b7280">Ações Tomadas:</strong>';
              html += '<div style="background:#fff;border:1px solid #e5e7eb;border-radius:6px;padding:12px;margin-top:8px;color:#374151">' + inspecao.acoes + '</div>';
              html += '</div>';
            }
            html += '</div>';

            // Fotos
            if (inspecao.fotoAntes || inspecao.fotoDepois) {
              html += '<div style="background:#f8fafc;border:1px solid #e5e7eb;border-radius:8px;padding:20px;margin-bottom:20px">';
              html += '<h3 style="margin:0 0 16px 0;color:#374151;font-size:1.2rem;font-weight:600;display:flex;align-items:center;gap:8px"> Fotos da Inspeção</h3>';
              html += '<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px">';
              
              if (inspecao.fotoAntes) {
                html += '<div>';
                html += '<h4 style="margin:0 0 12px 0;color:#6b7280;font-size:1rem;font-weight:600"> Foto Antes</h4>';
                html += '<div style="border:2px solid #e5e7eb;border-radius:8px;overflow:hidden;background:#fff">';
                html += '<img src="' + inspecao.fotoAntes + '" style="width:100%;height:200px;object-fit:cover;cursor:pointer" onclick="abrirImagemModal(\'' + inspecao.fotoAntes + '\', \'Foto Antes\')">';
                html += '</div>';
                html += '</div>';
              }
              
              if (inspecao.fotoDepois) {
                html += '<div>';
                html += '<h4 style="margin:0 0 12px 0;color:#6b7280;font-size:1rem;font-weight:600"> Foto Depois</h4>';
                html += '<div style="border:2px solid #e5e7eb;border-radius:8px;overflow:hidden;background:#fff">';
                html += '<img src="' + inspecao.fotoDepois + '" style="width:100%;height:200px;object-fit:cover;cursor:pointer" onclick="abrirImagemModal(\'' + inspecao.fotoDepois + '\', \'Foto Depois\')">';
                html += '</div>';
                html += '</div>';
              }
              
              html += '</div>';
              html += '</div>';
            }

            // Atualizar conteÃºdo do modal
            document.getElementById('conteudo-relatorio').innerHTML = html;
            document.getElementById('modal-relatorio-inspecao').style.display = 'flex';
          }

          function fecharModalRelatorio() {
            document.getElementById('modal-relatorio-inspecao').style.display = 'none';
          }

          function imprimirRelatorio() {
            var conteudo = document.getElementById('conteudo-relatorio').innerHTML;
            var janelaImprimir = window.open('', '_blank');
            janelaImprimir.document.write(`
              <html>
                <head>
                  <title>Relatório de Inspeção HSE</title>
                  <style>
                    body { font-family: Arial, sans-serif; margin: 20px; color: #374151; }
                    h1 { color: #059669; border-bottom: 2px solid #059669; padding-bottom: 10px; }
                    h3 { color: #374151; margin-top: 20px; }
                    img { max-width: 300px; height: auto; border: 1px solid #e5e7eb; border-radius: 8px; }
                    .no-print { display: none; }
                    @media print {
                      body { margin: 0; }
                      img { max-width: 200px; }
                    }
                  </style>
                </head>
                <body>
                  <h1> Relatório de Inspeção HSE</h1>
                  ${conteudo}
                </body>
              </html>
            `);
            janelaImprimir.document.close();
            janelaImprimir.print();
          }

          function abrirImagemModal(src, titulo) {
            var modal = document.createElement('div');
            modal.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:2000;display:flex;justify-content:center;align-items:center;cursor:pointer';
            modal.innerHTML = '<div style="max-width:90%;max-height:90%;text-align:center"><h3 style="color:#fff;margin-bottom:20px">' + titulo + '</h3><img src="' + src + '" style="max-width:100%;max-height:80vh;border-radius:8px;box-shadow:0 20px 25px -5px rgba(0,0,0,0.4)"></div>';
            modal.onclick = function() { document.body.removeChild(modal); };
            document.body.appendChild(modal);
          }

          // FunÃ§Ãµes do Modal de Fotos
          var fotosParaBaixar = []; // Array para armazenar fotos selecionadas para download

          function mostrarFotosInspecao(id) {
            var inspecao = inspecoes.find(function(insp) { return insp.id == id; });
            if (!inspecao) {
              alert('Inspeção nÃ£o encontrada!');
              return;
            }

            var html = '';
            fotosParaBaixar = []; // Limpar array de fotos

            // Verificar se hÃ¡ fotos
            if (!inspecao.fotoAntes && !inspecao.fotoDepois) {
              html = '<div style="text-align:center;padding:40px;color:#6b7280"><div style="font-size:3rem;margin-bottom:16px;opacity:0.5"></div><div style="font-size:1.1rem;font-weight:500;margin-bottom:8px">Nenhuma foto disponÃ­vel</div><div style="font-size:0.9rem">Esta inspeÃ§Ã£o nÃ£o possui fotos cadastradas.</div></div>';
            } else {
              html += '<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(350px,1fr));gap:24px">';
              
              // Foto Antes
              if (inspecao.fotoAntes) {
                fotosParaBaixar.push({
                  nome: 'Foto_Antes_Inspecao_' + id + '.jpg',
                  data: inspecao.fotoAntes
                });
                
                html += '<div style="border:2px solid #e5e7eb;border-radius:12px;overflow:hidden;background:#fff">';
                html += '<div style="background:#f8fafc;padding:16px;border-bottom:1px solid #e5e7eb">';
                html += '<h4 style="margin:0;color:#374151;font-size:1.1rem;font-weight:600;display:flex;align-items:center;gap:8px"> Foto Antes</h4>';
                html += '</div>';
                html += '<div style="position:relative">';
                html += '<img src="' + inspecao.fotoAntes + '" style="width:100%;height:250px;object-fit:cover;cursor:pointer" onclick="abrirImagemModal(\'' + inspecao.fotoAntes + '\', \'Foto Antes - Inspeção #' + id + '\')">';
                html += '<div style="position:absolute;top:8px;right:8px">';
                html += '<button onclick="baixarFoto(\'' + inspecao.fotoAntes + '\', \'Foto_Antes_Inspecao_' + id + '.jpg\')" style="background:rgba(0,0,0,0.7);color:#fff;border:none;border-radius:6px;padding:8px 12px;font-size:0.8rem;cursor:pointer;display:flex;align-items:center;gap:4px" title="Baixar foto">';
                html += ' Baixar</button>';
                html += '</div>';
                html += '</div>';
                html += '</div>';
              }
              
              // Foto Depois
              if (inspecao.fotoDepois) {
                fotosParaBaixar.push({
                  nome: 'Foto_Depois_Inspecao_' + id + '.jpg',
                  data: inspecao.fotoDepois
                });
                
                html += '<div style="border:2px solid #e5e7eb;border-radius:12px;overflow:hidden;background:#fff">';
                html += '<div style="background:#f8fafc;padding:16px;border-bottom:1px solid #e5e7eb">';
                html += '<h4 style="margin:0;color:#374151;font-size:1.1rem;font-weight:600;display:flex;align-items:center;gap:8px"> Foto Depois</h4>';
                html += '</div>';
                html += '<div style="position:relative">';
                html += '<img src="' + inspecao.fotoDepois + '" style="width:100%;height:250px;object-fit:cover;cursor:pointer" onclick="abrirImagemModal(\'' + inspecao.fotoDepois + '\', \'Foto Depois - Inspeção #' + id + '\')">';
                html += '<div style="position:absolute;top:8px;right:8px">';
                html += '<button onclick="baixarFoto(\'' + inspecao.fotoDepois + '\', \'Foto_Depois_Inspecao_' + id + '.jpg\')" style="background:rgba(0,0,0,0.7);color:#fff;border:none;border-radius:6px;padding:8px 12px;font-size:0.8rem;cursor:pointer;display:flex;align-items:center;gap:4px" title="Baixar foto">';
                html += ' Baixar</button>';
                html += '</div>';
                html += '</div>';
                html += '</div>';
              }
              
              html += '</div>';
              
              // InstruÃ§Ãµes
              html += '<div style="background:#f0f9ff;border:1px solid #bae6fd;border-radius:8px;padding:16px;margin-top:20px">';
              html += '<div style="display:flex;align-items:start;gap:12px">';
              html += '<div style="color:#0284c7;font-size:1.2rem"></div>';
              html += '<div>';
              html += '<div style="font-weight:600;color:#0c4a6e;margin-bottom:4px">Como usar:</div>';
              html += '<div style="color:#0369a1;font-size:0.9rem">';
              html += ' <strong>Clique na imagem</strong> para visualizar em tela cheia<br>';
              html += ' <strong>Clique em "Baixar"</strong> para fazer download individual<br>';
              html += ' <strong>Use "Baixar Todas"</strong> para download de todas as fotos';
              html += '</div>';
              html += '</div>';
              html += '</div>';
              html += '</div>';
            }

            // Atualizar conteÃºdo do modal
            document.getElementById('conteudo-fotos').innerHTML = html;
            document.getElementById('modal-fotos-inspecao').style.display = 'flex';
          }

          function fecharModalFotos() {
            document.getElementById('modal-fotos-inspecao').style.display = 'none';
            fotosParaBaixar = [];
          }

          function baixarFoto(dataUrl, nomeArquivo) {
            var link = document.createElement('a');
            link.href = dataUrl;
            link.download = nomeArquivo;
            link.style.display = 'none';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
          }

          function baixarTodasFotos() {
            if (fotosParaBaixar.length === 0) {
              alert('Nenhuma foto disponÃ­vel para download!');
              return;
            }

            fotosParaBaixar.forEach(function(foto, index) {
              setTimeout(function() {
                baixarFoto(foto.data, foto.nome);
              }, index * 500); // Delay de 500ms entre downloads para evitar conflitos
            });

            alert('Iniciando download de ' + fotosParaBaixar.length + ' foto(s)!');
          }
          
          // BotÃµes de cadastro de Ã¡rea e categoria
          document.getElementById('btn-cadastrar-area').addEventListener('click', function() {
            // Ocultar todas as seÃ§Ãµes
            hideAllSections();
            document.getElementById('areas-locais').style.display = 'block';
            inicializarAreasLocais();
            hideSidebarOnMobile();
          });
          
          document.getElementById('btn-cadastrar-categoria').addEventListener('click', function() {
            // Ocultar todas as seÃ§Ãµes
            hideAllSections();
            document.getElementById('categorias-hse').style.display = 'block';
            inicializarCategorias();
            hideSidebarOnMobile();
          });
          
          document.getElementById('btn-cadastrar-tipo-registro').addEventListener('click', function() {
            // Ocultar todas as seÃ§Ãµes
            hideAllSections();
            document.getElementById('gerenciamento-tipos-registro').style.display = 'block';
            inicializarTiposRegistro();
            hideSidebarOnMobile();
          });
          
          document.getElementById('btn-cadastrar-riscos-perigos').addEventListener('click', function() {
            // Ocultar todas as seÃ§Ãµes
            hideAllSections();
            document.getElementById('gerenciamento-riscos-perigos').style.display = 'block';
            inicializarRiscosPerigos();
            hideSidebarOnMobile();
          });
          
          // SISTEMA DE ART (Análise de Risco da Tarefa)
          
          // Array para armazenar ARTs
          var arts = JSON.parse(localStorage.getItem('arts')) || [];
          
          // Inicializar sistema de ART
          function inicializarART() {
            // Adicionar dados de exemplo se nÃ£o houver ARTs
            if (arts.length === 0) {
              var artExemplo = {
                id: Date.now(),
                numero: 'ART-001',
                tarefa: 'InstalaÃ§Ã£o de andaime em altura',
                area: 'BAP 1B',
                riscos: 'Queda em altura, colisÃ£o com estruturas',
                medidasControle: 'Uso de EPI completo, verificaÃ§Ã£o de estabilidade',
                responsavel: 'JoÃ£o Silva',
                data: '2024-01-15',
                status: 'ConcluÃ­da',
                dataCriacao: new Date().toISOString()
              };
              arts.push(artExemplo);
              localStorage.setItem('arts', JSON.stringify(arts));
            }
            
            carregarARTs();
          }
          
          // Carregar lista de ARTs na tabela
          function carregarARTs() {
            var tbody = document.getElementById('art-tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            arts.forEach(function(art) {
              var row = document.createElement('tr');
              
              row.innerHTML = `
                <td>${art.numero}</td>
                <td>${art.tarefa}</td>
                <td>${art.area}</td>
                <td>${art.riscos}</td>
                <td><span class="status-${art.status.toLowerCase()}">${art.status}</span></td>
                <td>
                  <button class="btn-editar" onclick="editarART(${art.id})">Editar</button>
                  <button class="btn-excluir" onclick="excluirART(${art.id})">Excluir</button>
                </td>
              `;
              
              tbody.appendChild(row);
            });
          }
          
          // FunÃ§Ã£o auxiliar para formatar data
          function formatarData(dataString) {
            if (!dataString) return '';
            var data = new Date(dataString);
            return data.toLocaleDateString('pt-BR');
          }
          
          // Event listeners para botÃµes da ART
          document.addEventListener('DOMContentLoaded', function() {
            // BotÃ£o Nova ART
            var btnNovaArt = document.getElementById('btn-nova-art');
            if (btnNovaArt) {
              btnNovaArt.addEventListener('click', abrirModalNovaART);
            }
            
            // BotÃ£o Histórico
            var btnHistoricoArt = document.getElementById('btn-historico-art');
            if (btnHistoricoArt) {
              btnHistoricoArt.addEventListener('click', function() {
                alert('Funcionalidade "Histórico" serÃ¡ implementada em breve.');
              });
            }
            
            // Fechar modal
            var btnFecharModal = document.getElementById('fechar-modal-art');
            if (btnFecharModal) {
              btnFecharModal.addEventListener('click', fecharModalART);
            }
            
            var btnCancelar = document.getElementById('cancelar-art');
            if (btnCancelar) {
              btnCancelar.addEventListener('click', fecharModalART);
            }
            
            // FormulÃ¡rio
            var formNovaArt = document.getElementById('form-nova-art');
            if (formNovaArt) {
              formNovaArt.addEventListener('submit', salvarNovaART);
            }
          });
          
          // FunÃ§Ãµes para editar e excluir ART
          function editarART(id) {
            alert('Funcionalidade "Editar ART" serÃ¡ implementada em breve. ID: ' + id);
          }
          
          function excluirART(id) {
            if (confirm('Tem certeza que deseja excluir esta ART?')) {
              arts = arts.filter(function(art) {
                return art.id !== id;
              });
              localStorage.setItem('arts', JSON.stringify(arts));
              carregarARTs();
            }
          }
          
          // FunÃ§Ãµes do modal ART
          function abrirModalNovaART() {
            document.getElementById('modal-nova-art').style.display = 'flex';
            
            // Configurar data atual
            var hoje = new Date();
            var dataHoje = hoje.getFullYear() + '-' + 
                     (hoje.getMonth() + 1).toString().padStart(2, '0') + '-' + 
                     hoje.getDate().toString().padStart(2, '0');
            document.getElementById('art-data').value = dataHoje;
            
            // Limpar formulÃ¡rio
            document.getElementById('form-nova-art').reset();
            
            // Configurar event listeners para cÃ¡lculo automÃ¡tico do nÃ­vel de risco
            document.getElementById('art-severidade').addEventListener('change', atualizarNivelRisco);
            document.getElementById('art-probabilidade').addEventListener('change', atualizarNivelRisco);
          }
          
          function atualizarNivelRisco() {
            var severidade = document.getElementById('art-severidade').value;
            var probabilidade = document.getElementById('art-probabilidade').value;
            var nivelRisco = calcularNivelRisco(severidade, probabilidade);
            document.getElementById('art-nivel-risco').value = nivelRisco;
          }
          
          function fecharModalART() {
            document.getElementById('modal-nova-art').style.display = 'none';
            document.getElementById('form-nova-art').reset();
          }
          
          function salvarNovaART(e) {
            e.preventDefault();
            
            var novaART = {
              id: Date.now(),
              numero: document.getElementById('art-numero').value,
              tarefa: document.getElementById('art-tarefa').value,
              area: document.getElementById('art-area').value,
              riscos: document.getElementById('art-riscos').value,
              medidasControle: document.getElementById('art-medidas').value,
              responsavel: document.getElementById('art-responsavel').value,
              data: document.getElementById('art-data').value,
              severidade: document.getElementById('art-severidade').value,
              probabilidade: document.getElementById('art-probabilidade').value,
              nivelRisco: calcularNivelRisco(document.getElementById('art-severidade').value, document.getElementById('art-probabilidade').value),
              status: document.getElementById('art-status').value,
              epi: document.getElementById('art-epi').value,
              emergencia: document.getElementById('art-emergencia').value,
              observacoes: document.getElementById('art-observacoes').value,
              aprovador: document.getElementById('art-aprovador').value,
              dataAprovacao: document.getElementById('art-data-aprovacao').value,
              revisao: document.getElementById('art-revisao').value,
              dataCriacao: new Date().toISOString()
            };
            
            arts.push(novaART);
            localStorage.setItem('arts', JSON.stringify(arts));
            
            carregarARTs();
            fecharModalART();
            
            alert('ART salva com sucesso!');
          }
          
          // FunÃ§Ã£o para calcular nÃ­vel de risco
          function calcularNivelRisco(severidade, probabilidade) {
            if (!severidade || !probabilidade) return '';
            
            var scoreSeveridade = { 'Baixa': 1, 'MÃ©dia': 2, 'Alta': 3, 'CrÃ­tica': 4 }[severidade] || 0;
            var scoreProbabilidade = { 'Baixa': 1, 'MÃ©dia': 2, 'Alta': 3 }[probabilidade] || 0;
            
            var nivel = scoreSeveridade * scoreProbabilidade;
            
            if (nivel <= 2) return 'Baixo';
            if (nivel <= 6) return 'MÃ©dio';
            if (nivel <= 9) return 'Alto';
            return 'CrÃ­tico';
          }
          
          // SISTEMA DE CATEGORIAS HSE
          
          // Array para armazenar categorias
          var categoriasHSE = JSON.parse(localStorage.getItem('categoriasHSE')) || [];
          
          // Inicializar sistema de categorias
          function inicializarCategorias() {
            carregarCategorias();
          }
          
          // BotÃ£o voltar para inspeÃ§Ã£o
          document.getElementById('btn-voltar-inspecao').addEventListener('click', function() {
            // Ocultar seÃ§Ã£o de categorias e mostrar inspeÃ§Ã£o
            document.getElementById('categorias-hse').style.display = 'none';
            document.getElementById('inspecao').style.display = 'block';
            inicializarInspecao();
          });
          
          // Abrir modal nova categoria
          document.getElementById('btn-nova-categoria').addEventListener('click', abrirModalNovaCategoria);
          
          function abrirModalNovaCategoria() {
            document.getElementById('modal-nova-categoria').style.display = 'flex';
          }
          
          // Fechar modal de categoria
          function fecharModalCategoria() {
            document.getElementById('modal-nova-categoria').style.display = 'none';
            document.getElementById('form-nova-categoria').reset();
          }
          
          // Salvar nova categoria
          document.getElementById('form-nova-categoria').addEventListener('submit', function(e) {
            e.preventDefault();
            
            var nomeClassificacao = document.getElementById('cat-classificacao').value.trim();
            var nomeCategoria = document.getElementById('cat-nome').value.trim();
            
            if (!nomeClassificacao || !nomeCategoria) {
              alert('Por favor, preencha tanto a classificaÃ§Ã£o quanto a categoria.');
              return;
            }
            
            // Verificar se a categoria jÃ¡ existe
            var categoriaExistente = categoriasHSE.find(function(cat) {
              return cat.nome.toLowerCase() === nomeCategoria.toLowerCase();
            });
            
            if (categoriaExistente) {
              // Adicionar classificaÃ§Ã£o Ã  categoria existente
              if (!categoriaExistente.classificacoes.includes(nomeClassificacao)) {
                categoriaExistente.classificacoes.push(nomeClassificacao);
                localStorage.setItem('categoriasHSE', JSON.stringify(categoriasHSE));
                alert('ClassificaÃ§Ã£o adicionada Ã  categoria existente!');
              } else {
                alert('Esta classificaÃ§Ã£o jÃ¡ existe nesta categoria.');
                return;
              }
            } else {
              // Criar nova categoria
              var novaCategoria = {
                id: Date.now(),
                nome: nomeCategoria,
                cor: '#10b981', // Cor verde padrÃ£o
                classificacoes: [nomeClassificacao],
                dataCriacao: new Date().toISOString()
              };
              
              categoriasHSE.push(novaCategoria);
              localStorage.setItem('categoriasHSE', JSON.stringify(categoriasHSE));
              alert('Nova categoria criada com sucesso!');
            }
            
            fecharModalCategoria();
            carregarCategorias();
          });
          
          // Carregar e exibir categorias
          function carregarCategorias() {
            var lista = document.getElementById('lista-categorias');
            
            if (categoriasHSE.length === 0) {
              lista.innerHTML = '<div style="padding:60px 20px;text-align:center;color:#9ca3af"><div style="font-size:3rem;margin-bottom:16px;opacity:0.5"></div><div style="font-size:1.1rem;font-weight:500;margin-bottom:8px">Nenhuma categoria cadastrada ainda.</div><div style="font-size:0.9rem">Clique em "Nova Categoria" para comeÃ§ar.</div></div>';
              return;
            }
            
            // Agrupar categorias por classificaÃ§Ã£o
            var grupos = {};
            
            categoriasHSE.forEach(function(categoria) {
              var classificacoes = categoria.classificacoes || categoria.subcategorias || [];
              
              classificacoes.forEach(function(classificacao) {
                if (!grupos[classificacao]) {
                  grupos[classificacao] = [];
                }
                grupos[classificacao].push(categoria);
              });
              
              // Se nÃ£o tem classificaÃ§Ã£o, colocar em grupo "Sem ClassificaÃ§Ã£o"
              if (classificacoes.length === 0) {
                if (!grupos['Sem ClassificaÃ§Ã£o']) {
                  grupos['Sem ClassificaÃ§Ã£o'] = [];
                }
                grupos['Sem ClassificaÃ§Ã£o'].push(categoria);
              }
            });
            
            // Ordenar os grupos alfabeticamente
            var gruposOrdenados = Object.keys(grupos).sort();
            
            var html = '';
            
            gruposOrdenados.forEach(function(nomeGrupo) {
              var categorias = grupos[nomeGrupo];
              
              // Header do grupo (ClassificaÃ§Ã£o)
              html += '<div style="margin-bottom:20px">';
              html += '<div style="background:linear-gradient(135deg,#10b981 0%,#059669 100%);color:#fff;padding:16px 20px;border-radius:8px;margin-bottom:12px">';
              html += '<div style="font-size:0.8rem;font-weight:500;opacity:0.9;margin-bottom:4px;text-transform:uppercase;letter-spacing:1px"> CLASSIFICAÃ‡Ã•ES:</div>';
              html += '<div style="font-size:1.1rem;font-weight:700">' + nomeGrupo + '</div>';
              html += '</div>';
              
              // Listar categorias do grupo
              categorias.forEach(function(categoria) {
                html += '<div style="background:#fff;border:1px solid #e5e7eb;border-radius:8px;padding:16px;margin-bottom:12px;margin-left:20px">';
                html += '<div style="display:flex;justify-content:space-between;align-items:center">';
                
                // Lado esquerdo - Info da categoria
                html += '<div style="display:flex;align-items:center;gap:12px;flex:1">';
                html += '<div style="width:12px;height:12px;background:' + (categoria.cor || '#10b981') + ';border-radius:50%;flex-shrink:0"></div>';
                html += '<div>';
                html += '<div style="font-size:0.75rem;color:#6b7280;font-weight:500;margin-bottom:2px">Categoria:</div>';
                html += '<div style="font-size:1rem;font-weight:600;color:#374151">' + categoria.nome + '</div>';
                if (categoria.descricao) {
                  html += '<div style="font-size:0.85rem;color:#6b7280;margin-top:4px">' + categoria.descricao + '</div>';
                }
                html += '</div>';
                html += '</div>';
                
                // Lado direito - BotÃµes
                html += '<div style="display:flex;gap:8px">';
                html += '<button onclick="editarCategoria(\'' + categoria.id + '\')" style="background:#f59e0b;color:#fff;border:none;border-radius:4px;padding:8px 12px;font-size:0.8rem;cursor:pointer;display:flex;align-items:center;gap:4px"> Editar</button>';
                html += '<button onclick="excluirCategoria(\'' + categoria.id + '\')" style="background:#ef4444;color:#fff;border:none;border-radius:4px;padding:8px 12px;font-size:0.8rem;cursor:pointer;display:flex;align-items:center;gap:4px"> Excluir</button>';
                html += '</div>';
                
                html += '</div>';
                html += '</div>';
              });
              
              html += '</div>';
            });
            
            lista.innerHTML = html;
          }
          
          // VariÃ¡vel para armazenar a categoria sendo editada
          var categoriaEditando = null;
          
          // FunÃ§Ã£o para editar categoria
          function editarCategoria(id) {
            // Encontrar a categoria pelo ID
            categoriaEditando = categoriasHSE.find(function(cat) { return cat.id == id; });
            
            if (!categoriaEditando) {
              alert('Categoria nÃ£o encontrada!');
              return;
            }
            
            // Preencher o formulÃ¡rio com os dados da categoria
            document.getElementById('edit-cat-nome').value = categoriaEditando.nome;
            document.getElementById('edit-cat-cor').value = categoriaEditando.cor || '#10b981';
            
            // Carregar as classificaÃ§Ãµes existentes
            carregarClassificacoesEdicao();
            
            // Abrir o modal
            document.getElementById('modal-editar-categoria').style.display = 'flex';
          }
          
          // FunÃ§Ã£o para carregar classificaÃ§Ãµes na ediÃ§Ã£o
          function carregarClassificacoesEdicao() {
            var lista = document.getElementById('edit-classificacoes-lista');
            
            if (!categoriaEditando.classificacoes || categoriaEditando.classificacoes.length === 0) {
              lista.innerHTML = '<div style="color:#6b7280;font-style:italic;text-align:center">Nenhuma classificaÃ§Ã£o cadastrada</div>';
              return;
            }
            
            var html = '<div style="display:flex;flex-wrap:wrap;gap:8px">';
            categoriaEditando.classificacoes.forEach(function(classif, index) {
              html += '<div style="background:#10b981;color:#fff;padding:6px 12px;border-radius:12px;font-size:0.85rem;display:flex;align-items:center;gap:6px">';
              html += '<span>' + classif + '</span>';
              html += '<button type="button" onclick="removerClassificacaoEdicao(' + index + ')" style="background:rgba(255,255,255,0.2);border:none;border-radius:50%;width:18px;height:18px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:0.7rem;color:#fff">Ã—</button>';
              html += '</div>';
            });
            html += '</div>';
            
            lista.innerHTML = html;
          }
          
          // FunÃ§Ã£o para adicionar nova classificaÃ§Ã£o na ediÃ§Ã£o
          function adicionarClassificacaoEdicao() {
            var novaClassif = document.getElementById('edit-nova-classificacao').value.trim();
            
            if (!novaClassif) {
              alert('Por favor, digite uma classificaÃ§Ã£o.');
              return;
            }
            
            // Verificar se jÃ¡ existe
            if (categoriaEditando.classificacoes.includes(novaClassif)) {
              alert('Esta classificaÃ§Ã£o jÃ¡ existe.');
              return;
            }
            
            // Adicionar Ã  lista
            if (!categoriaEditando.classificacoes) {
              categoriaEditando.classificacoes = [];
            }
            categoriaEditando.classificacoes.push(novaClassif);
            
            // Limpar campo e recarregar lista
            document.getElementById('edit-nova-classificacao').value = '';
            carregarClassificacoesEdicao();
          }
          
          // FunÃ§Ã£o para remover classificaÃ§Ã£o na ediÃ§Ã£o
          function removerClassificacaoEdicao(index) {
            if (confirm('Deseja remover esta classificaÃ§Ã£o?')) {
              categoriaEditando.classificacoes.splice(index, 1);
              carregarClassificacoesEdicao();
            }
          }
          
          // FunÃ§Ã£o para fechar modal de ediÃ§Ã£o
          function fecharModalEdicaoCategoria() {
            document.getElementById('modal-editar-categoria').style.display = 'none';
            document.getElementById('form-editar-categoria').reset();
            categoriaEditando = null;
          }
          
          // Event listener para o formulÃ¡rio de ediÃ§Ã£o
          document.getElementById('form-editar-categoria').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!categoriaEditando) {
              alert('Erro: Categoria nÃ£o selecionada.');
              return;
            }
            
            var novoNome = document.getElementById('edit-cat-nome').value.trim();
            var novaCor = document.getElementById('edit-cat-cor').value;
            
            if (!novoNome) {
              alert('Por favor, digite o nome da categoria.');
              return;
            }
            
            // Verificar se o nome jÃ¡ existe em outra categoria
            var categoriaExistente = categoriasHSE.find(function(cat) {
              return cat.id != categoriaEditando.id && cat.nome.toLowerCase() === novoNome.toLowerCase();
            });
            
            if (categoriaExistente) {
              alert('JÃ¡ existe uma categoria com este nome.');
              return;
            }
            
            // Atualizar a categoria
            categoriaEditando.nome = novoNome;
            categoriaEditando.cor = novaCor;
            
            // Salvar no localStorage
            localStorage.setItem('categoriasHSE', JSON.stringify(categoriasHSE));
            
            // Fechar modal e recarregar lista
            fecharModalEdicaoCategoria();
            carregarCategorias();
            
            alert('Categoria atualizada com sucesso!');
          });
          
          function excluirCategoria(id) {
            if (confirm('Deseja realmente excluir esta categoria?')) {
              categoriasHSE = categoriasHSE.filter(function(cat) { return cat.id != id; });
              localStorage.setItem('categoriasHSE', JSON.stringify(categoriasHSE));
              carregarCategorias();
              alert('Categoria excluÃ­da com sucesso!');
            }
          }
          
          // SISTEMA DE ÃREAS E LOCAIS
          
          // Array para armazenar Ã¡reas e locais
          var areasLocais = JSON.parse(localStorage.getItem('areasLocais')) || [];
          
          // Inicializar sistema de Ã¡reas e locais
          function inicializarAreasLocais() {
            carregarAreasLocais();
          }
          
          // BotÃ£o voltar para inspeÃ§Ã£o
          document.getElementById('btn-voltar-inspecao-area').addEventListener('click', function() {
            // Ocultar seÃ§Ã£o de Ã¡reas e mostrar inspeÃ§Ã£o
            document.getElementById('areas-locais').style.display = 'none';
            document.getElementById('inspecao').style.display = 'block';
            inicializarInspecao();
          });
          
          // Abrir modal nova Ã¡rea
          document.getElementById('btn-nova-area').addEventListener('click', abrirModalNovaArea);
          
          function abrirModalNovaArea() {
            document.getElementById('modal-nova-area').style.display = 'flex';
          }
          
          // Abrir modal nova empresa
          var btnNovaEmpresa = document.getElementById('btn-nova-empresa');
          if (btnNovaEmpresa) {
            btnNovaEmpresa.addEventListener('click', abrirModalNovaEmpresa);
            console.log('Event listener adicionado ao botÃ£o Nova Empresa');
          } else {
            console.error('BotÃ£o Nova Empresa nÃ£o encontrado!');
          }
          
          // Fechar modal empresa
          var btnFecharModal = document.getElementById('fechar-modal-empresa');
          if (btnFecharModal) {
            btnFecharModal.addEventListener('click', fecharModalEmpresa);
            console.log('Event listener adicionado ao botÃ£o Fechar Modal');
          } else {
            console.error('BotÃ£o Fechar Modal nÃ£o encontrado!');
          }
          
          // Fechar modal de Ã¡rea
          function fecharModalArea() {
            document.getElementById('modal-nova-area').style.display = 'none';
            document.getElementById('form-nova-area').reset();
          }
          
          // Salvar nova Ã¡rea/local
          document.getElementById('form-nova-area').addEventListener('submit', function(e) {
            e.preventDefault();
            
            var nomeArea = document.getElementById('area-nome').value.trim();
            var localEspecifico = document.getElementById('area-local').value.trim();
            var descricao = document.getElementById('area-descricao').value.trim();
            var cor = document.getElementById('area-cor').value;
            
            if (!nomeArea || !localEspecifico) {
              alert('Por favor, preencha o nome da Ã¡rea e o local especÃ­fico.');
              return;
            }
            
            // Verificar se a combinaÃ§Ã£o Ã¡rea + local jÃ¡ existe
            var areaExistente = areasLocais.find(function(area) {
              return area.nome.toLowerCase() === nomeArea.toLowerCase() && 
                   area.local.toLowerCase() === localEspecifico.toLowerCase();
            });
            
            if (areaExistente) {
              alert('Esta combinaÃ§Ã£o de Ã¡rea e local jÃ¡ existe.');
              return;
            }
            
            // Criar nova Ã¡rea/local
            var novaArea = {
              id: Date.now(),
              nome: nomeArea,
              local: localEspecifico,
              descricao: descricao,
              cor: cor,
              dataCriacao: new Date().toISOString()
            };
            
            areasLocais.push(novaArea);
            localStorage.setItem('areasLocais', JSON.stringify(areasLocais));
            
            fecharModalArea();
            carregarAreasLocais();
            alert('Ãrea e local cadastrados com sucesso!');
          });
          
          // Carregar e exibir Ã¡reas/locais
          function carregarAreasLocais() {
            var lista = document.getElementById('lista-areas');
            
            if (areasLocais.length === 0) {
              lista.innerHTML = '<div style="padding:60px 20px;text-align:center;color:#9ca3af"><div style="font-size:3rem;margin-bottom:16px;opacity:0.5"></div><div style="font-size:1.1rem;font-weight:500;margin-bottom:8px">Nenhuma Ã¡rea e local cadastrado ainda.</div><div style="font-size:0.9rem">Clique em "Nova Ã¡rea e local" para comeÃ§ar.</div></div>';
              return;
            }
            
            var html = '';
            areasLocais.forEach(function(area) {
              html += '<div style="padding:20px;border-bottom:1px solid #f3f4f6">';
              html += '<div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:12px">';
              html += '<div style="display:flex;align-items:center;gap:12px">';
              html += '<div style="width:20px;height:20px;background:' + area.cor + ';border-radius:4px"></div>';
              html += '<div>';
              html += '<h4 style="margin:0;color:#374151;font-size:1.1rem;font-weight:600">' + area.nome + '</h4>';
              html += '<p style="margin:4px 0 0 0;color:#6b7280;font-size:0.9rem;font-weight:500"> ' + area.local + '</p>';
              if (area.descricao) {
                html += '<p style="margin:4px 0 0 0;color:#6b7280;font-size:0.85rem">' + area.descricao + '</p>';
              }
              html += '</div>';
              html += '</div>';
              html += '<div style="display:flex;gap:8px">';
              html += '<button onclick="editarArea(\'' + area.id + '\')" style="background:#f59e0b;color:#fff;border:none;border-radius:4px;padding:6px 10px;font-size:0.8rem;cursor:pointer"> Editar</button>';
              html += '<button onclick="excluirArea(\'' + area.id + '\')" style="background:#ef4444;color:#fff;border:none;border-radius:4px;padding:6px 10px;font-size:0.8rem;cursor:pointer"> Excluir</button>';
              html += '</div>';
              html += '</div>';
              html += '</div>';
            });
            
            lista.innerHTML = html;
          }
          
          // VariÃ¡vel para armazenar a Ã¡rea sendo editada
          var areaEditando = null;
          
          // FunÃ§Ã£o para editar Ã¡rea
          function editarArea(id) {
            // Encontrar a Ã¡rea pelo ID
            areaEditando = areasLocais.find(function(area) { return area.id == id; });
            
            if (!areaEditando) {
              alert('Ãrea nÃ£o encontrada!');
              return;
            }
            
            // Preencher o formulÃ¡rio com os dados da Ã¡rea
            document.getElementById('edit-area-nome').value = areaEditando.nome;
            document.getElementById('edit-area-local').value = areaEditando.local;
            document.getElementById('edit-area-descricao').value = areaEditando.descricao || '';
            document.getElementById('edit-area-cor').value = areaEditando.cor || '#10b981';
            
            // Abrir o modal
            document.getElementById('modal-editar-area').style.display = 'flex';
          }
          
          // FunÃ§Ã£o para fechar modal de ediÃ§Ã£o
          function fecharModalEdicaoArea() {
            document.getElementById('modal-editar-area').style.display = 'none';
            document.getElementById('form-editar-area').reset();
            areaEditando = null;
          }
          
          // Event listener para o formulÃ¡rio de ediÃ§Ã£o
          document.getElementById('form-editar-area').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!areaEditando) {
              alert('Erro: Ãrea nÃ£o selecionada.');
              return;
            }
            
            var novoNome = document.getElementById('edit-area-nome').value.trim();
            var novoLocal = document.getElementById('edit-area-local').value.trim();
            var novaDescricao = document.getElementById('edit-area-descricao').value.trim();
            var novaCor = document.getElementById('edit-area-cor').value;
            
            if (!novoNome || !novoLocal) {
              alert('Por favor, preencha o nome da Ã¡rea e o local especÃ­fico.');
              return;
            }
            
            // Verificar se a combinaÃ§Ã£o Ã¡rea + local jÃ¡ existe em outra Ã¡rea
            var areaExistente = areasLocais.find(function(area) {
              return area.id != areaEditando.id && 
                   area.nome.toLowerCase() === novoNome.toLowerCase() && 
                   area.local.toLowerCase() === novoLocal.toLowerCase();
            });
            
            if (areaExistente) {
              alert('Esta combinaÃ§Ã£o de Ã¡rea e local jÃ¡ existe.');
              return;
            }
            
            // Atualizar a Ã¡rea
            areaEditando.nome = novoNome;
            areaEditando.local = novoLocal;
            areaEditando.descricao = novaDescricao;
            areaEditando.cor = novaCor;
            
            // Salvar no localStorage
            localStorage.setItem('areasLocais', JSON.stringify(areasLocais));
            
            // Fechar modal e recarregar lista
            fecharModalEdicaoArea();
            carregarAreasLocais();
            
            alert('Ãrea/local atualizada com sucesso!');
          });
          
          function excluirArea(id) {
            if (confirm('Deseja realmente excluir esta Ã¡rea/local?')) {
              areasLocais = areasLocais.filter(function(area) { return area.id != id; });
              localStorage.setItem('areasLocais', JSON.stringify(areasLocais));
              carregarAreasLocais();
              alert('Ãrea/local excluÃ­da com sucesso!');
            }
          }
          
          // SISTEMA DE TIPOS DE REGISTRO
          
          // Array para armazenar tipos de registro
          var tiposRegistro = JSON.parse(localStorage.getItem('tiposRegistro')) || [];
          var tipoRegistroEditando = null;
          
          // Inicializar sistema de tipos de registro
          function inicializarTiposRegistro() {
            carregarTiposRegistro();
            
            // Event listener para o botÃ£o novo tipo de registro
            document.getElementById('btn-novo-tipo-registro').addEventListener('click', abrirModalNovoTipoRegistro);
          }
          
          // BotÃ£o voltar para inspeÃ§Ã£o
          document.getElementById('btn-voltar-inspecao-tipos-registro') && document.getElementById('btn-voltar-inspecao-tipos-registro').addEventListener('click', function() {
            // Ocultar seÃ§Ã£o de tipos de registro e mostrar inspeÃ§Ã£o
            document.getElementById('gerenciamento-tipos-registro').style.display = 'none';
            document.getElementById('inspecao').style.display = 'block';
            inicializarInspecao();
          });
          
          // Abrir modal novo tipo de registro
          function abrirModalNovoTipoRegistro() {
            document.getElementById('modal-novo-tipo-registro').style.display = 'flex';
          }
          
          // Fechar modal de tipo de registro
          function fecharModalTipoRegistro() {
            document.getElementById('modal-novo-tipo-registro').style.display = 'none';
            document.getElementById('form-tipo-registro').reset();
          }
          
          // Salvar novo tipo de registro
          function salvarTipoRegistro(event) {
            event.preventDefault();
            
            var nome = document.getElementById('nome-tipo-registro').value.trim();
            var descricao = document.getElementById('descricao-tipo-registro').value.trim();
            var codigo = document.getElementById('codigo-tipo-registro').value.trim();
            var status = document.getElementById('status-tipo-registro').value;
            
            if (!nome) {
              alert('Por favor, informe o nome do tipo de registro.');
              return;
            }
            
            // Verificar se jÃ¡ existe um tipo de registro com o mesmo nome
            var tipoExistente = tiposRegistro.find(function(tipo) {
              return tipo.nome.toLowerCase() === nome.toLowerCase();
            });
            
            if (tipoExistente) {
              alert('JÃ¡ existe um tipo de registro com esse nome.');
              return;
            }
            
            var novoTipo = {
              id: Date.now(),
              nome: nome,
              descricao: descricao,
              codigo: codigo,
              status: status,
              dataCriacao: new Date().toLocaleString('pt-BR')
            };
            
            tiposRegistro.push(novoTipo);
            localStorage.setItem('tiposRegistro', JSON.stringify(tiposRegistro));
            
            // Fechar modal e recarregar lista
            fecharModalTipoRegistro();
            carregarTiposRegistro();
            
            alert('Tipo de registro cadastrado com sucesso!');
          }
          
          // Carregar e exibir tipos de registro
          function carregarTiposRegistro() {
            var lista = document.getElementById('lista-tipos-registro');
            
            if (tiposRegistro.length === 0) {
              lista.innerHTML = '<div style="padding:60px 20px;text-align:center;color:#9ca3af"><div style="font-size:3rem;margin-bottom:16px;opacity:0.5"></div><div style="font-size:1.1rem;font-weight:500;margin-bottom:8px">Nenhum tipo de registro cadastrado ainda.</div><div style="font-size:0.9rem">Clique em "Novo tipo de registro" para comeÃ§ar.</div></div>';
              return;
            }
            
            var html = '';
            tiposRegistro.forEach(function(tipo) {
              var statusClass = tipo.status === 'ativo' ? 'background:#10b981;color:#fff' : 'background:#6b7280;color:#fff';
              var statusIcon = tipo.status === 'ativo' ? '✓' : '○';
              
              html += '<div style="display:flex;align-items:center;padding:16px 20px;border-bottom:1px solid #e5e7eb;justify-content:space-between">';
              html += '<div style="flex:1">';
              html += '<div style="display:flex;align-items:center;gap:12px;margin-bottom:4px">';
              html += '<div style="font-weight:600;color:#374151;font-size:1rem">' + tipo.nome + '</div>';
              if (tipo.codigo) {
                html += '<span style="background:#f3f4f6;color:#6b7280;padding:2px 8px;border-radius:4px;font-size:0.8rem;font-weight:500">' + tipo.codigo + '</span>';
              }
              html += '<span style="' + statusClass + ';padding:4px 8px;border-radius:4px;font-size:0.8rem;font-weight:500">' + statusIcon + ' ' + (tipo.status === 'ativo' ? 'Ativo' : 'Inativo') + '</span>';
              html += '</div>';
              if (tipo.descricao) {
                html += '<div style="color:#6b7280;font-size:0.9rem;margin-bottom:4px">' + tipo.descricao + '</div>';
              }
              html += '<div style="color:#9ca3af;font-size:0.8rem">Criado em: ' + tipo.dataCriacao + '</div>';
              html += '</div>';
              html += '<div style="display:flex;gap:8px">';
              html += '<button onclick="editarTipoRegistro(' + tipo.id + ')" style="background:#3b82f6;color:#fff;border:none;padding:8px 12px;border-radius:4px;cursor:pointer;font-size:0.8rem;display:flex;align-items:center;gap:4px">';
              html += '<span></span> Editar';
              html += '</button>';
              html += '<button onclick="excluirTipoRegistro(' + tipo.id + ')" style="background:#ef4444;color:#fff;border:none;padding:8px 12px;border-radius:4px;cursor:pointer;font-size:0.8rem;display:flex;align-items:center;gap:4px">';
              html += '<span></span> Excluir';
              html += '</button>';
              html += '</div>';
              html += '</div>';
            });
            
            lista.innerHTML = html;
          }
          
          // Editar tipo de registro
          function editarTipoRegistro(id) {
            var tipo = tiposRegistro.find(function(t) { return t.id == id; });
            if (!tipo) {
              alert('Tipo de registro nÃ£o encontrado.');
              return;
            }
            
            tipoRegistroEditando = tipo;
            
            // Preencher campos do modal de ediÃ§Ã£o
            document.getElementById('id-editar-tipo-registro').value = tipo.id;
            document.getElementById('nome-editar-tipo-registro').value = tipo.nome;
            document.getElementById('descricao-editar-tipo-registro').value = tipo.descricao || '';
            document.getElementById('codigo-editar-tipo-registro').value = tipo.codigo || '';
            document.getElementById('status-editar-tipo-registro').value = tipo.status;
            
            // Abrir o modal
            document.getElementById('modal-editar-tipo-registro').style.display = 'flex';
          }
          
          // FunÃ§Ã£o para fechar modal de ediÃ§Ã£o
          function fecharModalEdicaoTipoRegistro() {
            document.getElementById('modal-editar-tipo-registro').style.display = 'none';
            document.getElementById('form-editar-tipo-registro').reset();
            tipoRegistroEditando = null;
          }
          
          // Atualizar tipo de registro
          function atualizarTipoRegistro(event) {
            event.preventDefault();
            
            if (!tipoRegistroEditando) {
              alert('Erro: Tipo de registro nÃ£o selecionado.');
              return;
            }
            
            var novoNome = document.getElementById('nome-editar-tipo-registro').value.trim();
            var novaDescricao = document.getElementById('descricao-editar-tipo-registro').value.trim();
            var novoCodigo = document.getElementById('codigo-editar-tipo-registro').value.trim();
            var novoStatus = document.getElementById('status-editar-tipo-registro').value;
            
            if (!novoNome) {
              alert('Por favor, informe o nome do tipo de registro.');
              return;
            }
            
            // Verificar se jÃ¡ existe outro tipo de registro com o mesmo nome
            var tipoExistente = tiposRegistro.find(function(tipo) {
              return tipo.nome.toLowerCase() === novoNome.toLowerCase() && tipo.id !== tipoRegistroEditando.id;
            });
            
            if (tipoExistente) {
              alert('JÃ¡ existe outro tipo de registro com esse nome.');
              return;
            }
            
            // Atualizar o tipo de registro
            tipoRegistroEditando.nome = novoNome;
            tipoRegistroEditando.descricao = novaDescricao;
            tipoRegistroEditando.codigo = novoCodigo;
            tipoRegistroEditando.status = novoStatus;
            tipoRegistroEditando.dataEdicao = new Date().toLocaleString('pt-BR');
            
            // Salvar no localStorage
            localStorage.setItem('tiposRegistro', JSON.stringify(tiposRegistro));
            
            // Fechar modal e recarregar lista
            fecharModalEdicaoTipoRegistro();
            carregarTiposRegistro();
            
            alert('Tipo de registro atualizado com sucesso!');
          }
          
          // Excluir tipo de registro
          function excluirTipoRegistro(id) {
            if (confirm('Deseja realmente excluir este tipo de registro?')) {
              tiposRegistro = tiposRegistro.filter(function(tipo) { return tipo.id != id; });
              localStorage.setItem('tiposRegistro', JSON.stringify(tiposRegistro));
              carregarTiposRegistro();
              alert('Tipo de registro excluÃ­do com sucesso!');
            }
          }
          
          // SISTEMA DE RISCOS E PERIGOS
          
          // Array para armazenar riscos e perigos
          var riscosPerigos = JSON.parse(localStorage.getItem('riscosPerigos')) || [];
          var riscoPerigoeditando = null;
          
          // Inicializar sistema de riscos e perigos
          function inicializarRiscosPerigos() {
            carregarRiscosPerigos();
            
            // Event listener para o botÃ£o novo risco/perigo
            document.getElementById('btn-novo-risco-perigo').addEventListener('click', abrirModalNovoRiscoPerigo);
          }
          
          // BotÃ£o voltar para inspeÃ§Ã£o
          document.getElementById('btn-voltar-inspecao-riscos-perigos') && document.getElementById('btn-voltar-inspecao-riscos-perigos').addEventListener('click', function() {
            // Ocultar todas as seÃ§Ãµes e mostrar inspeÃ§Ã£o
            hideAllSections();
            document.getElementById('inspecao').style.display = 'block';
            inicializarInspecao();
          });
          
          // Abrir modal novo risco/perigo
          function abrirModalNovoRiscoPerigo() {
            document.getElementById('modal-novo-risco-perigo').style.display = 'flex';
          }
          
          // Fechar modal de risco/perigo
          function fecharModalRiscoPerigo() {
            document.getElementById('modal-novo-risco-perigo').style.display = 'none';
            document.getElementById('form-risco-perigo').reset();
          }
          
          // Salvar novo risco/perigo
          function salvarRiscoPerigo(event) {
            event.preventDefault();
            
            var tipo = document.getElementById('tipo-risco-perigo').value;
            var categoria = document.getElementById('categoria-risco-perigo').value;
            var nome = document.getElementById('nome-risco-perigo').value.trim();
            var status = document.getElementById('status-risco-perigo').value;
            
            if (!tipo || !nome) {
              alert('Por favor, informe o tipo e o nome/descriÃ§Ã£o do risco ou perigo.');
              return;
            }
            
            // Verificar se jÃ¡ existe um risco/perigo com o mesmo nome
            var existente = riscosPerigos.find(function(item) {
              return item.nome.toLowerCase() === nome.toLowerCase();
            });
            
            if (existente) {
              alert('JÃ¡ existe um risco/perigo com esse nome.');
              return;
            }
            
            var novoRiscoPerigo = {
              id: Date.now(),
              tipo: tipo,
              categoria: categoria,
              nome: nome,
              status: status,
              dataCriacao: new Date().toLocaleString('pt-BR')
            };
            
            riscosPerigos.push(novoRiscoPerigo);
            localStorage.setItem('riscosPerigos', JSON.stringify(riscosPerigos));
            
            // Fechar modal e recarregar lista
            fecharModalRiscoPerigo();
            carregarRiscosPerigos();
            
            alert('Risco/perigo cadastrado com sucesso!');
          }
          
          // Carregar e exibir riscos/perigos
          function carregarRiscosPerigos() {
            var lista = document.getElementById('lista-riscos-perigos');
            
            if (riscosPerigos.length === 0) {
              lista.innerHTML = '<div style="padding:60px 20px;text-align:center;color:#9ca3af"><div style="font-size:3rem;margin-bottom:16px;opacity:0.5"> ï¸</div><div style="font-size:1.1rem;font-weight:500;margin-bottom:8px">Nenhum risco ou perigo cadastrado ainda.</div><div style="font-size:0.9rem">Clique em "Novo risco/perigo" para comeÃ§ar.</div></div>';
              return;
            }
            
            var html = '';
            riscosPerigos.forEach(function(item) {
              var tipoIcon = item.tipo === 'risco' ? '🚫' : '';
              var statusClass = '';
              var statusIcon = '';
              
              switch(item.status) {
                case 'ativo':
                  statusClass = 'background:#ef4444;color:#fff';
                  statusIcon = '🔴';
                  break;
                case 'controlado':
                  statusClass = 'background:#f59e0b;color:#fff';
                  statusIcon = '🟡';
                  break;
                case 'eliminado':
                  statusClass = 'background:#10b981;color:#fff';
                  statusIcon = '🟢';
                  break;
              }
              
              html += '<div style="display:flex;align-items:center;padding:16px 20px;border-bottom:1px solid #e5e7eb;justify-content:space-between">';
              html += '<div style="flex:1">';
              html += '<div style="display:flex;align-items:center;gap:12px;margin-bottom:4px">';
              html += '<span style="font-size:1.2rem">' + tipoIcon + '</span>';
              html += '<div style="font-weight:600;color:#374151;font-size:1rem">' + item.nome + '</div>';
              if (item.categoria) {
                html += '<span style="background:#f3f4f6;color:#6b7280;padding:2px 8px;border-radius:4px;font-size:0.8rem;font-weight:500">' + item.categoria.charAt(0).toUpperCase() + item.categoria.slice(1) + '</span>';
              }
              html += '<span style="' + statusClass + ';padding:4px 8px;border-radius:4px;font-size:0.8rem;font-weight:500">' + statusIcon + ' ' + item.status.charAt(0).toUpperCase() + item.status.slice(1) + '</span>';
              html += '</div>';
              html += '<div style="color:#9ca3af;font-size:0.8rem">Criado em: ' + item.dataCriacao + '</div>';
              html += '</div>';
              html += '<div style="display:flex;gap:8px">';
              html += '<button onclick="editarRiscoPerigo(' + item.id + ')" style="background:#3b82f6;color:#fff;border:none;padding:8px 12px;border-radius:4px;cursor:pointer;font-size:0.8rem;display:flex;align-items:center;gap:4px">';
              html += '<span></span> Editar';
              html += '</button>';
              html += '<button onclick="excluirRiscoPerigo(' + item.id + ')" style="background:#ef4444;color:#fff;border:none;padding:8px 12px;border-radius:4px;cursor:pointer;font-size:0.8rem;display:flex;align-items:center;gap:4px">';
              html += '<span></span> Excluir';
              html += '</button>';
              html += '</div>';
              html += '</div>';
            });
            
            lista.innerHTML = html;
          }
          
          // Editar risco/perigo
          function editarRiscoPerigo(id) {
            var item = riscosPerigos.find(function(r) { return r.id == id; });
            if (!item) {
              alert('Risco/perigo nÃ£o encontrado.');
              return;
            }
            
            riscoPerigoeditando = item;
            
            // Preencher campos do modal de ediÃ§Ã£o
            document.getElementById('id-editar-risco-perigo').value = item.id;
            document.getElementById('tipo-editar-risco-perigo').value = item.tipo;
            document.getElementById('categoria-editar-risco-perigo').value = item.categoria || '';
            document.getElementById('nome-editar-risco-perigo').value = item.nome;
            document.getElementById('status-editar-risco-perigo').value = item.status;
            
            // Abrir o modal
            document.getElementById('modal-editar-risco-perigo').style.display = 'flex';
          }
          
          // FunÃ§Ã£o para fechar modal de ediÃ§Ã£o
          function fecharModalEdicaoRiscoPerigo() {
            document.getElementById('modal-editar-risco-perigo').style.display = 'none';
            document.getElementById('form-editar-risco-perigo').reset();
            riscoPerigoeditando = null;
          }
          
          // Atualizar risco/perigo
          function atualizarRiscoPerigo(event) {
            event.preventDefault();
            
            if (!riscoPerigoeditando) {
              alert('Erro: Risco/perigo nÃ£o selecionado.');
              return;
            }
            
            var novoTipo = document.getElementById('tipo-editar-risco-perigo').value;
            var novaCategoria = document.getElementById('categoria-editar-risco-perigo').value;
            var novoNome = document.getElementById('nome-editar-risco-perigo').value.trim();
            var novoStatus = document.getElementById('status-editar-risco-perigo').value;
            
            if (!novoTipo || !novoNome) {
              alert('Por favor, informe o tipo e o nome/descriÃ§Ã£o do risco ou perigo.');
              return;
            }
            
            // Verificar se jÃ¡ existe outro risco/perigo com o mesmo nome
            var existente = riscosPerigos.find(function(item) {
              return item.nome.toLowerCase() === novoNome.toLowerCase() && item.id !== riscoPerigoeditando.id;
            });
            
            if (existente) {
              alert('JÃ¡ existe outro risco/perigo com esse nome.');
              return;
            }
            
            // Atualizar o risco/perigo
            riscoPerigoeditando.tipo = novoTipo;
            riscoPerigoeditando.categoria = novaCategoria;
            riscoPerigoeditando.nome = novoNome;
            riscoPerigoeditando.status = novoStatus;
            riscoPerigoeditando.dataEdicao = new Date().toLocaleString('pt-BR');
            
            // Salvar no localStorage
            localStorage.setItem('riscosPerigos', JSON.stringify(riscosPerigos));
            
            // Fechar modal e recarregar lista
            fecharModalEdicaoRiscoPerigo();
            carregarRiscosPerigos();
            
            alert('Risco/perigo atualizado com sucesso!');
          }
          
          // Excluir risco/perigo
          function excluirRiscoPerigo(id) {
            if (confirm('Deseja realmente excluir este risco/perigo?')) {
              riscosPerigos = riscosPerigos.filter(function(item) { return item.id != id; });
              localStorage.setItem('riscosPerigos', JSON.stringify(riscosPerigos));
              carregarRiscosPerigos();
              alert('Risco/perigo excluÃ­do com sucesso!');
            }
          }
          
          // Inicializar exibiÃ§Ã£o de funcionÃ¡rios
          exibirFuncionarios();
          
          // Verificar se os event listeners de empresa estÃ£o funcionando
          setTimeout(function() {
            console.log('Verificando elementos de empresa...');
            var btnNovaEmpresa = document.getElementById('btn-nova-empresa');
            var modalEmpresa = document.getElementById('modal-empresa');
            console.log('BotÃ£o Nova Empresa encontrado:', !!btnNovaEmpresa);
            console.log('Modal Empresa encontrado:', !!modalEmpresa);
          }, 1000);
          
          // Inicializar conteÃºdo principal (dashboard)
          function inicializarDashboard() {
            var conteudoPrincipal = document.getElementById('conteudo-principal');
            if (conteudoPrincipal) {
              conteudoPrincipal.innerHTML = `
                <div style="padding: 32px 24px; max-width: 1200px; margin: 0 auto;">
                  <!-- Cabeçalho -->
                  <div style="text-align: center; margin-bottom: 48px;">
                    <h1 style="font-size: 2.5rem; font-weight: 700; color: #1f2937; margin: 0 0 12px 0;">
                       Dashboard HSE
                    </h1>
                    <p style="font-size: 1.2rem; color: #6b7280; margin: 0;">
                      Sistema completo de gestão de Saúde, Segurança e Meio Ambiente
                    </p>
                  </div>
                  
                  <!-- Grid de Cards Principais -->
                  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 24px; margin-bottom: 40px;">
                    <!-- Card Dashboard -->
                    <div class="dashboard-card" onclick="window.location.reload()" style="background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; padding: 24px; border-radius: 12px; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                      <div style="font-size: 2.5rem; margin-bottom: 12px;"></div>
                      <h3 style="font-size: 1.3rem; font-weight: 600; margin: 0 0 8px 0;">Dashboard</h3>
                      <p style="opacity: 0.9; font-size: 0.95rem; margin: 0;">Visão geral do sistema e indicadores principais</p>
                    </div>
                    
                    <!-- Card Relatórios -->
                    <div class="dashboard-card" onclick="alert('Funcionalidade em desenvolvimento')" style="background: linear-gradient(135deg, #f59e0b, #d97706); color: white; padding: 24px; border-radius: 12px; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                      <div style="font-size: 2.5rem; margin-bottom: 12px;"></div>
                      <h3 style="font-size: 1.3rem; font-weight: 600; margin: 0 0 8px 0;">Relatórios</h3>
                      <p style="opacity: 0.9; font-size: 0.95rem; margin: 0;">Relatórios e análises de segurança</p>
                    </div>
                    
                    <!-- Card Empresa -->
                    <div class="dashboard-card" onclick="document.querySelectorAll('.nav a[href=\\\"#empresa\\\"]')[0].click()" style="background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 24px; border-radius: 12px; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                      <div style="font-size: 2.5rem; margin-bottom: 12px;"></div>
                      <h3 style="font-size: 1.3rem; font-weight: 600; margin: 0 0 8px 0;">Empresa</h3>
                      <p style="opacity: 0.9; font-size: 0.95rem; margin: 0;">Gerenciamento de empresas e configurações</p>
                    </div>
                    
                    <!-- Card Colaboradores -->
                    <div class="dashboard-card" onclick="document.querySelectorAll('.nav a[href=\\\"#funcionarios\\\"]')[0].click()" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed); color: white; padding: 24px; border-radius: 12px; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                      <div style="font-size: 2.5rem; margin-bottom: 12px;"></div>
                      <h3 style="font-size: 1.3rem; font-weight: 600; margin: 0 0 8px 0;">Colaboradores</h3>
                      <p style="opacity: 0.9; font-size: 0.95rem; margin: 0;">Cadastro e gestão de funcionários</p>
                    </div>
                    
                    <!-- Card Frequência -->
                    <div class="dashboard-card" onclick="document.querySelectorAll('.nav a[href=\\\"#frequencia\\\"]')[0].click()" style="background: linear-gradient(135deg, #ef4444, #dc2626); color: white; padding: 24px; border-radius: 12px; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                      <div style="font-size: 2.5rem; margin-bottom: 12px;"></div>
                      <h3 style="font-size: 1.3rem; font-weight: 600; margin: 0 0 8px 0;">Frequência</h3>
                      <p style="opacity: 0.9; font-size: 0.95rem; margin: 0;">Controle de presenças e participação em RAS</p>
                    </div>
                    
                    <!-- Card Usuário -->
                    <div class="dashboard-card" onclick="document.querySelectorAll('.nav a[href=\\\"#usuario\\\"]')[0].click()" style="background: linear-gradient(135deg, #6b7280, #4b5563); color: white; padding: 24px; border-radius: 12px; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                      <div style="font-size: 2.5rem; margin-bottom: 12px;"></div>
                      <h3 style="font-size: 1.3rem; font-weight: 600; margin: 0 0 8px 0;">Usuário</h3>
                      <p style="opacity: 0.9; font-size: 0.95rem; margin: 0;">Configurações de usuário e acesso</p>
                    </div>
                  </div>
                  
                  <!-- SeÃ§Ã£o Ferramentas -->
                  <div style="margin-top: 48px;">
                    <h2 style="font-size: 1.8rem; font-weight: 700; color: #1f2937; margin: 0 0 24px 0; text-align: center;">
                       ï¸ Ferramentas HSE
                    </h2>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 24px;">
                      <!-- Card RAS -->
                      <div class="dashboard-tool-card" onclick="document.querySelectorAll('.nav a[href=\\\"#ras\\\"]')[0].click()" style="background: white; border: 2px solid #e5e7eb; padding: 24px; border-radius: 12px; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <div style="font-size: 2.5rem; margin-bottom: 12px;"></div>
                        <h3 style="font-size: 1.3rem; font-weight: 600; margin: 0 0 8px 0; color: #1f2937;">RAS</h3>
                        <p style="color: #6b7280; font-size: 0.95rem; margin: 0;">Reunião de Análise de Segurança</p>
                      </div>
                      
                      <!-- Card CPT -->
                      <div class="dashboard-tool-card" onclick="document.querySelectorAll('.nav a[href=\\\"#cpt\\\"]')[0].click()" style="background: white; border: 2px solid #e5e7eb; padding: 24px; border-radius: 12px; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <div style="font-size: 2.5rem; margin-bottom: 12px;"></div>
                        <h3 style="font-size: 1.3rem; font-weight: 600; margin: 0 0 8px 0; color: #1f2937;">CPT</h3>
                        <p style="color: #6b7280; font-size: 0.95rem; margin: 0;">Controle de Presenças em Treinamentos</p>
                      </div>
                      
                      <!-- Card Inspeção HSE -->
                      <div class="dashboard-tool-card" onclick="document.querySelectorAll('.nav a[href=\\\"#inspecao\\\"]')[0].click()" style="background: white; border: 2px solid #e5e7eb; padding: 24px; border-radius: 12px; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <div style="font-size: 2.5rem; margin-bottom: 12px;"></div>
                        <h3 style="font-size: 1.3rem; font-weight: 600; margin: 0 0 8px 0; color: #1f2937;">Inspeção HSE</h3>
                        <p style="color: #6b7280; font-size: 0.95rem; margin: 0;">Sistema de inspeções de segurança</p>
                      </div>
                      
                      <!-- Card WOC MDHO -->
                      <div class="dashboard-tool-card" onclick="alert('Funcionalidade em desenvolvimento')" style="background: white; border: 2px solid #e5e7eb; padding: 24px; border-radius: 12px; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <div style="font-size: 2.5rem; margin-bottom: 12px;"> ï¸</div>
                        <h3 style="font-size: 1.3rem; font-weight: 600; margin: 0 0 8px 0; color: #1f2937;">WOC MDHO</h3>
                        <p style="color: #6b7280; font-size: 0.95rem; margin: 0;">Work Order Control - Manutenção</p>
                      </div>
                      
                      <!-- Card Melhorias -->
                      <div class="dashboard-tool-card" onclick="alert('Funcionalidade em desenvolvimento')" style="background: white; border: 2px solid #e5e7eb; padding: 24px; border-radius: 12px; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <div style="font-size: 2.5rem; margin-bottom: 12px;"></div>
                        <h3 style="font-size: 1.3rem; font-weight: 600; margin: 0 0 8px 0; color: #1f2937;">Melhorias</h3>
                        <p style="color: #6b7280; font-size: 0.95rem; margin: 0;">Sistema de sugestões e melhorias</p>
                      </div>
                      
                      <!-- Card Reunião Mensal -->
                      <div class="dashboard-tool-card" onclick="alert('Funcionalidade em desenvolvimento')" style="background: white; border: 2px solid #e5e7eb; padding: 24px; border-radius: 12px; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <div style="font-size: 2.5rem; margin-bottom: 12px;"></div>
                        <h3 style="font-size: 1.3rem; font-weight: 600; margin: 0 0 8px 0; color: #1f2937;">Reunião Mensal</h3>
                        <p style="color: #6b7280; font-size: 0.95rem; margin: 0;">Controle de reuniões mensais HSE</p>
                      </div>
                    </div>
                  </div>
                  
                  <!-- RodapÃ© -->
                  <div style="text-align: center; margin-top: 48px; padding-top: 24px; border-top: 1px solid #e5e7eb;">
                    <p style="color: #9ca3af; font-size: 0.9rem; margin: 0;">
                      Sistema HSE - VersÃ£o 2.0 | Última atualização: ${new Date().toLocaleDateString('pt-BR')}
                    </p>
                  </div>
                </div>
              `;
            }
          }
          
          // Inicializar dashboard ao carregar a pÃ¡gina
          inicializarDashboard();
          
          // ===== FUNÃ‡Ã•ES CHECK LIST FÃCIL =====
          
        // VariÃ¡vel global para armazenar checklists aplicados
        var checklistsAplicadas = [];
        
      // Carregar checklists do servidor e localStorage
      async function carregarChecklists() {
        try {
          // Tentar carregar do servidor primeiro
          const response = await fetch(`${API_BASE_URL}/api/checklists`);
          if (response.ok) {
            const dados = await response.json();
            checklistsAplicadas = dados;
            localStorage.setItem('checklistsAplicadas', JSON.stringify(checklistsAplicadas));
            console.log(' Checklists carregados do servidor:', checklistsAplicadas.length);
          } else {
            throw new Error('Erro ao carregar do servidor');
          }
        } catch(error) {
          console.warn(' ï¸ Falha ao carregar do servidor, usando localStorage:', error);
          // Fallback para localStorage
          var stored = localStorage.getItem('checklistsAplicadas');
          if (stored) {
            checklistsAplicadas = JSON.parse(stored);
          } else {
            checklistsAplicadas = [];
          }
        }
        
        popularFiltros();
        configurarEventListenersFiltros();
        atualizarTabelaChecklists();
      }
      
      // Popular dropdowns de filtros
      function popularFiltros() {
          // Filtro de empresas
          var empresasStored = localStorage.getItem('empresas');
          if (empresasStored) {
            var empresas = JSON.parse(empresasStored);
            var selectEmpresa = document.getElementById('filtro-empresa');
            var htmlEmpresa = '<option value="">Selecione(s)</option>';
            empresas.forEach(function(emp) {
              var nome = emp.nome || emp.Nome || '';
              var cnpj = emp.cnpj || emp.CNPJ || '';
              if (nome) {
                htmlEmpresa += '<option value="' + cnpj + '">' + nome + '</option>';
              }
            });
            selectEmpresa.innerHTML = htmlEmpresa;
          }
          
          // Filtro de tipos (baseado nos tipos cadastrados)
          var tipos = [];
          checklistsAplicadas.forEach(function(c) {
            if (c.tipo && tipos.indexOf(c.tipo) === -1) {
              tipos.push(c.tipo);
            }
          });
          var selectTipo = document.getElementById('filtro-tipo');
          var htmlTipo = '<option value="">Selecione(s)</option>';
          tipos.forEach(function(tipo) {
            htmlTipo += '<option value="' + tipo + '">' + tipo + '</option>';
          });
          selectTipo.innerHTML = htmlTipo;
          
          // Filtro de autores (baseado nos autores cadastrados)
          var autores = [];
          checklistsAplicadas.forEach(function(c) {
            if (c.autor && autores.indexOf(c.autor) === -1) {
              autores.push(c.autor);
            }
          });
          var selectAutor = document.getElementById('filtro-autor');
          var htmlAutor = '<option value="">Selecione(s)</option>';
          autores.forEach(function(autor) {
            htmlAutor += '<option value="' + autor + '">' + autor + '</option>';
          });
          selectAutor.innerHTML = htmlAutor;
        }
        
        // Configurar event listeners dos filtros
        function configurarEventListenersFiltros() {
          document.getElementById('filtro-empresa').addEventListener('change', atualizarTabelaChecklists);
          document.getElementById('filtro-tipo').addEventListener('change', atualizarTabelaChecklists);
          document.getElementById('filtro-autor').addEventListener('change', atualizarTabelaChecklists);
          document.getElementById('filtro-periodo').addEventListener('change', atualizarTabelaChecklists);
          document.getElementById('filtro-periodo-final').addEventListener('change', atualizarTabelaChecklists);
        }        
      // Mostrar modal de anexar formulÃ¡rio
      function mostrarModalNovaChecklist() {
        // PrÃ©-preencher a data atual
        var hoje = new Date().toISOString().split('T')[0];
        document.getElementById('checklist-data').value = hoje;
        document.getElementById('modal-nova-checklist').style.display = 'flex';
        
        // Carregar empresas no dropdown
        carregarEmpresasDropdown();
        
        // Carregar funcionÃ¡rios no dropdown
        carregarFuncionariosDropdown();
        
        // Event listener para upload de PDF
        document.getElementById('checklist-pdf').addEventListener('change', procesarPDFYExtraerDatos);
        
        // Event listener para autor para preencher setor automaticamente
        document.getElementById('checklist-autor').addEventListener('change', preencherSetorAutomaticamente);
      }      // Carregar empresas no dropdown
    function carregarEmpresasDropdown() {
      var empresasStored = localStorage.getItem('empresas');
      if (empresasStored) {
        var empresas = JSON.parse(empresasStored);
        var select = document.getElementById('checklist-empresa');
        var html = '<option value="">Selecione a empresa</option>';
        empresas.forEach(function(emp) {
          var cnpj = emp.cnpj || emp.CNPJ || '';
          var nome = emp.nome || emp.Nome || '';
          if (nome) {
            html += '<option value="' + cnpj + '">' + nome + '</option>';
          }
        });
        select.innerHTML = html;
      }
    }      // Carregar funcionÃ¡rios no dropdown
      function carregarFuncionariosDropdown() {
        var funcionariosStored = localStorage.getItem('funcionarios');
        if (funcionariosStored) {
          var funcionarios = JSON.parse(funcionariosStored);
          var select = document.getElementById('checklist-autor');
          var html = '<option value="">Selecione o funcionÃ¡rio</option>';
          funcionarios.forEach(function(func) {
            var nome = func.Nome || func.nome || '';
            var setor = func.Setor || func.setor || '';
            if (nome) {
              html += '<option value="' + nome + '" data-setor="' + setor + '">' + nome + '</option>';
            }
          });
          select.innerHTML = html;
        }
      }        // Processar PDF e salvar para visualizaÃ§Ã£o
        var pdfAnexado = null;
        
        function procesarPDFYExtraerDatos(event) {
          var file = event.target.files[0];
          if (!file) {
            pdfAnexado = null;
            return;
          }
          
          document.getElementById('pdf-status').style.display = 'block';
          document.getElementById('pdf-status').innerHTML = ' Carregando PDF...';
          
          // Salvar PDF como base64 para visualizaÃ§Ã£o posterior
          var reader = new FileReader();
          reader.onload = function(e) {
            pdfAnexado = e.target.result;
            document.getElementById('pdf-status').innerHTML = ' PDF anexado com sucesso';
            document.getElementById('pdf-status').style.color = '#059669';
          };
          reader.readAsDataURL(file);
        }
        
        // Extrair dados do texto do PDF
        function extrairDadosDoTexto(texto) {
          var dados = {
            autor: '',
            data: '',
            tipo: '',
            setor: ''
          };
          
          // Limpar texto para melhor processamento
          texto = texto.replace(/\0/g, '');
          
          // Padrão para nome do líder/autor (específico para ChecklistFácil)
          var nomeMatch = texto.match(/(?:Nome do Líder|Nome do User|Autor|Nome|Participante|Colaborador)[\s:\n]*([A-Za-záàâãéèêíïóôõöúçñ\s]{3,})/i);
          if (nomeMatch && nomeMatch[1]) {
            dados.autor = nomeMatch[1].trim().split('\n')[0].substring(0, 100);
          }
          
          // Padrão para data de participação (específico para ChecklistFácil)
          var dataPartMatch = texto.match(/(?:Data da Participação da CPT|Data da Participação|Data)[\s:\n]*(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{4})/i);
          if (dataPartMatch) {
            var dia = dataPartMatch[1].padStart(2, '0');
            var mes = dataPartMatch[2].padStart(2, '0');
            var ano = dataPartMatch[3];
            dados.data = ano + '-' + mes + '-' + dia;
          } else {
            // Padrão genérico para data (DD/MM/YYYY ou DD-MM-YYYY)
            var dataMatch = texto.match(/(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{4})/);
            if (dataMatch) {
              var dia = dataMatch[1].padStart(2, '0');
              var mes = dataMatch[2].padStart(2, '0');
              var ano = dataMatch[3];
              dados.data = ano + '-' + mes + '-' + dia;
            }
          }
          
          // Padrão para tipo (procura por palavras-chave com prioridade)
          if (texto.match(/Participação da CPT|participação\s+da\s+cpt/i)) {
            dados.tipo = 'Participação CPT';
          } else if (texto.match(/CPT/i)) {
            dados.tipo = 'Participação CPT';
          } else if (texto.match(/Participação da RAS|participação\s+na\s+ras/i)) {
            dados.tipo = 'Participação RAS';
          } else if (texto.match(/RAS|reunião/i)) {
            dados.tipo = 'Participação RAS';
          } else if (texto.match(/inspeção|vistoria/i)) {
            dados.tipo = 'Inspeção';
          } else if (texto.match(/auditoria/i)) {
            dados.tipo = 'Auditoria';
          } else if (texto.match(/checklist|verificação/i)) {
            dados.tipo = 'Checklist Diária';
          }
          
          return dados;
        }
        
        // Mostrar informações extraídas
        function mostrarInformacoesExtraidas(dados) {
          var infoDiv = document.getElementById('info-extraida');
          var detalhesDiv = document.getElementById('detalhes-extraidos');
          
          var html = '';
          if (dados.autor) html += '<div> <strong>Autor:</strong> ' + dados.autor + '</div>';
          if (dados.data) html += '<div> <strong>Data:</strong> ' + new Date(dados.data).toLocaleDateString('pt-BR') + '</div>';
          if (dados.tipo) html += '<div> <strong>Tipo:</strong> ' + dados.tipo + '</div>';
          
          if (html) {
            detalhesDiv.innerHTML = html;
            infoDiv.style.display = 'block';
          }
        }
        
      // Preencher setor automaticamente baseado no nome do funcionário selecionado
      function preencherSetorAutomaticamente() {
        var selectAutor = document.getElementById('checklist-autor');
        var setorInput = document.getElementById('checklist-setor');
        
        // Pegar o setor do option selecionado
        var selectedOption = selectAutor.options[selectAutor.selectedIndex];
        if (selectedOption && selectedOption.dataset.setor) {
          setorInput.value = selectedOption.dataset.setor;
        } else {
          setorInput.value = '';
        }
      }        // Fechar modal
        function fecharModalNovaChecklist() {
          document.getElementById('modal-nova-checklist').style.display = 'none';
          document.getElementById('form-nova-checklist').reset();
          document.getElementById('pdf-status').style.display = 'none';
          document.getElementById('info-extraida').style.display = 'none';
          pdfAnexado = null;
        }
        
        // Salvar nova checklist aplicada
        function salvarNovaChecklist(event) {
          event.preventDefault();
          
          var empresa = document.getElementById('checklist-empresa').value.trim();
          var tipo = document.getElementById('checklist-tipo').value.trim();
          var autor = document.getElementById('checklist-autor').value.trim();
          var setor = document.getElementById('checklist-setor').value.trim();
          var data = document.getElementById('checklist-data').value;
          var fotosInput = document.getElementById('checklist-foto-manual');
          
          if (!empresa || !tipo || !autor || !setor || !data) {
            alert('Por favor, preencha todos os campos obrigatÃ³rios');
            return;
          }
          
          // Calcular semana
          var dataObj = new Date(data + 'T00:00:00');
          var primeiroDia = new Date(dataObj.getFullYear(), dataObj.getMonth(), 1);
          var semana = Math.ceil((dataObj.getDate() + primeiroDia.getDay()) / 7);
          
          // Se houver fotos, processar
          if (fotosInput.files.length > 0) {
            var fotosParaCarregar = [];
            var arquivosProcessados = 0;
            
            for (var i = 0; i < fotosInput.files.length; i++) {
              var file = fotosInput.files[i];
              if (file.size > 5 * 1024 * 1024) {
                alert('Arquivo ' + file.name + ' muito grande. MÃ¡ximo 5MB');
                return;
              }
              
              var reader = new FileReader();
              reader.onload = (function(f) {
                return function(e) {
                  fotosParaCarregar.push(e.target.result);
                  arquivosProcessados++;
                  
                  if (arquivosProcessados === fotosInput.files.length) {
                    salvarChecklistComFotos(empresa, tipo, autor, setor, data, semana, fotosParaCarregar);
                  }
                };
              })(file);
              reader.readAsDataURL(file);
            }
          } else {
            salvarChecklistComFotos(empresa, tipo, autor, setor, data, semana, []);
          }
        }
        
      // Salvar checklist com fotos e PDF
    function salvarChecklistComFotos(empresa, tipo, autor, setor, data, semana, fotos) {
      console.log('Salvando checklist - Data recebida:', data, 'Semana:', semana);
      
      var novaChecklist = {
        id: Math.random().toString(36).substr(2, 9),
        empresa: empresa,
        tipo: tipo,
        autor: autor,
        setor: setor,
        data: data,
        semana: semana,
        fotos: fotos,
        pdf: pdfAnexado,
        dataCriacao: new Date().toLocaleString('pt-BR')
      };
      
      console.log('Checklist criado:', novaChecklist);
      
      checklistsAplicadas.push(novaChecklist);
      localStorage.setItem('checklistsAplicadas', JSON.stringify(checklistsAplicadas));
      
      // Sincronizar com servidor
      if (API_BASE_URL) {
        fetch(API_BASE_URL + '/api/checklists', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(novaChecklist)
        })
        .then(function(response) {
          console.log('Checklist enviado para servidor:', response.status);
        })
        .catch(function(error) {
          console.log('Erro ao sincronizar com servidor:', error);
          // Continua funcionando mesmo se falhar
        });
      }
      
      fecharModalNovaChecklist();
      popularFiltros();
      atualizarTabelaChecklists();
      alert('Checklist anexada com sucesso!');
      }        // Atualizar tabela de checklists
        function atualizarTabelaChecklists() {
          var container = document.getElementById('corpo-tabela-checklists');
          
          if (checklistsAplicadas.length === 0) {
            container.innerHTML = '<div style="padding:40px 20px;text-align:center;color:#9ca3af;grid-column:1/-1"><div style="font-size:2.5rem;margin-bottom:12px;opacity:0.5"></div><div style="font-size:1rem;font-weight:500;margin-bottom:6px">Nenhum checklist aplicado ainda</div><div style="font-size:0.9rem">Clique em "Anexar formulário" para começar</div></div>';
            return;
          }
          
          // Aplicar filtros
          var filtroEmpresa = document.getElementById('filtro-empresa').value;
          var filtroTipo = document.getElementById('filtro-tipo').value;
          var filtroAutor = document.getElementById('filtro-autor').value;
          var filtroPeriodo = document.getElementById('filtro-periodo').value;
          var filtroPeriodoFinal = document.getElementById('filtro-periodo-final').value;
          
          var checklistsFiltradas = checklistsAplicadas.filter(function(checklist) {
            // Filtro por empresa
            if (filtroEmpresa && checklist.empresa !== filtroEmpresa) return false;
            
            // Filtro por tipo
            if (filtroTipo && checklist.tipo !== filtroTipo) return false;
            
            // Filtro por autor
            if (filtroAutor && checklist.autor !== filtroAutor) return false;
            
            // Filtro por perÃ­odo inicial
            if (filtroPeriodo && checklist.data < filtroPeriodo) return false;
            
            // Filtro por perÃ­odo final
            if (filtroPeriodoFinal && checklist.data > filtroPeriodoFinal) return false;
            
            return true;
          });
          
          if (checklistsFiltradas.length === 0) {
            container.innerHTML = '<div style="padding:40px 20px;text-align:center;color:#9ca3af;grid-column:1/-1"><div style="font-size:2.5rem;margin-bottom:12px;opacity:0.5"></div><div style="font-size:1rem;font-weight:500;margin-bottom:6px">Nenhum checklist encontrado</div><div style="font-size:0.9rem">Tente ajustar os filtros</div></div>';
            return;
          }
          
        var html = '';
        checklistsFiltradas.forEach(function(checklist) {
          var dataFormatada = new Date(checklist.data + 'T00:00:00').toLocaleDateString('pt-BR');
          
          html += '<div style="display:grid;grid-template-columns:100px 80px 180px 220px 120px 80px 150px;gap:16px;padding:16px;border-bottom:1px solid #e5e7eb;font-size:0.9rem;align-items:center">';
          html += '<div>' + dataFormatada + '</div>';
          html += '<div><span style="background:#e0f2fe;color:#0369a1;padding:4px 8px;border-radius:4px;font-weight:500">Semana ' + checklist.semana + '</span></div>';
          html += '<div style="color:#374151">' + checklist.tipo + '</div>';
          html += '<div style="color:#374151">' + checklist.autor + '</div>';
          html += '<div style="color:#6b7280">' + checklist.setor + '</div>';
          html += '<div>';
          if (checklist.fotos && checklist.fotos.length > 0) {
            html += '<span style="color:#10b981;font-size:0.85rem"> ' + checklist.fotos.length + '</span>';
          } else {
            html += '<span style="color:#d1d5db">-</span>';
          }
          html += '</div>';
          html += '<div style="display:flex;gap:8px">';
          if (checklist.pdf) {
            html += '<button onclick="abrirPDFChecklist(\'' + checklist.id + '\')" style="background:#3b82f6;color:#fff;padding:6px 12px;border:none;border-radius:4px;cursor:pointer;font-size:0.8rem" title="Visualizar PDF"> PDF</button>';
          }
          if (checklist.fotos && checklist.fotos.length > 0) {
            html += '<button onclick="abrirFotosChecklist(\'' + checklist.id + '\')" style="background:#10b981;color:#fff;padding:6px 12px;border:none;border-radius:4px;cursor:pointer;font-size:0.8rem" title="Visualizar fotos"></button>';
          }
          html += '<button onclick="excluirChecklist(\'' + checklist.id + '\')" style="background:#ef4444;color:#fff;padding:6px 12px;border:none;border-radius:4px;cursor:pointer;font-size:0.8rem" title="Excluir"></button>';
          html += '</div>';
          html += '</div>';
        });
        
        container.innerHTML = html;
      }      // Abrir PDF de checklist
      function abrirPDFChecklist(id) {
        var checklist = checklistsAplicadas.find(function(c) { return c.id == id; });
        if (checklist && checklist.pdf) {
          var win = window.open();
          win.document.write('<iframe src="' + checklist.pdf + '" frameborder="0" style="width:100%;height:100%"></iframe>');
        }
      }
      
      // Abrir fotos de checklist
      function abrirFotosChecklist(id) {
        var checklist = checklistsAplicadas.find(function(c) { return c.id == id; });
        if (checklist && checklist.fotos && checklist.fotos.length > 0) {
          var win = window.open('', '_blank', 'width=800,height=600');
          win.document.write('<html><head><title>Fotos - ' + checklist.autor + '</title></head><body style="margin:0;padding:20px;background:#000;display:flex;flex-wrap:wrap;gap:10px;justify-content:center">');
          checklist.fotos.forEach(function(foto) {
            win.document.write('<img src="' + foto + '" style="max-width:100%;height:auto;border:2px solid #fff">');
          });
          win.document.write('</body></html>');
        }
      }
      
      // Matriz de Ferramentas
      function abrirMatrizFerramentas() {
        // Dados padrÃ£o das matrizes (editÃ¡veis)
        var matrizMensal = {
          'PARTICIPAÃ‡ÃƒO NA RAS': [1, 8, 15, 15, 15],
          'PARTICIPAÃ‡ÃƒO NA CPT': [1, 4, 10, 15, 4],
          'WOC MDHO': [2, 8, 12, 8, 4],
          'INSPEÃ‡ÃƒO DE SEGURANÃ‡A': [1, 4, 8, 4, 0],
          'REUNIÃƒO MENSAL DE HSE ALBRAS': [1, 1, 1, 1, 0],
          'REUNIÃƒO SEMANAL DE CONTRATADAS COM O HSE CAPEX': [0, 0, 4, 0, 0],
          'REUNIÃƒO DA CIPA INTEGRADA / CONSTITUÃDA': [0, 0, 0, 0, 1]
        };

        var matrizSemanal = {
          'PARTICIPAÃ‡ÃƒO NA RAS': [1, 2, 4, 4, 4],
          'PARTICIPAÃ‡ÃƒO NA CPT': [1, 1, 3, 4, 1],
          'WOC MDHO': [1, 2, 3, 2, 1],
          'INSPEÃ‡ÃƒO DE SEGURANÃ‡A': [1, 1, 2, 1, 0],
          'REUNIÃƒO MENSAL DE HSE ALBRAS': [1, 1, 1, 1, 0],
          'REUNIÃƒO SEMANAL DE CONTRATADAS COM O HSE CAPEX': [0, 0, 1, 0, 0],
          'REUNIÃƒO DA CIPA INTEGRADA / CONSTITUÃDA': [0, 0, 0, 0, 1]
        };

        var colunas = ['GERENTE', 'ENGENHEIRO', 'HSE', 'ENCARREGADO', 'CIPA'];

        // Gerar HTML
        var html = '<html><head><meta charset="UTF-8"><title>Matriz de Ferramentas HSE</title>';
        html += '<style>';
        html += 'body{font-family:Arial,sans-serif;margin:20px;background:#f0f2f5}';
        html += '.container{max-width:1600px;margin:0 auto}';
        html += '.header{background:linear-gradient(135deg,#0d9488 0%,#059669 100%);color:#fff;padding:20px;border-radius:8px;margin-bottom:20px;text-align:center}';
        html += '.header h1{margin:0;font-size:2rem}';
        html += '.matriz-wrapper{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px}';
        html += '.matriz-card{background:#fff;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.1);padding:20px;overflow-x:auto}';
        html += '.matriz-titulo{background:#1e40af;color:#fff;padding:15px;text-align:center;font-size:1.3rem;font-weight:bold;border-radius:4px;margin-bottom:15px}';
        html += '.btn-group{text-align:center;margin-bottom:20px}';
        html += '.btn-salvar{background:#1e40af;color:#fff;padding:12px 30px;border:none;border-radius:4px;cursor:pointer;font-weight:bold;font-size:1rem;margin:5px}';
        html += '.btn-salvar:hover{background:#1e3a8a}';
        html += 'table{width:100%;border-collapse:collapse;margin-top:10px}';
        html += 'th,td{border:1px solid #ccc;padding:10px;text-align:center}';
        html += 'th{background:#1e40af;color:#fff;font-weight:bold}';
        html += 'th.tipo-col{background:#1e40af;color:#fff;text-align:left;padding-left:15px}';
        html += 'th.meta-header{background:#6b9ef5;color:#fff;font-size:0.9rem}';
        html += 'td:first-child{text-align:left;font-weight:bold;background:#f8f9fa;padding-left:15px}';
        html += 'input[type="number"]{width:50px;padding:6px;border:1px solid #d1d5db;border-radius:4px;text-align:center;font-weight:bold;font-size:0.95rem}';
        html += 'input[type="number"]:focus{outline:2px solid #1e40af;background:#fffbeb}';
        html += '@media print{.btn-group{display:none}}';
        html += '@media (max-width:1200px){.matriz-wrapper{grid-template-columns:1fr}}';
        html += '</style></head><body>';

        html += '<div class="container">';
        html += '<div class="header"><h1> Matriz de Ferramentas HSE</h1><p>ConfiguraÃ§Ã£o de Metas por FunÃ§Ã£o e PerÃ­odo</p></div>';

        html += '<div class="btn-group">';
        html += '<button class="btn-salvar" onclick="window.print()"> Imprimir</button>';
        html += '</div>';

        html += '<div class="matriz-wrapper">';

        // Matriz Mensal
        html += '<div class="matriz-card">';
        html += '<div class="matriz-titulo">Matriz Mensal</div>';
        html += '<table>';
        html += '<thead>';
        html += '<tr><th class="tipo-col">TIPO</th>';
        colunas.forEach(function(col) {
          html += '<th>' + col + '</th>';
        });
        html += '</tr>';
        html += '<tr><th class="tipo-col"></th>';
        for(var i = 0; i < 5; i++) {
          html += '<th class="meta-header">META</th>';
        }
        html += '</tr>';
        html += '</thead><tbody>';

        Object.keys(matrizMensal).forEach(function(tipo) {
          html += '<tr><td>' + tipo + '</td>';
          matrizMensal[tipo].forEach(function(valor, index) {
            html += '<td><input type="number" value="' + valor + '" onchange="this.style.backgroundColor=\'#90EE90\'" /></td>';
          });
          html += '</tr>';
        });

        html += '</tbody>';
        html += '</table>';
        html += '</div>';

        // Matriz Semanal
        html += '<div class="matriz-card">';
        html += '<div class="matriz-titulo">Matriz Semanal</div>';
        html += '<table>';
        html += '<thead>';
        html += '<tr><th class="tipo-col">TIPO</th>';
        colunas.forEach(function(col) {
          html += '<th>' + col + '</th>';
        });
        html += '</tr>';
        html += '<tr><th class="tipo-col"></th>';
        for(var i = 0; i < 5; i++) {
          html += '<th class="meta-header">META</th>';
        }
        html += '</tr>';
        html += '</thead><tbody>';

        Object.keys(matrizSemanal).forEach(function(tipo) {
          html += '<tr><td>' + tipo + '</td>';
          matrizSemanal[tipo].forEach(function(valor, index) {
            html += '<td><input type="number" value="' + valor + '" onchange="this.style.backgroundColor=\'#90EE90\'" /></td>';
          });
          html += '</tr>';
        });

        html += '</tbody>';
        html += '</table>';
        html += '</div>';

        html += '</div>';
        html += '</div>';
        html += '</body></html>';

        var novaJanela = window.open('', 'MatrizFerramentas', 'width=1600,height=800');
        novaJanela.document.write(html);
        novaJanela.document.close();
      }
      
      // Acompanhamento Semanal
      function abrirAcompanhamentoSemanal() {
        if (!checklistsAplicadas || checklistsAplicadas.length === 0) {
          alert('Nenhuma checklist registrada para acompanhamento.');
          return;
        }
        
        // Estrutura: {nome_setor_semana_mes_ano: {nome, setor, semana, mes, ano, tipos: {tipo: {meta, realizado, aderencia}}}}
        var registrosMap = {};
        var allTipos = new Set();
        
        checklistsAplicadas.forEach(function(checklist) {
          var tipo = checklist.tipo || 'Não informado';
          var nome = checklist.autor || 'Não informado';
          var setor = checklist.setor || 'Não informado';
          var semana = checklist.semana || 'Sem semana';
          
          // Extrair mês e ano da data
          var data = new Date(checklist.data + 'T00:00:00');
          var mes = String(data.getMonth() + 1).padStart(2, '0');
          var ano = data.getFullYear();
          
          // Chave unica
          var chave = nome + '|' + setor + '|' + semana + '|' + mes + '|' + ano;
          
          if (!registrosMap[chave]) {
            registrosMap[chave] = {
              nome: nome,
              setor: setor,
              semana: semana,
              mes: mes,
              ano: ano,
              tipos: {}
            };
          }
          
          if (!registrosMap[chave].tipos[tipo]) {
            registrosMap[chave].tipos[tipo] = {
              meta: 0,
              realizado: 0,
              aderencia: 0
            };
          }
          
          // Incrementar realizado (somar duplicaÃ§Ãµes)
          registrosMap[chave].tipos[tipo].realizado++;
          allTipos.add(tipo);
          
          // Calcular aderÃªncia automaticamente
          var meta = registrosMap[chave].tipos[tipo].meta || 1;
          registrosMap[chave].tipos[tipo].aderencia = Math.round((registrosMap[chave].tipos[tipo].realizado / meta) * 100);
        });
        
        var tiposArray = Array.from(allTipos).sort();
        var registros = Object.values(registrosMap);
        
        // Ordenar por ano, mÃªs, semana descendente
        registros.sort(function(a, b) {
          var aKey = a.ano + a.mes + String(a.semana).padStart(2, '0');
          var bKey = b.ano + b.mes + String(b.semana).padStart(2, '0');
          return bKey.localeCompare(aKey);
        });
        
        // Gerar relatÃ³rio em nova janela
        var relatorio = '<html><head><meta charset="UTF-8"><title>Acompanhamento Semanal</title>';
        relatorio += '<style>';
        relatorio += 'body{font-family:Arial,sans-serif;margin:15px;background:#f5f5f5;overflow-x:auto}';
        relatorio += '.header{background:linear-gradient(135deg,#0d9488 0%,#059669 100%);color:#fff;padding:20px;border-radius:8px;margin-bottom:20px;text-align:center}';
        relatorio += '.header h1{margin:0;font-size:2rem}';
        relatorio += '.header p{margin:5px 0 0 0;opacity:0.9}';
        relatorio += '.table-wrapper{background:#fff;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,0.1);padding:20px;overflow-x:auto}';
        relatorio += 'table{width:100%;border-collapse:collapse;font-size:0.85rem;margin-bottom:20px}';
        relatorio += 'th{background:#e5e7eb;color:#1f2937;padding:10px 8px;text-align:center;border:1px solid #d1d5db;font-weight:bold;white-space:nowrap}';
        relatorio += 'td{padding:8px;border:1px solid #d1d5db;text-align:center}';
        relatorio += 'td:first-child, td:nth-child(2){text-align:left;font-weight:500}';
        relatorio += 'tr:nth-child(even){background:#f9fafb}';
        relatorio += '.header-group{background:#d1d5db;font-weight:bold;text-align:center;padding:10px}';
        relatorio += '.meta-cell{background:#fff3cd}';
        relatorio += '.realizado-cell{background:#cfe2ff}';
        relatorio += '.aderencia-100{background:#d1e7dd;color:#0d3b66;font-weight:bold}';
        relatorio += '.aderencia-80{background:#fff3cd;color:#856404;font-weight:bold}';
        relatorio += '.aderencia-0{background:#f8d7da;color:#721c24;font-weight:bold}';
        relatorio += '.meta-input{width:45px;padding:4px;border:1px solid #d1d5db;border-radius:4px;text-align:center;font-weight:bold}';
        relatorio += '.print-btn{background:#0d9488;color:#fff;padding:12px 24px;border:none;border-radius:4px;cursor:pointer;font-weight:bold;margin:20px auto;display:block}';
        relatorio += '.print-btn:hover{background:#059669}';
        relatorio += '.info-text{text-align:center;color:#666;font-size:0.9rem;margin-top:20px}';
        relatorio += '@media print{.print-btn{display:none};.meta-input{border:none;background:transparent;width:auto}}';
        relatorio += '</style></head><body>';
        
        relatorio += '<div class="header"><h1> Acompanhamento Semanal de Checklists</h1><p>Relatório de Conformidade - Metas e Aderência</p></div>';
        
        relatorio += '<div class="table-wrapper">';
        relatorio += '<table>';
        
        // Header da tabela
        relatorio += '<thead>';
        relatorio += '<tr>';
        relatorio += '<th>Nome</th>';
        relatorio += '<th>Setor</th>';
        relatorio += '<th>Semana</th>';
        relatorio += '<th>MÃªs</th>';
        relatorio += '<th>Ano</th>';
        
        tiposArray.forEach(function(tipo) {
          relatorio += '<th colspan="3" style="text-align:center">' + tipo + '</th>';
        });
        
        relatorio += '</tr>';
        
        // Sub-header (Meta, Realizado, Aderência)
        relatorio += '<tr>';
        relatorio += '<th colspan="5"></th>';
        
        tiposArray.forEach(function(tipo) {
          relatorio += '<th style="background:#ffd700;color:#000">Meta</th>';
          relatorio += '<th style="background:#87ceeb;color:#000">Realizado</th>';
          relatorio += '<th style="background:#90ee90;color:#000">Aderência</th>';
        });
        
        relatorio += '</tr>';
        relatorio += '</thead>';
        
        // Body da tabela
        relatorio += '<tbody>';
        
        registros.forEach(function(registro) {
          relatorio += '<tr>';
          relatorio += '<td><strong>' + registro.nome + '</strong></td>';
          relatorio += '<td>' + registro.setor + '</td>';
          relatorio += '<td style="text-align:center">' + registro.semana + '</td>';
          relatorio += '<td style="text-align:center">' + registro.mes + '</td>';
          relatorio += '<td style="text-align:center">' + registro.ano + '</td>';
          
          tiposArray.forEach(function(tipo) {
            var dados = registro.tipos[tipo];
            
            if (dados) {
              var aderenciaClass = dados.aderencia >= 100 ? 'aderencia-100' : 
                                  (dados.aderencia >= 80 ? 'aderencia-80' : 'aderencia-0');
              
              relatorio += '<td class="meta-cell"><input type="number" class="meta-input" value="' + dados.meta + '" min="0" data-chave="' + registro.nome + '|' + tipo + '" onchange="this.style.backgroundColor=\'#90EE90\'" /></td>';
              relatorio += '<td class="realizado-cell"><strong>' + dados.realizado + '</strong></td>';
              relatorio += '<td class="' + aderenciaClass + '">' + dados.aderencia + '%</td>';
            } else {
              relatorio += '<td class="meta-cell"><input type="number" class="meta-input" value="0" min="0" /></td>';
              relatorio += '<td class="realizado-cell">0</td>';
              relatorio += '<td class="aderencia-0">0%</td>';
            }
          });
          
          relatorio += '</tr>';
        });
        
        relatorio += '</tbody>';
        relatorio += '</table>';
        relatorio += '</div>';
        
        relatorio += '<button class="print-btn" onclick="window.print()">Imprimir Relatorio</button>';
        relatorio += '<div class="info-text"><strong>Legenda:</strong> Meta (amarelo) | Realizado (azul) | Aderencia (verde/laranja/vermelho)<br/>Edite as metas diretamente. Aderencia e calculada automaticamente: (Realizado / Meta) * 100%</div>';
        relatorio += '</body></html>';
        
        var novaJanela = window.open('', 'AcompanhamentoSemanal', 'width=1600,height=800');
        novaJanela.document.write(relatorio);
        novaJanela.document.close();
      }          // Inicializar checklists ao carregar
          carregarChecklists();
          </script>








